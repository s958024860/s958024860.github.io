/*! cn.tee3.avd-3.6.0.0 2019-09-11 07:10:36 */

var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function base64encode(e){var t,r,n,o,i,s;for(n=e.length,r=0,t="";r<n;){if(o=255&e.charCodeAt(r++),r==n){t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4),t+="==";break}if(i=e.charCodeAt(r++),r==n){t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4|(240&i)>>4),t+=base64EncodeChars.charAt((15&i)<<2),t+="=";break}s=e.charCodeAt(r++),t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4|(240&i)>>4),t+=base64EncodeChars.charAt((15&i)<<2|(192&s)>>6),t+=base64EncodeChars.charAt(63&s)}return t}function base64decode(e){var t,r,n,o,i,s,a;for(s=e.length,i=0,a="";i<s;){for(;t=base64DecodeChars[255&e.charCodeAt(i++)],i<s&&-1==t;);if(-1==t)break;for(;r=base64DecodeChars[255&e.charCodeAt(i++)],i<s&&-1==r;);if(-1==r)break;a+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(i++)))return a;n=base64DecodeChars[n]}while(i<s&&-1==n);if(-1==n)break;a+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(o=255&e.charCodeAt(i++)))return a;o=base64DecodeChars[o]}while(i<s&&-1==o);if(-1==o)break;a+=String.fromCharCode((3&n)<<6|o)}return a}function utf16to8(e){var t,r,n,o;for(t="",n=e.length,r=0;r<n;r++)1<=(o=e.charCodeAt(r))&&o<=127?t+=e.charAt(r):(2047<o?(t+=String.fromCharCode(224|o>>12&15),t+=String.fromCharCode(128|o>>6&63)):t+=String.fromCharCode(192|o>>6&31),t+=String.fromCharCode(128|o>>0&63));return t}function utf8to16(e){var t,r,n,o,i,s;for(t="",n=e.length,r=0;r<n;)switch((o=e.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(r-1);break;case 12:case 13:i=e.charCodeAt(r++),t+=String.fromCharCode((31&o)<<6|63&i);break;case 14:i=e.charCodeAt(r++),s=e.charCodeAt(r++),t+=String.fromCharCode((15&o)<<12|(63&i)<<6|(63&s)<<0)}return t}function doit(){var e=document.f;e.output.value=base64encode(utf16to8(e.source.value)),e.decode.value=utf8to16(base64decode(e.output.value))}function SdpSerializer(e){for(var d={},o=[],t=!1,r=!1,n=!1,i=!1,s=e.split("\r\n"),a=0;a<s.length;a++){var c=s[a];t||0==c.indexOf("m=audio")?(t=!0,l("audio"),(c=s[a+1])&&0==c.indexOf("m=video")&&(i=t=!1)):r||0==c.indexOf("m=video")?(r=!0,l("video"),(c=s[a+1])&&0==c.indexOf("m=application")&&(i=r=!1)):n||0==c.indexOf("m=application")?(n=!0,l("data")):o.push(c)}function l(t){if(d[t])if(c=="a=mid:"+t){var e=s[a-1];e&&(d[t].direction=e.split("a=")[1],d[t].attributes.pop(1)),i=!0,d[t]["a=mid:"+t]={line:c,attributes:[]}}else if(i)if(0==c.indexOf("a=crypto:"))d[t].crypto[c.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=c;else if(0==c.indexOf("a=rtpmap:")){var r=c.split("a=rtpmap:")[1].split(" ");d[t].payload[r[0]]=r[1],function e(){(c=s[a+1])&&-1==c.indexOf("a=rtpmap:")&&-1==c.indexOf("m=")&&(-1==c.indexOf("a=ssrc")&&(d[t].payload[r[0]]+="\r\n"+c),-1!=c.indexOf("a=ssrc")&&d[t].ssrc.push(c),a++,e())}()}else d[t]["a=mid:"+t].attributes.push(c);else d[t].attributes.push(c);else if(d[t]={line:c,attributes:[],payload:{},ssrc:[],crypto:{}},-1!=c.indexOf("RTP/SAVPF"))for(var n=c.split("RTP/SAVPF ")[1].split(" "),o=0;o<n.length;o++)d[t].payload[n[o]]=""}function u(e){if(d[e]){for(var t=[],r="",n=0;n<d[e].ssrc.length;n++){var o=d[e].ssrc[n];""==r?r=o:r+="\r\n"+o,-1!=o.indexOf("cname:")&&t.push([]),0<t.length&&t[t.length-1].push(o)}d[e].ssrc=t,d[e].ssrcStr=r}}function p(e,t){if(!d[t])return e;e+=d[t].line+"\r\n";for(var r=0;r<d[t].attributes.length;r++)e+=d[t].attributes[r]+"\r\n";d[t].direction&&(e+="a="+d[t].direction+"\r\n"),e+="a=mid:"+t+"\r\n";for(r=0;r<d[t]["a=mid:"+t].attributes.length;r++)d[t]["a=mid:"+t].attributes[r]&&(e+=d[t]["a=mid:"+t].attributes[r]+"\r\n");for(var n in d[t].crypto)e+=d[t].crypto[n]+"\r\n";if(-1!=d[t].line.indexOf("RTP/SAVPF"))for(var o=d[t].line.split("RTP/SAVPF ")[1].split(" "),i=0;i<o.length;i++){var s=o[i];s&&(e+="a=rtpmap:"+s+" "+d[t].payload[s]+"\r\n")}for(var a=0;a<d[t].ssrc.length;a++)for(var c=d[t].ssrc[a],l=0;l<c.length;l++)e+=c[l]+"\r\n";return e}function f(r){return{mLine:r,payload:function(e){return d[this.mLine]&&d[this.mLine].payload[e]||log.error(e,"doesn'nt exits."),{payload:e,mLine:this.mLine,newLine:function(e){d[this.mLine].payload[this.payload]+="\r\n"+e},remove:function(){!function(e,t){if(d[t]&&-1!=d[t].line.indexOf(e)&&(d[t].payload[e]&&delete d[t].payload[e],-1!=d[t].line.indexOf("RTP/SAVPF"))){for(var r=d[t].line.split("RTP/SAVPF ")[1].split(" "),n=0;n<r.length;n++)r[n]==e&&delete r[n];r=swap(r),d[t].line=d[t].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+r.join(" ")}}(this.payload,this.mLine)},order:function(e){!function(e,t,r){if(d[r]&&-1!=d[r].line.indexOf(e)&&-1!=d[r].line.indexOf("RTP/SAVPF")){for(var n=d[r].line.split("RTP/SAVPF ")[1].split(" "),o=[],i=0;i<n.length;i++)n[i]==e&&(o[t]=n[i],delete n[i]);for(i=0;i<n.length;i++)i<t&&(o[i]=n[i]),t<=i&&(o[i+1]=n[i]);o=swap(o),d[r].line=d[r].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+o.join(" ")}}(this.payload,e,this.mLine)}}},remove:function(){!function(e){d[e]&&delete d[e];for(var t=0;t<o.length;t++)if(-1!=o[t].indexOf("a=group")){var r=o[t].split("a=group:BUNDLE ")[1].split(" ");o[t]="a=group:BUNDLE";for(var n=0;n<r.length;n++)r[n]!=e&&(o[t]+=" "+r[n])}}(this.mLine)},isRejected:function(){var e=d[this.mLine].line.split("m="+this.mLine)[1];return 0==parseInt(e)},crypto:function(e){var t=d[this.mLine].crypto[e];return{mLine:this.mLine,remove:function(){t&&delete d[this.mLine].crypto[e]},newLine:function(e){d[this.mLine].crypto[e.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=e}}},track:function(t){var e=d[r].ssrc[t];return{ssrc:e,set:function(e){d[this.mLine].ssrc[t]=e},mLine:this.mLine,remove:function(){e&&(delete d[r].ssrc[t],d[r].ssrc=swap(d[r].ssrc))}}}}}u("audio"),u("video"),u("data"),this.deserialize=function(){for(var e="",t=0;t<o.length;t++)e+=o[t]+"\r\n";return e=p(e=p(e=p(e,"audio"),"video"),"data")},this.audio=f("audio"),this.video=f("video"),this.data=f("data"),this._inner=d}function swap(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t}function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}function debugout(){var a=this;if(a.realTimeLoggingOn=!0,a.useTimestamps=!1,a.useLocalStorage=!1,a.recordLogs=!0,a.autoTrim=!0,a.maxLines=5e4,a.tailNumLines=100,a.logFilename="debugout.txt",a.maxDepth=25,a.depth=0,a.parentSizes=[0],a.currentResult="",a.startTime=new Date,a.output="",a.logLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},this.version=function(){return"0.5.0"},this.getLog=function(){var e=new Date;if(a.recordLogs||a.log("[debugout.js] log recording is off."),a.useLocalStorage){var t=window.localStorage.getItem("debugout.js");t&&(t=JSON.parse(t),a.startTime=new Date(t.startTime),a.output=t.log,e=new Date(t.lastLog))}return a.output+"\n---- Log retrieved: "+e+" ----\n"+a.formatSessionDuration(a.startTime,e)},this.tail=function(e){e=e||a.tailLines;return a.trimLog(a.getLog(),e)},this.search=function(e){for(var t=a.output.split("\n"),r=new RegExp(e),n=[],o=0;o<t.length;o++){var i="["+o+"] ";t[o].match(r)&&n.push(i+t[o])}var s=n.join("\n");return 0==s.length&&(s='Nothing found for "'+e+'".'),s},this.getSlice=function(e,t){return a.output.split("\n").slice(e,e+t).join("\n")},this.downloadLog=function(){var e="data:text/plain;charset=utf-8,",t=a.getLog();e+=encodeURIComponent(t);var r=document.createElement("a");r.href=e,r.target="_blank",r.download=a.logFilename,document.body.appendChild(r),r.click(),r.remove()},this.clear=function(){var e=new Date;if(a.output="---- Log cleared: "+e+" ----\n",a.useLocalStorage){var t={startTime:a.startTime,log:a.output,lastLog:e};t=JSON.stringify(t),window.localStorage.setItem("debugout.js",t)}a.realTimeLoggingOn&&console.log("[debugout.js] clear()")},this.track=function(e){a.log(a.logLevel.track,e)},this.debug=function(e){a.log(a.logLevel.debug,e)},this.info=function(e){a.log(a.logLevel.info,e)},this.error=function(e){a.log(a.logLevel.error,e)},this.log=function(e,t){a.realTimeLoggingOn&&(e==this.logLevel.trace?console.trace(t):e==this.logLevel.debug?console.debug(t):e==this.logLevel.info?console.info(t):e==this.logLevel.error?console.error(t):console.info(t));var r=a.determineType(t);if(null!=r&&a.recordLogs){var n=a.formatType(r,t);if(a.useTimestamps){var o=new Date;a.output+=a.formatTimestamp(o)}if(e==this.logLevel.trace?a.output+="TRACK - ":e==this.logLevel.debug?a.output+="DEBUG - ":e==this.logLevel.info?a.output+="INFO - ":e==this.logLevel.error?a.output+="ERROR - ":a.output+="INFO - ",a.output+=n+"\n",a.autoTrim&&(a.output=a.trimLog(a.output,a.maxLines)),a.useLocalStorage){var i=new Date,s={startTime:a.startTime,log:a.output,lastLog:i};s=JSON.stringify(s),window.localStorage.setItem("debugout.js",s)}}a.depth=0,a.parentSizes=[0],a.currentResult=""},this.determineType=function(e){if(null==e)return null;var t=typeof e;return"object"==t?null==e.length?"function"==typeof e.getTime?"Date":"function"==typeof e.test?"RegExp":"Object":"Array":t},this.formatType=function(e,t){if(a.maxDepth&&a.depth>=a.maxDepth)return"... (max-depth reached)";switch(e){case"Object":a.currentResult+="{\n",a.depth++,a.parentSizes.push(a.objectSize(t));var r=0;for(var n in t){a.currentResult+=a.indentsForDepth(a.depth),a.currentResult+=n+": ";var o=a.determineType(t[n]);(i=a.formatType(o,t[n]))&&(a.currentResult+=i),r!=a.parentSizes[a.depth]-1&&(a.currentResult+=","),a.currentResult+="\n",r++}if(a.depth--,a.parentSizes.pop(),a.currentResult+=a.indentsForDepth(a.depth),a.currentResult+="}",0==a.depth)return a.currentResult;break;case"Array":a.currentResult+="[",a.depth++,a.parentSizes.push(t.length);for(r=0;r<t.length;r++){var i;"Object"!=(o=a.determineType(t[r]))&&"Array"!=o||(a.currentResult+="\n"+a.indentsForDepth(a.depth)),(i=a.formatType(o,t[r]))?(a.currentResult+=i,r!=a.parentSizes[a.depth]-1&&(a.currentResult+=", "),"Array"==o&&(a.currentResult+="\n")):(r!=a.parentSizes[a.depth]-1&&(a.currentResult+=", "),"Object"!=o?a.currentResult+="\n":r==a.parentSizes[a.depth]-1&&(a.currentResult+="\n"))}if(a.depth--,a.parentSizes.pop(),a.currentResult+="]",0==a.depth)return a.currentResult;break;case"function":var s=(t+="").split("\n");for(r=0;r<s.length;r++)s[r].match(/\}/)&&a.depth--,a.currentResult+=a.indentsForDepth(a.depth),s[r].match(/\{/)&&a.depth++,a.currentResult+=s[r]+"\n";return a.currentResult;case"RegExp":return"/"+t.source+"/";case"Date":case"string":return 0<a.depth||0==t.length?'"'+t+'"':t;case"boolean":return t?"true":"false";case"number":return t+""}},this.indentsForDepth=function(e){for(var t="",r=0;r<e;r++)t+="\t";return t},this.trimLog=function(e,t){var r=e.split("\n");return r.length>t&&(r=r.slice(r.length-t)),r.join("\n")},this.lines=function(){return a.output.split("\n").length},this.formatSessionDuration=function(e,t){var r=t-e,n=Math.floor(r/1e3/60/60),o=("0"+n).slice(-2);r-=1e3*n*60*60;var i=Math.floor(r/1e3/60),s=("0"+i).slice(-2);r-=1e3*i*60;var a=Math.floor(r/1e3);return r-=1e3*a,"---- Session duration: "+o+":"+s+":"+("0"+a).slice(-2)+" ----"},this.formatTimestamp=function(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"]: "},this.objectSize=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},a.useLocalStorage){var e=window.localStorage.getItem("debugout.js");if(e){e=JSON.parse(e),a.output=e.log;var t=new Date(e.startTime),r=new Date(e.lastLog);a.output+="\n---- Session end: "+e.lastLog+" ----\n",a.output+=a.formatSessionDuration(t,r),a.output+="\n\n"}}a.output+="---- Session started: "+a.startTime+" ----\n\n"}!function(e,t){"function"==typeof define&&define.amd?define([],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(this,function(){"use strict";function f(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}try{Object.defineProperty(f.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}f.isLong=function(e){return!0===(e&&e.__isLong__)};var o={},i={};f.fromInt=function(e,t){var r,n;return t?0<=(e>>>=0)&&e<256&&(n=i[e])?n:(r=new f(e,(0|e)<0?-1:0,!0),0<=e&&e<256&&(i[e]=r),r):-128<=(e|=0)&&e<128&&(n=o[e])?n:(r=new f(e,e<0?-1:0,!1),-128<=e&&e<128&&(o[e]=r),r)},f.fromNumber=function(e,t){return t=!!t,isNaN(e)||!isFinite(e)?f.ZERO:!t&&e<=-s?f.MIN_VALUE:!t&&s<=e+1?f.MAX_VALUE:t&&n<=e?f.MAX_UNSIGNED_VALUE:e<0?f.fromNumber(-e,t).negate():new f(e%r|0,e/r|0,t)},f.fromBits=function(e,t,r){return new f(e,t,r)},f.fromString=function(e,t,r){if(0===e.length)throw Error("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return f.ZERO;if("number"==typeof t&&(r=t,t=!1),(r=r||10)<2||36<r)throw Error("radix out of range: "+r);var n;if(0<(n=e.indexOf("-")))throw Error('number format error: interior "-" character: '+e);if(0===n)return f.fromString(e.substring(1),t,r).negate();for(var o=f.fromNumber(Math.pow(r,8)),i=f.ZERO,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),r);if(a<8){var l=f.fromNumber(Math.pow(r,a));i=i.multiply(l).add(f.fromNumber(c))}else i=(i=i.multiply(o)).add(f.fromNumber(c))}return i.unsigned=t,i},f.fromValue=function(e){return e instanceof f?e:"number"==typeof e?f.fromNumber(e):"string"==typeof e?f.fromString(e):new f(e.low,e.high,e.unsigned)};var r=4294967296,n=r*r,s=n/2,h=f.fromInt(1<<24);return f.ZERO=f.fromInt(0),f.UZERO=f.fromInt(0,!0),f.ONE=f.fromInt(1),f.UONE=f.fromInt(1,!0),f.NEG_ONE=f.fromInt(-1),f.MAX_VALUE=f.fromBits(-1,2147483647,!1),f.MAX_UNSIGNED_VALUE=f.fromBits(-1,-1,!0),f.MIN_VALUE=f.fromBits(0,-2147483648,!1),f.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},f.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*r+(this.low>>>0):this.high*r+(this.low>>>0)},f.prototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix out of range: "+e);if(this.isZero())return"0";var t;if(this.isNegative()){if(this.equals(f.MIN_VALUE)){var r=f.fromNumber(e),n=this.divide(r);return t=n.multiply(r).subtract(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.negate().toString(e)}var o=f.fromNumber(Math.pow(e,6),this.unsigned);t=this;for(var i="";;){var s=t.divide(o),a=(t.subtract(s.multiply(o)).toInt()>>>0).toString(e);if((t=s).isZero())return a+i;for(;a.length<6;)a="0"+a;i=""+a+i}},f.prototype.getHighBits=function(){return this.high},f.prototype.getHighBitsUnsigned=function(){return this.high>>>0},f.prototype.getLowBits=function(){return this.low},f.prototype.getLowBitsUnsigned=function(){return this.low>>>0},f.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(f.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},f.prototype.isZero=function(){return 0===this.high&&0===this.low},f.prototype.isNegative=function(){return!this.unsigned&&this.high<0},f.prototype.isPositive=function(){return this.unsigned||0<=this.high},f.prototype.isOdd=function(){return 1==(1&this.low)},f.prototype.isEven=function(){return 0==(1&this.low)},f.eq=f.prototype.equals=function(e){return f.isLong(e)||(e=f.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},f.neq=f.prototype.notEquals=function(e){return!this.equals(e)},f.prototype.lt=f.prototype.lessThan=function(e){return this.compare(e)<0},f.prototype.lte=f.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},f.prototype.gt=f.prototype.greaterThan=function(e){return 0<this.compare(e)},f.prototype.gte=f.prototype.greaterThanOrEqual=function(e){return 0<=this.compare(e)},f.prototype.compare=function(e){if(f.isLong(e)||(e=f.fromValue(e)),this.equals(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.subtract(e).isNegative()?-1:1},f.prototype.neg=f.prototype.negate=function(){return!this.unsigned&&this.equals(f.MIN_VALUE)?f.MIN_VALUE:this.not().add(f.ONE)},f.prototype.add=function(e){f.isLong(e)||(e=f.fromValue(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,s=65535&e.high,a=e.low>>>16,c=0,l=0,d=0,u=0;return d+=(u+=o+(65535&e.low))>>>16,l+=(d+=n+a)>>>16,c+=(l+=r+s)>>>16,c+=t+i,f.fromBits((d&=65535)<<16|(u&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},f.prototype.sub=f.prototype.subtract=function(e){return f.isLong(e)||(e=f.fromValue(e)),this.add(e.negate())},f.prototype.mul=f.prototype.multiply=function(e){if(this.isZero())return f.ZERO;if(f.isLong(e)||(e=f.fromValue(e)),e.isZero())return f.ZERO;if(this.equals(f.MIN_VALUE))return e.isOdd()?f.MIN_VALUE:f.ZERO;if(e.equals(f.MIN_VALUE))return this.isOdd()?f.MIN_VALUE:f.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(h)&&e.lessThan(h))return f.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,s=65535&e.high,a=e.low>>>16,c=65535&e.low,l=0,d=0,u=0,p=0;return u+=(p+=o*c)>>>16,d+=(u+=n*c)>>>16,u&=65535,d+=(u+=o*a)>>>16,l+=(d+=r*c)>>>16,d&=65535,l+=(d+=n*a)>>>16,d&=65535,l+=(d+=o*s)>>>16,l+=t*c+r*a+n*s+o*i,f.fromBits((u&=65535)<<16|(p&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},f.prototype.div=f.prototype.divide=function(e){if(f.isLong(e)||(e=f.fromValue(e)),e.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?f.UZERO:f.ZERO;var t,r,n;{if(this.equals(f.MIN_VALUE))return e.equals(f.ONE)||e.equals(f.NEG_ONE)?f.MIN_VALUE:e.equals(f.MIN_VALUE)?f.ONE:(t=this.shiftRight(1).divide(e).shiftLeft(1)).equals(f.ZERO)?e.isNegative()?f.ONE:f.NEG_ONE:(r=this.subtract(e.multiply(t)),n=t.add(r.divide(e)));if(e.equals(f.MIN_VALUE))return this.unsigned?f.UZERO:f.ZERO}if(this.isNegative())return e.isNegative()?this.negate().divide(e.negate()):this.negate().divide(e).negate();if(e.isNegative())return this.divide(e.negate()).negate();for(n=f.ZERO,r=this;r.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),i=o<=48?1:Math.pow(2,o-48),s=f.fromNumber(t),a=s.multiply(e);a.isNegative()||a.greaterThan(r);)a=(s=f.fromNumber(t-=i,this.unsigned)).multiply(e);s.isZero()&&(s=f.ONE),n=n.add(s),r=r.subtract(a)}return n},f.prototype.mod=f.prototype.modulo=function(e){return f.isLong(e)||(e=f.fromValue(e)),this.subtract(this.divide(e).multiply(e))},f.prototype.not=function(){return f.fromBits(~this.low,~this.high,this.unsigned)},f.prototype.and=function(e){return f.isLong(e)||(e=f.fromValue(e)),f.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},f.prototype.or=function(e){return f.isLong(e)||(e=f.fromValue(e)),f.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},f.prototype.xor=function(e){return f.isLong(e)||(e=f.fromValue(e)),f.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},f.prototype.shl=f.prototype.shiftLeft=function(e){return f.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?f.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):f.fromBits(0,this.low<<e-32,this.unsigned)},f.prototype.shr=f.prototype.shiftRight=function(e){return f.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?f.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):f.fromBits(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},f.prototype.shru=f.prototype.shiftRightUnsigned=function(e){if(f.isLong(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;if(e<32){var r=this.low;return f.fromBits(r>>>e|t<<32-e,t>>>e,this.unsigned)}return f.fromBits(32===e?t:t>>>e-32,0,this.unsigned)},f.prototype.toSigned=function(){return this.unsigned?new f(this.low,this.high,!1):this},f.prototype.toUnsigned=function(){return this.unsigned?this:new f(this.low,this.high,!0)},f}),function(e,t){"function"==typeof define&&define.amd?define(["long"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var e;try{e=require("long")}catch(e){}return t(e)}():(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=t(e.dcodeIO.Long)}(this,function(c){"use strict";var h=function(e,t,r){if(void 0===e&&(e=h.DEFAULT_CAPACITY),void 0===t&&(t=h.DEFAULT_ENDIAN),void 0===r&&(r=h.DEFAULT_NOASSERT),!r){if((e|=0)<0)throw RangeError("Illegal capacity");t=!!t,r=!!r}this.buffer=0===e?i:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=r};h.VERSION="5.0.1",h.LITTLE_ENDIAN=!0,h.BIG_ENDIAN=!1,h.DEFAULT_CAPACITY=16,h.DEFAULT_ENDIAN=h.BIG_ENDIAN,h.DEFAULT_NOASSERT=!1,h.Long=c||null;var s=h.prototype;s.__isByteBuffer__;try{Object.defineProperty(s,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}try{var i=new ArrayBuffer(0)}catch(e){i=""}var r=String.fromCharCode;function a(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function l(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+r.apply(String,e);1024<e.length+arguments.length&&(t.push(r.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function n(e,t,r,n,o){var i,s,a=8*o-n-1,c=(1<<a)-1,l=c>>1,d=-7,u=r?o-1:0,p=r?-1:1,f=e[t+u];for(u+=p,i=f&(1<<-d)-1,f>>=-d,d+=a;0<d;i=256*i+e[t+u],u+=p,d-=8);for(s=i&(1<<-d)-1,i>>=-d,d+=n;0<d;s=256*s+e[t+u],u+=p,d-=8);if(0===i)i=1-l;else{if(i===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),i-=l}return(f?-1:1)*s*Math.pow(2,i-n)}function o(e,t,r,n,o,i){var s,a,c,l=8*i-o-1,d=(1<<l)-1,u=d>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:i-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),2<=(t+=1<=s+u?p/c:p*Math.pow(2,1-u))*c&&(s++,c/=2),d<=s+u?(a=0,s=d):1<=s+u?(a=(t*c-1)*Math.pow(2,o),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,o),s=0));8<=o;e[r+f]=255&a,f+=h,a/=256,o-=8);for(s=s<<o|a,l+=o;0<l;e[r+f]=255&s,f+=h,s/=256,l-=8);e[r+f-h]|=128*m}h.accessor=function(){return Uint8Array},h.allocate=function(e,t,r){return new h(e,t,r)},h.concat=function(e,t,r,n){"boolean"!=typeof t&&"string"==typeof t||(n=r,r=t,t=void 0);for(var o,i=0,s=0,a=e.length;s<a;++s)h.isByteBuffer(e[s])||(e[s]=h.wrap(e[s],t)),0<(o=e[s].limit-e[s].offset)&&(i+=o);if(0===i)return new h(0,r,n);var c,l=new h(i,r,n);for(s=0;s<a;)(o=(c=e[s++]).limit-c.offset)<=0||(l.view.set(c.view.subarray(c.offset,c.limit),l.offset),l.offset+=o);return l.limit=l.offset,l.offset=0,l},h.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},h.type=function(){return ArrayBuffer},h.wrap=function(e,t,r,n){if("string"!=typeof t&&(n=r,r=t,t=void 0),"string"==typeof e)switch(void 0===t&&(t="utf8"),t){case"base64":return h.fromBase64(e,r);case"hex":return h.fromHex(e,r);case"binary":return h.fromBinary(e,r);case"utf8":return h.fromUTF8(e,r);case"debug":return h.fromDebug(e,r);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var o;if(h.isByteBuffer(e))return(o=s.clone.call(e)).markedOffset=-1,o;if(e instanceof Uint8Array)o=new h(0,r,n),0<e.length&&(o.buffer=e.buffer,o.offset=e.byteOffset,o.limit=e.byteOffset+e.byteLength,o.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)o=new h(0,r,n),0<e.byteLength&&(o.buffer=e,o.offset=0,o.limit=e.byteLength,o.view=0<e.byteLength?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");(o=new h(e.length,r,n)).limit=e.length;for(var i=0;i<e.length;++i)o.view[i]=e[i]}return o},s.writeBitSet=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o=t,i=e.length,s=i>>3,a=0;for(t+=this.writeVarint32(i,t);s--;)n=1&!!e[a++]|(1&!!e[a++])<<1|(1&!!e[a++])<<2|(1&!!e[a++])<<3|(1&!!e[a++])<<4|(1&!!e[a++])<<5|(1&!!e[a++])<<6|(1&!!e[a++])<<7,this.writeByte(n,t++);if(a<i){var c=0;for(n=0;a<i;)n|=(1&!!e[a++])<<c++;this.writeByte(n,t++)}return r?(this.offset=t,this):t-o},s.readBitSet=function(e){var t=void 0===e;t&&(e=this.offset);var r,n=this.readVarint32(e),o=n.value,i=o>>3,s=0,a=[];for(e+=n.length;i--;)r=this.readByte(e++),a[s++]=!!(1&r),a[s++]=!!(2&r),a[s++]=!!(4&r),a[s++]=!!(8&r),a[s++]=!!(16&r),a[s++]=!!(32&r),a[s++]=!!(64&r),a[s++]=!!(128&r);if(s<o){var c=0;for(r=this.readByte(e++);s<o;)a[s++]=!!(r>>c++&1)}return t&&(this.offset=e),a},s.readBytes=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var n=this.slice(t,t+e);return r&&(this.offset+=e),n},s.writeBytes=s.append,s.writeInt8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},s.writeByte=s.writeInt8,s.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view[e];return 128==(128&r)&&(r=-(255-r+1)),t&&(this.offset+=1),r},s.readByte=s.readInt8,s.writeUint8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},s.writeUInt8=s.writeUint8,s.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view[e];return t&&(this.offset+=1),r},s.readUInt8=s.readUint8,s.writeInt16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},s.writeShort=s.writeInt16,s.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),32768==(32768&r)&&(r=-(65535-r+1)),t&&(this.offset+=2),r},s.readShort=s.readInt16,s.writeUint16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},s.writeUInt16=s.writeUint16,s.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),t&&(this.offset+=2),r},s.readUInt16=s.readUint16,s.writeInt32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},s.writeInt=s.writeInt32,s.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0),r|=0,t&&(this.offset+=4),r},s.readInt=s.readInt32,s.writeUint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},s.writeUInt32=s.writeUint32,s.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0),t&&(this.offset+=4),r},s.readUInt32=s.readUint32,c&&(s.writeInt64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=c.fromNumber(e);else if("string"==typeof e)e=c.fromString(e);else if(!(e&&e instanceof c))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=c.fromNumber(e):"string"==typeof e&&(e=c.fromString(e)),t+=8;var n=this.buffer.byteLength;n<t&&this.resize((n*=2)>t?n:t),t-=8;var o=e.low,i=e.high;return this.littleEndian?(this.view[t+3]=o>>>24&255,this.view[t+2]=o>>>16&255,this.view[t+1]=o>>>8&255,this.view[t]=255&o,t+=4,this.view[t+3]=i>>>24&255,this.view[t+2]=i>>>16&255,this.view[t+1]=i>>>8&255,this.view[t]=255&i):(this.view[t]=i>>>24&255,this.view[t+1]=i>>>16&255,this.view[t+2]=i>>>8&255,this.view[t+3]=255&i,t+=4,this.view[t]=o>>>24&255,this.view[t+1]=o>>>16&255,this.view[t+2]=o>>>8&255,this.view[t+3]=255&o),r&&(this.offset+=8),this},s.writeLong=s.writeInt64,s.readInt64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0):(n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var o=new c(r,n,!1);return t&&(this.offset+=8),o},s.readLong=s.readInt64,s.writeUint64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=c.fromNumber(e);else if("string"==typeof e)e=c.fromString(e);else if(!(e&&e instanceof c))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=c.fromNumber(e):"string"==typeof e&&(e=c.fromString(e)),t+=8;var n=this.buffer.byteLength;n<t&&this.resize((n*=2)>t?n:t),t-=8;var o=e.low,i=e.high;return this.littleEndian?(this.view[t+3]=o>>>24&255,this.view[t+2]=o>>>16&255,this.view[t+1]=o>>>8&255,this.view[t]=255&o,t+=4,this.view[t+3]=i>>>24&255,this.view[t+2]=i>>>16&255,this.view[t+1]=i>>>8&255,this.view[t]=255&i):(this.view[t]=i>>>24&255,this.view[t+1]=i>>>16&255,this.view[t+2]=i>>>8&255,this.view[t+3]=255&i,t+=4,this.view[t]=o>>>24&255,this.view[t+1]=o>>>16&255,this.view[t+2]=o>>>8&255,this.view[t+3]=255&o),r&&(this.offset+=8),this},s.writeUInt64=s.writeUint64,s.readUint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0):(n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var o=new c(r,n,!0);return t&&(this.offset+=8),o},s.readUInt64=s.readUint64),s.writeFloat32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=4,o(this.view,e,t,this.littleEndian,23,4),r&&(this.offset+=4),this},s.writeFloat=s.writeFloat32,s.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=n(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),r},s.readFloat=s.readFloat32,s.writeFloat64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=8,o(this.view,e,t,this.littleEndian,52,8),r&&(this.offset+=8),this},s.writeDouble=s.writeFloat64,s.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=n(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),r},s.readDouble=s.readFloat64,h.MAX_VARINT32_BYTES=5,h.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},h.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},h.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},s.writeVarint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o=h.calculateVarint32(e);t+=o;var i=this.buffer.byteLength;for(i<t&&this.resize((i*=2)>t?i:t),t-=o,e>>>=0;128<=e;)n=127&e|128,this.view[t++]=n,e>>>=7;return this.view[t++]=e,r?(this.offset=t,this):o},s.writeVarint32ZigZag=function(e,t){return this.writeVarint32(h.zigZagEncode32(e),t)},s.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=0,o=0;do{if(!this.noAssert&&e>this.limit){var i=Error("Truncated");throw i.truncated=!0,i}r=this.view[e++],n<5&&(o|=(127&r)<<7*n),++n}while(0!=(128&r));return o|=0,t?(this.offset=e,o):{value:o,length:n}},s.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return"object"==typeof t?t.value=h.zigZagDecode32(t.value):t=h.zigZagDecode32(t),t},c&&(h.MAX_VARINT64_BYTES=10,h.calculateVarint64=function(e){"number"==typeof e?e=c.fromNumber(e):"string"==typeof e&&(e=c.fromString(e));var t=e.toInt()>>>0,r=e.shiftRightUnsigned(28).toInt()>>>0,n=e.shiftRightUnsigned(56).toInt()>>>0;return 0==n?0==r?t<16384?t<128?1:2:t<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:n<128?9:10},h.zigZagEncode64=function(e){return"number"==typeof e?e=c.fromNumber(e,!1):"string"==typeof e?e=c.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},h.zigZagDecode64=function(e){return"number"==typeof e?e=c.fromNumber(e,!1):"string"==typeof e?e=c.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(c.ONE).toSigned().negate()).toSigned()},s.writeVarint64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=c.fromNumber(e);else if("string"==typeof e)e=c.fromString(e);else if(!(e&&e instanceof c))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=c.fromNumber(e,!1):"string"==typeof e?e=c.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned());var n=h.calculateVarint64(e),o=e.toInt()>>>0,i=e.shiftRightUnsigned(28).toInt()>>>0,s=e.shiftRightUnsigned(56).toInt()>>>0;t+=n;var a=this.buffer.byteLength;switch(a<t&&this.resize((a*=2)>t?a:t),t-=n,n){case 10:this.view[t+9]=s>>>7&1;case 9:this.view[t+8]=9!==n?128|s:127&s;case 8:this.view[t+7]=8!==n?i>>>21|128:i>>>21&127;case 7:this.view[t+6]=7!==n?i>>>14|128:i>>>14&127;case 6:this.view[t+5]=6!==n?i>>>7|128:i>>>7&127;case 5:this.view[t+4]=5!==n?128|i:127&i;case 4:this.view[t+3]=4!==n?o>>>21|128:o>>>21&127;case 3:this.view[t+2]=3!==n?o>>>14|128:o>>>14&127;case 2:this.view[t+1]=2!==n?o>>>7|128:o>>>7&127;case 1:this.view[t]=1!==n?128|o:127&o}return r?(this.offset+=n,this):n},s.writeVarint64ZigZag=function(e,t){return this.writeVarint64(h.zigZagEncode64(e),t)},s.readVarint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,n=0,o=0,i=0,s=0;if(n=127&(s=this.view[e++]),128&s&&(n|=(127&(s=this.view[e++]))<<7,(128&s||this.noAssert&&void 0===s)&&(n|=(127&(s=this.view[e++]))<<14,(128&s||this.noAssert&&void 0===s)&&(n|=(127&(s=this.view[e++]))<<21,(128&s||this.noAssert&&void 0===s)&&(o=127&(s=this.view[e++]),(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<7,(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<14,(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<21,(128&s||this.noAssert&&void 0===s)&&(i=127&(s=this.view[e++]),(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[e++]))<<7,128&s||this.noAssert&&void 0===s))))))))))throw Error("Buffer overrun");var a=c.fromBits(n|o<<28,o>>>4|i<<24,!1);return t?(this.offset=e,a):{value:a,length:e-r}},s.readVarint64ZigZag=function(e){var t=this.readVarint64(e);return t&&t.value instanceof c?t.value=h.zigZagDecode64(t.value):t=h.zigZagDecode64(t),t}),s.writeCString=function(e,t){var r=void 0===t;r&&(t=this.offset);var n,o=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(n=0;n<o;++n)if(0===e.charCodeAt(n))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}o=p.calculateUTF16asUTF8(a(e))[1],t+=o+1;var i=this.buffer.byteLength;return i<t&&this.resize((i*=2)>t?i:t),t-=o+1,p.encodeUTF16toUTF8(a(e),function(e){this.view[t++]=e}.bind(this)),this.view[t++]=0,r?(this.offset=t,this):o},s.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=e,o=-1;return p.decodeUTF8toUTF16(function(){if(0===o)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(o=this.view[e++])?null:o}.bind(this),r=l(),!0),t?(this.offset=e,r()):{string:r(),length:e-n}},s.writeIString=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o=t;n=p.calculateUTF16asUTF8(a(e),this.noAssert)[1],t+=4+n;var i=this.buffer.byteLength;if(i<t&&this.resize((i*=2)>t?i:t),t-=4+n,this.littleEndian?(this.view[t+3]=n>>>24&255,this.view[t+2]=n>>>16&255,this.view[t+1]=n>>>8&255,this.view[t]=255&n):(this.view[t]=n>>>24&255,this.view[t+1]=n>>>16&255,this.view[t+2]=n>>>8&255,this.view[t+3]=255&n),t+=4,p.encodeUTF16toUTF8(a(e),function(e){this.view[t++]=e}.bind(this)),t!==o+4+n)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+n));return r?(this.offset=t,this):t-o},s.readIString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=e,n=this.readUint32(e),o=this.readUTF8String(n,h.METRICS_BYTES,e+=4);return e+=o.length,t?(this.offset=e,o.string):{string:o.string,length:e-r}},h.METRICS_CHARS="c",h.METRICS_BYTES="b",s.writeUTF8String=function(e,t){var r,n=void 0===t;if(n&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o=t;r=p.calculateUTF16asUTF8(a(e))[1],t+=r;var i=this.buffer.byteLength;return i<t&&this.resize((i*=2)>t?i:t),t-=r,p.encodeUTF16toUTF8(a(e),function(e){this.view[t++]=e}.bind(this)),n?(this.offset=t,this):t-o},s.writeString=s.writeUTF8String,h.calculateUTF8Chars=function(e){return p.calculateUTF16asUTF8(a(e))[0]},h.calculateUTF8Bytes=function(e){return p.calculateUTF16asUTF8(a(e))[1]},h.calculateString=h.calculateUTF8Bytes,s.readUTF8String=function(e,t,r){"number"==typeof t&&(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),void 0===t&&(t=h.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,i=0,s=r;if(t===h.METRICS_CHARS){if(o=l(),p.decodeUTF8(function(){return i<e&&r<this.limit?this.view[r++]:null}.bind(this),function(e){++i,p.UTF8toUTF16(e,o)}),i!==e)throw RangeError("Illegal range: Truncated data, "+i+" == "+e);return n?(this.offset=r,o()):{string:o(),length:r-s}}if(t!==h.METRICS_BYTES)throw TypeError("Unsupported metrics: "+t);if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+e+") <= "+this.buffer.byteLength)}var a=r+e;if(p.decodeUTF8toUTF16(function(){return r<a?this.view[r++]:null}.bind(this),o=l(),this.noAssert),r!==a)throw RangeError("Illegal range: Truncated data, "+r+" == "+a);return n?(this.offset=r,o()):{string:o(),length:r-s}},s.readString=s.readUTF8String,s.writeVString=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o,i=t;n=p.calculateUTF16asUTF8(a(e),this.noAssert)[1],o=h.calculateVarint32(n),t+=o+n;var s=this.buffer.byteLength;if(s<t&&this.resize((s*=2)>t?s:t),t-=o+n,t+=this.writeVarint32(n,t),p.encodeUTF16toUTF8(a(e),function(e){this.view[t++]=e}.bind(this)),t!==i+n+o)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+n+o));return r?(this.offset=t,this):t-i},s.readVString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,n=this.readVarint32(e),o=this.readUTF8String(n.value,h.METRICS_BYTES,e+=n.length);return e+=o.length,t?(this.offset=e,o.string):{string:o.string,length:e-r}},s.append=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof h||(e=h.wrap(e,t));var o=e.limit-e.offset;if(o<=0)return this;r+=o;var i=this.buffer.byteLength;return i<r&&this.resize((i*=2)>r?i:r),r-=o,this.view.set(e.view.subarray(e.offset,e.limit),r),e.offset+=o,n&&(this.offset+=o),this},s.appendTo=function(e,t){return e.append(this,t),this},s.assert=function(e){return this.noAssert=!e,this},s.capacity=function(){return this.buffer.byteLength},s.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},s.clone=function(e){var t=new h(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},s.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var r=t-e;if(0===r)return this.buffer=i,this.view=null,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var n=new ArrayBuffer(r),o=new Uint8Array(n);return o.set(this.view.subarray(e,t)),this.buffer=n,this.view=o,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=r,this},s.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return new h(0,this.littleEndian,this.noAssert);var r=t-e,n=new h(r,this.littleEndian,this.noAssert);return n.offset=0,n.limit=r,0<=n.markedOffset&&(n.markedOffset-=e),this.copyTo(n,0,e,t),n},s.copyTo=function(e,t,r,n){var o,i;if(!this.noAssert&&!h.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(i=void 0===t)?e.offset:0|t,r=(o=void 0===r)?this.offset:0|r,n=void 0===n?this.limit:0|n,t<0||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(r<0||n>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var s=n-r;return 0===s?e:(e.ensureCapacity(t+s),e.view.set(this.view.subarray(r,n),t),o&&(this.offset+=s),i&&(e.offset+=s),this)},s.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},s.fill=function(e,t,r){var n=void 0===t;if(n&&(t=this.offset),"string"==typeof e&&0<e.length&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(r<=t)return this;for(;t<r;)this.view[t++]=e;return n&&(this.offset=t),this},s.flip=function(){return this.limit=this.offset,this.offset=0,this},s.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},s.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},s.LE=function(e){return this.littleEndian=void 0===e||!!e,this},s.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},s.prepend=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof h||(e=h.wrap(e,t));var o=e.limit-e.offset;if(o<=0)return this;var i=o-r;if(0<i){var s=new ArrayBuffer(this.buffer.byteLength+i),a=new Uint8Array(s);a.set(this.view.subarray(r,this.buffer.byteLength),o),this.buffer=s,this.view=a,this.offset+=i,0<=this.markedOffset&&(this.markedOffset+=i),this.limit+=i,r+=i}else new Uint8Array(this.buffer);return this.view.set(e.view.subarray(e.offset,e.limit),r-o),e.offset=e.limit,n&&(this.offset-=o),this},s.prependTo=function(e,t){return e.prepend(this,t),this},s.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},s.remaining=function(){return this.limit-this.offset},s.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},s.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e),r=new Uint8Array(t);r.set(this.view),this.buffer=t,this.view=r}return this},s.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},s.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},s.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=e,r.limit=t,r},s.toBuffer=function(e){var t=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(!e&&0===t&&r===this.buffer.byteLength)return this.buffer;if(t===r)return i;var n=new ArrayBuffer(r-t);return new Uint8Array(n).set(new Uint8Array(this.buffer).subarray(t,r),0),n},s.toArrayBuffer=s.toBuffer,s.toString=function(e,t,r){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(r=t=e="utf8"),e){case"utf8":return this.toUTF8(t,r);case"base64":return this.toBase64(t,r);case"hex":return this.toHex(t,r);case"binary":return this.toBinary(t,r);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var d=function(){for(var e={},o=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],s=[],t=0,r=o.length;t<r;++t)s[o[t]]=t;return e.encode=function(e,t){for(var r,n;null!==(r=e());)t(o[r>>2&63]),n=(3&r)<<4,null!==(r=e())?(t(o[63&((n|=r>>4&15)|r>>4&15)]),n=(15&r)<<2,null!==(r=e())?(t(o[63&(n|r>>6&3)]),t(o[63&r])):(t(o[63&n]),t(61))):(t(o[63&n]),t(61),t(61))},e.decode=function(e,t){var r,n,o;function i(e){throw Error("Illegal character code: "+e)}for(;null!==(r=e());)if(void 0===(n=s[r])&&i(r),null!==(r=e())&&(void 0===(o=s[r])&&i(r),t(n<<2>>>0|(48&o)>>4),null!==(r=e()))){if(void 0===(n=s[r])){if(61===r)break;i(r)}if(t((15&o)<<4>>>0|(60&n)>>2),null!==(r=e())){if(void 0===(o=s[r])){if(61===r)break;i(r)}t((3&n)<<6>>>0|o)}}},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)},e}();s.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||t<e)throw RangeError("begin, end");var r;return d.encode(function(){return e<t?this.view[e++]:null}.bind(this),r=l()),r()},h.fromBase64=function(e,t){if("string"!=typeof e)throw TypeError("str");var r=new h(e.length/4*3,t),n=0;return d.decode(a(e),function(e){r.view[n++]=e}),r.limit=n,r},h.btoa=function(e){return h.fromBinary(e).toBase64()},h.atob=function(e){return h.fromBase64(e).toBinary()},s.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||t<e)throw RangeError("begin, end");if(e===t)return"";for(var r=[],n=[];e<t;)r.push(this.view[e++]),1024<=r.length&&(n.push(String.fromCharCode.apply(String,r)),r=[]);return n.join("")+String.fromCharCode.apply(String,r)},h.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var r,n=0,o=e.length,i=new h(o,t);n<o;){if(255<(r=e.charCodeAt(n)))throw RangeError("illegal char code: "+r);i.view[n++]=r}return i.limit=o,i},s.toDebug=function(e){for(var t,r=-1,n=this.buffer.byteLength,o="",i="",s="";r<n;){if(-1!==r&&(o+=(t=this.view[r])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(i+=32<t&&t<127?String.fromCharCode(t):".")),++r,e&&0<r&&r%16==0&&r!==n){for(;o.length<51;)o+=" ";s+=o+i+"\n",o=i=""}r===this.offset&&r===this.limit?o+=r===this.markedOffset?"!":"|":r===this.offset?o+=r===this.markedOffset?"[":"<":r===this.limit?o+=r===this.markedOffset?"]":">":o+=r===this.markedOffset?"'":e||0!==r&&r!==n?" ":""}if(e&&" "!==o){for(;o.length<51;)o+=" ";s+=o+i+"\n"}return e?s:o},h.fromDebug=function(e,t,r){for(var n,o,i=e.length,s=new h((i+1)/3|0,t,r),a=0,c=0,l=!1,d=!1,u=!1,p=!1,f=!1;a<i;){switch(n=e.charAt(a++)){case"!":if(!r){if(d||u||p){f=!0;break}d=u=p=!0}s.offset=s.markedOffset=s.limit=c,l=!1;break;case"|":if(!r){if(d||p){f=!0;break}d=p=!0}s.offset=s.limit=c,l=!1;break;case"[":if(!r){if(d||u){f=!0;break}d=u=!0}s.offset=s.markedOffset=c,l=!1;break;case"<":if(!r){if(d){f=!0;break}d=!0}s.offset=c,l=!1;break;case"]":if(!r){if(p||u){f=!0;break}p=u=!0}s.limit=s.markedOffset=c,l=!1;break;case">":if(!r){if(p){f=!0;break}p=!0}s.limit=c,l=!1;break;case"'":if(!r){if(u){f=!0;break}u=!0}s.markedOffset=c,l=!1;break;case" ":l=!1;break;default:if(!r&&l){f=!0;break}if(o=parseInt(n+e.charAt(a++),16),!r&&(isNaN(o)||o<0||255<o))throw TypeError("Illegal str: Not a debug encoded string");s.view[c++]=o,l=!0}if(f)throw TypeError("Illegal str: Invalid symbol at "+a)}if(!r){if(!d||!p)throw TypeError("Illegal str: Missing offset or limit");if(c<s.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+c+" < "+i)}return s},s.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var r,n=new Array(t-e);e<t;)(r=this.view[e++])<16?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},h.fromHex=function(e,t,r){if(!r){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var n,o=e.length,i=new h(o/2|0,t),s=0,a=0;s<o;s+=2){if(n=parseInt(e.substring(s,s+2),16),!r&&(!isFinite(n)||n<0||255<n))throw TypeError("Illegal str: Contains non-hex characters");i.view[a++]=n}return i.limit=a,i};var u,p=u={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<128?t(127&r):(r<2048?t(r>>6&31|192):(r<65536?t(r>>12&15|224):(t(r>>18&7|240),t(r>>12&63|128)),t(r>>6&63|128)),t(63&r|128)),r=null},decodeUTF8:function(e,t){for(var r,n,o,i,s=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(r=e());)if(0==(128&r))t(r);else if(192==(224&r))null===(n=e())&&s([r,n]),t((31&r)<<6|63&n);else if(224==(240&r))(null===(n=e())||null===(o=e()))&&s([r,n,o]),t((15&r)<<12|(63&n)<<6|63&o);else{if(240!=(248&r))throw RangeError("Illegal starting byte: "+r);(null===(n=e())||null===(o=e())||null===(i=e()))&&s([r,n,o,i]),t((7&r)<<18|(63&n)<<12|(63&o)<<6|63&i)}},UTF16toUTF8:function(e,t){for(var r,n=null;null!==(r=null!==n?n:e());)55296<=r&&r<=57343&&null!==(n=e())&&56320<=n&&n<=57343?(t(1024*(r-55296)+n-56320+65536),n=null):t(r);null!==n&&t(n)},UTF8toUTF16:function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<=65535?t(r):(t(55296+((r-=65536)>>10)),t(r%1024+56320)),r=null},encodeUTF16toUTF8:function(e,t){u.UTF16toUTF8(e,function(e){u.encodeUTF8(e,t)})},decodeUTF8toUTF16:function(e,t){u.decodeUTF8(e,function(e){u.UTF8toUTF16(e,t)})},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,r=0;null!==(t=e());)r+=t<128?1:t<2048?2:t<65536?3:4;return r},calculateUTF16asUTF8:function(e){var t=0,r=0;return u.UTF16toUTF8(e,function(e){++t,r+=e<128?1:e<2048?2:e<65536?3:4}),[t,r]}};return s.toUTF8=function(t,r){if(void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}var e;try{p.decodeUTF8toUTF16(function(){return t<r?this.view[t++]:null}.bind(this),e=l())}catch(e){if(t!==r)throw RangeError("Illegal range: Truncated data, "+t+" != "+r)}return e()},h.fromUTF8=function(e,t,r){if(!r&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var n=new h(p.calculateUTF16asUTF8(a(e),!0)[1],t,r),o=0;return p.encodeUTF16toUTF8(a(e),function(e){n.view[o++]=e}),n.limit=o,n},h}),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.log4javascript=e()}(function(){function isUndefined(e){return void 0===e}function EventSupport(){}Array.prototype.push||(Array.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(0<this.length){for(var e=this[0],t=0,r=this.length-1;t<r;t++)this[t]=this[t+1];return this.length=this.length-1,e}}),Array.prototype.splice||(Array.prototype.splice=function(e,t){var r=this.slice(e+t),n=this.slice(e,e+t);this.length=e;for(var o=[],i=0,s=arguments.length;i<s;i++)o[i]=arguments[i];var a=2<o.length?r=o.slice(2).concat(r):r;for(i=0,s=a.length;i<s;i++)this.push(a[i]);return n}),EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(e){if(e instanceof Array){this.eventTypes=e,this.eventListeners={};for(var t=0,r=this.eventTypes.length;t<r;t++)this.eventListeners[this.eventTypes[t]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+e+"'"),this.eventListeners[e].push(t)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+e+"'"),array_remove(this.eventListeners[e],t)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(e,t){if(array_contains(this.eventTypes,e))for(var r=this.eventListeners[e],n=0,o=r.length;n<o;n++)r[n](this,e,t);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+e+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;function Log4JavaScript(){}Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;function toStr(e){return e&&e.toString?e.toString():String(e)}function getExceptionMessage(e){return e.message?e.message:e.description?e.description:toStr(e)}function getUrlFileName(e){var t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return e.substr(t+1)}function getExceptionStringRep(e){if(e){var t="Exception: "+getExceptionMessage(e);try{e.lineNumber&&(t+=" on line number "+e.lineNumber),e.fileName&&(t+=" in file "+getUrlFileName(e.fileName))}catch(e){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&e.stack&&(t+=newLine+"Stack trace:"+newLine+e.stack),t}return null}function bool(e){return Boolean(e)}function trim(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n")}log4javascript.version="1.4.11",log4javascript.edition="log4javascript";var urlEncode=void 0!==window.encodeURIComponent?function(e){return encodeURIComponent(e)}:function(e){return escape(e).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};function array_remove(e,t){for(var r=-1,n=0,o=e.length;n<o;n++)if(e[n]===t){r=n;break}return 0<=r&&(e.splice(r,1),!0)}function array_contains(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]==t)return!0;return!1}function extractBooleanFromParam(e,t){return isUndefined(e)?t:bool(e)}function extractStringFromParam(e,t){return isUndefined(e)?t:String(e)}function extractIntFromParam(t,r){if(isUndefined(t))return r;try{var e=parseInt(t,10);return isNaN(e)?r:e}catch(e){return logLog.warn("Invalid int param "+t,e),r}}function extractFunctionFromParam(e,t){return"function"==typeof e?e:t}function isError(e){return e instanceof Error}Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";void 0!==obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(e){for(var t=[],r=1,n=arguments.length;r<n;r++)t[r-1]=arguments[r];return this.apply(e,t)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(e){this.quietMode=bool(e)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(e){this.alertAllErrors=e},debug:function(e){this.debugMessages.push(e)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(e,t){},error:function(e,t){if((1==++this.numberOfErrors||this.alertAllErrors)&&!this.quietMode){var r="log4javascript error: "+e;t&&(r+=newLine+newLine+"Original error: "+getExceptionStringRep(t)),alert(r)}}};function handleError(e,t){logLog.error(e,t),log4javascript.dispatchEvent("error",{message:e,exception:t})}log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled);log4javascript.setEnabled=function(e){enabled=bool(e)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(e){useTimeStampsInMilliseconds=bool(e)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(e){showStackTraces=bool(e)};var Level=function(e,t){this.level=e,this.name=t};function Timer(e,t){this.name=e,this.level=isUndefined(t)?Level.INFO:t,this.start=new Date}Level.prototype={toString:function(){return this.name},equals:function(e){return this.level==e.level},isGreaterOrEqual:function(e){return this.level>=e.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";function Logger(e){this.name=e,this.parent=null,this.children=[];var r=[],t=null,n=this.name===rootLoggerName,o=this.name===nullLoggerName,i=null,s=!1;this.addChild=function(e){this.children.push(e),e.parent=this,e.invalidateAppenderCache()};var a=!0;this.getAdditivity=function(){return a},this.setAdditivity=function(e){var t=a!=e;a=e,t&&this.invalidateAppenderCache()},this.addAppender=function(e){o?handleError("Logger.addAppender: you may not add an appender to the null logger"):e instanceof log4javascript.Appender?array_contains(r,e)||(r.push(e),e.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(e)+"') is not a subclass of Appender")},this.removeAppender=function(e){array_remove(r,e),e.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var e=r.length;if(0<e){for(var t=0;t<e;t++)r[t].setRemovedFromLogger(this);r.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(null===i||s){var e=n||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();i=e.concat(r),s=!1}return i},this.invalidateAppenderCache=function(){s=!0;for(var e=0,t=this.children.length;e<t;e++)this.children[e].invalidateAppenderCache()},this.log=function(e,t){if(enabled&&e.isGreaterOrEqual(this.getEffectiveLevel())){var r,n=t.length-1,o=t[n];1<t.length&&isError(o)&&(r=o,n--);for(var i=[],s=0;s<=n;s++)i[s]=t[s];var a=new LoggingEvent(this,new Date,e,i,r);this.callAppenders(a),bugout&&(e==Level.TRACE?bugout.trace(i.toString()):e==Level.DEBUG?bugout.debug(i.toString()):e==Level.INFO?bugout.info(i.toString()):e==Level.ERROR?bugout.error(i.toString()):bugout.info(i.toString()))}"undefined"!=typeof logAjax&&logAjax.enabled&&e.level>=logAjax.level&&saveLog(e.name,t[0],t[1])},this.callAppenders=function(e){for(var t=this.getEffectiveAppenders(),r=0,n=t.length;r<n;r++)t[r].doAppend(e)},this.setLevel=function(e){n&&null===e?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):e instanceof Level?t=e:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return t},this.getEffectiveLevel=function(){for(var e=this;null!==e;e=e.parent){var t=e.getLevel();if(null!==t)return t}},this.group=function(e,t){if(enabled)for(var r=this.getEffectiveAppenders(),n=0,o=r.length;n<o;n++)r[n].group(e,t)},this.groupEnd=function(){if(enabled)for(var e=this.getEffectiveAppenders(),t=0,r=e.length;t<r;t++)e[t].groupEnd()};var c={};this.time=function(e,t){enabled&&(isUndefined(e)?handleError("Logger.time: a name for the timer must be supplied"):!t||t instanceof Level?c[e]=new Timer(e,t):handleError("Logger.time: level supplied to timer "+e+" is not an instance of log4javascript.Level"))},this.timeEnd=function(e){if(enabled)if(isUndefined(e))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(c[e]){var t=c[e],r=t.getElapsedTime();this.log(t.level,["Timer "+toStr(e)+" completed in "+r+"ms"]),delete c[e]}else logLog.warn("Logger.timeEnd: no timer found with name "+e)},this.assert=function(e){if(enabled&&!e){for(var t=[],r=1,n=arguments.length;r<n;r++)t.push(arguments[r]);(t=0<t.length?t:["Assertion Failure"]).push(newLine),t.push(e),this.log(Level.ERROR,t)}},this.toString=function(){return"Logger["+this.name+"]"}}Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(e){return e.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(e){if("string"!=typeof e&&(e=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(e)+" supplied, returning anonymous logger")),e==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[e]){var t=new Logger(e);loggers[e]=t,loggerNames.push(e);var r,n=e.lastIndexOf(".");if(-1<n){var o=e.substring(0,n);r=log4javascript.getLogger(o)}else r=rootLogger;r.addChild(t)}return loggers[e]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){return defaultLogger||(defaultLogger=createDefaultLogger()),defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName)).setLevel(Level.OFF),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(e,t,r,n,o){this.logger=e,this.timeStamp=t,this.timeStampInMilliseconds=t.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=r,this.messages=n,this.exception=o};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(e){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(e)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(e){return this.isTimeStampsInMilliseconds()?e.timeStampInMilliseconds:e.timeStampInSeconds},getDataValues:function(e,t){var r=[[this.loggerKey,e.logger.name],[this.timeStampKey,this.getTimeStampValue(e)],[this.levelKey,e.level.name],[this.urlKey,window.location.href],[this.messageKey,t?e.getCombinedMessages():e.messages]];if(this.isTimeStampsInMilliseconds()||r.push([this.millisecondsKey,e.milliseconds]),e.exception&&r.push([this.exceptionKey,getExceptionStringRep(e.exception)]),this.hasCustomFields())for(var n=0,o=this.customFields.length;n<o;n++){var i=this.customFields[n].value;"function"==typeof i&&(i=i(this,e)),r.push([this.customFields[n].name,i])}return r},setKeys:function(e,t,r,n,o,i,s){this.loggerKey=extractStringFromParam(e,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(t,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(r,this.defaults.levelKey),this.messageKey=extractStringFromParam(n,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(o,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(i,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(s,this.defaults.millisecondsKey)},setCustomField:function(e,t){for(var r=!1,n=0,o=this.customFields.length;n<o;n++)this.customFields[n].name===e&&(this.customFields[n].value=t,r=!0);r||this.customFields.push({name:e,value:t})},hasCustomFields:function(){return 0<this.customFields.length},formatWithException:function(e){var t=this.format(e);return e.exception&&this.ignoresThrowable()&&(t+=e.getThrowableStrRep()),t},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){},SimpleDateFormat;function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(e){this.combineMessages=extractBooleanFromParam(e,!0),this.customFields=[]}function escapeNewLines(e){return e.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(e,t){this.readable=extractBooleanFromParam(e,!1),this.combineMessages=extractBooleanFromParam(t,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(e,t,r){var p=[];return function e(t,r,o){var n,i,s,a,c,l,d;function u(e){for(var t=splitIntoLines(e),r=1,n=t.length;r<n;r++)t[r]=o+t[r];return t.join(newLine)}if(o||(o=""),null===t)return"null";if(void 0===t)return"undefined";if("string"==typeof t)return u(t);if("object"==typeof t&&array_contains(p,t)){try{l=toStr(t)}catch(e){l="Error formatting property. Details: "+getExceptionStringRep(e)}return l+" [already expanded]"}if(t instanceof Array&&0<r){for(p.push(t),l="["+newLine,s=r-1,a=o+"  ",c=[],n=0,i=t.length;n<i;n++)try{d=e(t[n],s,a),c.push(a+d)}catch(e){c.push(a+"Error formatting array member. Details: "+getExceptionStringRep(e))}return l+=c.join(","+newLine)+newLine+o+"]"}if("[object Date]"==Object.prototype.toString.call(t))return t.toString();if("object"==typeof t&&0<r){for(n in p.push(t),l="{"+newLine,s=r-1,a=o+"  ",c=[],t)try{d=e(t[n],s,a),c.push(a+n+": "+d)}catch(e){c.push(a+n+": Error formatting property. Details: "+getExceptionStringRep(e))}return l+=c.join(","+newLine)+newLine+o+"}"}return u(toStr(t))}(e,t,r)}function PatternLayout(e){this.pattern=e||PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(e){enabled&&e.level.level>=this.threshold.level&&this.append(e)},Appender.prototype.append=function(e){},Appender.prototype.setLayout=function(e){e instanceof Layout?this.layout=e:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(e){e instanceof Level?this.threshold=e:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(e){this.loggers.push(e)},Appender.prototype.setRemovedFromLogger=function(e){array_remove(this.loggers,e)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(e){return e.level.name+" - "+e.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(e){return e.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(e){var t=e.messages,r=e.exception;return r?t.concat([r]):t},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(e){return e.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(e){var t,r,n=this;function o(e){return e="string"==typeof e?e:toStr(e),"<log4javascript:message><![CDATA["+n.escapeCdata(e)+"]]></log4javascript:message>"}var i='<log4javascript:event logger="'+e.logger.name+'" timestamp="'+this.getTimeStampValue(e)+'"';if(this.isTimeStampsInMilliseconds()||(i+=' milliseconds="'+e.milliseconds+'"'),i+=' level="'+e.level.name+'">'+newLine,this.combineMessages)i+=o(e.getCombinedMessages());else{for(i+="<log4javascript:messages>"+newLine,t=0,r=e.messages.length;t<r;t++)i+=o(e.messages[t])+newLine;i+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(t=0,r=this.customFields.length;t<r;t++)i+='<log4javascript:customfield name="'+this.customFields[t].name+'"><![CDATA['+this.customFields[t].value.toString()+"]]></log4javascript:customfield>"+newLine;return e.exception&&(i+="<log4javascript:exception><![CDATA["+getExceptionStringRep(e.exception)+"]]></log4javascript:exception>"+newLine),i+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(e){var t,r,c=this,n=this.getDataValues(e,this.combineMessages),o="{"+this.lineBreak;function l(e,t,r){var n,o=typeof e;if(e instanceof Date)n=String(e.getTime());else if(r&&e instanceof Array){n="["+c.lineBreak;for(var i=0,s=e.length;i<s;i++){var a=t+c.tab;n+=a+l(e[i],a,!1),i<e.length-1&&(n+=","),n+=c.lineBreak}n+=t+"]"}else n="number"!==o&&"boolean"!==o?'"'+escapeNewLines(toStr(e).replace(/\"/g,'\\"'))+'"':e;return n}for(t=0,r=n.length-1;t<=r;t++)o+=this.tab+'"'+n[t][0]+'"'+this.colon+l(n[t][1],this.tab,!0),t<r&&(o+=","),o+=this.lineBreak;return o+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(e){for(var t=this.getDataValues(e),r=[],n=0,o=t.length;n<o;n++){var i=t[n][1]instanceof Date?String(t[n][1].getTime()):t[n][1];r.push(urlEncode(t[n][0])+"="+urlEncode(i))}return r.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(e){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout,function(){var m=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,g=["January","February","March","April","May","June","July","August","September","October","November","December"],v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y={G:0,y:3,M:4,w:2,W:2,D:2,d:2,F:2,E:1,a:0,H:2,k:2,K:2,h:2,m:2,s:2,S:2,Z:5},o=function(e,t,r){var n=new Date(e,t,r,0,0,0);return n.setMilliseconds(0),n};Date.prototype.getDifference=function(e){return this.getTime()-e.getTime()},Date.prototype.isBefore=function(e){return this.getTime()<e.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(e){return this.getUTCTime()-e.getUTCTime()},Date.prototype.getPreviousSunday=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),t=new Date(e.getTime()-864e5*this.getDay());return o(t.getFullYear(),t.getMonth(),t.getDate())},Date.prototype.getWeekInYear=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=o(this.getFullYear(),0,1),n=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return 7-r.getDay()<e&&n--,n},Date.prototype.getWeekInMonth=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=o(this.getFullYear(),this.getMonth(),1),n=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return e<=7-r.getDay()&&n++,n},Date.prototype.getDayInYear=function(){var e=o(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(e)/864e5)},(SimpleDateFormat=function(e){this.formatString=e}).prototype.setMinimalDaysInFirstWeek=function(e){this.minimalDaysInFirstWeek=e},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?1:this.minimalDaysInFirstWeek};var b=function(e,t){for(;e.length<t;)e="0"+e;return e},_=function(e,t,r){return 4<=t?e:e.substr(0,Math.max(r,t))},S=function(e,t){return b(""+e,t)};SimpleDateFormat.prototype.format=function(e){for(var t,r="",n=this.formatString;t=m.exec(n);){var o=t[1],i=t[2],s=t[3],a=t[4];if(o)r+="''"==o?"'":o.substring(1,o.length-1);else if(s);else if(a)r+=a;else if(i){var c=i.charAt(0),l=i.length,d="";switch(c){case"G":d="AD";break;case"y":d=e.getFullYear();break;case"M":d=e.getMonth();break;case"w":d=e.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":d=e.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":d=e.getDayInYear();break;case"d":d=e.getDate();break;case"F":d=1+Math.floor((e.getDate()-1)/7);break;case"E":d=v[e.getDay()];break;case"a":d=12<=e.getHours()?"PM":"AM";break;case"H":d=e.getHours();break;case"k":d=e.getHours()||24;break;case"K":d=e.getHours()%12;break;case"h":d=e.getHours()%12||12;break;case"m":d=e.getMinutes();break;case"s":d=e.getSeconds();break;case"S":d=e.getMilliseconds();break;case"Z":d=e.getTimezoneOffset()}switch(y[c]){case 0:r+=_(d,l,2);break;case 1:r+=_(d,l,3);break;case 2:r+=S(d,l);break;case 3:if(l<=3)r+=(""+d).substr(2,2);else r+=S(d,l);break;case 4:r+=3<=l?_(g[d],l,l):S(d+1,l);break;case 5:var u=0<d?"-":"+",p=Math.abs(d),f=""+Math.floor(p/60),h=""+p%60;r+=u+(f=b(f,2))+(h=b(h,2))}}n=n.substr(t.index+t[0].length)}return r}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(e){for(var t,r=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,n="",o=this.pattern;t=r.exec(o);){var i=t[0],s=t[1],a=t[2],c=t[3],l=t[5],d=t[6];if(d)n+=""+d;else{var u,p="";switch(c){case"a":case"m":var f=0;l&&(f=parseInt(l,10),isNaN(f)&&(handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character '"+c+"' - should be a number"),f=0));for(var h="a"===c?e.messages[0]:e.messages,m=0,g=h.length;m<g;m++)0<m&&" "!==p.charAt(p.length-1)&&(p+=" "),p+=0===f?h[m]:formatObjectExpansion(h[m],f);break;case"c":var v=e.logger.name;if(l){var y=parseInt(l,10),b=e.logger.name.split(".");p=y>=b.length?v:b.slice(b.length-y).join(".")}else p=v;break;case"d":var _=PatternLayout.ISO8601_DATEFORMAT;l&&("ISO8601"==(_=l)?_=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==_?_=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==_&&(_=PatternLayout.DATETIME_DATEFORMAT)),p=new SimpleDateFormat(_).format(e.timeStamp);break;case"f":if(this.hasCustomFields()){var S=0;l&&(S=parseInt(l,10),isNaN(S)?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - should be a number"):0===S?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - must be greater than zero"):S>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - there aren't that many custom fields"):S-=1);var w=this.customFields[S].value;"function"==typeof w&&(w=w(this,e)),p=w}break;case"n":p=newLine;break;case"p":p=e.level.name;break;case"r":p=""+e.timeStamp.getDifference(applicationStartDate);break;case"%":p="%";break;default:p=i}if(a){u=parseInt(a.substr(1),10);var E=p.length;u<E&&(p=p.substring(E-u,E))}if(s)if("-"==s.charAt(0))for(u=parseInt(s.substr(1),10);p.length<u;)p+=" ";else for(u=parseInt(s,10);p.length<u;)p=" "+p;n+=p}o=o.substr(t.index+t[0].length)}return n},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(e){alert(this.getLayout().formatWithException(e))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(t){var e,r=this,n=function(){var e=r.getLayout().formatWithException(t);return"string"==typeof e?[e]:e};if((e=window.console)&&e.log){var o,i=n();e[o=e.debug&&Level.DEBUG.isGreaterOrEqual(t.level)?"debug":e.info&&Level.INFO.equals(t.level)?"info":e.warn&&Level.WARN.equals(t.level)?"warn":e.error&&t.level.isGreaterOrEqual(Level.ERROR)?"error":"log"].apply?e[o].apply(e,i):e[o](i)}else"undefined"!=typeof opera&&opera.postError&&opera.postError(n())},BrowserConsoleAppender.prototype.group=function(e){window.console&&window.console.group&&window.console.group(e)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(e){for(var t,r=null,n=0,o=xmlHttpFactories.length;n<o;n++){t=xmlHttpFactories[n];try{return r=t(),withCredentialsSupported=t==xhrFactory&&"withCredentials"in r,getXmlHttp=t,r}catch(e){}}e?e():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")},ConsoleAppender;function isHttpRequestSuccessful(e){return isUndefined(e.status)||0===e.status||200<=e.status&&e.status<300||1223==e.status}function AjaxAppender(a,c){var o=this,l=!0;a||(handleError("AjaxAppender: URL must be specified in constructor"),l=!1);var i=this.defaults.timed,s=this.defaults.waitForResponse,d=this.defaults.batchSize,t=this.defaults.timerInterval,u=this.defaults.requestSuccessCallback,p=this.defaults.failCallback,f=this.defaults.postVarName,h=this.defaults.sendAllOnUnload,m=this.defaults.contentType,r=null,g=[],v=[],y=[],b=!1,_=!1;function n(e){return!_||(handleError("AjaxAppender: configuration option '"+e+"' may not be set after the appender has been initialized"),!1)}function S(){var e;if(l&&enabled)if(b=!0,s)0<v.length?I(E(e=v.shift()),S):(b=!1,i&&C());else{for(;e=v.shift();)I(E(e));b=!1,i&&C()}}function w(){var e=!1;if(l&&enabled){for(var t,r=o.getLayout().allowBatching()?d:1,n=[];t=g.shift();)n.push(t),g.length>=r&&(v.push(n),n=[]);0<n.length&&v.push(n),e=0<v.length,i=s=!1,S()}return e}function E(e){for(var t,r=[],n="";t=e.shift();)r.push(o.getLayout().formatWithException(t));return n=1==e.length?r.join(""):o.getLayout().batchHeader+r.join(o.getLayout().batchSeparator)+o.getLayout().batchFooter,m==o.defaults.contentType&&(0<(n=o.getLayout().returnsPostData?n:urlEncode(f)+"="+urlEncode(n)).length&&(n+="&"),n+="layout="+urlEncode(o.getLayout().toString())),n}function C(){window.setTimeout(S,t)}function T(){var e="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(e),l=!1,p&&p(e)}function I(e,t){try{var r=getXmlHttp(T);if(l){r.onreadystatechange=function(){if(4==r.readyState){if(isHttpRequestSuccessful(r))u&&u(r),t&&t(r);else{var e="AjaxAppender.append: XMLHttpRequest request to URL "+a+" returned status code "+r.status;handleError(e),p&&p(e)}r.onreadystatechange=emptyFunction,r=null}},r.open("POST",a,!0),c&&withCredentialsSupported&&(r.withCredentials=!0);try{for(var n,o=0;n=y[o++];)r.setRequestHeader(n.name,n.value);r.setRequestHeader("Content-Type",m)}catch(e){var i="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(i),l=!1,void(p&&p(i))}r.send(e)}}catch(e){var s="AjaxAppender.append: error sending log message to "+a;handleError(s,e),l=!1,p&&p(s+". Details: "+getExceptionStringRep(e))}}this.getSessionId=function(){return r},this.setSessionId=function(e){r=extractStringFromParam(e,null),this.layout.setCustomField("sessionid",r)},this.setLayout=function(e){n("layout")&&(this.layout=e,null!==r&&this.setSessionId(r))},this.isTimed=function(){return i},this.setTimed=function(e){n("timed")&&(i=bool(e))},this.getTimerInterval=function(){return t},this.setTimerInterval=function(e){n("timerInterval")&&(t=extractIntFromParam(e,t))},this.isWaitForResponse=function(){return s},this.setWaitForResponse=function(e){n("waitForResponse")&&(s=bool(e))},this.getBatchSize=function(){return d},this.setBatchSize=function(e){n("batchSize")&&(d=extractIntFromParam(e,d))},this.isSendAllOnUnload=function(){return h},this.setSendAllOnUnload=function(e){n("sendAllOnUnload")&&(h=extractBooleanFromParam(e,h))},this.setRequestSuccessCallback=function(e){u=extractFunctionFromParam(e,u)},this.setFailCallback=function(e){p=extractFunctionFromParam(e,p)},this.getPostVarName=function(){return f},this.setPostVarName=function(e){n("postVarName")&&(f=extractStringFromParam(e,f))},this.getHeaders=function(){return y},this.addHeader=function(e,t){"content-type"==e.toLowerCase()?m=t:y.push({name:e,value:t})},this.sendAll=S,this.sendAllRemaining=w,this.append=function(e){if(l){_||function(){if(_=!0,h){var e=window.onbeforeunload;window.onbeforeunload=function(){e&&e(),w()}}i&&C()}(),g.push(e);var t=this.getLayout().allowBatching()?d:1;if(g.length>=t){for(var r,n=[];r=g.shift();)n.push(r);v.push(n),i||s&&(!s||b)||S()}}}}function setCookie(e,t,r,n){var o;if(n=n?"; path="+n:"",r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),o="; expires="+i.toGMTString()}else o="";document.cookie=escape(e)+"="+escape(t)+o+n}function getCookie(e){for(var t=escape(e)+"=",r=document.cookie.split(";"),n=0,o=r.length;n<o;n++){for(var i=r[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return unescape(i.substring(t.length,i.length))}return null}function getBaseUrl(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t)if(-1!=e[t].src.indexOf("log4javascript")){var n=e[t].src.lastIndexOf("/");return-1==n?"":e[t].src.substr(0,n+1)}return null}function isLoaded(e){try{return bool(e.loaded)}catch(e){return!1}}function padWithSpaces(e,t){if(e.length<t){for(var r=[],n=Math.max(0,t-e.length),o=0;o<n;o++)r[o]=" ";e+=r.join("")}return e}function createDefaultLogger(){var e=log4javascript.getLogger(defaultLoggerName),t=new log4javascript.PopUpAppender;return e.addAppender(t),e}if(AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender,function(){var ee=[],te=1;function e(e,t,r,n,o){this.create(!1,null,e,t,r,n,o,this.defaults.focusPopUp)}function t(e,t,r,n,o,i){this.create(!0,e,t,r,n,o,i,!1)}(ConsoleAppender=function(){}).prototype=new Appender,ConsoleAppender.prototype.create=function(e,r,t,a,c,l,d,n){var f=this,o=!1,u=!1,p=!1,h=!1,i=[],m=!0,g=te++;a=extractBooleanFromParam(a,this.defaults.initiallyMinimized),t=extractBooleanFromParam(t,this.defaults.lazyInit),c=extractBooleanFromParam(c,this.defaults.useDocumentWrite);var s=this.defaults.newestMessageAtTop,v=this.defaults.scrollToLatestMessage;l=l||this.defaults.width,d=d||this.defaults.height;var y,b,_,S,w,E=this.defaults.maxMessages,C=this.defaults.showCommandLine,T=this.defaults.commandLineObjectExpansionDepth,I=this.defaults.showHideButton,R=this.defaults.showCloseButton;this.setLayout(this.defaults.layout);var P=e?"InPageAppender":"PopUpAppender",x=function(e){return!u||(handleError(P+": configuration option '"+e+"' may not be set after the appender has been initialized"),!1)},M=function(){return p&&m&&!h};this.isNewestMessageAtTop=function(){return s},this.setNewestMessageAtTop=function(e){s=bool(e),M()&&S().setNewestAtTop(s)},this.isScrollToLatestMessage=function(){return v},this.setScrollToLatestMessage=function(e){v=bool(e),M()&&S().setScrollToLatest(v)},this.getWidth=function(){return l},this.setWidth=function(e){x("width")&&(l=extractStringFromParam(e,l))},this.getHeight=function(){return d},this.setHeight=function(e){x("height")&&(d=extractStringFromParam(e,d))},this.getMaxMessages=function(){return E},this.setMaxMessages=function(e){E=extractIntFromParam(e,E),M()&&S().setMaxMessages(E)},this.isShowCommandLine=function(){return C},this.setShowCommandLine=function(e){C=bool(e),M()&&S().setShowCommandLine(C)},this.isShowHideButton=function(){return I},this.setShowHideButton=function(e){I=bool(e),M()&&S().setShowHideButton(I)},this.isShowCloseButton=function(){return R},this.setShowCloseButton=function(e){R=bool(e),M()&&S().setShowCloseButton(R)},this.getCommandLineObjectExpansionDepth=function(){return T},this.setCommandLineObjectExpansionDepth=function(e){T=extractIntFromParam(e,T)};var k=a;function A(e,t){this.loggingEvent=e,this.levelName=e.level.name,this.formattedMessage=t}function O(e,t){this.name=e,this.initiallyExpanded=t}function U(){}this.isInitiallyMinimized=function(){return a},this.setInitiallyMinimized=function(e){x("initiallyMinimized")&&(a=bool(e),k=a)},this.isUseDocumentWrite=function(){return c},this.setUseDocumentWrite=function(e){x("useDocumentWrite")&&(c=bool(e))},A.prototype.append=function(){S().log(this.levelName,this.formattedMessage)},O.prototype.append=function(){S().group(this.name,this.initiallyExpanded)},U.prototype.append=function(){S().groupEnd()};var L=function(){_(),o?h&&Z&&b():y(),_()&&D()};this.append=function(e){if(m){var t=f.getLayout().formatWithException(e);i.push(new A(e,t)),L()}},this.group=function(e,t){m&&(i.push(new O(e,t)),L())},this.groupEnd=function(){m&&(i.push(new U),L())};var D=function(){for(;0<i.length;)i.shift().append();n&&S().focus()};this.setAddedToLogger=function(e){this.loggers.push(e),enabled&&!t&&y()},this.clear=function(){M()&&S().clearLog(),i.length=0},this.focus=function(){M()&&S().focus()},this.focusCommandLine=function(){M()&&S().focusCommandLine()},this.focusSearch=function(){M()&&S().focusSearch()};var N=window;this.getCommandWindow=function(){return N},this.setCommandWindow=function(e){N=e},this.executeLastCommand=function(){M()&&S().evalLastCommand()};var B=new PatternLayout("%m");this.getCommandLayout=function(){return B},this.setCommandLayout=function(e){B=e},this.evalCommandAndAppend=function(e){var t={appendResult:!0,isError:!1},r="";try{var n,o;!N.eval&&N.execScript&&N.execScript("null");var i={};for(o=0,len=j.length;o<len;o++)i[j[o][0]]=j[o][1];var s=[],a=function(e){s.push([e,N[e]])};a("appender"),N.appender=f,a("commandReturnValue"),N.commandReturnValue=t,a("commandLineFunctionsHash"),N.commandLineFunctionsHash=i;var c=function(e){a(e),N[e]=function(){return this.commandLineFunctionsHash[e](f,arguments,t)}};for(o=0,len=j.length;o<len;o++)c(j[o][0]);for(r=isUndefined(n=N===window&&N.execScript?(a("evalExpr"),a("result"),window.evalExpr=e,N.execScript("window.result=eval(window.evalExpr);"),window.result):N.eval(e))?n:formatObjectExpansion(n,T),o=0,len=s.length;o<len;o++)N[s[o][0]]=s[o][1]}catch(e){r="Error evaluating command: "+getExceptionStringRep(e),t.isError=!0}if(t.appendResult){var l=">>> "+e;isUndefined(r)||(l+=newLine+r);var d=t.isError?Level.ERROR:Level.INFO,u=new LoggingEvent(null,new Date,d,[l],null),p=this.getLayout();this.setLayout(B),this.append(u),this.setLayout(p)}};var j=ee.concat([]);this.addCommandLineFunction=function(e,t){j.push([e,t])};var F="log4javascriptCommandHistory";this.storeCommandHistory=function(e){setCookie(F,e.join(","))};var V=function(e){var t=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"\t<head>","\t\t<title>log4javascript</title>",'\t\t<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"\t\t\x3c!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work --\x3e",'\t\t<meta http-equiv="X-UA-Compatible" content="IE=7" />','\t\t<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','\t\t\x3c!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]--\x3e','\t\t\x3c!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]--\x3e','\t\t<script type="text/javascript">',"\t\t\t//<![CDATA[","\t\t\tvar loggingEnabled = true;","\t\t\tvar logQueuedEventsTimer = null;","\t\t\tvar logEntries = [];","\t\t\tvar logEntriesAndSeparators = [];","\t\t\tvar logItems = [];","\t\t\tvar renderDelay = 100;","\t\t\tvar unrenderedLogItemsExist = false;","\t\t\tvar rootGroup, currentGroup = null;","\t\t\tvar loaded = false;","\t\t\tvar currentLogItem = null;","\t\t\tvar logMainContainer;","","\t\t\tfunction copyProperties(obj, props) {","\t\t\t\tfor (var i in props) {","\t\t\t\t\tobj[i] = props[i];","\t\t\t\t}","\t\t\t}","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItem() {","\t\t\t}","","\t\t\tLogItem.prototype = {","\t\t\t\tmainContainer: null,","\t\t\t\twrappedContainer: null,","\t\t\t\tunwrappedContainer: null,","\t\t\t\tgroup: null,","","\t\t\t\tappendToLog: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].appendToLog();","\t\t\t\t\t}","\t\t\t\t\tthis.group.update();","\t\t\t\t},","","\t\t\t\tdoRemove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].remove();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = null;","\t\t\t\t\t\tthis.wrappedElementContainer = null;","\t\t\t\t\t\tthis.mainElementContainer = null;","\t\t\t\t\t}","\t\t\t\t\tif (this.group && removeFromGroup) {","\t\t\t\t\t\tthis.group.removeChild(this, doUpdate);","\t\t\t\t\t}","\t\t\t\t\tif (this === currentLogItem) {","\t\t\t\t\t\tcurrentLogItem = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\trender: function() {},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visit(this);","\t\t\t\t},","","\t\t\t\tgetUnwrappedDomContainer: function() {","\t\t\t\t\treturn this.group.unwrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetWrappedDomContainer: function() {","\t\t\t\t\treturn this.group.wrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetMainDomContainer: function() {","\t\t\t\t\treturn this.group.mainElementContainer.contentDiv;","\t\t\t\t}","\t\t\t};","","\t\t\tLogItem.serializedItemKeys = {LOG_ENTRY: 0, GROUP_START: 1, GROUP_END: 2};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContainerElement() {","\t\t\t}","","\t\t\tLogItemContainerElement.prototype = {","\t\t\t\tappendToLog: function() {","\t\t\t\t\tvar insertBeforeFirst = (newestAtTop && this.containerDomNode.hasChildNodes());","\t\t\t\t\tif (insertBeforeFirst) {","\t\t\t\t\t\tthis.containerDomNode.insertBefore(this.mainDiv, this.containerDomNode.firstChild);","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.containerDomNode.appendChild(this.mainDiv);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction SeparatorElementContainer(containerDomNode) {","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "separator";','\t\t\t\tthis.mainDiv.innerHTML = "&nbsp;";',"\t\t\t}","","\t\t\tSeparatorElementContainer.prototype = new LogItemContainerElement();","","\t\t\tSeparatorElementContainer.prototype.remove = function() {","\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\tthis.mainDiv = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Separator() {","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tSeparator.prototype = new LogItem();","","\t\t\tcopyProperties(Separator.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.unwrappedElementContainer = new SeparatorElementContainer(this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new SeparatorElementContainer(this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new SeparatorElementContainer(this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupElementContainer(group, containerDomNode, isRoot, isWrapped) {","\t\t\t\tthis.group = group;","\t\t\t\tthis.containerDomNode = containerDomNode;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.isWrapped = isWrapped;","\t\t\t\tthis.expandable = false;","","\t\t\t\tif (this.isRoot) {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.contentDiv = logMainContainer.appendChild(document.createElement("div"));','\t\t\t\t\t\tthis.contentDiv.id = this.isWrapped ? "log_wrapped" : "log_unwrapped";',"\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentDiv = logMainContainer;","\t\t\t\t\t}","\t\t\t\t} else {","\t\t\t\t\tvar groupElementContainer = this;","\t\t\t\t\t",'\t\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\t\tthis.mainDiv.className = "group";',"",'\t\t\t\t\tthis.headingDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tthis.headingDiv.className = "groupheading";',"",'\t\t\t\t\tthis.expander = this.headingDiv.appendChild(document.createElement("span"));','\t\t\t\t\tthis.expander.className = "expander unselectable greyedout";',"\t\t\t\t\tthis.expander.unselectable = true;",'\t\t\t\t\tvar expanderText = this.group.expanded ? "-" : "+";',"\t\t\t\t\tthis.expanderTextNode = this.expander.appendChild(document.createTextNode(expanderText));","\t\t\t\t\t",'\t\t\t\t\tthis.headingDiv.appendChild(document.createTextNode(" " + this.group.name));',"",'\t\t\t\t\tthis.contentDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tvar contentCssClass = this.group.expanded ? "expanded" : "collapsed";','\t\t\t\t\tthis.contentDiv.className = "groupcontent " + contentCssClass;',"","\t\t\t\t\tthis.expander.onclick = function() {","\t\t\t\t\t\tif (groupElementContainer.group.expandable) {","\t\t\t\t\t\t\tgroupElementContainer.group.toggleExpanded();","\t\t\t\t\t\t}","\t\t\t\t\t};","\t\t\t\t}","\t\t\t}","","\t\t\tGroupElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(GroupElementContainer.prototype, {","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tvar oldCssClass, newCssClass, expanderText;","\t\t\t\t\t\tif (this.group.expanded) {",'\t\t\t\t\t\t\tnewCssClass = "expanded";','\t\t\t\t\t\t\toldCssClass = "collapsed";','\t\t\t\t\t\t\texpanderText = "-";',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tnewCssClass = "collapsed";','\t\t\t\t\t\t\toldCssClass = "expanded";','\t\t\t\t\t\t\texpanderText = "+";',"\t\t\t\t\t\t}","\t\t\t\t\t\treplaceClass(this.contentDiv, newCssClass, oldCssClass);","\t\t\t\t\t\tthis.expanderTextNode.nodeValue = expanderText;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tthis.headingDiv = null;","\t\t\t\t\t\tthis.expander.onclick = null;","\t\t\t\t\t\tthis.expander = null;","\t\t\t\t\t\tthis.expanderTextNode = null;","\t\t\t\t\t\tthis.contentDiv = null;","\t\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\t// Invert the order of the log entries","\t\t\t\t\tvar node = null;","","\t\t\t\t\t// Remove all the log container nodes","\t\t\t\t\tvar childDomNodes = [];","\t\t\t\t\twhile ((node = this.contentDiv.firstChild)) {","\t\t\t\t\t\tthis.contentDiv.removeChild(node);","\t\t\t\t\t\tchildDomNodes.push(node);","\t\t\t\t\t}","","\t\t\t\t\t// Put them all back in reverse order","\t\t\t\t\twhile ((node = childDomNodes.pop())) {","\t\t\t\t\t\tthis.contentDiv.appendChild(node);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tif (this.group.expandable) {",'\t\t\t\t\t\t\tremoveClass(this.expander, "greyedout");',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\taddClass(this.expander, "greyedout");',"\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tif (this.isRoot) {",'\t\t\t\t\t\tthis.contentDiv.innerHTML = "";',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Group(name, isRoot, initiallyExpanded) {","\t\t\t\tthis.name = name;","\t\t\t\tthis.group = null;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.initiallyExpanded = initiallyExpanded;","\t\t\t\tthis.elementContainers = [];","\t\t\t\tthis.children = [];","\t\t\t\tthis.expanded = initiallyExpanded;","\t\t\t\tthis.rendered = false;","\t\t\t\tthis.expandable = false;","\t\t\t}","","\t\t\tGroup.prototype = new LogItem();","","\t\t\tcopyProperties(Group.prototype, {","\t\t\t\taddChild: function(logItem) {","\t\t\t\t\tthis.children.push(logItem);","\t\t\t\t\tlogItem.group = this;","\t\t\t\t},","","\t\t\t\trender: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tvar unwrappedDomContainer, wrappedDomContainer;","\t\t\t\t\t\tif (this.isRoot) {","\t\t\t\t\t\t\tunwrappedDomContainer = logMainContainer;","\t\t\t\t\t\t\twrappedDomContainer = logMainContainer;","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tunwrappedDomContainer = this.getUnwrappedDomContainer();","\t\t\t\t\t\t\twrappedDomContainer = this.getWrappedDomContainer();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = new GroupElementContainer(this, unwrappedDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.wrappedElementContainer = new GroupElementContainer(this, wrappedDomContainer, this.isRoot, true);","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tvar mainDomContainer = this.isRoot ? logMainContainer : this.getMainDomContainer();","\t\t\t\t\t\tthis.mainElementContainer = new GroupElementContainer(this, mainDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tthis.expanded = !this.expanded;","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\texpand: function() {","\t\t\t\t\tif (!this.expanded) {","\t\t\t\t\t\tthis.toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitGroup(this);","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].reverseChildren();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tvar previouslyExpandable = this.expandable;","\t\t\t\t\tthis.expandable = (this.children.length !== 0);","\t\t\t\t\tif (this.expandable !== previouslyExpandable) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].update();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tflatten: function() {","\t\t\t\t\tvar visitor = new GroupFlattener();","\t\t\t\t\tthis.accept(visitor);","\t\t\t\t\treturn visitor.logEntriesAndSeparators;","\t\t\t\t},","","\t\t\t\tremoveChild: function(child, doUpdate) {","\t\t\t\t\tarray_remove(this.children, child);","\t\t\t\t\tchild.group = null;","\t\t\t\t\tif (doUpdate) {","\t\t\t\t\t\tthis.update();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].remove(false, false);","\t\t\t\t\t}","\t\t\t\t\tthis.children = [];","\t\t\t\t\tthis.update();","\t\t\t\t\tif (this === currentGroup) {","\t\t\t\t\t\tcurrentGroup = this.group;","\t\t\t\t\t}","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_START, this.name]);","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].serialize(items);","\t\t\t\t\t}","\t\t\t\t\tif (this !== currentGroup) {","\t\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_END]);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clear();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryElementContainer() {","\t\t\t}","","\t\t\tLogEntryElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(LogEntryElementContainer.prototype, {","\t\t\t\tremove: function() {","\t\t\t\t\tthis.doRemove();","\t\t\t\t},","","\t\t\t\tdoRemove: function() {","\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\tthis.contentElement = null;","\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentElement.innerHTML = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {",'\t\t\t\t\tvar oldCssClass = isMatch ? "searchnonmatch" : "searchmatch";','\t\t\t\t\tvar newCssClass = isMatch ? "searchmatch" : "searchnonmatch";',"\t\t\t\t\treplaceClass(this.mainDiv, newCssClass, oldCssClass);","\t\t\t\t},","","\t\t\t\tclearSearch: function() {",'\t\t\t\t\tremoveClass(this.mainDiv, "searchmatch");','\t\t\t\t\tremoveClass(this.mainDiv, "searchnonmatch");',"\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryWrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");',"\t\t\t\tthis.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.mainDiv.className = "logentry wrapped " + this.logEntry.level;',"\t\t\t\tthis.contentElement = this.mainDiv;","\t\t\t}","","\t\t\tLogEntryWrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryWrappedElementContainer.prototype.setContent = function(content, wrappedContent) {","\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t} else {","\t\t\t\t\tthis.contentElement.innerHTML = wrappedContent;","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryUnwrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry unwrapped " + this.logEntry.level;','\t\t\t\tthis.pre = this.mainDiv.appendChild(document.createElement("pre"));',"\t\t\t\tthis.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.pre.className = "unwrapped";',"\t\t\t\tthis.contentElement = this.pre;","\t\t\t}","","\t\t\tLogEntryUnwrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryUnwrappedElementContainer.prototype.remove = function() {","\t\t\t\tthis.doRemove();","\t\t\t\tthis.pre = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryMainElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry nonielogentry " + this.logEntry.level;','\t\t\t\tthis.contentElement = this.mainDiv.appendChild(document.createElement("span"));',"\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));","\t\t\t}","","\t\t\tLogEntryMainElementContainer.prototype = new LogEntryElementContainer();","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntry(level, formattedMessage) {","\t\t\t\tthis.level = level;","\t\t\t\tthis.formattedMessage = formattedMessage;","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tLogEntry.prototype = new LogItem();","","\t\t\tcopyProperties(LogEntry.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar logEntry = this;","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","","\t\t\t\t\t// Support for the CSS attribute white-space in IE for Windows is","\t\t\t\t\t// non-existent pre version 6 and slightly odd in 6, so instead","\t\t\t\t\t// use two different HTML elements","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.formattedMessage = this.formattedMessage.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\tthis.unwrappedElementContainer = new LogEntryUnwrappedElementContainer(this, this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new LogEntryWrappedElementContainer(this, this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new LogEntryMainElementContainer(this, this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content != this.content) {","\t\t\t\t\t\tif (isIe && (content !== this.formattedMessage)) {",'\t\t\t\t\t\t\tcontent = content.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\t}","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].setContent(content, wrappedContent);","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.content = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tgetSearchMatches: function() {","\t\t\t\t\tvar matches = [];","\t\t\t\t\tvar i, len;","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tvar unwrappedEls = getElementsByClass(this.unwrappedElementContainer.mainDiv, "searchterm", "span");','\t\t\t\t\t\tvar wrappedEls = getElementsByClass(this.wrappedElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = unwrappedEls.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, null, unwrappedEls[i], wrappedEls[i]);","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tvar els = getElementsByClass(this.mainElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = els.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, els[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn matches;","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].setSearchMatch(isMatch);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclearSearch: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clearSearch();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitLogEntry(this);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.LOG_ENTRY, this.level, this.formattedMessage]);","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemVisitor() {","\t\t\t}","","\t\t\tLogItemVisitor.prototype = {","\t\t\t\tvisit: function(logItem) {","\t\t\t\t},","","\t\t\t\tvisitParent: function(logItem) {","\t\t\t\t\tif (logItem.group) {","\t\t\t\t\t\tlogItem.group.accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitChildren: function(logItem) {","\t\t\t\t\tfor (var i = 0, len = logItem.children.length; i < len; i++) {","\t\t\t\t\t\tlogItem.children[i].accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitLogEntry: function(logEntry) {","\t\t\t\t\tthis.visit(logEntry);","\t\t\t\t},","","\t\t\t\tvisitSeparator: function(separator) {","\t\t\t\t\tthis.visit(separator);","\t\t\t\t},","","\t\t\t\tvisitGroup: function(group) {","\t\t\t\t\tthis.visit(group);","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupFlattener() {","\t\t\t\tthis.logEntriesAndSeparators = [];","\t\t\t}","","\t\t\tGroupFlattener.prototype = new LogItemVisitor();","","\t\t\tGroupFlattener.prototype.visitGroup = function(group) {","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitLogEntry = function(logEntry) {","\t\t\t\tthis.logEntriesAndSeparators.push(logEntry);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitSeparator = function(separator) {","\t\t\t\tthis.logEntriesAndSeparators.push(separator);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\twindow.onload = function() {","\t\t\t\t// Sort out document.domain","\t\t\t\tif (location.search) {",'\t\t\t\t\tvar queryBits = unescape(location.search).substr(1).split("&"), nameValueBits;',"\t\t\t\t\tfor (var i = 0, len = queryBits.length; i < len; i++) {",'\t\t\t\t\t\tnameValueBits = queryBits[i].split("=");','\t\t\t\t\t\tif (nameValueBits[0] == "log4javascript_domain") {',"\t\t\t\t\t\t\tdocument.domain = nameValueBits[1];","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","","\t\t\t\t// Create DOM objects",'\t\t\t\tlogMainContainer = $("log");',"\t\t\t\tif (isIePre7) {",'\t\t\t\t\taddClass(logMainContainer, "oldIe");',"\t\t\t\t}","",'\t\t\t\trootGroup = new Group("root", true);',"\t\t\t\trootGroup.render();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\t","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t\ttoggleLoggingEnabled();","\t\t\t\ttoggleSearchEnabled();","\t\t\t\ttoggleSearchFilter();","\t\t\t\ttoggleSearchHighlight();","\t\t\t\tapplyFilters();","\t\t\t\tcheckAllLevels();","\t\t\t\ttoggleWrap();","\t\t\t\ttoggleNewestAtTop();","\t\t\t\ttoggleScrollToLatest();","\t\t\t\trenderQueuedLogItems();","\t\t\t\tloaded = true;",'\t\t\t\t$("command").value = "";','\t\t\t\t$("command").autocomplete = "off";','\t\t\t\t$("command").onkeydown = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 10 || evt.keyCode == 13) { // Return/Enter","\t\t\t\t\t\tevalCommandLine();","\t\t\t\t\t\tstopPropagation(evt);","\t\t\t\t\t} else if (evt.keyCode == 27) { // Escape",'\t\t\t\t\t\tthis.value = "";',"\t\t\t\t\t\tthis.focus();","\t\t\t\t\t} else if (evt.keyCode == 38 && commandHistory.length > 0) { // Up","\t\t\t\t\t\tcurrentCommandIndex = Math.max(0, currentCommandIndex - 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t} else if (evt.keyCode == 40 && commandHistory.length > 0) { // Down","\t\t\t\t\t\tcurrentCommandIndex = Math.min(commandHistory.length - 1, currentCommandIndex + 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keypress moving the caret in Firefox",'\t\t\t\t$("command").onkeypress = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 38 && commandHistory.length > 0 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keyup event blurring the input in Opera",'\t\t\t\t$("command").onkeyup = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 27 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t\tthis.focus();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Add document keyboard shortcuts","\t\t\t\tdocument.onkeydown = function keyEventHandler(evt) {","\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tswitch (evt.keyCode) {","\t\t\t\t\t\tcase 69: // Ctrl + shift + E: re-execute last command","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tevalLastCommand();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 75: // Ctrl + shift + K: focus search","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusSearch();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 40: // Ctrl + shift + down arrow: focus command line","\t\t\t\t\t\tcase 76: // Ctrl + shift + L: focus command line","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusCommandLine();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Workaround to make sure log div starts at the correct size","\t\t\t\tsetTimeout(setLogContainerHeight, 20);","","\t\t\t\tsetShowCommandLine(showCommandLine);","\t\t\t\tdoSearch();","\t\t\t};","","\t\t\twindow.onunload = function() {","\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\tappender.unload();","\t\t\t\t}","\t\t\t\tappender = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction toggleLoggingEnabled() {",'\t\t\t\tsetLoggingEnabled($("enableLogging").checked);',"\t\t\t}","","\t\t\tfunction setLoggingEnabled(enable) {","\t\t\t\tloggingEnabled = enable;","\t\t\t}","","\t\t\tvar appender = null;","","\t\t\tfunction setAppender(appenderParam) {","\t\t\t\tappender = appenderParam;","\t\t\t}","","\t\t\tfunction setShowCloseButton(showCloseButton) {",'\t\t\t\t$("closeButton").style.display = showCloseButton ? "inline" : "none";',"\t\t\t}","","\t\t\tfunction setShowHideButton(showHideButton) {",'\t\t\t\t$("hideButton").style.display = showHideButton ? "inline" : "none";',"\t\t\t}","","\t\t\tvar newestAtTop = false;","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContentReverser() {","\t\t\t}","\t\t\t","\t\t\tLogItemContentReverser.prototype = new LogItemVisitor();","\t\t\t","\t\t\tLogItemContentReverser.prototype.visitGroup = function(group) {","\t\t\t\tgroup.reverseChildren();","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction setNewestAtTop(isNewestAtTop) {","\t\t\t\tvar oldNewestAtTop = newestAtTop;","\t\t\t\tvar i, iLen, j, jLen;","\t\t\t\tnewestAtTop = Boolean(isNewestAtTop);","\t\t\t\tif (oldNewestAtTop != newestAtTop) {","\t\t\t\t\tvar visitor = new LogItemContentReverser();","\t\t\t\t\trootGroup.accept(visitor);","","\t\t\t\t\t// Reassemble the matches array","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tvar matchIndex = 0;","\t\t\t\t\t\tvar matches = [];","\t\t\t\t\t\tvar actOnLogEntry = function(logEntry) {","\t\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\t\tfor (j = 0, jLen = logEntryMatches.length; j < jLen; j++) {","\t\t\t\t\t\t\t\tmatches[matchIndex] = logEntryMatches[j];","\t\t\t\t\t\t\t\tif (currentMatch && logEntryMatches[j].equals(currentMatch)) {","\t\t\t\t\t\t\t\t\tcurrentMatchIndex = matchIndex;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tmatchIndex++;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t};","\t\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\t\tfor (i = logEntries.length - 1; i >= 0; i--) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfor (i = 0, iLen = logEntries.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tcurrentSearch.matches = matches;","\t\t\t\t\t\tif (currentMatch) {","\t\t\t\t\t\t\tcurrentMatch.setCurrent();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (scrollToLatest) {","\t\t\t\t\t\tdoScrollToLatest();","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\t$("newestAtTop").checked = isNewestAtTop;',"\t\t\t}","","\t\t\tfunction toggleNewestAtTop() {",'\t\t\t\tvar isNewestAtTop = $("newestAtTop").checked;',"\t\t\t\tsetNewestAtTop(isNewestAtTop);","\t\t\t}","","\t\t\tvar scrollToLatest = true;","","\t\t\tfunction setScrollToLatest(isScrollToLatest) {","\t\t\t\tscrollToLatest = isScrollToLatest;","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}",'\t\t\t\t$("scrollToLatest").checked = isScrollToLatest;',"\t\t\t}","","\t\t\tfunction toggleScrollToLatest() {",'\t\t\t\tvar isScrollToLatest = $("scrollToLatest").checked;',"\t\t\t\tsetScrollToLatest(isScrollToLatest);","\t\t\t}","","\t\t\tfunction doScrollToLatest() {","\t\t\t\tvar l = logMainContainer;",'\t\t\t\tif (typeof l.scrollTop != "undefined") {',"\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\tl.scrollTop = 0;","\t\t\t\t\t} else {","\t\t\t\t\t\tvar latestLogEntry = l.lastChild;","\t\t\t\t\t\tif (latestLogEntry) {","\t\t\t\t\t\t\tl.scrollTop = l.scrollHeight;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tvar closeIfOpenerCloses = true;","","\t\t\tfunction setCloseIfOpenerCloses(isCloseIfOpenerCloses) {","\t\t\t\tcloseIfOpenerCloses = isCloseIfOpenerCloses;","\t\t\t}","","\t\t\tvar maxMessages = null;","","\t\t\tfunction setMaxMessages(max) {","\t\t\t\tmaxMessages = max;","\t\t\t\tpruneLogEntries();","\t\t\t}","","\t\t\tvar showCommandLine = false;","","\t\t\tfunction setShowCommandLine(isShowCommandLine) {","\t\t\t\tshowCommandLine = isShowCommandLine;","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("commandLine").style.display = showCommandLine ? "block" : "none";',"\t\t\t\t\tsetCommandInputWidth();","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusCommandLine() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("command").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusSearch() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("searchBox").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction getLogItems() {","\t\t\t\tvar items = [];","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tlogItems[i].serialize(items);","\t\t\t\t}","\t\t\t\treturn items;","\t\t\t}","","\t\t\tfunction setLogItems(items) {","\t\t\t\tvar loggingReallyEnabled = loggingEnabled;","\t\t\t\t// Temporarily turn logging on","\t\t\t\tloggingEnabled = true;","\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {","\t\t\t\t\tswitch (items[i][0]) {","\t\t\t\t\t\tcase LogItem.serializedItemKeys.LOG_ENTRY:","\t\t\t\t\t\t\tlog(items[i][1], items[i][2]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_START:","\t\t\t\t\t\t\tgroup(items[i][1]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_END:","\t\t\t\t\t\t\tgroupEnd();","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tloggingEnabled = loggingReallyEnabled;","\t\t\t}","","\t\t\tfunction log(logLevel, formattedMessage) {","\t\t\t\tif (loggingEnabled) {","\t\t\t\t\tvar logEntry = new LogEntry(logLevel, formattedMessage);","\t\t\t\t\tlogEntries.push(logEntry);","\t\t\t\t\tlogEntriesAndSeparators.push(logEntry);","\t\t\t\t\tlogItems.push(logEntry);","\t\t\t\t\tcurrentGroup.addChild(logEntry);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction renderQueuedLogItems() {","\t\t\t\tlogQueuedEventsTimer = null;","\t\t\t\tvar pruned = pruneLogEntries();","","\t\t\t\t// Render any unrendered log entries and apply the current search to them","\t\t\t\tvar initiallyHasMatches = currentSearch ? currentSearch.hasMatches() : false;","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tif (!logItems[i].rendered) {","\t\t\t\t\t\tlogItems[i].render();","\t\t\t\t\t\tlogItems[i].appendToLog();","\t\t\t\t\t\tif (currentSearch && (logItems[i] instanceof LogEntry)) {","\t\t\t\t\t\t\tcurrentSearch.applyTo(logItems[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (pruned) {","\t\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (!initiallyHasMatches && currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}","\t\t\t\tunrenderedLogItemsExist = false;","\t\t\t}","","\t\t\tfunction pruneLogEntries() {","\t\t\t\tif ((maxMessages !== null) && (logEntriesAndSeparators.length > maxMessages)) {","\t\t\t\t\tvar numberToDelete = logEntriesAndSeparators.length - maxMessages;","\t\t\t\t\tvar prunedLogEntries = logEntriesAndSeparators.slice(0, numberToDelete);","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tcurrentSearch.removeMatches(prunedLogEntries);","\t\t\t\t\t}","\t\t\t\t\tvar group;","\t\t\t\t\tfor (var i = 0; i < numberToDelete; i++) {","\t\t\t\t\t\tgroup = logEntriesAndSeparators[i].group;","\t\t\t\t\t\tarray_remove(logItems, logEntriesAndSeparators[i]);","\t\t\t\t\t\tarray_remove(logEntries, logEntriesAndSeparators[i]);","\t\t\t\t\t\tlogEntriesAndSeparators[i].remove(true, true);","\t\t\t\t\t\tif (group.children.length === 0 && group !== currentGroup && group !== rootGroup) {","\t\t\t\t\t\t\tarray_remove(logItems, group);","\t\t\t\t\t\t\tgroup.remove(true, true);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tlogEntriesAndSeparators = array_removeFromStart(logEntriesAndSeparators, numberToDelete);","\t\t\t\t\treturn true;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction group(name, startExpanded) {","\t\t\t\tif (loggingEnabled) {",'\t\t\t\t\tinitiallyExpanded = (typeof startExpanded === "undefined") ? true : Boolean(startExpanded);',"\t\t\t\t\tvar newGroup = new Group(name, false, initiallyExpanded);","\t\t\t\t\tcurrentGroup.addChild(newGroup);","\t\t\t\t\tcurrentGroup = newGroup;","\t\t\t\t\tlogItems.push(newGroup);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction groupEnd() {","\t\t\t\tcurrentGroup = (currentGroup === rootGroup) ? rootGroup : currentGroup.group;","\t\t\t}","","\t\t\tfunction mainPageReloaded() {","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tvar separator = new Separator();","\t\t\t\tlogEntriesAndSeparators.push(separator);","\t\t\t\tlogItems.push(separator);","\t\t\t\tcurrentGroup.addChild(separator);","\t\t\t}","","\t\t\tfunction closeWindow() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.close(true);","\t\t\t\t} else {","\t\t\t\t\twindow.close();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hide() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.hide();","\t\t\t\t}","\t\t\t}","","\t\t\tvar mainWindow = window;",'\t\t\tvar windowId = "log4javascriptConsoleWindow_" + new Date().getTime() + "_" + ("" + Math.random()).substr(2);',"","\t\t\tfunction setMainWindow(win) {","\t\t\t\tmainWindow = win;","\t\t\t\tmainWindow[windowId] = window;","\t\t\t\t// If this is a pop-up, poll the opener to see if it's closed","\t\t\t\tif (opener && closeIfOpenerCloses) {","\t\t\t\t\tpollOpener();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction pollOpener() {","\t\t\t\tif (closeIfOpenerCloses) {","\t\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\t\tsetTimeout(pollOpener, 500);","\t\t\t\t\t} else {","\t\t\t\t\t\tcloseWindow();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction mainWindowExists() {","\t\t\t\ttry {","\t\t\t\t\treturn (mainWindow && !mainWindow.closed &&","\t\t\t\t\t\tmainWindow[windowId] == window);","\t\t\t\t} catch (ex) {}","\t\t\t\treturn false;","\t\t\t}","",'\t\t\tvar logLevels = ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"];',"","\t\t\tfunction getCheckBox(logLevel) {",'\t\t\t\treturn $("switch_" + logLevel);',"\t\t\t}","","\t\t\tfunction getIeWrappedLogContainer() {",'\t\t\t\treturn $("log_wrapped");',"\t\t\t}","","\t\t\tfunction getIeUnwrappedLogContainer() {",'\t\t\t\treturn $("log_unwrapped");',"\t\t\t}","","\t\t\tfunction applyFilters() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (getCheckBox(logLevels[i]).checked) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tupdateSearchFromFilters();","\t\t\t}","","\t\t\tfunction toggleAllLevels() {",'\t\t\t\tvar turnOn = $("switch_ALL").checked;',"\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tgetCheckBox(logLevels[i]).checked = turnOn;","\t\t\t\t\tif (turnOn) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction checkAllLevels() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (!getCheckBox(logLevels[i]).checked) {",'\t\t\t\t\t\tgetCheckBox("ALL").checked = false;',"\t\t\t\t\t\treturn;","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\tgetCheckBox("ALL").checked = true;',"\t\t\t}","","\t\t\tfunction clearLog() {","\t\t\t\trootGroup.clear();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tlogEntries = [];","\t\t\t\tlogItems = [];","\t\t\t\tlogEntriesAndSeparators = [];"," \t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction toggleWrap() {",'\t\t\t\tvar enable = $("wrap").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "wrap");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "wrap");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------- */","","\t\t\t// Search","","\t\t\tvar searchTimer = null;","","\t\t\tfunction scheduleSearch() {","\t\t\t\ttry {","\t\t\t\t\tclearTimeout(searchTimer);","\t\t\t\t} catch (ex) {","\t\t\t\t\t// Do nothing","\t\t\t\t}","\t\t\t\tsearchTimer = setTimeout(doSearch, 500);","\t\t\t}","","\t\t\tfunction Search(searchTerm, isRegex, searchRegex, isCaseSensitive) {","\t\t\t\tthis.searchTerm = searchTerm;","\t\t\t\tthis.isRegex = isRegex;","\t\t\t\tthis.searchRegex = searchRegex;","\t\t\t\tthis.isCaseSensitive = isCaseSensitive;","\t\t\t\tthis.matches = [];","\t\t\t}","","\t\t\tSearch.prototype = {","\t\t\t\thasMatches: function() {","\t\t\t\t\treturn this.matches.length > 0;","\t\t\t\t},","","\t\t\t\thasVisibleMatches: function() {","\t\t\t\t\tif (this.hasMatches()) {","\t\t\t\t\t\tfor (var i = 0; i < this.matches.length; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn false;","\t\t\t\t},","","\t\t\t\tmatch: function(logEntry) {","\t\t\t\t\tvar entryText = String(logEntry.formattedMessage);","\t\t\t\t\tvar matchesSearch = false;","\t\t\t\t\tif (this.isRegex) {","\t\t\t\t\t\tmatchesSearch = this.searchRegex.test(entryText);","\t\t\t\t\t} else if (this.isCaseSensitive) {","\t\t\t\t\t\tmatchesSearch = (entryText.indexOf(this.searchTerm) > -1);","\t\t\t\t\t} else {","\t\t\t\t\t\tmatchesSearch = (entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1);","\t\t\t\t\t}","\t\t\t\t\treturn matchesSearch;","\t\t\t\t},","","\t\t\t\tgetNextVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex + 1; i < this.matches.length; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the first match","\t\t\t\t\tfor (i = 0; i <= currentMatchIndex; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tgetPreviousVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex - 1; i >= 0; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the last match","\t\t\t\t\tfor (var i = this.matches.length - 1; i >= currentMatchIndex; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tapplyTo: function(logEntry) {","\t\t\t\t\tvar doesMatch = this.match(logEntry);","\t\t\t\t\tif (doesMatch) {","\t\t\t\t\t\tlogEntry.group.expand();","\t\t\t\t\t\tlogEntry.setSearchMatch(true);","\t\t\t\t\t\tvar logEntryContent;","\t\t\t\t\t\tvar wrappedLogEntryContent;",'\t\t\t\t\t\tvar searchTermReplacementStartTag = "<span class=\\"searchterm\\">";','\t\t\t\t\t\tvar searchTermReplacementEndTag = "<" + "/span>";','\t\t\t\t\t\tvar preTagName = isIe ? "pre" : "span";','\t\t\t\t\t\tvar preStartTag = "<" + preTagName + " class=\\"pre\\">";','\t\t\t\t\t\tvar preEndTag = "<" + "/" + preTagName + ">";',"\t\t\t\t\t\tvar startIndex = 0;","\t\t\t\t\t\tvar searchIndex, matchedText, textBeforeMatch;","\t\t\t\t\t\tif (this.isRegex) {",'\t\t\t\t\t\t\tvar flags = this.isCaseSensitive ? "g" : "gi";','\t\t\t\t\t\t\tvar capturingRegex = new RegExp("(" + this.searchRegex.source + ")", flags);',"","\t\t\t\t\t\t\t// Replace the search term with temporary tokens for the start and end tags",'\t\t\t\t\t\t\tvar rnd = ("" + Math.random()).substr(2);','\t\t\t\t\t\t\tvar startToken = "%%s" + rnd + "%%";','\t\t\t\t\t\t\tvar endToken = "%%e" + rnd + "%%";','\t\t\t\t\t\t\tlogEntryContent = logEntry.formattedMessage.replace(capturingRegex, startToken + "$1" + endToken);',"","\t\t\t\t\t\t\t// Escape the HTML to get rid of angle brackets","\t\t\t\t\t\t\tlogEntryContent = escapeHtml(logEntryContent);","","\t\t\t\t\t\t\t// Substitute the proper HTML back in for the search match","\t\t\t\t\t\t\tvar result;","\t\t\t\t\t\t\tvar searchString = logEntryContent;",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\twhile ((searchIndex = searchString.indexOf(startToken, startIndex)) > -1) {","\t\t\t\t\t\t\t\tvar endTokenIndex = searchString.indexOf(endToken, searchIndex);","\t\t\t\t\t\t\t\tmatchedText = searchString.substring(searchIndex + startToken.length, endTokenIndex);","\t\t\t\t\t\t\t\ttextBeforeMatch = searchString.substring(startIndex, searchIndex);","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += searchTermReplacementStartTag + preStartTag + matchedText +","\t\t\t\t\t\t\t\t\tpreEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = endTokenIndex + endToken.length;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tlogEntryContent += preStartTag + searchString.substr(startIndex) + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += searchString.substr(startIndex);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\tvar searchTermReplacementLength = searchTermReplacementStartTag.length +","\t\t\t\t\t\t\t\tthis.searchTerm.length + searchTermReplacementEndTag.length;","\t\t\t\t\t\t\tvar searchTermLength = this.searchTerm.length;","\t\t\t\t\t\t\tvar searchTermLowerCase = this.searchTerm.toLowerCase();","\t\t\t\t\t\t\tvar logTextLowerCase = logEntry.formattedMessage.toLowerCase();","\t\t\t\t\t\t\twhile ((searchIndex = logTextLowerCase.indexOf(searchTermLowerCase, startIndex)) > -1) {","\t\t\t\t\t\t\t\tmatchedText = escapeHtml(logEntry.formattedMessage.substr(searchIndex, this.searchTerm.length));","\t\t\t\t\t\t\t\ttextBeforeMatch = escapeHtml(logEntry.formattedMessage.substring(startIndex, searchIndex));","\t\t\t\t\t\t\t\tvar searchTermReplacement = searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\tpreStartTag + matchedText + preEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag + searchTermReplacement;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = searchIndex + searchTermLength;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvar textAfterLastMatch = escapeHtml(logEntry.formattedMessage.substr(startIndex));","\t\t\t\t\t\t\tlogEntryContent += preStartTag + textAfterLastMatch + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += textAfterLastMatch;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tlogEntry.setContent(logEntryContent, wrappedLogEntryContent);","\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\tthis.matches = this.matches.concat(logEntryMatches);","\t\t\t\t\t} else {","\t\t\t\t\t\tlogEntry.setSearchMatch(false);","\t\t\t\t\t\tlogEntry.setContent(logEntry.formattedMessage, logEntry.formattedMessage);","\t\t\t\t\t}","\t\t\t\t\treturn doesMatch;","\t\t\t\t},","","\t\t\t\tremoveMatches: function(logEntries) {","\t\t\t\t\tvar matchesToRemoveCount = 0;","\t\t\t\t\tvar currentMatchRemoved = false;","\t\t\t\t\tvar matchesToRemove = [];","\t\t\t\t\tvar i, iLen, j, jLen;","","\t\t\t\t\t// Establish the list of matches to be removed","\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\tfor (j = 0, jLen = logEntries.length; j < jLen; j++) {","\t\t\t\t\t\t\tif (this.matches[i].belongsTo(logEntries[j])) {","\t\t\t\t\t\t\t\tmatchesToRemove.push(this.matches[i]);","\t\t\t\t\t\t\t\tif (i === currentMatchIndex) {","\t\t\t\t\t\t\t\t\tcurrentMatchRemoved = true;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Set the new current match index if the current match has been deleted","\t\t\t\t\t// This will be the first match that appears after the first log entry being","\t\t\t\t\t// deleted, if one exists; otherwise, it's the first match overall","\t\t\t\t\tvar newMatch = currentMatchRemoved ? null : this.matches[currentMatchIndex];","\t\t\t\t\tif (currentMatchRemoved) {","\t\t\t\t\t\tfor (i = currentMatchIndex, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible() && !array_contains(matchesToRemove, this.matches[i])) {","\t\t\t\t\t\t\t\tnewMatch = this.matches[i];","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Remove the matches","\t\t\t\t\tfor (i = 0, iLen = matchesToRemove.length; i < iLen; i++) {","\t\t\t\t\t\tarray_remove(this.matches, matchesToRemove[i]);","\t\t\t\t\t\tmatchesToRemove[i].remove();","\t\t\t\t\t}","","\t\t\t\t\t// Set the new match, if one exists","\t\t\t\t\tif (this.hasVisibleMatches()) {","\t\t\t\t\t\tif (newMatch === null) {","\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t// Get the index of the new match","\t\t\t\t\t\t\tvar newMatchIndex = 0;","\t\t\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tif (newMatch === this.matches[i]) {","\t\t\t\t\t\t\t\t\tnewMatchIndex = i;","\t\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tsetCurrentMatchIndex(newMatchIndex);","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tcurrentMatchIndex = null;","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tfunction getPageOffsetTop(el, container) {","\t\t\t\tvar currentEl = el;","\t\t\t\tvar y = 0;","\t\t\t\twhile (currentEl && currentEl != container) {","\t\t\t\t\ty += currentEl.offsetTop;","\t\t\t\t\tcurrentEl = currentEl.offsetParent;","\t\t\t\t}","\t\t\t\treturn y;","\t\t\t}","","\t\t\tfunction scrollIntoView(el) {","\t\t\t\tvar logContainer = logMainContainer;","\t\t\t\t// Check if the whole width of the element is visible and centre if not",'\t\t\t\tif (!$("wrap").checked) {',"\t\t\t\t\tvar logContainerLeft = logContainer.scrollLeft;","\t\t\t\t\tvar logContainerRight = logContainerLeft  + logContainer.offsetWidth;","\t\t\t\t\tvar elLeft = el.offsetLeft;","\t\t\t\t\tvar elRight = elLeft + el.offsetWidth;","\t\t\t\t\tif (elLeft < logContainerLeft || elRight > logContainerRight) {","\t\t\t\t\t\tlogContainer.scrollLeft = elLeft - (logContainer.offsetWidth - el.offsetWidth) / 2;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Check if the whole height of the element is visible and centre if not","\t\t\t\tvar logContainerTop = logContainer.scrollTop;","\t\t\t\tvar logContainerBottom = logContainerTop  + logContainer.offsetHeight;","\t\t\t\tvar elTop = getPageOffsetTop(el) - getToolBarsHeight();","\t\t\t\tvar elBottom = elTop + el.offsetHeight;","\t\t\t\tif (elTop < logContainerTop || elBottom > logContainerBottom) {","\t\t\t\t\tlogContainer.scrollTop = elTop - (logContainer.offsetHeight - el.offsetHeight) / 2;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction Match(logEntryLevel, spanInMainDiv, spanInUnwrappedPre, spanInWrappedDiv) {","\t\t\t\tthis.logEntryLevel = logEntryLevel;","\t\t\t\tthis.spanInMainDiv = spanInMainDiv;","\t\t\t\tif (isIe) {","\t\t\t\t\tthis.spanInUnwrappedPre = spanInUnwrappedPre;","\t\t\t\t\tthis.spanInWrappedDiv = spanInWrappedDiv;","\t\t\t\t}","\t\t\t\tthis.mainSpan = isIe ? spanInUnwrappedPre : spanInMainDiv;","\t\t\t}","","\t\t\tMatch.prototype = {","\t\t\t\tequals: function(match) {","\t\t\t\t\treturn this.mainSpan === match.mainSpan;","\t\t\t\t},","","\t\t\t\tsetCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\taddClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\taddClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t\t// Scroll the visible one into view",'\t\t\t\t\t\tvar elementToScroll = $("wrap").checked ? this.spanInWrappedDiv : this.spanInUnwrappedPre;',"\t\t\t\t\t\tscrollIntoView(elementToScroll);","\t\t\t\t\t} else {",'\t\t\t\t\t\taddClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t\tscrollIntoView(this.spanInMainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tbelongsTo: function(logEntry) {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\treturn isDescendant(this.spanInUnwrappedPre, logEntry.unwrappedPre);","\t\t\t\t\t} else {","\t\t\t\t\t\treturn isDescendant(this.spanInMainDiv, logEntry.mainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetNotCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tremoveClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\tremoveClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tisOrphan: function() {","\t\t\t\t\treturn isOrphan(this.mainSpan);","\t\t\t\t},","","\t\t\t\tisVisible: function() {","\t\t\t\t\treturn getCheckBox(this.logEntryLevel).checked;","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.spanInUnwrappedPre = null;","\t\t\t\t\t\tthis.spanInWrappedDiv = null;","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.spanInMainDiv = null;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tvar currentSearch = null;","\t\t\tvar currentMatchIndex = null;","","\t\t\tfunction doSearch() {",'\t\t\t\tvar searchBox = $("searchBox");',"\t\t\t\tvar searchTerm = searchBox.value;",'\t\t\t\tvar isRegex = $("searchRegex").checked;','\t\t\t\tvar isCaseSensitive = $("searchCaseSensitive").checked;',"\t\t\t\tvar i;","",'\t\t\t\tif (searchTerm === "") {','\t\t\t\t\t$("searchReset").disabled = true;','\t\t\t\t\t$("searchNav").style.display = "none";','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(searchBox, "hasmatches");','\t\t\t\t\tremoveClass(searchBox, "nomatches");',"\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tlogEntries[i].clearSearch();","\t\t\t\t\t\tlogEntries[i].setContent(logEntries[i].formattedMessage, logEntries[i].formattedMessage);","\t\t\t\t\t}","\t\t\t\t\tcurrentSearch = null;","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t} else {",'\t\t\t\t\t$("searchReset").disabled = false;','\t\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\t\tvar searchRegex;","\t\t\t\t\tvar regexValid;","\t\t\t\t\tif (isRegex) {","\t\t\t\t\t\ttry {",'\t\t\t\t\t\t\tsearchRegex = isCaseSensitive ? new RegExp(searchTerm, "g") : new RegExp(searchTerm, "gi");',"\t\t\t\t\t\t\tregexValid = true;",'\t\t\t\t\t\t\treplaceClass(searchBox, "validregex", "invalidregex");','\t\t\t\t\t\t\tsearchBox.title = "Valid regex";',"\t\t\t\t\t\t} catch (ex) {","\t\t\t\t\t\t\tregexValid = false;",'\t\t\t\t\t\t\treplaceClass(searchBox, "invalidregex", "validregex");','\t\t\t\t\t\t\tsearchBox.title = "Invalid regex: " + (ex.message ? ex.message : (ex.description ? ex.description : "unknown error"));',"\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tsearchBox.title = "";','\t\t\t\t\t\tremoveClass(searchBox, "validregex");','\t\t\t\t\t\tremoveClass(searchBox, "invalidregex");',"\t\t\t\t\t}",'\t\t\t\t\taddClass(document.body, "searching");',"\t\t\t\t\tcurrentSearch = new Search(searchTerm, isRegex, searchRegex, isCaseSensitive);","\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tcurrentSearch.applyTo(logEntries[i]);","\t\t\t\t\t}","\t\t\t\t\tsetLogContainerHeight();","","\t\t\t\t\t// Highlight the first search match","\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction updateSearchFromFilters() {","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (currentSearch.hasMatches()) {","\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\tcurrentMatchIndex = 0;","\t\t\t\t\t\t}","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tif (currentMatch.isVisible()) {","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tcurrentMatch.setNotCurrent();","\t\t\t\t\t\t\t// Find the next visible match, if one exists","\t\t\t\t\t\t\tvar nextVisibleMatchIndex = currentSearch.getNextVisibleMatchIndex();","\t\t\t\t\t\t\tif (nextVisibleMatchIndex > -1) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(nextVisibleMatchIndex);","\t\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction refreshCurrentMatch() {","\t\t\t\tif (currentSearch && currentSearch.hasVisibleMatches()) {","\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t}","\t\t\t}","","\t\t\tfunction displayMatches() {",'\t\t\t\treplaceClass($("searchBox"), "hasmatches", "nomatches");','\t\t\t\t$("searchBox").title = "" + currentSearch.matches.length + " matches found";','\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction displayNoMatches() {",'\t\t\t\treplaceClass($("searchBox"), "nomatches", "hasmatches");','\t\t\t\t$("searchBox").title = "No matches found";','\t\t\t\t$("searchNav").style.display = "none";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchEnabled(enable) {",'\t\t\t\tenable = (typeof enable == "undefined") ? !$("searchDisable").checked : enable;','\t\t\t\t$("searchBox").disabled = !enable;','\t\t\t\t$("searchReset").disabled = !enable;','\t\t\t\t$("searchRegex").disabled = !enable;','\t\t\t\t$("searchNext").disabled = !enable;','\t\t\t\t$("searchPrevious").disabled = !enable;','\t\t\t\t$("searchCaseSensitive").disabled = !enable;','\t\t\t\t$("searchNav").style.display = (enable && ($("searchBox").value !== "") &&',"\t\t\t\t\t\tcurrentSearch && currentSearch.hasVisibleMatches()) ?",'\t\t\t\t\t"block" : "none";',"\t\t\t\tif (enable) {",'\t\t\t\t\tremoveClass($("search"), "greyedout");','\t\t\t\t\taddClass(document.body, "searching");','\t\t\t\t\tif ($("searchHighlight").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t}",'\t\t\t\t\tif ($("searchFilter").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t\t}",'\t\t\t\t\t$("searchDisable").checked = !enable;',"\t\t\t\t} else {",'\t\t\t\t\taddClass($("search"), "greyedout");','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");','\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchFilter() {",'\t\t\t\tvar enable = $("searchFilter").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\tfunction toggleSearchHighlight() {",'\t\t\t\tvar enable = $("searchHighlight").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction clearSearch() {",'\t\t\t\t$("searchBox").value = "";',"\t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction searchNext() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar nextMatchIndex = currentSearch.getNextVisibleMatchIndex();",'\t\t\t\t\tif (nextMatchIndex > currentMatchIndex || confirm("Reached the end of the page. Start from the top?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(nextMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction searchPrevious() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar previousMatchIndex = currentSearch.getPreviousVisibleMatchIndex();",'\t\t\t\t\tif (previousMatchIndex < currentMatchIndex || confirm("Reached the start of the page. Continue from the bottom?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(previousMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCurrentMatchIndex(index) {","\t\t\t\tcurrentMatchIndex = index;","\t\t\t\tcurrentSearch.matches[currentMatchIndex].setCurrent();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// CSS Utilities","","\t\t\tfunction addClass(el, cssClass) {","\t\t\t\tif (!hasClass(el, cssClass)) {","\t\t\t\t\tif (el.className) {",'\t\t\t\t\t\tel.className += " " + cssClass;',"\t\t\t\t\t} else {","\t\t\t\t\t\tel.className = cssClass;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hasClass(el, cssClass) {","\t\t\t\tif (el.className) {",'\t\t\t\t\tvar classNames = el.className.split(" ");',"\t\t\t\t\treturn array_contains(classNames, cssClass);","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction removeClass(el, cssClass) {","\t\t\t\tif (hasClass(el, cssClass)) {","\t\t\t\t\t// Rebuild the className property",'\t\t\t\t\tvar existingClasses = el.className.split(" ");',"\t\t\t\t\tvar newClasses = [];","\t\t\t\t\tfor (var i = 0, len = existingClasses.length; i < len; i++) {","\t\t\t\t\t\tif (existingClasses[i] != cssClass) {","\t\t\t\t\t\t\tnewClasses[newClasses.length] = existingClasses[i];","\t\t\t\t\t\t}","\t\t\t\t\t}",'\t\t\t\t\tel.className = newClasses.join(" ");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction replaceClass(el, newCssClass, oldCssClass) {","\t\t\t\tremoveClass(el, oldCssClass);","\t\t\t\taddClass(el, newCssClass);","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// Other utility functions","","\t\t\tfunction getElementsByClass(el, cssClass, tagName) {","\t\t\t\tvar elements = el.getElementsByTagName(tagName);","\t\t\t\tvar matches = [];","\t\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {","\t\t\t\t\tif (hasClass(elements[i], cssClass)) {","\t\t\t\t\t\tmatches.push(elements[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn matches;","\t\t\t}","","\t\t\t// Syntax borrowed from Prototype library","\t\t\tfunction $(id) {","\t\t\t\treturn document.getElementById(id);","\t\t\t}","","\t\t\tfunction isDescendant(node, ancestorNode) {","\t\t\t\twhile (node != null) {","\t\t\t\t\tif (node === ancestorNode) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t\tnode = node.parentNode;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction isOrphan(node) {","\t\t\t\tvar currentNode = node;","\t\t\t\twhile (currentNode) {","\t\t\t\t\tif (currentNode == document.body) {","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","\t\t\t\t\tcurrentNode = currentNode.parentNode;","\t\t\t\t}","\t\t\t\treturn true;","\t\t\t}","","\t\t\tfunction escapeHtml(str) {",'\t\t\t\treturn str.replace(/&/g, "&amp;").replace(/[<]/g, "&lt;").replace(/>/g, "&gt;");',"\t\t\t}","","\t\t\tfunction getWindowWidth() {","\t\t\t\tif (window.innerWidth) {","\t\t\t\t\treturn window.innerWidth;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientWidth) {","\t\t\t\t\treturn document.documentElement.clientWidth;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientWidth;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getWindowHeight() {","\t\t\t\tif (window.innerHeight) {","\t\t\t\t\treturn window.innerHeight;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientHeight) {","\t\t\t\t\treturn document.documentElement.clientHeight;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientHeight;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getToolBarsHeight() {",'\t\t\t\treturn $("switches").offsetHeight;',"\t\t\t}","","\t\t\tfunction getChromeHeight() {","\t\t\t\tvar height = getToolBarsHeight();","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\theight += $("commandLine").offsetHeight;',"\t\t\t\t}","\t\t\t\treturn height;","\t\t\t}","","\t\t\tfunction setLogContainerHeight() {","\t\t\t\tif (logMainContainer) {","\t\t\t\t\tvar windowHeight = getWindowHeight();",'\t\t\t\t\t$("body").style.height = getWindowHeight() + "px";','\t\t\t\t\tlogMainContainer.style.height = "" +','\t\t\t\t\t\tMath.max(0, windowHeight - getChromeHeight()) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCommandInputWidth() {","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\t$("command").style.width = "" + Math.max(0, $("commandLineContainer").offsetWidth -','\t\t\t\t\t\t($("evaluateButton").offsetWidth + 13)) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\twindow.onresize = function() {","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t};","","\t\t\tif (!Array.prototype.push) {","\t\t\t\tArray.prototype.push = function() {","\t\t\t        for (var i = 0, len = arguments.length; i < len; i++){","\t\t\t            this[this.length] = arguments[i];","\t\t\t        }","\t\t\t        return this.length;","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.pop) {","\t\t\t\tArray.prototype.pop = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar val = this[this.length - 1];","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn val;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.shift) {","\t\t\t\tArray.prototype.shift = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar firstItem = this[0];","\t\t\t\t\t\tfor (var i = 0, len = this.length - 1; i < len; i++) {","\t\t\t\t\t\t\tthis[i] = this[i + 1];","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn firstItem;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.splice) {","\t\t\t\tArray.prototype.splice = function(startIndex, deleteCount) {","\t\t\t\t\tvar itemsAfterDeleted = this.slice(startIndex + deleteCount);","\t\t\t\t\tvar itemsDeleted = this.slice(startIndex, startIndex + deleteCount);","\t\t\t\t\tthis.length = startIndex;","\t\t\t\t\t// Copy the arguments into a proper Array object","\t\t\t\t\tvar argumentsArray = [];","\t\t\t\t\tfor (var i = 0, len = arguments.length; i < len; i++) {","\t\t\t\t\t\targumentsArray[i] = arguments[i];","\t\t\t\t\t}","\t\t\t\t\tvar itemsToAppend = (argumentsArray.length > 2) ?","\t\t\t\t\t\titemsAfterDeleted = argumentsArray.slice(2).concat(itemsAfterDeleted) : itemsAfterDeleted;","\t\t\t\t\tfor (i = 0, len = itemsToAppend.length; i < len; i++) {","\t\t\t\t\t\tthis.push(itemsToAppend[i]);","\t\t\t\t\t}","\t\t\t\t\treturn itemsDeleted;","\t\t\t\t};","\t\t\t}","","\t\t\tfunction array_remove(arr, val) {","\t\t\t\tvar index = -1;","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] === val) {","\t\t\t\t\t\tindex = i;","\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (index >= 0) {","\t\t\t\t\tarr.splice(index, 1);","\t\t\t\t\treturn index;","\t\t\t\t} else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction array_removeFromStart(array, numberToRemove) {","\t\t\t\tif (Array.prototype.splice) {","\t\t\t\t\tarray.splice(0, numberToRemove);","\t\t\t\t} else {","\t\t\t\t\tfor (var i = numberToRemove, len = array.length; i < len; i++) {","\t\t\t\t\t\tarray[i - numberToRemove] = array[i];","\t\t\t\t\t}","\t\t\t\t\tarray.length = array.length - numberToRemove;","\t\t\t\t}","\t\t\t\treturn array;","\t\t\t}","","\t\t\tfunction array_contains(arr, val) {","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] == val) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction getErrorMessage(ex) {","\t\t\t\tif (ex.message) {","\t\t\t\t\treturn ex.message;","\t\t\t\t} else if (ex.description) {","\t\t\t\t\treturn ex.description;","\t\t\t\t}",'\t\t\t\treturn "" + ex;',"\t\t\t}","","\t\t\tfunction moveCaretToEnd(input) {","\t\t\t\tif (input.setSelectionRange) {","\t\t\t\t\tinput.focus();","\t\t\t\t\tvar length = input.value.length;","\t\t\t\t\tinput.setSelectionRange(length, length);","\t\t\t\t} else if (input.createTextRange) {","\t\t\t\t\tvar range = input.createTextRange();","\t\t\t\t\trange.collapse(false);","\t\t\t\t\trange.select();","\t\t\t\t}","\t\t\t\tinput.focus();","\t\t\t}","","\t\t\tfunction stopPropagation(evt) {","\t\t\t\tif (evt.stopPropagation) {","\t\t\t\t\tevt.stopPropagation();",'\t\t\t\t} else if (typeof evt.cancelBubble != "undefined") {',"\t\t\t\t\tevt.cancelBubble = true;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction getEvent(evt) {","\t\t\t\treturn evt ? evt : event;","\t\t\t}","","\t\t\tfunction getTarget(evt) {","\t\t\t\treturn evt.target ? evt.target : evt.srcElement;","\t\t\t}","","\t\t\tfunction getRelatedTarget(evt) {","\t\t\t\tif (evt.relatedTarget) {","\t\t\t\t\treturn evt.relatedTarget;","\t\t\t\t} else if (evt.srcElement) {","\t\t\t\t\tswitch(evt.type) {",'\t\t\t\t\t\tcase "mouseover":',"\t\t\t\t\t\t\treturn evt.fromElement;",'\t\t\t\t\t\tcase "mouseout":',"\t\t\t\t\t\t\treturn evt.toElement;","\t\t\t\t\t\tdefault:","\t\t\t\t\t\t\treturn evt.srcElement;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction cancelKeyEvent(evt) {","\t\t\t\tevt.returnValue = false;","\t\t\t\tstopPropagation(evt);","\t\t\t}","","\t\t\tfunction evalCommandLine() {",'\t\t\t\tvar expr = $("command").value;',"\t\t\t\tevalCommand(expr);",'\t\t\t\t$("command").value = "";',"\t\t\t}","","\t\t\tfunction evalLastCommand() {","\t\t\t\tif (lastCommand != null) {","\t\t\t\t\tevalCommand(lastCommand);","\t\t\t\t}","\t\t\t}","","\t\t\tvar lastCommand = null;","\t\t\tvar commandHistory = [];","\t\t\tvar currentCommandIndex = 0;","","\t\t\tfunction evalCommand(expr) {","\t\t\t\tif (appender) {","\t\t\t\t\tappender.evalCommandAndAppend(expr);","\t\t\t\t} else {",'\t\t\t\t\tvar prefix = ">>> " + expr + "\\r\\n";',"\t\t\t\t\ttry {",'\t\t\t\t\t\tlog("INFO", prefix + eval(expr));',"\t\t\t\t\t} catch (ex) {",'\t\t\t\t\t\tlog("ERROR", prefix + "Error: " + getErrorMessage(ex));',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Update command history","\t\t\t\tif (expr != commandHistory[commandHistory.length - 1]) {","\t\t\t\t\tcommandHistory.push(expr);","\t\t\t\t\t// Update the appender","\t\t\t\t\tif (appender) {","\t\t\t\t\t\tappender.storeCommandHistory(commandHistory);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tcurrentCommandIndex = (expr == commandHistory[currentCommandIndex]) ? currentCommandIndex + 1 : commandHistory.length;","\t\t\t\tlastCommand = expr;","\t\t\t}","\t\t\t//]]>","\t\t<\/script>",'\t\t<style type="text/css">',"\t\t\tbody {","\t\t\t\tbackground-color: white;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0;","\t\t\t\tmargin: 0;","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t\toverflow: hidden;","\t\t\t}","","\t\t\tdiv#switchesContainer input {","\t\t\t\tmargin-bottom: 0;","\t\t\t}","","\t\t\tdiv.toolbar {","\t\t\t\tborder-top: solid #ffffff 1px;","\t\t\t\tborder-bottom: solid #aca899 1px;","\t\t\t\tbackground-color: #f1efe7;","\t\t\t\tpadding: 3px 5px;","\t\t\t\tfont-size: 68.75%;","\t\t\t}","","\t\t\tdiv.toolbar, div#search input {","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t}","","\t\t\tdiv.toolbar input.button {","\t\t\t\tpadding: 0 5px;","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv.toolbar input.hidden {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#switches input#clearButton {","\t\t\t\tmargin-left: 20px;","\t\t\t}","","\t\t\tdiv#levels label {","\t\t\t\tfont-weight: bold;","\t\t\t}","","\t\t\tdiv#levels label, div#options label {","\t\t\t\tmargin-right: 5px;","\t\t\t}","","\t\t\tdiv#levels label#wrapLabel {","\t\t\t\tfont-weight: normal;","\t\t\t}","","\t\t\tdiv#search label {","\t\t\t\tmargin-right: 10px;","\t\t\t}","","\t\t\tdiv#search label.searchboxlabel {","\t\t\t\tmargin-right: 0;","\t\t\t}","","\t\t\tdiv#search input {","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv#search input.validregex {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#search input.invalidregex {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#searchNav {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine input#command {","\t\t\t\tfont-size: 100%;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t}","","\t\t\tdiv#commandLine input#evaluateButton {","\t\t\t}","","\t\t\t*.greyedout {","\t\t\t\tcolor: gray !important;","\t\t\t\tborder-color: gray !important;","\t\t\t}","","\t\t\t*.greyedout *.alwaysenabled { color: black; }","","\t\t\t*.unselectable {","\t\t\t\t-khtml-user-select: none;","\t\t\t\t-moz-user-select: none;","\t\t\t\tuser-select: none;","\t\t\t}","","\t\t\tdiv#log {","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 75%;","\t\t\t\twidth: 100%;","\t\t\t\toverflow: auto;","\t\t\t\tclear: both;","\t\t\t\tposition: relative;","\t\t\t}","","\t\t\tdiv.group {","\t\t\t\tborder-color: #cccccc;","\t\t\t\tborder-style: solid;","\t\t\t\tborder-width: 1px 0 1px 1px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.oldIe div.group, div.oldIe div.group *, div.oldIe *.logentry {","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupheading span.expander {","\t\t\t\tborder: solid black 1px;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 0.833em;","\t\t\t\tbackground-color: #eeeeee;","\t\t\t\tposition: relative;","\t\t\t\ttop: -1px;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0 2px;","\t\t\t\tcursor: pointer;","\t\t\t\tcursor: hand;","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupcontent {","\t\t\t\tmargin-left: 10px;","\t\t\t\tpadding-bottom: 2px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.group div.expanded {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.group div.collapsed {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\t*.logentry {","\t\t\t\toverflow: visible;","\t\t\t\tdisplay: none;","\t\t\t\twhite-space: pre;","\t\t\t}","","\t\t\tspan.pre {","\t\t\t\twhite-space: pre;","\t\t\t}","\t\t\t","\t\t\tpre.unwrapped {","\t\t\t\tdisplay: inline !important;","\t\t\t}","","\t\t\tpre.unwrapped pre.pre, div.wrapped pre.pre {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.wrapped pre.pre {","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tbody.searching *.logentry span.currentmatch {","\t\t\t\tcolor: white !important;","\t\t\t\tbackground-color: green !important;","\t\t\t}","","\t\t\tbody.searching div.searchhighlight *.logentry span.searchterm {","\t\t\t\tcolor: black;","\t\t\t\tbackground-color: yellow;","\t\t\t}","","\t\t\tdiv.wrap *.logentry {","\t\t\t\twhite-space: normal !important;","\t\t\t\tborder-width: 0 0 1px 0;","\t\t\t\tborder-color: #dddddd;","\t\t\t\tborder-style: dotted;","\t\t\t}","","\t\t\tdiv.wrap #log_wrapped, #log_unwrapped {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.wrap #log_unwrapped, #log_wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.pre {","\t\t\t\toverflow: visible;","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrap *.logentry pre.unwrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.wrapped {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.searchfilter *.searchnonmatch {","\t\t\t\tdisplay: none !important;","\t\t\t}","","\t\t\tdiv#log *.TRACE, label#label_TRACE {","\t\t\t\tcolor: #666666;","\t\t\t}","","\t\t\tdiv#log *.DEBUG, label#label_DEBUG {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#log *.INFO, label#label_INFO {","\t\t\t\tcolor: #000099;","\t\t\t}","","\t\t\tdiv#log *.WARN, label#label_WARN {","\t\t\t\tcolor: #999900;","\t\t\t}","","\t\t\tdiv#log *.ERROR, label#label_ERROR {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#log *.FATAL, label#label_FATAL {","\t\t\t\tcolor: #660066;","\t\t\t}","","\t\t\tdiv.TRACE#log *.TRACE,","\t\t\tdiv.DEBUG#log *.DEBUG,","\t\t\tdiv.INFO#log *.INFO,","\t\t\tdiv.WARN#log *.WARN,","\t\t\tdiv.ERROR#log *.ERROR,","\t\t\tdiv.FATAL#log *.FATAL {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv#log div.separator {","\t\t\t\tbackground-color: #cccccc;","\t\t\t\tmargin: 5px 0;","\t\t\t\tline-height: 1px;","\t\t\t}","\t\t</style>","\t</head>","",'\t<body id="body">','\t\t<div id="switchesContainer">','\t\t\t<div id="switches">','\t\t\t\t<div id="levels" class="toolbar">',"\t\t\t\t\tFilters:",'\t\t\t\t\t<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','\t\t\t\t\t<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','\t\t\t\t\t<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','\t\t\t\t\t<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','\t\t\t\t\t<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','\t\t\t\t\t<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','\t\t\t\t\t<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"\t\t\t\t</div>",'\t\t\t\t<div id="search" class="toolbar">','\t\t\t\t\t<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','\t\t\t\t\t<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','\t\t\t\t\t<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','\t\t\t\t\t<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','\t\t\t\t\t<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','\t\t\t\t\t<div id="searchNav">','\t\t\t\t\t\t<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','\t\t\t\t\t\t<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','\t\t\t\t\t\t<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','\t\t\t\t\t\t<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"\t\t\t\t\t</div>","\t\t\t\t</div>",'\t\t\t\t<div id="options" class="toolbar">',"\t\t\t\t\tOptions:",'\t\t\t\t\t<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','\t\t\t\t\t<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','\t\t\t\t\t<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','\t\t\t\t\t<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','\t\t\t\t\t<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','\t\t\t\t\t<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','\t\t\t\t\t<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"\t\t\t\t</div>","\t\t\t</div>","\t\t</div>",'\t\t<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','\t\t<div id="commandLine" class="toolbar">','\t\t\t<div id="commandLineContainer">','\t\t\t\t<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','\t\t\t\t<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"\t\t\t</div>","\t\t</div>","\t</body>","</html>",""];e.open();for(var r=0,n=t.length;r<n;r++)e.writeln(t[r]);e.close()};this.setEventTypes(["load","unload"]);var q=function(){var e=S();e.setAppender(f),e.setNewestAtTop(s),e.setScrollToLatest(v),e.setMaxMessages(E),e.setShowCommandLine(C),e.setShowHideButton(I),e.setShowCloseButton(R),e.setMainWindow(window);var t=getCookie(F);t&&(e.commandHistory=t.split(","),e.currentCommandIndex=e.commandHistory.length),f.dispatchEvent("load",{win:e})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),h||(logLog.debug("really doing unload "+this),u=p=!(h=!0),f.dispatchEvent("unload",{}))};var G=function(e,t,r,n){var o=setInterval(function(){try{h&&clearInterval(o),e(S())&&(clearInterval(o),r())}catch(e){clearInterval(o),m=!1,handleError(n,e)}},t)},W=function(){var e=document.domain!=location.hostname;return c?"":getBaseUrl()+"console_uncompressed.html"+(e?"?log4javascript_domain="+escape(document.domain):"")};if(e){var H,z=null,Y=[],Q=!(this.addCssProperty=function(e,t){x("cssProperties")&&Y.push([e,t])}),K=uniqueId+"_InPageAppender_"+g;this.hide=function(){o&&u&&(M()&&S().$("command").blur(),H.style.display="none",k=!0)},this.show=function(){o&&(u?(H.style.display="block",this.setShowCommandLine(C),k=!1):Q||b(!0))},this.isVisible=function(){return!k&&!h},this.close=function(e){h||e&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||(H.parentNode.removeChild(H),this.unload())},w=function(){var t="InPageAppender.open: unable to create console iframe";function r(){try{a||f.show(),q(),p=!0,D()}catch(e){m=!1,handleError(t,e)}}function e(){try{var e=function(e){return isLoaded(e)};c&&V(S().document),e(S())?r():G(e,100,r,t)}catch(e){m=!1,handleError(t,e)}}k=!1,(H=z.appendChild(document.createElement("div"))).style.width=l,H.style.height=d,H.style.border="solid gray 1px";for(var n=0,o=Y.length;n<o;n++)H.style[Y[n][0]]=Y[n][1];var i=c?"":" src='"+W()+"'";H.innerHTML="<iframe id='"+K+"' name='"+K+"' width='100%' height='100%' frameborder='0'"+i+" scrolling='no'></iframe>",h=!1;var s=function(e){try{return bool(e)&&bool(e.document)}catch(e){return!1}};s(S())?e():G(s,100,e,t),u=!0},b=function(e){if(e||!a){var t=function(){if(r)try{var e=document.getElementById(r);1==e.nodeType&&(z=e),w()}catch(e){handleError("InPageAppender.init: invalid container element '"+r+"' supplied",e)}else(z=document.createElement("div")).style.position="fixed",z.style.left="0",z.style.right="0",z.style.bottom="0",document.body.appendChild(z),f.addCssProperty("borderWidth","1px 0 0 0"),f.addCssProperty("zIndex",1e6),w()};pageLoaded&&r&&r.appendChild?(z=r,w()):pageLoaded?t():log4javascript.addEventListener("load",t),Q=!0}},y=function(){b(),o=!0},S=function(){var e=window.frames[K];if(e)return e},_=function(){return!(!m||h)&&(u&&!p&&S()&&isLoaded(S())&&(p=!0),p)}}else{var J,X=f.defaults.useOldPopUp,$=f.defaults.complainAboutPopUpBlocking,Z=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return X},this.setUseOldPopUp=function(e){x("useOldPopUp")&&(X=bool(e))},this.isComplainAboutPopUpBlocking=function(){return $},this.setComplainAboutPopUpBlocking=function(e){x("complainAboutPopUpBlocking")&&($=bool(e))},this.isFocusPopUp=function(){return n},this.setFocusPopUp=function(e){n=bool(e)},this.isReopenWhenClosed=function(){return Z},this.setReopenWhenClosed=function(e){Z=bool(e)},this.close=function(){logLog.debug("close "+this);try{J.close(),this.unload()}catch(e){}},this.hide=function(){logLog.debug("hide "+this),M()&&this.close()},this.show=function(){logLog.debug("show "+this),u||w()},this.isVisible=function(){return _()},w=function(){var e="width="+l+",height="+d+",status,resizable",t="";try{var r=window.frameElement;r&&(t="_"+r.tagName+"_"+(r.name||r.id||""))}catch(e){t="_inaccessibleParentFrame"}var n="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+g+t;X&&c||(n=n+"_"+uniqueId);var o=function(e){if(h)return!0;try{return bool(e)&&e.closed}catch(e){}return!1},i=function(){h||f.unload()};function s(){S().setCloseIfOpenerCloses(!X||!c),q(),p=!0,D(),G(o,500,i,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}try{if(J=window.open(W(),n,e),u=!(h=!1),J&&J.document)if(c&&X&&isLoaded(J))J.mainPageReloaded(),s();else{c&&V(J.document);isLoaded(J)?s():G(function(e){return bool(e)&&isLoaded(e)},100,s,"PopUpAppender.init: unable to create console window")}else m=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),$&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(e){handleError("PopUpAppender.init: error creating pop-up",e)}},b=function(){a||w()},y=function(){b(),o=!0},S=function(){return J},_=function(){if(m&&!isUndefined(J)&&!h){if(J.closed||p&&isUndefined(J.closed))return f.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!p&&isLoaded(J)&&(p=!0)}return m&&p&&!h}}this.getConsoleWindow=S},ConsoleAppender.addGlobalCommandLineFunction=function(e,t){ee.push([e,t])},(e.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},e.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=e,(t.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},t.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=t,log4javascript.InlineAppender=t}(),function(){function s(e){var t=0;for(var r in e)t=Math.max(toStr(r).length,t);var n=[];for(r in e){var o,i="  "+padWithSpaces(toStr(r),t+2);try{o=splitIntoLines(toStr(e[r])).join(padWithSpaces(newLine,t+6))}catch(e){o="[Error obtaining property. Details: "+getExceptionMessage(e)+"]"}n.push(i+o)}return n.join(newLine)}var _={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},S=["script","pre"],w=["br","img","hr","param","link","area","input","col","base","meta"],E="  ";function C(e,t,r,n,o){var i;function s(e){for(var t=e.style.cssText.split(";"),r="",n=0,o=t.length;n<o;n++){var i=t[n].split(":"),s=[];/^\s*$/.test(i[0])||s.push(trim(i[0]).toLowerCase()+":"+trim(i[1])),r=s.join(";")}return r}"string"!=typeof r&&(r=""),n=!!n,o=!!o;var a,c,l,d;if(!(t=void 0===t||!!t)||e.nodeType==_.DOCUMENT_FRAGMENT_NODE){for(i="",a=0,c=e.childNodes.length;a<c;a++)i+=C(e.childNodes[a],!0,r+E);return i}switch(e.nodeType){case _.ELEMENT_NODE:var u=e.tagName.toLowerCase();i=n?newLine+r:"",i+="<";var p=(d=e).prefix?d.prefix:d.outerHTML&&new RegExp("<([^:]+):"+d.tagName+"[^>]*>","i").test(d.outerHTML)?RegExp.$1.toLowerCase():"",f=!!p;for(f&&(i+=p+":"),i+=u,a=0,c=e.attributes.length;a<c;a++){var h=e.attributes[a];h.specified&&null!==h.nodeValue&&"style"!==h.nodeName.toLowerCase()&&"string"==typeof h.nodeValue&&0!==h.nodeName.indexOf("_moz")&&(i+=" "+h.nodeName.toLowerCase()+'="',i+=h.nodeValue.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;"),i+='"')}if(e.style.cssText)""!==s(e)&&(i+=' style="'+s(e)+'"');if(array_contains(w,u)||f&&!e.hasChildNodes())i+="/>";else{i+=">";var m=!(1===e.childNodes.length&&e.childNodes[0].nodeType===_.TEXT_NODE),g=array_contains(S,u);for(a=0,c=e.childNodes.length;a<c;a++)i+=C(e.childNodes[a],!0,r+E,m,g);var v="</"+u+">";i+=m?newLine+r+v:v}return i;case _.TEXT_NODE:if((l=e).nodeType==_.TEXT_NODE&&/^[ \t\r\n]*$/.test(l.nodeValue))i="";else{if(o)i=e.nodeValue;else{var y=splitIntoLines(trim(e.nodeValue)),b=[];for(a=0,c=y.length;a<c;a++)b[a]=trim(y[a]);i=b.join(newLine+r)}n&&(i=newLine+r+i)}return i;case _.CDATA_SECTION_NODE:return"<![CDATA["+e.nodeValue+"]]>"+newLine;case _.DOCUMENT_NODE:for(i="",a=0,c=e.childNodes.length;a<c;a++)i+=C(e.childNodes[a],!0,r);return i;default:return""}}ConsoleAppender.addGlobalCommandLineFunction("$",function(e,t,r){return document.getElementById(t[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(e,t,r){for(var n=[],o=0,i=t.length;o<i;o++)n[o]=s(t[o]);return n.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(e,t,r){for(var n=[],o=0,i=t.length;o<i;o++)n[o]=C(t[o]);return n.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(e,t,r){var n,o;return 0===t.length||""===t[0]?(n=window,o="Command line set to run in main window"):t[0].window==t[0]?(n=t[0],o="Command line set to run in frame '"+t[0].name+"'"):(n=window.frames[t[0]])?o="Command line set to run in frame '"+t[0]+"'":(r.isError=!0,o="Frame '"+t[0]+"' does not exist",n=e.getCommandWindow()),e.setCommandWindow(n),o}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(e,t,r){r.appendResult=!1,e.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(e,t,r){var n=[];for(var o in t[0])n.push(o);return n}),ConsoleAppender.addGlobalCommandLineFunction("values",function(e,t,r){var n=[];for(var o in t[0])try{n.push(t[0][o])}catch(e){logLog.warn("values(): Unable to obtain value for key "+o+". Details: "+getExceptionMessage(e))}return n}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(e,t,r){var n=parseInt(t[0],10);return isNaN(n)||n<0?(r.isError=!0,t[0]+" is not a valid expansion depth"):(e.setCommandLineObjectExpansionDepth(n),"Object expansion depth set to "+n)})}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(e){oldOnload&&oldOnload(e),log4javascript.setDocumentReady()}}return log4javascript},this),function(e,t){"function"==typeof define&&define.amd?define(["bytebuffer"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t(require("bytebuffer"),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this,function(C,e){"use strict";var o,u,t,s,a,r,i={};return i.ByteBuffer=C,i.Long=C.Long||null,i.VERSION="5.0.1",i.WIRE_TYPES={},i.WIRE_TYPES.VARINT=0,i.WIRE_TYPES.BITS64=1,i.WIRE_TYPES.LDELIM=2,i.WIRE_TYPES.STARTGROUP=3,i.WIRE_TYPES.ENDGROUP=4,i.WIRE_TYPES.BITS32=5,i.PACKABLE_WIRE_TYPES=[i.WIRE_TYPES.VARINT,i.WIRE_TYPES.BITS64,i.WIRE_TYPES.BITS32],i.TYPES={int32:{name:"int32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},uint64:{name:"uint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.UZERO:void 0},sint64:{name:"sint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},bool:{name:"bool",wireType:i.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:i.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:i.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.ZERO:void 0},float:{name:"float",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:i.WIRE_TYPES.STARTGROUP,defaultValue:null}},i.MAP_KEY_TYPES=[i.TYPES.int32,i.TYPES.sint32,i.TYPES.sfixed32,i.TYPES.uint32,i.TYPES.fixed32,i.TYPES.int64,i.TYPES.sint64,i.TYPES.sfixed64,i.TYPES.uint64,i.TYPES.fixed64,i.TYPES.bool,i.TYPES.string,i.TYPES.bytes],i.ID_MIN=1,i.ID_MAX=536870911,i.convertFieldsToCamelCase=!1,i.populateAccessors=!0,i.populateDefaults=!0,i.Util=((o={}).IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),o.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,r=0;r<e.length;r++){try{t=e[r]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},o.fetch=function(e,r){if(r&&"function"!=typeof r&&(r=null),o.IS_NODE){var t=require("fs");if(r)t.readFile(e,function(e,t){r(e?null:""+t)});else try{return t.readFileSync(e)}catch(e){return null}}else{var n=o.XHR();if(n.open("GET",e,!!r),n.setRequestHeader("Accept","text/plain"),"function"==typeof n.overrideMimeType&&n.overrideMimeType("text/plain"),!r)return n.send(null),200==n.status||0==n.status&&"string"==typeof n.responseText?n.responseText:null;if(n.onreadystatechange=function(){4==n.readyState&&(200==n.status||0==n.status&&"string"==typeof n.responseText?r(n.responseText):r(null))},4==n.readyState)return;n.send(null)}},o.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},o),i.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},i.DotProto=function(o,s){var e={},t=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},r=t.prototype;r._readString=function(){var e='"'===this._stringOpen?s.STRING_DQ:s.STRING_SQ;e.lastIndex=this.index-1;var t=e.exec(this.source);if(!t)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,t[1]},r.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,t,r;do{for(e=!1;s.WHITESPACE.test(r=this.source.charAt(this.index));)if("\n"===r&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(r=this.source.charAt(this.index)))return"/";do{if("\n"===r&&++this.line,++this.index===this.source.length)return null;t=r,r=this.source.charAt(this.index)}while("*"!==t||"/"!==r);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;var n=this.index;if(s.DELIM.lastIndex=0,!s.DELIM.test(this.source.charAt(n++)))for(;n<this.source.length&&!s.DELIM.test(this.source.charAt(n));)++n;var o=this.source.substring(this.index,this.index=n);return'"'!==o&&"'"!==o||(this._stringOpen=o),o},r.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},r.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},r.omit=function(e){return this.peek()===e&&(this.next(),!0)},r.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},e.Tokenizer=t;var n=function(e){this.tn=new t(e),this.proto3=!1},i=n.prototype;function a(e,t){var r=-1,n=1;if("-"==e.charAt(0)&&(n=-1,e=e.substring(1)),s.NUMBER_DEC.test(e))r=parseInt(e);else if(s.NUMBER_HEX.test(e))r=parseInt(e.substring(2),16);else{if(!s.NUMBER_OCT.test(e))throw Error("illegal id value: "+(n<0?"-":"")+e);r=parseInt(e.substring(1),8)}if(r=n*r|0,!t&&r<0)throw Error("illegal id value: "+(n<0?"-":"")+e);return r}function c(e){var t=1;if("-"==e.charAt(0)&&(t=-1,e=e.substring(1)),s.NUMBER_DEC.test(e))return t*parseInt(e,10);if(s.NUMBER_HEX.test(e))return t*parseInt(e.substring(2),16);if(s.NUMBER_OCT.test(e))return t*parseInt(e.substring(1),8);if("inf"===e)return t*(1/0);if("nan"===e)return NaN;if(s.NUMBER_FLT.test(e))return t*parseFloat(e);throw Error("illegal number value: "+(t<0?"-":"")+e)}function l(e,t,r){void 0===e[t]?e[t]=r:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(r))}return i.parse=function(){var e,t,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},n=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!n||null!==r.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!s.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),r.package=e;break;case"import":if(!n)throw Error("unexpected 'import'");("public"===(e=this.tn.peek())||(t="weak"===e))&&this.tn.next(),e=this._readString(),this.tn.skip(";"),t||r.imports.push(e);break;case"syntax":if(!n)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),n=!1;break;case"enum":this._parseEnum(r),n=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete r.name,r},n.parse=function(e){return new n(e).parse()},i._readString=function(){var e,t,r="";do{if("'"!==(t=this.tn.next())&&'"'!==t)throw Error("illegal string delimiter: "+t);r+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('"'===e||'"'===e);return r},i._readValue=function(e){var t=this.tn.peek();if('"'===t||"'"===t)return this._readString();if(this.tn.next(),s.NUMBER.test(t))return c(t);if(s.BOOL.test(t))return"true"===t.toLowerCase();if(e&&s.TYPEREF.test(t))return t;throw Error("illegal value: "+t)},i._parseOption=function(e,t){var r=this.tn.next(),n=!1;if("("===r&&(n=!0,r=this.tn.next()),!s.TYPEREF.test(r))throw Error("illegal option name: "+r);var o=r;n&&(this.tn.skip(")"),o="("+o+")",r=this.tn.peek(),s.FQTYPEREF.test(r)&&(o+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,o),t||this.tn.skip(";")},i._parseOptionValue=function(e,t){var r=this.tn.peek();if("{"!==r)l(e.options,t,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!s.NAME.test(r))throw Error("illegal option name: "+t+"."+r);this.tn.omit(":")?l(e.options,t+"."+r,this._readValue(!0)):this._parseOptionValue(e,t+"."+r)}},i._parseService=function(e){var t=this.tn.next();if(!s.NAME.test(t))throw Error("illegal service name at line "+this.tn.line+": "+t);var r={name:t,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if("option"===t)this._parseOption(r);else{if("rpc"!==t)throw Error("illegal service token: "+t);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},i._parseServiceRPC=function(e){var t=this.tn.next();if(!s.NAME.test(t))throw Error("illegal rpc service method name: "+t);var r=t,n={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(n.request_stream=!0,t=this.tn.next()),!s.TYPEREF.test(t))throw Error("illegal rpc service request type: "+t);if(n.request=t,this.tn.skip(")"),"returns"!==(t=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+t);if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(n.response_stream=!0,t=this.tn.next()),n.response=t,this.tn.skip(")"),"{"===(t=this.tn.peek())){for(this.tn.next();"}"!==(t=this.tn.next());){if("option"!==t)throw Error("illegal rpc service token: "+t);this._parseOption(n)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[r]=n},i._parseMessage=function(e,t){var r=!!t,n=this.tn.next(),o={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!s.NAME.test(n))throw Error("illegal "+(r?"group":"message")+" name: "+n);for(o.name=n,r&&(this.tn.skip("="),t.id=a(this.tn.next()),o.isGroup=!0),"["===(n=this.tn.peek())&&t&&this._parseFieldOptions(t),this.tn.skip("{");"}"!==(n=this.tn.next());)if(s.RULE.test(n))this._parseMessageField(o,n);else if("oneof"===n)this._parseMessageOneOf(o);else if("enum"===n)this._parseEnum(o);else if("message"===n)this._parseMessage(o);else if("option"===n)this._parseOption(o);else if("service"===n)this._parseService(o);else if("extensions"===n)o.extensions=this._parseExtensionRanges();else if("reserved"===n)this._parseIgnored();else if("extend"===n)this._parseExtend(o);else{if(!s.TYPEREF.test(n))throw Error("illegal message token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(o,"optional",n)}return this.tn.omit(";"),e.messages.push(o),o},i._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},i._parseMessageField=function(e,t,r){if(!s.RULE.test(t))throw Error("illegal message field rule: "+t);var n,o={rule:t,type:"",name:"",options:{},id:0};if("map"===t){if(r)throw Error("illegal type: "+r);if(this.tn.skip("<"),n=this.tn.next(),!s.TYPE.test(n)&&!s.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(o.keytype=n,this.tn.skip(","),n=this.tn.next(),!s.TYPE.test(n)&&!s.TYPEREF.test(n))throw Error("illegal message field: "+n);if(o.type=n,this.tn.skip(">"),n=this.tn.next(),!s.NAME.test(n))throw Error("illegal message field name: "+n);o.name=n,this.tn.skip("="),o.id=a(this.tn.next()),"["===(n=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}else if("group"===(r=void 0!==r?r:this.tn.next())){var i=this._parseMessage(e,o);if(!/^[A-Z]/.test(i.name))throw Error("illegal group name: "+i.name);o.type=i.name,o.name=i.name.toLowerCase(),this.tn.omit(";")}else{if(!s.TYPE.test(r)&&!s.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(o.type=r,n=this.tn.next(),!s.NAME.test(n))throw Error("illegal message field name: "+n);o.name=n,this.tn.skip("="),o.id=a(this.tn.next()),"["===(n=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}return e.fields.push(o),o},i._parseMessageOneOf=function(e){var t=this.tn.next();if(!s.NAME.test(t))throw Error("illegal oneof name: "+t);var r,n=t,o=[];for(this.tn.skip("{");"}"!==(t=this.tn.next());)(r=this._parseMessageField(e,"optional",t)).oneof=n,o.push(r.id);this.tn.omit(";"),e.oneofs[n]=o},i._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},i._parseEnum=function(e){var t={name:"",values:[],options:{}},r=this.tn.next();if(!s.NAME.test(r))throw Error("illegal name: "+r);for(t.name=r,this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(t);else{if(!s.NAME.test(r))throw Error("illegal name: "+r);this.tn.skip("=");var n={name:r,id:a(this.tn.next(),!0)};"["===(r=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),t.values.push(n)}this.tn.omit(";"),e.enums.push(t)},i._parseExtensionRanges=function(){var e,t,r,n=[];do{for(t=[];;){switch(e=this.tn.next()){case"min":r=o.ID_MIN;break;case"max":r=o.ID_MAX;break;default:r=c(e)}if(t.push(r),2===t.length)break;if("to"!==this.tn.peek()){t.push(r);break}this.tn.next()}n.push(t)}while(this.tn.omit(","));return this.tn.skip(";"),n},i._parseExtend=function(e){var t=this.tn.next();if(!s.TYPEREF.test(t))throw Error("illegal extend reference: "+t);var r={ref:t,fields:[]};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if(s.RULE.test(t))this._parseMessageField(r,t);else{if(!s.TYPEREF.test(t))throw Error("illegal extend token: "+t);if(!this.proto3)throw Error("illegal field rule: "+t);this._parseMessageField(r,"optional",t)}return this.tn.omit(";"),e.messages.push(r),r},i.toString=function(){return"Parser at line "+this.tn.line},e.Parser=n,e}(i,i.Lang),i.Reflect=function(m){var s={},d=function(e,t,r){this.builder=e,this.parent=t,this.name=r,this.className},e=d.prototype;e.fqn=function(){for(var e=this.name,t=this;;){if(null==(t=t.parent))break;e=t.name+"."+e}return e},e.toString=function(e){return(e?this.className+" ":"")+this.fqn()},e.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},s.T=d;var a=function(e,t,r,n,o){d.call(this,e,t,r),this.className="Namespace",this.children=[],this.options=n||{},this.syntax=o||"proto2"};try{var t=a.prototype=Object.create(d.prototype)}catch(e){t=""}t.getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],r=0,n=this.children.length;r<n;++r)this.children[r]instanceof e&&t.push(this.children[r]);return t},t.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof p.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof p.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},t.getChild=function(e){for(var t="number"==typeof e?"id":"name",r=0,n=this.children.length;r<n;++r)if(this.children[r][t]===e)return this.children[r];return null},t.resolve=function(e,t){var r,n="string"==typeof e?e.split("."):e,o=this,i=0;if(""===n[i]){for(;null!==o.parent;)o=o.parent;i++}do{do{if(!(o instanceof s.Namespace)){o=null;break}if(!(r=o.getChild(n[i]))||!(r instanceof s.T)||t&&!(r instanceof s.Namespace)){o=null;break}o=r,i++}while(i<n.length);if(null!=o)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=o);return o},t.qn=function(e){for(var t=[],r=e;t.unshift(r.name),null!==(r=r.parent););for(var n=1;n<=t.length;n++){var o=t.slice(t.length-n);if(e===this.resolve(o,e instanceof s.Namespace))return o.join(".")}return e.fqn()},t.build=function(){for(var e,t={},r=this.children,n=0,o=r.length;n<o;++n)(e=r[n])instanceof a&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},t.buildOpt=function(){for(var e={},t=Object.keys(this.options),r=0,n=t.length;r<n;++r){var o=t[r],i=this.options[t[r]];e[o]=i}return e},t.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},s.Namespace=a;var u=function(e,t,r,n){if(this.type=e,this.resolvedType=t,this.isMapKey=r,this.syntax=n,r&&m.MAP_KEY_TYPES.indexOf(e)<0)throw Error("Invalid map key type: "+e.name)},r=u.prototype;function c(e,t){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low==e.low&&e.high==e.high)return new m.Long(e.low,e.high,void 0===t?e.unsigned:t);if("string"==typeof e)return m.Long.fromString(e,t||!1,10);if("number"==typeof e)return m.Long.fromNumber(e,t||!1);throw Error("not convertible to Long")}u.defaultFieldValue=function(e){if("string"==typeof e&&(e=m.TYPES[e]),void 0===e.defaultValue)throw Error("default value for type "+e.name+" is not supported");return e==m.TYPES.bytes?new C(0):e.defaultValue},r.verifyValue=function(t){var r=this;function n(e,t){throw Error("Illegal value for "+r.toString(!0)+" of type "+r.type.name+": "+e+" ("+t+")")}switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),4294967295<t?0|t:t;case m.TYPES.uint32:case m.TYPES.fixed32:return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),t<0?t>>>0:t;case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:if(m.Long)try{return c(t,!1)}catch(e){n(typeof t,e.message)}else n(typeof t,"requires Long.js");case m.TYPES.uint64:case m.TYPES.fixed64:if(m.Long)try{return c(t,!0)}catch(e){n(typeof t,e.message)}else n(typeof t,"requires Long.js");case m.TYPES.bool:return"boolean"!=typeof t&&n(typeof t,"not a boolean"),t;case m.TYPES.float:case m.TYPES.double:return"number"!=typeof t&&n(typeof t,"not a number"),t;case m.TYPES.string:return"string"==typeof t||t&&t instanceof String||n(typeof t,"not a string"),""+t;case m.TYPES.bytes:return C.isByteBuffer(t)?t:C.wrap(t,"base64");case m.TYPES.enum:var e=this.resolvedType.getChildren(m.Reflect.Enum.Value);for(i=0;i<e.length;i++){if(e[i].name==t)return e[i].id;if(e[i].id==t)return e[i].id}if("proto3"===this.syntax)return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),(4294967295<t||t<0)&&n(typeof t,"not in range for uint32"),t;n(t,"not a valid enum value");case m.TYPES.group:case m.TYPES.message:if(t&&"object"==typeof t||n(typeof t,"object expected"),t instanceof this.resolvedType.clazz)return t;if(t instanceof m.Builder.Message){var o={};for(var i in t)t.hasOwnProperty(i)&&(o[i]=t[i]);t=o}return new this.resolvedType.clazz(t)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+t+" (undefined type "+this.type+")")},r.calculateLength=function(e,t){if(null===t)return 0;var r;switch(this.type){case m.TYPES.int32:return t<0?C.calculateVarint64(t):C.calculateVarint32(t);case m.TYPES.uint32:return C.calculateVarint32(t);case m.TYPES.sint32:return C.calculateVarint32(C.zigZagEncode32(t));case m.TYPES.fixed32:case m.TYPES.sfixed32:case m.TYPES.float:return 4;case m.TYPES.int64:case m.TYPES.uint64:return C.calculateVarint64(t);case m.TYPES.sint64:return C.calculateVarint64(C.zigZagEncode64(t));case m.TYPES.fixed64:case m.TYPES.sfixed64:return 8;case m.TYPES.bool:return 1;case m.TYPES.enum:return C.calculateVarint32(t);case m.TYPES.double:return 8;case m.TYPES.string:return r=C.calculateUTF8Bytes(t),C.calculateVarint32(r)+r;case m.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");return C.calculateVarint32(t.remaining())+t.remaining();case m.TYPES.message:return r=this.resolvedType.calculate(t),C.calculateVarint32(r)+r;case m.TYPES.group:return(r=this.resolvedType.calculate(t))+C.calculateVarint32(e<<3|m.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")},r.encodeValue=function(e,t,r){if(null===t)return r;switch(this.type){case m.TYPES.int32:t<0?r.writeVarint64(t):r.writeVarint32(t);break;case m.TYPES.uint32:r.writeVarint32(t);break;case m.TYPES.sint32:r.writeVarint32ZigZag(t);break;case m.TYPES.fixed32:r.writeUint32(t);break;case m.TYPES.sfixed32:r.writeInt32(t);break;case m.TYPES.int64:case m.TYPES.uint64:r.writeVarint64(t);break;case m.TYPES.sint64:r.writeVarint64ZigZag(t);break;case m.TYPES.fixed64:r.writeUint64(t);break;case m.TYPES.sfixed64:r.writeInt64(t);break;case m.TYPES.bool:"string"==typeof t?r.writeVarint32("false"===t.toLowerCase()?0:!!t):r.writeVarint32(t?1:0);break;case m.TYPES.enum:r.writeVarint32(t);break;case m.TYPES.float:r.writeFloat32(t);break;case m.TYPES.double:r.writeFloat64(t);break;case m.TYPES.string:r.writeVString(t);break;case m.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");var n=t.offset;r.writeVarint32(t.remaining()),r.append(t),t.offset=n;break;case m.TYPES.message:var o=(new C).LE();this.resolvedType.encode(t,o),r.writeVarint32(o.offset),r.append(o.flip());break;case m.TYPES.group:this.resolvedType.encode(t,r),r.writeVarint32(e<<3|m.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")}return r},r.decode=function(e,t,r){if(t!=this.type.wireType)throw Error("Unexpected wire type for element");var n,o;switch(this.type){case m.TYPES.int32:return 0|e.readVarint32();case m.TYPES.uint32:return e.readVarint32()>>>0;case m.TYPES.sint32:return 0|e.readVarint32ZigZag();case m.TYPES.fixed32:return e.readUint32()>>>0;case m.TYPES.sfixed32:return 0|e.readInt32();case m.TYPES.int64:return e.readVarint64();case m.TYPES.uint64:return e.readVarint64().toUnsigned();case m.TYPES.sint64:return e.readVarint64ZigZag();case m.TYPES.fixed64:return e.readUint64();case m.TYPES.sfixed64:return e.readInt64();case m.TYPES.bool:return!!e.readVarint32();case m.TYPES.enum:return e.readVarint32();case m.TYPES.float:return e.readFloat();case m.TYPES.double:return e.readDouble();case m.TYPES.string:return e.readVString();case m.TYPES.bytes:if(o=e.readVarint32(),e.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+e.remaining());return(n=e.clone()).limit=n.offset+o,e.offset+=o,n;case m.TYPES.message:return o=e.readVarint32(),this.resolvedType.decode(e,o);case m.TYPES.group:return this.resolvedType.decode(e,-1,r)}throw Error("[INTERNAL] Illegal decode type")},r.valueFromString=function(e){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:case m.TYPES.uint32:case m.TYPES.fixed32:return this.verifyValue(parseInt(e));case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:case m.TYPES.uint64:case m.TYPES.fixed64:return this.verifyValue(e);case m.TYPES.bool:return"true"===e;case m.TYPES.string:return this.verifyValue(e);case m.TYPES.bytes:return C.fromBinary(e)}},r.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===m.TYPES.bytes?e.toString("binary"):e.toString()},s.Element=u;var p=function(e,t,r,n,o,i){a.call(this,e,t,r,n,i),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!o,this._fields=null,this._fieldsById=null,this._fieldsByName=null};try{var n=p.prototype=Object.create(a.prototype)}catch(e){n=""}function g(e,t){var r=t.readVarint32(),n=7&r,o=r>>>3;switch(n){case m.WIRE_TYPES.VARINT:for(;128==(128&(r=t.readUint8())););break;case m.WIRE_TYPES.BITS64:t.offset+=8;break;case m.WIRE_TYPES.LDELIM:r=t.readVarint32(),t.offset+=r;break;case m.WIRE_TYPES.STARTGROUP:g(o,t);break;case m.WIRE_TYPES.ENDGROUP:if(o===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+o+" ("+e+" expected)");case m.WIRE_TYPES.BITS32:t.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+n)}return!0}n.build=function(e){if(this.clazz&&!e)return this.clazz;var t=function(u,s){var a=s.getChildren(u.Reflect.Message.Field),c=s.getChildren(u.Reflect.Message.OneOf),l=function(e,t){u.Builder.Message.call(this);for(var r=0,n=c.length;r<n;++r)this[c[r].name]=null;for(r=0,n=a.length;r<n;++r){var o=a[r];this[o.name]=o.repeated?[]:o.map?new u.Map(o):null,!o.required&&"proto3"!==s.syntax||null===o.defaultValue||(this[o.name]=o.defaultValue)}var i;if(0<arguments.length)if(1!==arguments.length||null===e||"object"!=typeof e||!("function"!=typeof e.encode||e instanceof l)||Array.isArray(e)||e instanceof u.Map||C.isByteBuffer(e)||e instanceof ArrayBuffer||u.Long&&e instanceof u.Long)for(r=0,n=arguments.length;r<n;++r)void 0!==(i=arguments[r])&&this.$set(a[r].name,i);else this.$set(e)};try{var i=l.prototype=Object.create(u.Builder.Message.prototype)}catch(e){i=""}i.add=function(e,t,r){var n=s._fieldsByName[e];if(!r){if(!n)throw Error(this+"#"+e+" is undefined");if(!(n instanceof u.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+n.toString(!0));if(!n.repeated)throw Error(this+"#"+e+" is not a repeated field");t=n.verifyValue(t,!0)}return null===this[e]&&(this[e]=[]),this[e].push(t),this},i.$add=i.add,i.set=function(e,t,r){if(e&&"object"==typeof e){for(var n in r=t,e)e.hasOwnProperty(n)&&void 0!==(t=e[n])&&this.$set(n,t,r);return this}var o=s._fieldsByName[e];if(r)this[e]=t;else{if(!o)throw Error(this+"#"+e+" is not a field: undefined");if(!(o instanceof u.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+o.toString(!0));this[o.name]=t=o.verifyValue(t)}if(o&&o.oneof){var i=this[o.oneof.name];null!==t?(null!==i&&i!==o.name&&(this[i]=null),this[o.oneof.name]=o.name):i===e&&(this[o.oneof.name]=null)}return this},i.$set=i.set,i.get=function(e,t){if(t)return this[e];var r=s._fieldsByName[e];if(!(r&&r instanceof u.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(r instanceof u.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+r.toString(!0));return this[r.name]},i.$get=i.get;for(var e=0;e<a.length;e++){var t=a[e];t instanceof u.Reflect.Message.ExtensionField||s.builder.options.populateAccessors&&function(r){var e=r.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")});e=e.substring(0,1).toUpperCase()+e.substring(1);var t=r.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),n=function(e,t){return this[r.name]=t?e:r.verifyValue(e),this},o=function(){return this[r.name]};null===s.getChild("set"+e)&&(i["set"+e]=n),null===s.getChild("set_"+t)&&(i["set_"+t]=n),null===s.getChild("get"+e)&&(i["get"+e]=o),null===s.getChild("get_"+t)&&(i["get_"+t]=o)}(t)}function p(e,r,n,o){if(null===e||"object"!=typeof e){if(o&&o instanceof u.Reflect.Enum){var t=u.Reflect.Enum.getName(o.object,e);if(null!==t)return t}return e}if(C.isByteBuffer(e))return r?e.toBase64():e.toBuffer();if(u.Long.isLong(e))return n?e.toString():u.Long.fromValue(e);var i;if(Array.isArray(e))return i=[],e.forEach(function(e,t){i[t]=p(e,r,n,o)}),i;if(i={},e instanceof u.Map){for(var s=e.entries(),a=s.next();!a.done;a=s.next())i[e.keyElem.valueToString(a.value[0])]=p(a.value[1],r,n,e.valueElem.resolvedType);return i}var c=e.$type,l=void 0;for(var d in e)e.hasOwnProperty(d)&&(c&&(l=c.getChild(d))?i[d]=p(e[d],r,n,l.resolvedType):i[d]=p(e[d],r,n));return i}return i.encode=function(t,e){"boolean"==typeof t&&(e=t,t=void 0);var r=!1;t||(t=new C,r=!0);var n=t.littleEndian;try{return s.encode(this,t.LE(),e),(r?t.flip():t).LE(n)}catch(e){throw t.LE(n),e}},l.encode=function(e,t,r){return new l(e).encode(t,r)},i.calculate=function(){return s.calculate(this)},i.encodeDelimited=function(e,t){var r=!1;e||(e=new C,r=!0);var n=(new C).LE();return s.encode(this,n,t).flip(),e.writeVarint32(n.remaining()),e.append(n),r?e.flip():e},i.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},i.toArrayBuffer=i.encodeAB,i.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},i.toBuffer=i.encodeNB,i.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},i.toBase64=i.encode64,i.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},i.toHex=i.encodeHex,i.toRaw=function(e,t){return p(this,!!e,!!t,this.$type)},i.encodeJSON=function(){return JSON.stringify(p(this,!0,!0,this.$type))},l.decode=function(t,e,r){"string"==typeof e&&(r=e,e=-1),"string"==typeof t&&(t=C.wrap(t,r||"base64"));var n=(t=C.isByteBuffer(t)?t:C.wrap(t)).littleEndian;try{var o=s.decode(t.LE());return t.LE(n),o}catch(e){throw t.LE(n),e}},l.decodeDelimited=function(t,e){if("string"==typeof t&&(t=C.wrap(t,e||"base64")),(t=C.isByteBuffer(t)?t:C.wrap(t)).remaining()<1)return null;var r=t.offset,n=t.readVarint32();if(t.remaining()<n)return t.offset=r,null;try{var o=s.decode(t.slice(t.offset,t.offset+n).LE());return t.offset+=n,o}catch(e){throw t.offset+=n,e}},l.decode64=function(e){return l.decode(e,"base64")},l.decodeHex=function(e){return l.decode(e,"hex")},l.decodeJSON=function(e){return new l(JSON.parse(e))},i.toString=function(){return s.toString()},Object.defineProperty&&(Object.defineProperty(l,"$options",{value:s.buildOpt()}),Object.defineProperty(i,"$options",{value:l.$options}),Object.defineProperty(l,"$type",{value:s}),Object.defineProperty(i,"$type",{value:s})),l}(m,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,o=this.children.length;n<o;n++)if((r=this.children[n])instanceof f||r instanceof p||r instanceof b){if(t.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");t[r.name]=r.build()}else if(r instanceof p.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof p.OneOf||r instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=t},n.encode=function(e,t,r){for(var n,o,i=null,s=0,a=this._fields.length;s<a;++s)o=e[(n=this._fields[s]).name],n.required&&null===o?null===i&&(i=n):n.encode(r?o:n.verifyValue(o),t,e);if(null===i)return t;var c=Error("Missing at least one required field for "+this.toString(!0)+": "+i);throw c.encoded=t,c},n.calculate=function(e){for(var t,r,n=0,o=0,i=this._fields.length;o<i;++o){if(r=e[(t=this._fields[o]).name],t.required&&null===r)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);n+=t.calculate(r,e)}return n},n.decode=function(e,t,r){t="number"==typeof t?t:-1;for(var n,o,i,s,a=e.offset,c=new this.clazz;e.offset<a+t||-1===t&&0<e.remaining();){if(i=(n=e.readVarint32())>>>3,(o=7&n)===m.WIRE_TYPES.ENDGROUP){if(i!==r)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+i+" ("+(r?r+" expected":"not a group")+")");break}if(s=this._fieldsById[i]){if(s.repeated&&!s.options.packed)c[s.name].push(s.decode(o,e));else if(s.map){var l=s.decode(o,e);c[s.name].set(l[0],l[1])}else if(c[s.name]=s.decode(o,e),s.oneof){var d=c[s.oneof.name];null!==d&&d!==s.name&&(c[d]=null),c[s.oneof.name]=s.name}}else switch(o){case m.WIRE_TYPES.VARINT:e.readVarint32();break;case m.WIRE_TYPES.BITS32:e.offset+=4;break;case m.WIRE_TYPES.BITS64:e.offset+=8;break;case m.WIRE_TYPES.LDELIM:var u=e.readVarint32();e.offset+=u;break;case m.WIRE_TYPES.STARTGROUP:for(;g(i,e););break;default:throw Error("Illegal wire type for unknown field "+i+" in "+this.toString(!0)+"#decode: "+o)}}for(var p=0,f=this._fields.length;p<f;++p)if(null===c[(s=this._fields[p]).name])if("proto3"===this.syntax)c[s.name]=s.defaultValue;else{if(s.required){var h=Error("Missing at least one required field for "+this.toString(!0)+": "+s.name);throw h.decoded=c,h}m.populateDefaults&&null!==s.defaultValue&&(c[s.name]=s.defaultValue)}return c},s.Message=p;var l=function(e,t,r,n,o,i,s,a,c,l){d.call(this,e,t,i),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=n||null,this.type=o,this.resolvedType=null,this.id=s,this.options=a||{},this.defaultValue=null,this.oneof=c||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof p.ExtensionField||(this.name=m.Util.toCamelCase(this.name))};try{var o=l.prototype=Object.create(d.prototype)}catch(e){o=""}o.build=function(){this.element=new u(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new u(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=u.defaultFieldValue(this.type)},o.verifyValue=function(e,t){t=t||!1;var r,n=this;function o(e,t){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+e+" ("+t+")")}if(null===e)return this.required&&o(typeof e,"required"),"proto3"===this.syntax&&this.type!==m.TYPES.message&&o(typeof e,"proto3 field without field presence cannot be null"),null;if(!this.repeated||t)return this.map&&!t?e instanceof m.Map?e:(e instanceof Object||o(typeof e,"expected ProtoBuf.Map or raw object for map field"),new m.Map(this,e)):(!this.repeated&&Array.isArray(e)&&o(typeof e,"no array expected"),this.element.verifyValue(e));Array.isArray(e)||(e=[e]);var i=[];for(r=0;r<e.length;r++)i.push(this.element.verifyValue(e[r]));return i},o.hasWirePresence=function(e,t){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&t[this.oneof.name]===this.name)return!0;switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:case m.TYPES.uint32:case m.TYPES.fixed32:return 0!==e;case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:case m.TYPES.uint64:case m.TYPES.fixed64:return 0!==e.low||0!==e.high;case m.TYPES.bool:return e;case m.TYPES.float:case m.TYPES.double:return 0!==e;case m.TYPES.string:return 0<e.length;case m.TYPES.bytes:return 0<e.remaining();case m.TYPES.enum:return 0!==e;case m.TYPES.message:return null!==e;default:return!0}},o.encode=function(t,o,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return o;try{var r;if(this.repeated)if(this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){o.writeVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),o.ensureCapacity(o.offset+=1);var n=o.offset;for(r=0;r<t.length;r++)this.element.encodeValue(this.id,t[r],o);var i=o.offset-n,s=C.calculateVarint32(i);if(1<s){var a=o.slice(n,o.offset);n+=s-1,o.offset=n,o.append(a)}o.writeVarint32(i,n-s)}else for(r=0;r<t.length;r++)o.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t[r],o);else this.map?t.forEach(function(e,t,r){var n=C.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+C.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);o.writeVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),o.writeVarint32(n),o.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,t,o),o.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,o)},this):this.hasWirePresence(t,e)&&(o.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t,o))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return o},o.calculate=function(t,e){if(t=this.verifyValue(t),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return 0;var o=0;try{var r,n;if(this.repeated)if(this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(o+=C.calculateVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),r=n=0;r<t.length;r++)n+=this.element.calculateLength(this.id,t[r]);o+=C.calculateVarint32(n),o+=n}else for(r=0;r<t.length;r++)o+=C.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,t[r]);else this.map?t.forEach(function(e,t,r){var n=C.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+C.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);o+=C.calculateVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),o+=C.calculateVarint32(n),o+=n},this):this.hasWirePresence(t,e)&&(o+=C.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,t))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return o},o.decode=function(e,t,r){var n,o;if(!(!this.map&&e==this.type.wireType||!r&&this.repeated&&this.options.packed&&e==m.WIRE_TYPES.LDELIM||this.map&&e==m.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==m.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){o=t.readVarint32(),o=t.offset+o;for(var i=[];t.offset<o;)i.push(this.decode(this.type.wireType,t,!0));return i}if(this.map){var s=u.defaultFieldValue(this.keyType);if(n=u.defaultFieldValue(this.type),o=t.readVarint32(),t.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+t.remaining());var a=t.clone();for(a.limit=a.offset+o,t.offset+=o;0<a.remaining();){var c=a.readVarint32();e=7&c;var l=c>>>3;if(1===l)s=this.keyElement.decode(a,e,l);else{if(2!==l)throw Error("Unexpected tag in map field key/value submessage");n=this.element.decode(a,e,l)}}return[s,n]}return this.element.decode(t,e,this.id)},s.Message.Field=l;var i=function(e,t,r,n,o,i,s){l.call(this,e,t,r,null,n,o,i,s),this.extension};try{i.prototype=Object.create(l.prototype)}catch(e){i.prototype=null}s.Message.ExtensionField=i;s.Message.OneOf=function(e,t,r){d.call(this,e,t,r),this.fields=[]};var f=function(e,t,r,n,o){a.call(this,e,t,r,n,o),this.className="Enum",this.object=null};f.getName=function(e,t){for(var r,n=Object.keys(e),o=0;o<n.length;++o)if(e[r=n[o]]===t)return r;return null};try{var h=f.prototype=Object.create(a.prototype)}catch(e){h=f.prototype=null}h&&(h.build=function(e){if(this.object&&!e)return this.object;for(var t=new m.Builder.Enum,r=this.getChildren(f.Value),n=0,o=r.length;n<o;++n)t[r[n].name]=r[n].id;return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=t}),s.Enum=f;var v=function(e,t,r,n){d.call(this,e,t,r),this.className="Enum.Value",this.id=n};try{v.prototype=Object.create(d.prototype)}catch(e){v.prototype=null}s.Enum.Value=v;var y=function(e,t,r,n){d.call(this,e,t,r),this.field=n};try{y.prototype=Object.create(d.prototype)}catch(e){y.prototype=null}s.Extension=y;var b=function(e,t,r,n){a.call(this,e,t,r,n),this.className="Service",this.clazz=null};try{var _=b.prototype=Object.create(a.prototype)}catch(e){_=null}_&&(_.build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(t,o){for(var i=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,r){setTimeout(r.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=i.prototype=Object.create(t.Builder.Service.prototype),r=o.getChildren(t.Reflect.Service.RPCMethod),n=0;n<r.length;n++)!function(n){e[n.name]=function(e,r){try{try{e=n.resolvedRequestType.clazz.decode(C.wrap(e))}catch(e){if(!(e instanceof TypeError))throw e}if(null===e||"object"!=typeof e)throw Error("Illegal arguments");e instanceof n.resolvedRequestType.clazz||(e=new n.resolvedRequestType.clazz(e)),this.rpcImpl(n.fqn(),e,function(e,t){if(e)r(e);else{null===t&&(t="");try{t=n.resolvedResponseType.clazz.decode(t)}catch(e){}t&&t instanceof n.resolvedResponseType.clazz?r(null,t):r(Error("Illegal response type received in service method "+o.name+"#"+n.name))}})}catch(e){setTimeout(r.bind(this,e),0)}},i[n.name]=function(e,t,r){new i(e)[n.name](t,r)},Object.defineProperty&&(Object.defineProperty(i[n.name],"$options",{value:n.buildOpt()}),Object.defineProperty(e[n.name],"$options",{value:i[n.name].$options}))}(r[n]);return Object.defineProperty&&(Object.defineProperty(i,"$options",{value:o.buildOpt()}),Object.defineProperty(e,"$options",{value:i.$options}),Object.defineProperty(i,"$type",{value:o}),Object.defineProperty(e,"$type",{value:o})),i}(m,this)}),s.Service=b;var S=function(e,t,r,n){d.call(this,e,t,r),this.className="Service.Method",this.options=n||{}};try{var w=S.prototype=Object.create(d.prototype)}catch(e){w=null}w&&(w.buildOpt=t.buildOpt),s.Service.Method=S;var E=function(e,t,r,n,o,i,s,a){S.call(this,e,t,r,a),this.className="Service.RPCMethod",this.requestName=n,this.responseName=o,this.requestStream=i,this.responseStream=s,this.resolvedRequestType=null,this.resolvedResponseType=null};try{E.prototype=Object.create(S.prototype)}catch(e){E.prototype=null}return s.Service.RPCMethod=E,s}(i),i.Builder=(t=(u=i).Lang,s=i.Reflect,r=(a=function(e){this.ns=new s.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}}).prototype,a.isMessage=function(e){return"string"==typeof e.name&&void 0===e.values&&void 0===e.rpc},a.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},a.isEnum=function(e){return"string"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},a.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},a.isExtend=function(e){return"string"==typeof e.ref},r.reset=function(){return this.ptr=this.ns,this},r.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach(function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new s.Namespace(this,this.ptr,e)),this.ptr=t},this),this},r.create=function(e){if(!e)return this;if(Array.isArray(e)){if(0===e.length)return this;e=e.slice()}else e=[e];for(var t=[e];0<t.length;){if(e=t.pop(),!Array.isArray(e))throw Error("not a valid namespace: "+JSON.stringify(e));for(;0<e.length;){var r=e.shift();if(a.isMessage(r)){var i=new s.Message(this,this.ptr,r.name,r.options,r.isGroup,r.syntax),n={};r.oneofs&&Object.keys(r.oneofs).forEach(function(e){i.addChild(n[e]=new s.Message.OneOf(this,i,e))},this),r.fields&&r.fields.forEach(function(e){if(null!==i.getChild(0|e.id))throw Error("duplicate or invalid field id in "+i.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+i.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=n[e.oneof]))throw Error("illegal oneof in "+i.name+"#"+e.name+": "+e.oneof);e=new s.Message.Field(this,i,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,r.syntax),t&&t.fields.push(e),i.addChild(e)},this);var o=[];if(r.enums&&r.enums.forEach(function(e){o.push(e)}),r.messages&&r.messages.forEach(function(e){o.push(e)}),r.services&&r.services.forEach(function(e){o.push(e)}),r.extensions&&("number"==typeof r.extensions[0]?i.extensions=[r.extensions]:i.extensions=r.extensions),this.ptr.addChild(i),0<o.length){t.push(e),e=o,o=null,this.ptr=i,i=null;continue}o=null}else if(a.isEnum(r))i=new s.Enum(this,this.ptr,r.name,r.options,r.syntax),r.values.forEach(function(e){i.addChild(new s.Enum.Value(this,i,e.name,e.id))},this),this.ptr.addChild(i);else if(a.isService(r))i=new s.Service(this,this.ptr,r.name,r.options),Object.keys(r.rpc).forEach(function(e){var t=r.rpc[e];i.addChild(new s.Service.RPCMethod(this,i,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(i);else{if(!a.isExtend(r))throw Error("not a valid definition: "+JSON.stringify(r));if(i=this.ptr.resolve(r.ref,!0))r.fields.forEach(function(t){if(null!==i.getChild(0|t.id))throw Error("duplicate extended field id in "+i.name+": "+t.id);if(i.extensions){var r=!1;if(i.extensions.forEach(function(e){t.id>=e[0]&&t.id<=e[1]&&(r=!0)}),!r)throw Error("illegal extended field id in "+i.name+": "+t.id+" (not within valid ranges)")}var e=t.name;this.options.convertFieldsToCamelCase&&(e=u.Util.toCamelCase(e));var n=new s.Message.ExtensionField(this,i,t.rule,t.type,this.ptr.fqn()+"."+e,t.id,t.options),o=new s.Extension(this,this.ptr,t.name,n);n.extension=o,this.ptr.addChild(o),i.addChild(n)},this);else if(!/\.?google\.protobuf\./.test(r.ref))throw Error("extended message "+r.ref+" is not defined")}i=r=null}e=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},r.import=function(t,e){var r="/";if("string"==typeof e){if(u.Util.IS_NODE&&(e=require("path").resolve(e)),!0===this.files[e])return this.reset();this.files[e]=!0}else if("object"==typeof e){var n=e.root;u.Util.IS_NODE&&(n=require("path").resolve(n)),(0<=n.indexOf("\\")||0<=e.file.indexOf("\\"))&&(r="\\");var o=n+r+e.file;if(!0===this.files[o])return this.reset();this.files[o]=!0}if(t.imports&&0<t.imports.length){var i,s=!1;"object"==typeof e?(this.importRoot=e.root,s=!0,i=this.importRoot,e=e.file,(0<=i.indexOf("\\")||0<=e.indexOf("\\"))&&(r="\\")):"string"==typeof e?this.importRoot?i=this.importRoot:0<=e.indexOf("/")?""===(i=e.replace(/\/[^\/]*$/,""))&&(i="/"):0<=e.indexOf("\\")?(i=e.replace(/\\[^\\]*$/,""),r="\\"):i=".":i=null;for(var a=0;a<t.imports.length;a++)if("string"==typeof t.imports[a]){if(!i)throw Error("cannot determine import root");var c=t.imports[a];if("google/protobuf/descriptor.proto"===c)continue;if(c=i+r+c,!0===this.files[c])continue;/\.proto$/i.test(c)&&!u.DotProto&&(c=c.replace(/\.proto$/,".json"));var l=u.Util.fetch(c);if(null===l)throw Error("failed to import '"+c+"' in '"+e+"': file not found");/\.json$/i.test(c)?this.import(JSON.parse(l+""),c):this.import(u.DotProto.Parser.parse(l),c)}else e?/\.(\w+)$/.test(e)?this.import(t.imports[a],e.replace(/^(.+)\.(\w+)$/,function(e,t,r){return t+"_import"+a+"."+r})):this.import(t.imports[a],e+"_import"+a):this.import(t.imports[a]);s&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&function t(r){r.messages&&r.messages.forEach(function(e){e.syntax=r.syntax,t(e)}),r.enums&&r.enums.forEach(function(e){e.syntax=r.syntax})}(t);var d=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){d.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=d),t.enums&&(this.create(t.enums),this.ptr=d),t.services&&(this.create(t.services),this.ptr=d),t.extends&&this.create(t.extends),this.reset()},r.resolveAll=function(){var e;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof s.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof s.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=u.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(e=(this.ptr instanceof s.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if((this.ptr.resolvedType=e)instanceof s.Enum){if(this.ptr.type=u.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==e.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(e instanceof s.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=e.isGroup?u.TYPES.group:u.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=u.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof u.Reflect.Service.Method){if(!(this.ptr instanceof u.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((e=this.ptr.parent.resolve(this.ptr.requestName,!0))&&e instanceof u.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=e,!((e=this.ptr.parent.resolve(this.ptr.responseName,!0))&&e instanceof u.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=e}else if(!(this.ptr instanceof u.Reflect.Message.OneOf||this.ptr instanceof u.Reflect.Extension||this.ptr instanceof u.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},r.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(var t="string"==typeof e?e.split("."):e,r=this.result,n=0;n<t.length;n++){if(!r[t[n]]){r=null;break}r=r[t[n]]}return r},r.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},r.toString=function(){return"Builder"},a.Message=function(){},a.Enum=function(){},a.Service=function(){},a),i.Map=function(e,s){var t=function(e,t){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new s.Element(e.keyType,null,!0,e.syntax),this.valueElem=new s.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),t)for(var r=Object.keys(t),n=0;n<r.length;n++){var o=this.keyElem.valueFromString(r[n]),i=this.valueElem.verifyValue(t[r[n]]);this.map[this.keyElem.valueToString(o)]={key:o,value:i}}},r=t.prototype;function o(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}return r.clear=function(){this.map={}},r.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),r=t in this.map;return delete this.map[t],r},r.entries=function(){for(var e,t=[],r=Object.keys(this.map),n=0;n<r.length;n++)t.push([(e=this.map[r[n]]).key,e.value]);return o(t)},r.keys=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].key);return o(e)},r.values=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].value);return o(e)},r.forEach=function(e,t){for(var r,n=Object.keys(this.map),o=0;o<n.length;o++)e.call(t,(r=this.map[n[o]]).value,r.key,this)},r.set=function(e,t){var r=this.keyElem.verifyValue(e),n=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(r)]={key:r,value:n},this},r.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));if(t in this.map)return this.map[t].value},r.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},t}(0,i.Reflect),i.loadProto=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=void 0),i.loadJson(i.DotProto.Parser.parse(e),t,r)},i.protoFromString=i.loadProto,i.loadProtoFile=function(t,r,n){if(r&&"object"==typeof r?(n=r,r=null):r&&"function"==typeof r||(r=null),r)return i.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null!==e)try{r(null,i.loadProto(e,n,t))}catch(e){r(e)}else r(Error("Failed to fetch file"))});var e=i.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===e?null:i.loadProto(e,n,t)},i.protoFromFile=i.loadProtoFile,i.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=i.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=i.populateAccessors),new i.Builder(e)},i.loadJson=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=null),t&&"object"==typeof t||(t=i.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,r),t.resolveAll(),t},i.loadJsonFile=function(t,r,n){if(r&&"object"==typeof r?(n=r,r=null):r&&"function"==typeof r||(r=null),r)return i.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null!==e)try{r(null,i.loadJson(JSON.parse(e),n,t))}catch(e){r(e)}else r(Error("Failed to fetch file"))});var e=i.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===e?null:i.loadJson(JSON.parse(e),n,t)},i}),SdpSerializer.SerializeASBandwidth=function(e,t){return t=t||{},e=(e=(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+(t.audio||50)+"\r\n")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(t.video||256)+"\r\n")).replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+(t.data||1638400)+"\r\n")},SdpSerializer.SerializePTime=function(e,t){return t=t||{},e=(e=e.replace("a=fmtp:111 minptime=10","a=fmtp:111 minptime="+(t.minptime||10))).replace("a=maxptime:60","a=maxptime:"+(t.maxptime||60))},SdpSerializer.SerializeGoogleMinBitrate=function(e,t){return e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\na=rtpmap:120 VP8/90000\r\na=fmtp:120 \t\t\t\t\t\t\tx-google-min-bitrate="+(t||10)+"\r\n")},SdpSerializer.RTPOverTCP=function(e){return e.replace(/a=candidate:.*udp.*\r\n/g,"")},EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=500,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,r,n,o,i,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(isUndefined(r=this._events[e]))return!1;if(isFunction(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];r.apply(this,o)}else if(isObject(r)){for(n=arguments.length,o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];for(n=(s=r.slice()).length,i=0;i<n;i++)s[i].apply(this,o)}return!0},EventEmitter.prototype.addListener=function(e,t){var r;if(!isFunction(t))throw TypeError("listener must be a function");(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned)&&((r=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()));return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){if(!isFunction(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var r,n,o,i;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,n=-1,r===t||isFunction(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(r)){for(i=o;0<i--;)if(r[i]===t||r[i].listener&&r[i].listener===t){n=i;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(r=this._events[e]))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){return this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){return e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0},function(e,I){e(function(){function m(e,t,r,n){return a(e).then(t,r,n)}function s(e,t){this.then=e,this.inspect=t}function a(t){return u(function(e){e(t)})}function u(e){function t(e){c&&(a=o(e),n(c,a),c=T)}function r(e){t(l(e))}var a,c=[];try{e(t,r,function(e){c&&n(c,function n(o){var i=new s(function(e,t,r){try{return"function"==typeof r?n(r(o)):i}catch(e){return n(e)}});return i}(e))})}catch(e){r(e)}return new s(function(o,i,s){return u(function(t,r,n){c?c.push(function(e){e.then(o,i,s).then(t,r,n)}):f(function(){a.then(o,i,s).then(t,r,n)})})},function(){return a?a.inspect():{state:"pending"}})}function o(o){return o instanceof s?o:o===Object(o)&&"then"in o?u(function(t,r,n){f(function(){try{var e=o.then;"function"==typeof e?b(e,o,t,r,n):t(i(o))}catch(e){r(e)}})}):i(o)}function i(t){var r=new s(function(e){try{return"function"==typeof e?o(e(t)):r}catch(e){return l(e)}},function(){return p(t)});return r}function l(r){var n=new s(function(e,t){try{return"function"==typeof t?o(t(r)):n}catch(e){return l(e)}},function(){return t(r)});return n}function n(r,n){f(function(){for(var e,t=0;e=r[t++];)e(n)})}function c(e,h,t,r,n){return m(e,function(f){return u(function(t,r,e){function n(e){d(e)}function o(e){l(e)}var i,s,a,c,l,d,u,p;if(u=f.length>>>0,i=Math.max(0,Math.min(h,u)),a=[],s=u-i+1,c=[],i)for(d=function(e){c.push(e),--s||(l=d=g,r(c))},l=function(e){a.push(e),--i||(l=d=g,t(a))},p=0;p<u;++p)p in f&&m(f[p],o,n,e);else t(a)}).then(t,r,n)})}function r(e,t,r,n){return d(e,g).then(t,r,n)}function d(e,l,d){return m(e,function(c){return u(function(r,n,o){var i,e,s,t,a;if(s=e=c.length>>>0,i=[],s)for(t=function(e,t){m(e,l,d).then(function(e){i[t]=e,--s||r(i)},n,o)},a=0;a<e;a++)a in c?t(c[a],a):--s;else r(i)})})}function p(e){return{state:"fulfilled",value:e}}function t(e){return{state:"rejected",reason:e}}function f(e){1===S.push(e)&&_(h)}function h(){for(var e,t=0;e=S[t++];)e();S=[]}function g(e){return e}var v,y,b,_,S,w,e,E,C,T;return m.defer=function(){var e,o,i;return(e={promise:T,resolve:T,reject:T,notify:T,resolver:{resolve:T,reject:T,notify:T}}).promise=o=u(function(t,r,n){e.resolve=e.resolver.resolve=function(e){return i?a(e):(i=!0,t(e),o)},e.reject=e.resolver.reject=function(e){return i?a(l(e)):(i=!0,r(e),o)},e.notify=e.resolver.notify=function(e){return n(e),e}}),e},m.resolve=a,m.reject=function(e){return m(e,l)},m.join=function(){return d(arguments,g)},m.all=r,m.map=function(e,t){return d(e,t)},m.reduce=function(e,i){var t=b(y,arguments,1);return m(e,function(e){var o;return o=e.length,t[0]=function(e,r,n){return m(e,function(t){return m(r,function(e){return i(t,e,n,o)})})},v.apply(e,t)})},m.settle=function(e){return d(e,p,t)},m.any=function(e,t,r,n){return c(e,1,function(e){return t?t(e[0]):e[0]},r,n)},m.some=c,m.isPromise=function(e){return e&&"function"==typeof e.then},m.promise=u,s.prototype={otherwise:function(e){return this.then(T,e)},ensure:function(e){function t(){return a(e())}return this.then(t,t).yield2(this)},yield2:function(e){return this.then(function(){return e})},spread:function(t){return this.then(function(e){return r(e,function(e){return t.apply(T,e)})})},always:function(e,t){return this.then(e,e,t)}},S=[],w=I.setTimeout,_="function"==typeof setImmediate?setImmediate.bind(I):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(e){w(e,0)},E=(e=Function.prototype).call,b=e.bind?E.bind(E):function(e,t){return e.apply(t,y.call(arguments,2))},y=(C=[]).slice,v=C.reduce||function(e){var t,r,n,o,i;if(i=0,o=(t=Object(this)).length>>>0,(r=arguments).length<=1)for(;;){if(i in t){n=t[i++];break}if(++i>=o)throw new TypeError}else n=r[1];for(;i<o;++i)i in t&&(n=e(n,t[i],i,t));return n},m})}("function"==typeof define&&define.amd?define:function(e){window.when=e()},this),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}}(function(){return function i(s,a,c){function l(r,e){if(!a[r]){if(!s[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(d)return d(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var o=a[r]={exports:{}};s[r][0].call(o.exports,function(e){var t=s[r][1][e];return l(t||e)},o,o.exports,i,s,a,c)}return a[r].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(e,t,r){"use strict";var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier(),d.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},d.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},d.getDescription=function(e){var t=d.splitSections(e);return t&&t[0]},d.getMediaSections=function(e){var t=d.splitSections(e);return t.shift(),t},d.matchPrefix=function(e,t){return d.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},d.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},d.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},d.parseIceOptions=function(e){return e.substr(14).split(" ")},d.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.numChannels=3===t.length?parseInt(t[2],10):1,r},d.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},d.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},d.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},d.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<n.length;o++)r[(t=n[o].trim().split("="))[0].trim()]=t[1];return r},d.writeFmtp=function(t){var e="",r=t.payloadType;if(void 0!==t.preferredPayloadType&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var n=[];Object.keys(t.parameters).forEach(function(e){n.push(e+"="+t.parameters[e])}),e+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return e},d.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},d.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},d.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return-1<n?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},d.getMid=function(e){var t=d.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},d.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},d.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:d.matchPrefix(e+t,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},d.getIceParameters=function(e,t){var r=d.splitLines(e);return{usernameFragment:(r=r.concat(d.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},d.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},d.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=d.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var o=r[n],i=d.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(i){var s=d.parseRtpMap(i),a=d.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=a.length?d.parseFmtp(a[0]):{},s.rtcpFeedback=d.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(d.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return d.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(d.parseExtmap(e))}),t},d.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=0<t.codecs.length?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=d.writeRtpMap(e),r+=d.writeFmtp(e),r+=d.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),0<n&&(r+="a=maxptime:"+n+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){r+=d.writeExtmap(e)}),r},d.parseRtpEncodingParameters=function(e){var r,n=[],t=d.parseRtpParameters(e),o=-1!==t.fecMechanisms.indexOf("RED"),i=-1!==t.fecMechanisms.indexOf("ULPFEC"),s=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),a=0<s.length&&s[0].ssrc,c=d.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});0<c.length&&1<c[0].length&&c[0][0]===a&&(r=c[0][1]),t.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:r}};n.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:r,mechanism:i?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&a&&n.push({ssrc:a});var l=d.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=l})),n},d.parseRtcpParameters=function(e){var t={},r=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var n=d.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<n.length,t.compound=0===n.length;var o=d.matchPrefix(e,"a=rtcp-mux");return t.mux=0<o.length,t},d.parseMsid=function(e){var t,r=d.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var n=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<n.length?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(e,t){var r=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||d.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(e,t,r,n){var o=d.writeRtpDescription(e.kind,t);if(o+=d.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=d.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var i="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+i,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+i,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+i,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),o},d.getDirection=function(e,t){for(var r=d.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?d.getDirection(t):"sendrecv"},d.getKind=function(e){return d.splitLines(e)[0].split(" ")[0].substr(2)},d.isRejected=function(e){return"0"===e.split(" ",2)[1]},d.parseMLine=function(e){var t=d.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},d.parseOLine=function(e){var t=d.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},"object"==typeof t&&(t.exports=d)},{}],2:[function(e,t,r){"use strict";var D=e("sdp");function c(e,t,r,n,o){var i=D.writeRtpDescription(e.kind,t);if(i+=D.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=D.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),i+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var a="msid:"+(n?n.id:"-")+" "+s+"\r\n";i+="a="+a,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+D.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+D.localCName+"\r\n"),i}function h(l,d){var u={codecs:[],headerExtensions:[],fecMechanisms:[]},p=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]};return l.codecs.forEach(function(r){for(var e=0;e<d.codecs.length;e++){var t=d.codecs[e];if(r.name.toLowerCase()===t.name.toLowerCase()&&r.clockRate===t.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&t.parameters.apt&&(n=r,o=t,i=l.codecs,s=d.codecs,c=a=void 0,a=p(n.parameters.apt,i),c=p(o.parameters.apt,s),!a||!c||a.name.toLowerCase()!==c.name.toLowerCase()))continue;(t=JSON.parse(JSON.stringify(t))).numChannels=Math.min(r.numChannels,t.numChannels),u.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}var n,o,i,s,a,c}),l.headerExtensions.forEach(function(e){for(var t=0;t<d.headerExtensions.length;t++){var r=d.headerExtensions[t];if(e.uri===r.uri){u.headerExtensions.push(r);break}}}),u}function i(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function N(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function m(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(O,U){function L(e,t){t.addTrack(e),t.dispatchEvent(new O.MediaStreamTrackEvent("addtrack",{track:e}))}function o(e,t,r,n){var o=new Event("track");o.track=t,o.receiver=r,o.transceiver={receiver:r},o.streams=n,O.setTimeout(function(){e._dispatchEvent("track",o)})}var n=function(e){var t,n,o,r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw m("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=(t=e.iceServers||[],n=U,o=!1,(t=JSON.parse(JSON.stringify(t))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof t;return r&&(t=[t]),t=t.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||o?0===e.indexOf("stun:")&&14393<=n&&-1===e.indexOf("?transport=udp"):o=!0}),delete e.url,e.urls=r?t[0]:t,!!t.length}})),this._iceGatherers=[],e.iceCandidatePoolSize)for(var s=e.iceCandidatePoolSize;0<s;s--)this._iceGatherers.push(new O.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=D.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};n.prototype.onicecandidate=null,n.prototype.onaddstream=null,n.prototype.ontrack=null,n.prototype.onremovestream=null,n.prototype.onsignalingstatechange=null,n.prototype.oniceconnectionstatechange=null,n.prototype.onconnectionstatechange=null,n.prototype.onicegatheringstatechange=null,n.prototype.onnegotiationneeded=null,n.prototype.ondatachannel=null,n.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(e,t){var r=0<this.transceivers.length,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var o=this._createIceAndDtlsTransports();n.iceTransport=o.iceTransport,n.dtlsTransport=o.dtlsTransport}return t||this.transceivers.push(n),n},n.prototype.addTrack=function(t,e){if(this._isClosed)throw m("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw m("InvalidAccessError","Track already exists.");for(var n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==t.kind||(r=this.transceivers[n]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),r.track=t,r.stream=e,r.rtpSender=new O.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},n.prototype.addStream=function(t){var r=this;if(15025<=U)t.getTracks().forEach(function(e){r.addTrack(e,t)});else{var n=t.clone();t.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},n.prototype.removeTrack=function(t){if(this._isClosed)throw m("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof O.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(e){return e.rtpSender===t});if(!e)throw m("InvalidAccessError","Sender was not created by this connection.");var r=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&-1<this.localStreams.indexOf(r)&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(e){var r=this;e.getTracks().forEach(function(t){var e=r.getSenders().find(function(e){return e.track===t});e&&r.removeTrack(e)})},n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},n.prototype._createIceGatherer=function(r,e){var n=this;if(e&&0<r)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var o=new O.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(o,"state",{value:"new",writable:!0}),this.transceivers[r].bufferedCandidateEvents=[],this.transceivers[r].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;o.state=t?"completed":"gathering",null!==n.transceivers[r].bufferedCandidateEvents&&n.transceivers[r].bufferedCandidateEvents.push(e)},o.addEventListener("localcandidate",this.transceivers[r].bufferCandidates),o},n.prototype._gather=function(a,c){var l=this,d=this.transceivers[c].iceGatherer;if(!d.onlocalcandidate){var e=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),d.onlocalcandidate=function(e){if(!(l.usingBundle&&0<c)){var t=new Event("icecandidate");t.candidate={sdpMid:a,sdpMLineIndex:c};var r=e.candidate,n=!r||0===Object.keys(r).length;if(n)"new"!==d.state&&"gathering"!==d.state||(d.state="completed");else{"new"===d.state&&(d.state="gathering"),r.component=1;var o=D.writeCandidate(r);t.candidate=Object.assign(t.candidate,D.parseCandidate(o)),t.candidate.candidate=o}var i=D.getMediaSections(l.localDescription.sdp);i[t.candidate.sdpMLineIndex]+=n?"a=end-of-candidates\r\n":"a="+t.candidate.candidate+"\r\n",l.localDescription.sdp=D.getDescription(l.localDescription.sdp)+i.join("");var s=l.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==l.iceGatheringState&&(l.iceGatheringState="gathering",l._emitGatheringStateChange()),n||l._dispatchEvent("icecandidate",t),s&&(l._dispatchEvent("icecandidate",new Event("icecandidate")),l.iceGatheringState="complete",l._emitGatheringStateChange())}},O.setTimeout(function(){e.forEach(function(e){d.onlocalcandidate(e)})},0)}},n.prototype._createIceAndDtlsTransports=function(){var e=this,t=new O.RTCIceTransport(null);t.onicestatechange=function(){e._updateIceConnectionState(),e._updateConnectionState()};var r=new O.RTCDtlsTransport(t);return r.ondtlsstatechange=function(){e._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:r}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,t,r){var n=h(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(n.encodings=e.sendEncodingParameters,n.rtcp={cname:D.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(n)),r&&e.rtpReceiver&&0<n.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&U<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?n.encodings=e.recvEncodingParameters:n.encodings=[{}],n.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(n.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(n))},n.prototype.setLocalDescription=function(e){var t,u,p=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(m("TypeError",'Unsupported type "'+e.type+'"'));if(!i("setLocalDescription",e.type,p.signalingState)||p._isClosed)return Promise.reject(m("InvalidStateError","Can not set local "+e.type+" in state "+p.signalingState));if("offer"===e.type)t=D.splitSections(e.sdp),u=t.shift(),t.forEach(function(e,t){var r=D.parseRtpParameters(e);p.transceivers[t].localCapabilities=r}),p.transceivers.forEach(function(e,t){p._gather(e.mid,t)});else if("answer"===e.type){t=D.splitSections(p.remoteDescription.sdp),u=t.shift();var f=0<D.matchPrefix(u,"a=ice-lite").length;t.forEach(function(e,t){var r=p.transceivers[t],n=r.iceGatherer,o=r.iceTransport,i=r.dtlsTransport,s=r.localCapabilities,a=r.remoteCapabilities;if(!(D.isRejected(e)&&0===D.matchPrefix(e,"a=bundle-only").length)&&!r.rejected){var c=D.getIceParameters(e,u),l=D.getDtlsParameters(e,u);f&&(l.role="server"),p.usingBundle&&0!==t||(p._gather(r.mid,t),"new"===o.state&&o.start(n,c,f?"controlling":"controlled"),"new"===i.state&&i.start(l));var d=h(s,a);p._transceive(r,0<d.codecs.length,!1)}})}return p.localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?p._updateSignalingState("have-local-offer"):p._updateSignalingState("stable"),Promise.resolve()},n.prototype.setRemoteDescription=function(I){var R=this;if(-1===["offer","answer"].indexOf(I.type))return Promise.reject(m("TypeError",'Unsupported type "'+I.type+'"'));if(!i("setRemoteDescription",I.type,R.signalingState)||R._isClosed)return Promise.reject(m("InvalidStateError","Can not set remote "+I.type+" in state "+R.signalingState));var P={};R.remoteStreams.forEach(function(e){P[e.id]=e});var x=[],e=D.splitSections(I.sdp),M=e.shift(),k=0<D.matchPrefix(M,"a=ice-lite").length,A=0<D.matchPrefix(M,"a=group:BUNDLE ").length;R.usingBundle=A;var t=D.matchPrefix(M,"a=ice-options:")[0];return R.canTrickleIceCandidates=!!t&&0<=t.substr(14).split(" ").indexOf("trickle"),e.forEach(function(e,t){var r=D.splitLines(e),n=D.getKind(e),o=D.isRejected(e)&&0===D.matchPrefix(e,"a=bundle-only").length,i=r[0].substr(2).split(" ")[2],s=D.getDirection(e,M),a=D.parseMsid(e),c=D.getMid(e)||D.generateIdentifier();if("application"===n&&"DTLS/SCTP"===i||o)R.transceivers[t]={mid:c,kind:n,rejected:!0};else{var l,d,u,p,f,h,m,g,v;!o&&R.transceivers[t]&&R.transceivers[t].rejected&&(R.transceivers[t]=R._createTransceiver(n,!0));var y,b,_=D.parseRtpParameters(e);o||(y=D.getIceParameters(e,M),(b=D.getDtlsParameters(e,M)).role="client"),m=D.parseRtpEncodingParameters(e);var S=D.parseRtcpParameters(e),w=0<D.matchPrefix(e,"a=end-of-candidates",M).length,E=D.matchPrefix(e,"a=candidate:").map(function(e){return D.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===I.type||"answer"===I.type)&&!o&&A&&0<t&&R.transceivers[t]&&(R._disposeIceAndDtlsTransports(t),R.transceivers[t].iceGatherer=R.transceivers[0].iceGatherer,R.transceivers[t].iceTransport=R.transceivers[0].iceTransport,R.transceivers[t].dtlsTransport=R.transceivers[0].dtlsTransport,R.transceivers[t].rtpSender&&R.transceivers[t].rtpSender.setTransport(R.transceivers[0].dtlsTransport),R.transceivers[t].rtpReceiver&&R.transceivers[t].rtpReceiver.setTransport(R.transceivers[0].dtlsTransport)),"offer"!==I.type||o)"answer"!==I.type||o||(d=(l=R.transceivers[t]).iceGatherer,u=l.iceTransport,p=l.dtlsTransport,f=l.rtpReceiver,h=l.sendEncodingParameters,g=l.localCapabilities,R.transceivers[t].recvEncodingParameters=m,R.transceivers[t].remoteCapabilities=_,R.transceivers[t].rtcpParameters=S,E.length&&"new"===u.state&&(!k&&!w||A&&0!==t?E.forEach(function(e){N(l.iceTransport,e)}):u.setRemoteCandidates(E)),A&&0!==t||("new"===u.state&&u.start(d,y,"controlling"),"new"===p.state&&p.start(b)),R._transceive(l,"sendrecv"===s||"recvonly"===s,"sendrecv"===s||"sendonly"===s),!f||"sendrecv"!==s&&"sendonly"!==s?delete l.rtpReceiver:(v=f.track,a?(P[a.stream]||(P[a.stream]=new O.MediaStream),L(v,P[a.stream]),x.push([v,f,P[a.stream]])):(P.default||(P.default=new O.MediaStream),L(v,P.default),x.push([v,f,P.default]))));else{(l=R.transceivers[t]||R._createTransceiver(n)).mid=c,l.iceGatherer||(l.iceGatherer=R._createIceGatherer(t,A)),E.length&&"new"===l.iceTransport.state&&(!w||A&&0!==t?E.forEach(function(e){N(l.iceTransport,e)}):l.iceTransport.setRemoteCandidates(E)),g=O.RTCRtpReceiver.getCapabilities(n),U<15019&&(g.codecs=g.codecs.filter(function(e){return"rtx"!==e.name})),h=l.sendEncodingParameters||[{ssrc:1001*(2*t+2)}];var C,T=!1;if("sendrecv"===s||"sendonly"===s){if(T=!l.rtpReceiver,f=l.rtpReceiver||new O.RTCRtpReceiver(l.dtlsTransport,n),T)v=f.track,a&&"-"===a.stream||(C=a?(P[a.stream]||(P[a.stream]=new O.MediaStream,Object.defineProperty(P[a.stream],"id",{get:function(){return a.stream}})),Object.defineProperty(v,"id",{get:function(){return a.track}}),P[a.stream]):(P.default||(P.default=new O.MediaStream),P.default)),C&&(L(v,C),l.associatedRemoteMediaStreams.push(C)),x.push([v,f,C])}else l.rtpReceiver&&l.rtpReceiver.track&&(l.associatedRemoteMediaStreams.forEach(function(e){var t,r,n=e.getTracks().find(function(e){return e.id===l.rtpReceiver.track.id});n&&(t=n,(r=e).removeTrack(t),r.dispatchEvent(new O.MediaStreamTrackEvent("removetrack",{track:t})))}),l.associatedRemoteMediaStreams=[]);l.localCapabilities=g,l.remoteCapabilities=_,l.rtpReceiver=f,l.rtcpParameters=S,l.sendEncodingParameters=h,l.recvEncodingParameters=m,R._transceive(R.transceivers[t],!1,T)}}}),void 0===R._dtlsRole&&(R._dtlsRole="offer"===I.type?"active":"passive"),R.remoteDescription={type:I.type,sdp:I.sdp},"offer"===I.type?R._updateSignalingState("have-remote-offer"):R._updateSignalingState("stable"),Object.keys(P).forEach(function(e){var n=P[e];if(n.getTracks().length){if(-1===R.remoteStreams.indexOf(n)){R.remoteStreams.push(n);var t=new Event("addstream");t.stream=n,O.setTimeout(function(){R._dispatchEvent("addstream",t)})}x.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&o(R,t,r,[n])})}}),x.forEach(function(e){e[2]||o(R,e[0],e[1],[])}),O.setTimeout(function(){R&&R.transceivers&&R.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},n.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,O.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},n.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},n.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},n.prototype.createOffer=function(){var a=this;if(a._isClosed)return Promise.reject(m("InvalidStateError","Can not call createOffer after close"));var t=a.transceivers.filter(function(e){return"audio"===e.kind}).length,r=a.transceivers.filter(function(e){return"video"===e.kind}).length,e=arguments[0];if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(t=!0===e.offerToReceiveAudio?1:!1===e.offerToReceiveAudio?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(r=!0===e.offerToReceiveVideo?1:!1===e.offerToReceiveVideo?0:e.offerToReceiveVideo)}for(a.transceivers.forEach(function(e){"audio"===e.kind?--t<0&&(e.wantReceive=!1):"video"===e.kind&&--r<0&&(e.wantReceive=!1)});0<t||0<r;)0<t&&(a._createTransceiver("audio"),t--),0<r&&(a._createTransceiver("video"),r--);var n=D.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.transceivers.forEach(function(e,t){var r=e.track,n=e.kind,o=e.mid||D.generateIdentifier();e.mid=o,e.iceGatherer||(e.iceGatherer=a._createIceGatherer(t,a.usingBundle));var i=O.RTCRtpSender.getCapabilities(n);U<15019&&(i.codecs=i.codecs.filter(function(e){return"rtx"!==e.name})),i.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),e.remoteCapabilities&&e.remoteCapabilities.codecs&&e.remoteCapabilities.codecs.forEach(function(e){t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate&&(t.preferredPayloadType=e.payloadType)})}),i.headerExtensions.forEach(function(t){(e.remoteCapabilities&&e.remoteCapabilities.headerExtensions||[]).forEach(function(e){t.uri===e.uri&&(t.id=e.id)})});var s=e.sendEncodingParameters||[{ssrc:1001*(2*t+1)}];r&&15019<=U&&"video"===n&&!s[0].rtx&&(s[0].rtx={ssrc:s[0].ssrc+1}),e.wantReceive&&(e.rtpReceiver=new O.RTCRtpReceiver(e.dtlsTransport,n)),e.localCapabilities=i,e.sendEncodingParameters=s}),"max-compat"!==a._config.bundlePolicy&&(n+="a=group:BUNDLE "+a.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n",a.transceivers.forEach(function(e,t){n+=c(e,e.localCapabilities,"offer",e.stream,a._dtlsRole),n+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===a.iceGatheringState||0!==t&&a.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,n+="a="+D.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(n+="a=end-of-candidates\r\n"))});var o=new O.RTCSessionDescription({type:"offer",sdp:n});return Promise.resolve(o)},n.prototype.createAnswer=function(){var o=this;if(o._isClosed)return Promise.reject(m("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==o.signalingState&&"have-local-pranswer"!==o.signalingState)return Promise.reject(m("InvalidStateError","Can not call createAnswer in signalingState "+o.signalingState));var i=D.writeSessionBoilerplate(o._sdpSessionId,o._sdpSessionVersion++);o.usingBundle&&(i+="a=group:BUNDLE "+o.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=D.getMediaSections(o.remoteDescription.sdp).length;o.transceivers.forEach(function(e,t){if(!(s<t+1)){if(e.rejected)return"application"===e.kind?i+="m=application 0 DTLS/SCTP 5000\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var r;if(e.stream)"audio"===e.kind?r=e.stream.getAudioTracks()[0]:"video"===e.kind&&(r=e.stream.getVideoTracks()[0]),r&&15019<=U&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var n=h(e.localCapabilities,e.remoteCapabilities);!n.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=c(e,n,"answer",e.stream,o._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}});var e=new O.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(e)},n.prototype.addIceCandidate=function(c){var l,d=this;return c&&void 0===c.sdpMLineIndex&&!c.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,t){if(!d.remoteDescription)return t(m("InvalidStateError","Can not add ICE candidate without a remote description"));if(c&&""!==c.candidate){var r=c.sdpMLineIndex;if(c.sdpMid)for(var n=0;n<d.transceivers.length;n++)if(d.transceivers[n].mid===c.sdpMid){r=n;break}var o=d.transceivers[r];if(!o)return t(m("OperationError","Can not add ICE candidate"));if(o.rejected)return e();var i=0<Object.keys(c.candidate).length?D.parseCandidate(c.candidate):{};if("tcp"===i.protocol&&(0===i.port||9===i.port))return e();if(i.component&&1!==i.component)return e();if((0===r||0<r&&o.iceTransport!==d.transceivers[0].iceTransport)&&!N(o.iceTransport,i))return t(m("OperationError","Can not add ICE candidate"));var s=c.candidate.trim();0===s.indexOf("a=")&&(s=s.substr(2)),(l=D.getMediaSections(d.remoteDescription.sdp))[r]+="a="+(i.type?s:"end-of-candidates")+"\r\n",d.remoteDescription.sdp=l.join("")}else for(var a=0;a<d.transceivers.length&&(d.transceivers[a].rejected||(d.transceivers[a].iceTransport.addRemoteCandidate({}),(l=D.getMediaSections(d.remoteDescription.sdp))[a]+="a=end-of-candidates\r\n",d.remoteDescription.sdp=D.getDescription(d.remoteDescription.sdp)+l.join(""),!d.usingBundle));a++);e()})},n.prototype.getStats=function(){var r=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&r.push(t[e].getStats())})});return new Promise(function(t){var n=new Map;Promise.all(r).then(function(e){e.forEach(function(r){Object.keys(r).forEach(function(e){var t;r[e].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(t=r[e]).type]||t.type,n.set(e,r[e])})}),t(n)})})};var e=["createOffer","createAnswer"];return e.forEach(function(e){var r=n.prototype[e];n.prototype[e]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?r.apply(this,[arguments[2]]).then(function(e){"function"==typeof t[0]&&t[0].apply(null,[e])},function(e){"function"==typeof t[1]&&t[1].apply(null,[e])}):r.apply(this,arguments)}}),(e=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var r=n.prototype[e];n.prototype[e]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?r.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)},function(e){"function"==typeof t[2]&&t[2].apply(null,[e])}):r.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=n.prototype[e];n.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),n}},{sdp:1}],3:[function(e,t,r){"use strict";var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier(),d.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},d.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},d.getDescription=function(e){var t=d.splitSections(e);return t&&t[0]},d.getMediaSections=function(e){var t=d.splitSections(e);return t.shift(),t},d.matchPrefix=function(e,t){return d.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},d.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},d.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},d.parseIceOptions=function(e){return e.substr(14).split(" ")},d.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.numChannels=3===t.length?parseInt(t[2],10):1,r},d.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},d.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},d.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},d.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<n.length;o++)r[(t=n[o].trim().split("="))[0].trim()]=t[1];return r},d.writeFmtp=function(t){var e="",r=t.payloadType;if(void 0!==t.preferredPayloadType&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var n=[];Object.keys(t.parameters).forEach(function(e){n.push(e+"="+t.parameters[e])}),e+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return e},d.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},d.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},d.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return-1<n?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},d.getMid=function(e){var t=d.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},d.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},d.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:d.matchPrefix(e+t,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},d.getIceParameters=function(e,t){var r=d.splitLines(e);return{usernameFragment:(r=r.concat(d.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},d.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},d.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=d.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var o=r[n],i=d.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(i){var s=d.parseRtpMap(i),a=d.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=a.length?d.parseFmtp(a[0]):{},s.rtcpFeedback=d.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(d.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return d.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(d.parseExtmap(e))}),t},d.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=0<t.codecs.length?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=d.writeRtpMap(e),r+=d.writeFmtp(e),r+=d.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),0<n&&(r+="a=maxptime:"+n+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){r+=d.writeExtmap(e)}),r},d.parseRtpEncodingParameters=function(e){var r,n=[],t=d.parseRtpParameters(e),o=-1!==t.fecMechanisms.indexOf("RED"),i=-1!==t.fecMechanisms.indexOf("ULPFEC"),s=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),a=0<s.length&&s[0].ssrc,c=d.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});0<c.length&&1<c[0].length&&c[0][0]===a&&(r=c[0][1]),t.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:r}};n.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:r,mechanism:i?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&a&&n.push({ssrc:a});var l=d.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=l})),n},d.parseRtcpParameters=function(e){var t={},r=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var n=d.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<n.length,t.compound=0===n.length;var o=d.matchPrefix(e,"a=rtcp-mux");return t.mux=0<o.length,t},d.parseMsid=function(e){var t,r=d.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var n=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<n.length?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(e,t){var r=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||d.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(e,t,r,n){var o=d.writeRtpDescription(e.kind,t);if(o+=d.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=d.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var i="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+i,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+i,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+i,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),o},d.getDirection=function(e,t){for(var r=d.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?d.getDirection(t):"sendrecv"},d.getKind=function(e){return d.splitLines(e)[0].split(" ")[0].substr(2)},d.isRejected=function(e){return"0"===e.split(" ",2)[1]},d.parseMLine=function(e){var t=d.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},d.parseOLine=function(e){var t=d.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},"object"==typeof t&&(t.exports=d)},{}],4:[function(r,n,e){(function(e){"use strict";var t=r("./adapter_factory.js");n.exports=t({window:e.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":5}],5:[function(f,e,t){"use strict";var h=f("./utils");e.exports=function(e,t){var r=e&&e.window,n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var o in t)hasOwnProperty.call(t,o)&&(n[o]=t[o]);var i=h.log,s=h.detectBrowser(r),a=f("./chrome/chrome_shim")||null,c=f("./edge/edge_shim")||null,l=f("./firefox/firefox_shim")||null,d=f("./safari/safari_shim")||null,u=f("./common_shim")||null,p={browserDetails:s,commonShim:u,extractVersion:h.extractVersion,disableLog:h.disableLog,disableWarnings:h.disableWarnings};switch(s.browser){case"chrome":if(!a||!a.shimPeerConnection||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),p;i("adapter.js shimming chrome."),p.browserShim=a,u.shimCreateObjectURL(r),a.shimGetUserMedia(r),a.shimMediaStream(r),a.shimSourceObject(r),a.shimPeerConnection(r),a.shimOnTrack(r),r.RTCPeerConnection.prototype,u.shimRTCIceCandidate(r),u.shimMaxMessageSize(r),u.shimSendThrowTypeError(r);break;case"firefox":if(!l||!l.shimPeerConnection||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),p;i("adapter.js shimming firefox."),p.browserShim=l,u.shimCreateObjectURL(r),l.shimGetUserMedia(r),l.shimSourceObject(r),l.shimPeerConnection(r),l.shimOnTrack(r),l.shimRemoveStream(r),u.shimRTCIceCandidate(r),u.shimMaxMessageSize(r),u.shimSendThrowTypeError(r);break;case"edge":if(!c||!c.shimPeerConnection||!n.shimEdge)return i("MS edge shim is not included in this adapter release."),p;i("adapter.js shimming edge."),p.browserShim=c,u.shimCreateObjectURL(r),c.shimGetUserMedia(r),c.shimPeerConnection(r),c.shimReplaceTrack(r),u.shimMaxMessageSize(r),u.shimSendThrowTypeError(r);break;case"safari":if(!d||!n.shimSafari)return i("Safari shim is not included in this adapter release."),p;i("adapter.js shimming safari."),p.browserShim=d,u.shimCreateObjectURL(r),d.shimRTCIceServerUrls(r),d.shimCallbacksAPI(r),d.shimLocalStreamsAPI(r),d.shimRemoteStreamsAPI(r),d.shimTrackEventTransceiver(r),d.shimGetUserMedia(r),d.shimCreateOfferLegacy(r),u.shimRTCIceCandidate(r),u.shimMaxMessageSize(r),u.shimSendThrowTypeError(r);break;default:i("Unsupported browser!")}return p}},{"./chrome/chrome_shim":6,"./common_shim":8,"./edge/edge_shim":9,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],6:[function(e,t,r){"use strict";var c=e("../utils.js"),n=c.log;t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(i){if("object"!=typeof i||!i.RTCPeerConnection||"ontrack"in i.RTCPeerConnection.prototype)"RTCRtpTransceiver"in i||c.wrapPeerConnectionEvent(i,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(i.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var e=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){var o=this;return o._ontrackpoly||(o._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(t){var e;e=i.RTCPeerConnection.prototype.getReceivers?o.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track};var r=new Event("track");r.track=t.track,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],o.dispatchEvent(r)}),n.stream.getTracks().forEach(function(t){var e;e=i.RTCPeerConnection.prototype.getReceivers?o.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t};var r=new Event("track");r.track=t,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],o.dispatchEvent(r)})},o.addEventListener("addstream",o._ontrackpoly)),e.apply(o,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var n=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){var r=o.apply(this,arguments);return r||(r=n(this,e),this._senders.push(r)),r};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;t._senders=t._senders||[],i.apply(t,[e]),e.getTracks().forEach(function(e){t._senders.push(n(t,e))})};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var r=this;r._senders=r._senders||[],t.apply(r,[e]),e.getTracks().forEach(function(t){var e=r._senders.find(function(e){return e.track===t});e&&r._senders.splice(r._senders.indexOf(e),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=s.apply(t,[]);return e.forEach(function(e){e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var r=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&r.revokeObjectURL(this.src),e?(this.src=r.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&r.revokeObjectURL(t.src),t.src=r.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&r.revokeObjectURL(t.src),t.src=r.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=n.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(r)&&this._shimmedLocalStreams[t.id].push(r):this._shimmedLocalStreams[t.id]=[t,r],r};var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var t=r.getSenders();o.apply(this,arguments);var n=r.getSenders().filter(function(e){return-1===t.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(n)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(r){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=n._shimmedLocalStreams[e].indexOf(r);-1!==t&&n._shimmedLocalStreams[e].splice(t,1),1===n._shimmedLocalStreams[e].length&&delete n._shimmedLocalStreams[e]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(s){var e=c.detectBrowser(s);if(s.RTCPeerConnection.prototype.addTrack&&65<=e.version)return this.shimAddTrackRemoveTrackWithNative(s);var r=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=r.apply(this);return t._reverseStreams=t._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})};var n=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(e){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[e.id]){var t=new s.MediaStream(e.getTracks());r._streams[e.id]=t,r._reverseStreams[t.id]=e,e=t}n.apply(r,[e])};var o=s.RTCPeerConnection.prototype.removeStream;function i(n,e){var o=e.sdp;return Object.keys(n._reverseStreams||[]).forEach(function(e){var t=n._reverseStreams[e],r=n._streams[t.id];o=o.replace(new RegExp(r.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:o})}s.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},s.RTCPeerConnection.prototype.addTrack=function(t,e){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[e.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var i=new s.MediaStream([t]);r._streams[e.id]=i,r._reverseStreams[i.id]=e,r.addStream(i)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var t=s.RTCPeerConnection.prototype[e];s.RTCPeerConnection.prototype[e]=function(){var r=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?t.apply(r,[function(e){var t=i(r,e);n[0].apply(null,[t])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):t.apply(r,arguments).then(function(e){return i(r,e)})}});var t=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){var n,e,o;return arguments.length&&arguments[0].type&&(arguments[0]=(n=this,e=arguments[0],o=e.sdp,Object.keys(n._reverseStreams||[]).forEach(function(e){var t=n._reverseStreams[e],r=n._streams[t.id];o=o.replace(new RegExp(t.id,"g"),r.id)}),new RTCSessionDescription({type:e.type,sdp:o}))),t.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:i(this,e)}}),s.RTCPeerConnection.prototype.removeTrack=function(t){var r,n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===n))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");n._streams=n._streams||{},Object.keys(n._streams).forEach(function(e){n._streams[e].getTracks().find(function(e){return t.track===e})&&(r=n._streams[e])}),r&&(1===r.getTracks().length?n.removeStream(n._reverseStreams[r.id]):r.removeTrack(t.track),n.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(r){var e=c.detectBrowser(r);if(!r.RTCPeerConnection&&r.webkitRTCPeerConnection)r.RTCPeerConnection=function(e,t){return n("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new r.webkitRTCPeerConnection(e,t)},r.RTCPeerConnection.prototype=r.webkitRTCPeerConnection.prototype,r.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return r.webkitRTCPeerConnection.generateCertificate}});else{var i=r.RTCPeerConnection;r.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var o=e.iceServers[n];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(c.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,r.push(o)):r.push(e.iceServers[n])}e.iceServers=r}return new i(e,t)},r.RTCPeerConnection.prototype=i.prototype,Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return i.generateCertificate}})}var a=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(e,t,r){var n=this,o=arguments;if(0<arguments.length&&"function"==typeof e)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof e))return a.apply(this,[]);var i=function(e){var n={};return e.result().forEach(function(t){var r={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){r[e]=t.stat(e)}),n[r.id]=r}),n},s=function(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))};if(2<=arguments.length){return a.apply(this,[function(e){o[1](s(i(e)))},e])}return new Promise(function(t,e){a.apply(n,[function(e){t(s(i(e)))},e])}).then(t,r)},e.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var o=r.RTCPeerConnection.prototype[e];r.RTCPeerConnection.prototype[e]=function(){var r=arguments,n=this,e=new Promise(function(e,t){o.apply(n,[r[0],e,t])});return r.length<2?e:e.then(function(){r[1].apply(null,[])},function(e){3<=r.length&&r[2].apply(null,[e])})}}),e.version<52&&["createOffer","createAnswer"].forEach(function(e){var o=r.RTCPeerConnection.prototype[e];r.RTCPeerConnection.prototype[e]=function(){var r=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(e,t){o.apply(r,[e,t,n])})}return o.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=r.RTCPeerConnection.prototype[e];r.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var t=r.RTCPeerConnection.prototype.addIceCandidate;r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":14,"./getusermedia":7}],7:[function(e,t,r){"use strict";var n=e("../utils.js"),l=n.log;t.exports=function(e){var s=n.detectBrowser(e),a=e&&e.navigator,c=function(o){if("object"!=typeof o||o.mandatory||o.optional)return o;var i={};return Object.keys(o).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"==typeof o[t]?o[t]:{ideal:o[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){i.optional=i.optional||[];var e={};"number"==typeof r.ideal?(e[n("min",t)]=r.ideal,i.optional.push(e),(e={})[n("max",t)]=r.ideal):e[n("",t)]=r.ideal,i.optional.push(e)}void 0!==r.exact&&"number"!=typeof r.exact?(i.mandatory=i.mandatory||{},i.mandatory[n("",t)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(i.mandatory=i.mandatory||{},i.mandatory[n(e,t)]=r[e])})}}),o.advanced&&(i.optional=(i.optional||[]).concat(o.advanced)),i};a.getUserMedia=function(e,t,r){!function(r,n){if(61<=s.version)return n(r);if((r=JSON.parse(JSON.stringify(r)))&&"object"==typeof r.audio){var e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","googAutoGainControl"),e(r.audio,"noiseSuppression","googNoiseSuppression"),r.audio=c(r.audio)}if(r&&"object"==typeof r.video){var o=r.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var i,t=s.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||t)&&(delete r.video.facingMode,"environment"===o.exact||"environment"===o.ideal?i=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(i=["front"]),i))return a.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return i.some(function(e){return-1!==t.label.toLowerCase().indexOf(e)})});return!t&&e.length&&-1!==i.indexOf("back")&&(t=e[e.length-1]),t&&(r.video.deviceId=o.exact?{exact:t.deviceId}:{ideal:t.deviceId}),r.video=c(r.video),l("chrome: "+JSON.stringify(r)),n(r)});r.video=c(r.video)}l("chrome: "+JSON.stringify(r)),n(r)}(e,function(e){a.webkitGetUserMedia(e,t,function(e){var t;r&&r({name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[(t=e).name]||t.name,message:t.message,constraint:t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}})})})};var t=function(r){return new Promise(function(e,t){a.getUserMedia(r,e,t)})};a.mediaDevices||(a.mediaDevices={getUserMedia:t,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),a.mediaDevices.getUserMedia||(a.mediaDevices.getUserMedia=function(e){return t(e)}),void 0===a.mediaDevices.addEventListener&&(a.mediaDevices.addEventListener=function(){l("Dummy mediaDevices.addEventListener called.")}),void 0===a.mediaDevices.removeEventListener&&(a.mediaDevices.removeEventListener=function(){l("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],8:[function(e,t,r){"use strict";var u=e("sdp"),c=e("./utils");t.exports={shimRTCIceCandidate:function(t){if(t.RTCIceCandidate&&!(t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)){var o=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new o(e),r=u.parseCandidate(e.candidate),n=Object.assign(t,r);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new o(e)},t.RTCIceCandidate.prototype=o.prototype,c.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),o=new Map,i=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++i;return o.set(t,e),c.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var a=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),a.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var l=c.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,t,r,n;if(this._sctp=null,r=arguments[0],(n=u.splitSections(r.sdp)).shift(),n.some(function(e){var t=u.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})){var o,i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),s=(e=i,t=65536,"firefox"===l.browser&&(t=l.version<57?-1===e?16384:2147483637:57===l.version?65535:65536),t),a=function(e,t){var r=65536;"firefox"===l.browser&&57===l.version&&(r=65535);var n=u.matchPrefix(e.sdp,"a=max-message-size:");return 0<n.length?r=parseInt(n[0].substr(19),10):"firefox"===l.browser&&-1!==t&&(r=2147483637),r}(arguments[0],i);o=0===s&&0===a?Number.POSITIVE_INFINITY:0===s||0===a?Math.max(s,a):Math.min(s,a);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return o}}),this._sctp=c}return d.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var t=this,e=n.apply(t,arguments),r=e.send;return e.send=function(){var e=arguments[0];if((e.length||e.size||e.byteLength)>t.sctp.maxMessageSize)throw new DOMException("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)","TypeError");return r.apply(this,arguments)},e}}}}},{"./utils":14,sdp:3}],9:[function(e,t,r){"use strict";var n=e("../utils"),o=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender),e.RTCPeerConnection=o(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./getusermedia":10,"rtcpeerconnection-shim":2}],10:[function(e,t,r){"use strict";t.exports=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(t=e).name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}});var t})}}},{}],11:[function(e,t,r){"use strict";var n=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(r){r.stream.getTracks().forEach(function(e){var t=new Event("track");t.track=e,t.receiver={track:e},t.transceiver={receiver:t.receiver},t.streams=[r.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(a){var c=n.detectBrowser(a);if("object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(e,t){if(c.version<38&&e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var o=e.iceServers[n];if(o.hasOwnProperty("urls"))for(var i=0;i<o.urls.length;i++){var s={url:o.urls[i]};0===o.urls[i].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),r.push(s)}else r.push(e.iceServers[n])}e.iceServers=r}return new a.mozRTCPeerConnection(e,t)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=a.RTCPeerConnection.prototype[e];a.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(e,o,t){return r.apply(this,[e||null]).then(function(r){var t,n;if(c.version<48&&(t=r,n=new Map,Object.keys(t).forEach(function(e){n.set(e,t[e]),n[e]=t[e]}),r=n),c.version<53&&!o)try{r.forEach(function(e){e.type=i[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;r.forEach(function(e,t){r.set(t,Object.assign({},e,{type:i[e.type]||e.type}))})}return r}).then(o,t)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var r=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&-1!==t.getTracks().indexOf(e.track)&&r.removeTrack(e)})})}}},{"../utils":14,"./getusermedia":12}],12:[function(e,t,r){"use strict";var p=e("../utils"),f=p.log;t.exports=function(e){var o=p.detectBrowser(e),i=e&&e.navigator,t=e&&e.MediaStreamTrack,s=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},n=function(e,t,r){var n=function(n){if("object"!=typeof n||n.require)return n;var o=[];return Object.keys(n).forEach(function(e){if("require"!==e&&"advanced"!==e&&"mediaSource"!==e){var t=n[e]="object"==typeof n[e]?n[e]:{ideal:n[e]};if(void 0===t.min&&void 0===t.max&&void 0===t.exact||o.push(e),void 0!==t.exact&&("number"==typeof t.exact?t.min=t.max=t.exact:n[e]=t.exact,delete t.exact),void 0!==t.ideal){n.advanced=n.advanced||[];var r={};"number"==typeof t.ideal?r[e]={min:t.ideal,max:t.ideal}:r[e]=t.ideal,n.advanced.push(r),delete t.ideal,Object.keys(t).length||delete n[e]}}}),o.length&&(n.require=o),n};return e=JSON.parse(JSON.stringify(e)),o.version<38&&(f("spec: "+JSON.stringify(e)),e.audio&&(e.audio=n(e.audio)),e.video&&(e.video=n(e.video)),f("ff37: "+JSON.stringify(e))),i.mozGetUserMedia(e,t,function(e){r(s(e))})};if(i.mediaDevices||(i.mediaDevices={getUserMedia:function(r){return new Promise(function(e,t){n(r,e,t)})},addEventListener:function(){},removeEventListener:function(){}}),i.mediaDevices.enumerateDevices=i.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},o.version<41){var r=i.mediaDevices.enumerateDevices.bind(i.mediaDevices);i.mediaDevices.enumerateDevices=function(){return r().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(o.version<49){var a=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return a(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(e){return Promise.reject(s(e))})}}if(!(55<o.version&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){var c=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),c(e.audio,"autoGainControl","mozAutoGainControl"),c(e.audio,"noiseSuppression","mozNoiseSuppression")),l(e)},t&&t.prototype.getSettings){var d=t.prototype.getSettings;t.prototype.getSettings=function(){var e=d.apply(this,arguments);return c(e,"mozAutoGainControl","autoGainControl"),c(e,"mozNoiseSuppression","noiseSuppression"),e}}if(t&&t.prototype.applyConstraints){var u=t.prototype.applyConstraints;t.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),c(e,"autoGainControl","mozAutoGainControl"),c(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}i.getUserMedia=function(e,t,r){if(o.version<44)return n(e,t,r);p.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,r)}}},{"../utils":14}],13:[function(e,t,r){"use strict";var s=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(t){var r=null;return this._localStreams&&this._localStreams.forEach(function(e){e.id===t&&(r=e)}),this._remoteStreams&&this._remoteStreams.forEach(function(e){e.id===t&&(r=e)}),r}),!("addStream"in e.RTCPeerConnection.prototype)){var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(t)&&this._localStreams.push(t);var r=this;t.getTracks().forEach(function(e){n.call(r,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e,t){return t&&(this._localStreams?-1===this._localStreams.indexOf(t)&&this._localStreams.push(t):this._localStreams=[t]),n.call(this,e,t)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var r=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(r._remoteStreams||(r._remoteStreams=[]),!(0<=r._remoteStreams.indexOf(e))){r._remoteStreams.push(e);var t=new Event("addstream");t.stream=e,r.dispatchEvent(t)}})})}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,o=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(e,t){var r=2<=arguments.length?arguments[2]:e,n=o.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){var r=2<=arguments.length?arguments[2]:e,n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};var r=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=r,r=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=r,r=function(e,t,r){var n=c.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=r}},shimGetUserMedia:function(e){var n=e&&e.navigator;n.getUserMedia||(n.webkitGetUserMedia?n.getUserMedia=n.webkitGetUserMedia.bind(n):n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(e,t,r){n.mediaDevices.getUserMedia(e).then(t,r)}.bind(n)))},shimRTCIceServerUrls:function(e){var i=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var o=e.iceServers[n];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(s.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,r.push(o)):r.push(e.iceServers[n])}e.iceServers=r}return new i(e,t)},e.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return i.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var o=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var t=this;if(e){var r=t.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||t.addTransceiver("audio");var n=t.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection("sendonly"):"recvonly"===n.direction&&n.setDirection("inactive"):!0!==e.offerToReceiveVideo||n||t.addTransceiver("video")}return o.apply(t,arguments)}}}},{"../utils":14}],14:[function(e,t,r){"use strict";var n=!0,o=!0;function i(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}t.exports={extractVersion:i,wrapPeerConnectionEvent:function(e,n,o){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,i=t.addEventListener;t.addEventListener=function(e,t){if(e!==n)return i.apply(this,arguments);var r=function(e){t(o(e))};return this._eventMap=this._eventMap||{},this._eventMap[t]=r,i.apply(this,[e,r])};var s=t.removeEventListener;t.removeEventListener=function(e,t){if(e!==n||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);var r=this._eventMap[t];return delete this._eventMap[t],s.apply(this,[e,r])},Object.defineProperty(t,"on"+n,{get:function(){return this["_on"+n]},set:function(e){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),e&&this.addEventListener(n,this["_on"+n]=e)}})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=i(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=i(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=i(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=i(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}}},{}]},{},[4])(4)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mqtt=e()}}(function(){return function i(s,a,c){function l(t,e){if(!a[t]){if(!s[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(d)return d(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=a[t]={exports:{}};s[t][0].call(o.exports,function(e){return l(s[t][1][e]||e)},o,o.exports,i,s,a,c)}return a[t].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(v,y,e){(function(c,e){"use strict";var n=v("events"),i=v("./store"),l=v("mqtt-packet"),d=v("readable-stream").Writable,t=v("inherits"),r=v("reinterval"),f=v("./validations"),h=v("xtend"),m=e.setImmediate||function(e){c.nextTick(e)},s={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},u={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function p(e,t,r){e.emit("packetsend",t),!l.writeToStream(t,e.stream,e.options)&&r?e.stream.once("drain",r):r&&r()}function o(t,r,n,o){t.outgoingStore.put(r,function(e){if(e)return n&&n(e);o(),p(t,r,n)})}function g(){}function a(e,t){var r,o=this;if(!(this instanceof a))return new a(e,t);for(r in this.options=t||{},s)void 0===this.options[r]?this.options[r]=s[r]:this.options[r]=t[r];this.options.clientId="string"==typeof t.clientId?t.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),this.options.customHandleAcks=5===t.protocolVersion&&t.customHandleAcks?t.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=e,this.outgoingStore=t.outgoingStore||new i,this.incomingStore=t.incomingStore||new i,this.queueQoSZero=void 0===t.queueQoSZero||t.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("close",function(){this.connected=!1,clearTimeout(this.connackTimer)}),this.on("connect",function(){var n=this.queue;!function t(){var e,r=n.shift();r&&(e=r.packet,o._sendPacket(e,function(e){r.cb&&r.cb(e),t()}))}()}),this.on("close",function(){null!==o.pingTimer&&(o.pingTimer.clear(),o.pingTimer=null)}),this.on("close",this._setupReconnect),n.EventEmitter.call(this),this._setupStream()}t(a,n.EventEmitter),a.prototype._setupStream=function(){var e,r=this,t=new d,n=l.parser(this.options),o=null,i=[];function s(){if(i.length)c.nextTick(a);else{var e=o;o=null,e()}}function a(){var e=i.shift();if(e)r._handlePacket(e,s);else{var t=o;o=null,t&&t()}}if(this._clearReconnect(),this.stream=this.streamBuilder(this),n.on("packet",function(e){i.push(e)}),t._write=function(e,t,r){o=r,n.parse(e),a()},this.stream.pipe(t),this.stream.on("error",g),this.stream.on("close",function(){var t;(t=r.outgoing)&&Object.keys(t).forEach(function(e){t[e].volatile&&"function"==typeof t[e].cb&&(t[e].cb(new Error("Connection closed")),delete t[e])}),r.emit("close")}),(e=Object.create(this.options)).cmd="connect",p(this,e),n.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.emit("error",new Error("Packet has no Authentication Method")),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket)p(this,h({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){r._cleanUp(!0)},this.options.connectTimeout)},a.prototype._handlePacket=function(e,t){var r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<e.length)return this.emit("error",new Error("exceeding packets size "+e.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(this.emit("packetreceive",e),e.cmd){case"publish":this._handlePublish(e,t);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(e),t();break;case"pubrel":this._handlePubrel(e,t);break;case"connack":this._handleConnack(e),t();break;case"pingresp":this._handlePingresp(e),t();break;case"disconnect":this._handleDisconnect(e),t()}},a.prototype._checkDisconnecting=function(e){return this.disconnecting&&(e?e(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},a.prototype.publish=function(e,t,r,n){var o,i=this.options;"function"==typeof r&&(n=r,r=null);if(r=h({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(n))return this;switch(o={cmd:"publish",topic:e,payload:t,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},5===i.protocolVersion&&(o.properties=r.properties,(!i.properties&&o.properties&&o.properties.topicAlias||r.properties&&i.properties&&(r.properties.topicAlias&&i.properties.topicAliasMaximum&&r.properties.topicAlias>i.properties.topicAliasMaximum||!i.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete o.properties.topicAlias),r.qos){case 1:case 2:this.outgoing[o.messageId]={volatile:!1,cb:n||g},this._storeProcessing?(this._packetIdsDuringStoreProcessing[o.messageId]=!1,this._storePacket(o,void 0,r.cbStorePut)):this._sendPacket(o,void 0,r.cbStorePut);break;default:this._storeProcessing?this._storePacket(o,n,r.cbStorePut):this._sendPacket(o,n,r.cbStorePut)}return this},a.prototype.subscribe=function(){for(var e,t=new Array(arguments.length),r=0;r<arguments.length;r++)t[r]=arguments[r];var n,o=[],i=t.shift(),s=i.resubscribe,a=t.pop()||g,c=t.pop(),l=this,d=this.options.protocolVersion;if(delete i.resubscribe,"string"==typeof i&&(i=[i]),"function"!=typeof a&&(c=a,a=g),null!==(n=f.validateTopics(i)))return m(a,new Error("Invalid topic "+n)),this;if(this._checkDisconnecting(a))return this;var u={qos:0};if(5===d&&(u.nl=!1,u.rap=!1,u.rh=0),c=h(u,c),Array.isArray(i)?i.forEach(function(e){if(!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<c.qos||s){var t={topic:e,qos:c.qos};5===d&&(t.nl=c.nl,t.rap=c.rap,t.rh=c.rh,t.properties=c.properties),o.push(t)}}):Object.keys(i).forEach(function(e){if(!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<i[e].qos||s){var t={topic:e,qos:i[e].qos};5===d&&(t.nl=i[e].nl,t.rap=i[e].rap,t.rh=i[e].rh,t.properties=c.properties),o.push(t)}}),e={cmd:"subscribe",subscriptions:o,qos:1,retain:!1,dup:!1,messageId:this._nextId()},c.properties&&(e.properties=c.properties),o.length){if(this.options.resubscribe){var p=[];o.forEach(function(e){if(0<l.options.reconnectPeriod){var t={qos:e.qos};5===d&&(t.nl=e.nl||!1,t.rap=e.rap||!1,t.rh=e.rh||0,t.properties=e.properties),l._resubscribeTopics[e.topic]=t,p.push(e.topic)}}),l.messageIdToTopic[e.messageId]=p}return this.outgoing[e.messageId]={volatile:!0,cb:function(e,t){if(!e)for(var r=t.granted,n=0;n<r.length;n+=1)o[n].qos=r[n];a(e,o)}},this._sendPacket(e),this}a(null,[])},a.prototype.unsubscribe=function(){for(var e={cmd:"unsubscribe",qos:1,messageId:this._nextId()},t=this,r=new Array(arguments.length),n=0;n<arguments.length;n++)r[n]=arguments[n];var o=r.shift(),i=r.pop()||g,s=r.pop();return"string"==typeof o&&(o=[o]),"function"!=typeof i&&(s=i,i=g),this._checkDisconnecting(i)||("string"==typeof o?e.unsubscriptions=[o]:"object"==typeof o&&o.length&&(e.unsubscriptions=o),this.options.resubscribe&&e.unsubscriptions.forEach(function(e){delete t._resubscribeTopics[e]}),"object"==typeof s&&s.properties&&(e.properties=s.properties),this.outgoing[e.messageId]={volatile:!0,cb:i},this._sendPacket(e)),this},a.prototype.end=function(){var e=this,t=arguments[0],r=arguments[1],n=arguments[2];function o(){e.disconnected=!0,e.incomingStore.close(function(){e.outgoingStore.close(function(){n&&n.apply(null,arguments),e.emit("end")})}),e._deferredReconnect&&e._deferredReconnect()}function i(){e._cleanUp(t,m.bind(null,o),r)}return null!=t&&"boolean"==typeof t||(n=r||g,r=t,t=!1,"object"!=typeof r&&(n=r,r=null,"function"!=typeof n&&(n=g))),"object"!=typeof r&&(n=r,r=null),n=n||g,this.disconnecting||(this._clearReconnect(),this.disconnecting=!0,!t&&0<Object.keys(this.outgoing).length?this.once("outgoingEmpty",setTimeout.bind(null,i,10)):i()),this},a.prototype.removeOutgoingMessage=function(e){var t=this.outgoing[e]?this.outgoing[e].cb:null;return delete this.outgoing[e],this.outgoingStore.del({messageId:e},function(){t(new Error("Message removed"))}),this},a.prototype.reconnect=function(e){var t=this,r=function(){e?(t.options.incomingStore=e.incomingStore,t.options.outgoingStore=e.outgoingStore):(t.options.incomingStore=null,t.options.outgoingStore=null),t.incomingStore=t.options.incomingStore||new i,t.outgoingStore=t.options.outgoingStore||new i,t.disconnecting=!1,t.disconnected=!1,t._deferredReconnect=null,t._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this},a.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},a.prototype._setupReconnect=function(){var e=this;!e.disconnecting&&!e.reconnectTimer&&0<e.options.reconnectPeriod&&(this.reconnecting||(this.emit("offline"),this.reconnecting=!0),e.reconnectTimer=setInterval(function(){e._reconnect()},e.options.reconnectPeriod))},a.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},a.prototype._cleanUp=function(e,t){var r,n=arguments[2];if(t&&this.stream.on("close",t),e)0===this.options.reconnectPeriod&&this.options.clean&&(r=this.outgoing)&&Object.keys(r).forEach(function(e){"function"==typeof r[e].cb&&(r[e].cb(new Error("Connection closed")),delete r[e])}),this.stream.destroy();else{var o=h({cmd:"disconnect"},n);this._sendPacket(o,m.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null),t&&!this.connected&&(this.stream.removeListener("close",t),t())},a.prototype._sendPacket=function(e,t,r){if(r=r||g,this.connected){switch(this._shiftPingInterval(),e.cmd){case"publish":break;case"pubrel":return void o(this,e,t,r);default:return void p(this,e,t)}switch(e.qos){case 2:case 1:o(this,e,t,r);break;case 0:default:p(this,e,t)}}else this._storePacket(e,t,r)},a.prototype._storePacket=function(e,t,r){r=r||g,0===(e.qos||0)&&this.queueQoSZero||"publish"!==e.cmd?this.queue.push({packet:e,cb:t}):0<e.qos?(t=this.outgoing[e.messageId]?this.outgoing[e.messageId].cb:null,this.outgoingStore.put(e,function(e){if(e)return t&&t(e);r()})):t&&t(new Error("No connection to broker"))},a.prototype._setupPingTimer=function(){var e=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=r(function(){e._checkPing()},1e3*this.options.keepalive))},a.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},a.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):this._cleanUp(!0)},a.prototype._handlePingresp=function(){this.pingResp=!0},a.prototype._handleConnack=function(e){var t=this.options,r=5===t.protocolVersion?e.reasonCode:e.returnCode;if(clearTimeout(this.connackTimer),e.properties&&(e.properties.topicAliasMaximum&&(t.properties||(t.properties={}),t.properties.topicAliasMaximum=e.properties.topicAliasMaximum),e.properties.serverKeepAlive&&t.keepalive&&(t.keepalive=e.properties.serverKeepAlive,this._shiftPingInterval()),e.properties.maximumPacketSize&&(t.properties||(t.properties={}),t.properties.maximumPacketSize=e.properties.maximumPacketSize)),0===r)this.reconnecting=!1,this._onConnect(e);else if(0<r){var n=new Error("Connection refused: "+u[r]);n.code=r,this.emit("error",n)}},a.prototype._handlePublish=function(r,n){n=void 0!==n?n:g;var o=r.topic.toString(),i=r.payload,e=r.qos,s=r.messageId,a=this,t=this.options,c=[0,16,128,131,135,144,145,151,153];switch(e){case 2:t.customHandleAcks(o,i,r,function(e,t){return e instanceof Error||(t=e,e=null),e?a.emit("error",e):-1===c.indexOf(t)?a.emit("error",new Error("Wrong reason code for pubrec")):void(t?a._sendPacket({cmd:"pubrec",messageId:s,reasonCode:t},n):a.incomingStore.put(r,function(){a._sendPacket({cmd:"pubrec",messageId:s},n)}))});break;case 1:t.customHandleAcks(o,i,r,function(e,t){return e instanceof Error||(t=e,e=null),e?a.emit("error",e):-1===c.indexOf(t)?a.emit("error",new Error("Wrong reason code for puback")):(t||a.emit("message",o,i,r),void a.handleMessage(r,function(e){if(e)return n&&n(e);a._sendPacket({cmd:"puback",messageId:s,reasonCode:t},n)}))});break;case 0:this.emit("message",o,i,r),this.handleMessage(r,n)}},a.prototype.handleMessage=function(e,t){t()},a.prototype._handleAck=function(e){var t,r=e.messageId,n=e.cmd,o=null,i=this.outgoing[r]?this.outgoing[r].cb:null,s=this;if(i){switch(n){case"pubcomp":case"puback":var a=e.reasonCode;a&&0<a&&16!==a&&((t=new Error("Publish error: "+u[a])).code=a,i(t,e)),delete this.outgoing[r],this.outgoingStore.del(e,i);break;case"pubrec":o={cmd:"pubrel",qos:2,messageId:r};var c=e.reasonCode;c&&0<c&&16!==c?((t=new Error("Publish error: "+u[c])).code=c,i(t,e)):this._sendPacket(o);break;case"suback":delete this.outgoing[r];for(var l=0;l<e.granted.length;l++)if(0!=(128&e.granted[l])){var d=this.messageIdToTopic[r];d&&d.forEach(function(e){delete s._resubscribeTopics[e]})}i(null,e);break;case"unsuback":delete this.outgoing[r],i(null);break;default:s.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},a.prototype._handlePubrel=function(e,r){r=void 0!==r?r:g;var t=e.messageId,n=this,o={cmd:"pubcomp",messageId:t};n.incomingStore.get(e,function(e,t){e?n._sendPacket(o,r):(n.emit("message",t.topic,t.payload,t),n.handleMessage(t,function(e){if(e)return r(e);n.incomingStore.del(t,g),n._sendPacket(o,r)}))})},a.prototype._handleDisconnect=function(e){this.emit("disconnect",e)},a.prototype._nextId=function(){var e=this.nextId++;return 65536===this.nextId&&(this.nextId=1),e},a.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},a.prototype._resubscribe=function(e){var t=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!e.sessionPresent)&&0<t.length)if(this.options.resubscribe)if(5===this.options.protocolVersion)for(var r=0;r<t.length;r++){var n={};n[t[r]]=this._resubscribeTopics[t[r]],n.resubscribe=!0,this.subscribe(n,{properties:n[t[r]].properties})}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},a.prototype._onConnect=function(i){if(this.disconnected)this.emit("connect",i);else{var s=this;this._setupPingTimer(),this._resubscribe(i),this.connected=!0,function r(){var t=s.outgoingStore.createStream();function n(){s._storeProcessing=!1,s._packetIdsDuringStoreProcessing={}}function o(){t.destroy(),t=null,n()}s.once("close",o),t.on("error",function(e){n(),s.removeListener("close",o),s.emit("error",e)}),t.on("end",function(){var e=!0;for(var t in s._packetIdsDuringStoreProcessing)if(!s._packetIdsDuringStoreProcessing[t]){e=!1;break}e?(n(),s.removeListener("close",o),s.emit("connect",i)):r()}),function r(){if(t){s._storeProcessing=!0;var n,e=t.read(1);e?s._packetIdsDuringStoreProcessing[e.messageId]?r():s.disconnecting||s.reconnectTimer?t.destroy&&t.destroy():(n=s.outgoing[e.messageId]?s.outgoing[e.messageId].cb:null,s.outgoing[e.messageId]={volatile:!1,cb:function(e,t){n&&n(e,t),r()}},s._packetIdsDuringStoreProcessing[e.messageId]=!0,s._sendPacket(e)):t.once("readable",r)}}()}()}},y.exports=a}).call(this,v("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":7,"./validations":8,_process:92,events:13,inherits:80,"mqtt-packet":84,"readable-stream":108,reinterval:109,xtend:121}],2:[function(e,t,r){(function(d){"use strict";var u,p,f,h=e("readable-stream").Transform,m=e("duplexify"),g=e("base64-js"),v=!1;t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error("Could not determine host. Specify host manually.");var r,n="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={});var o,i,s,a,c,l=(i=e,s="alis"===(o=t).protocol?"wss":"ws",a=s+"://"+o.hostname+o.path,o.port&&80!==o.port&&443!==o.port&&(a=s+"://"+o.hostname+":"+o.port+o.path),"function"==typeof o.transformWsUrl&&(a=o.transformWsUrl(a,o,i)),a);return(u=t.my).connectSocket({url:l,protocols:n}),(c=new h)._write=function(e,t,r){u.sendSocketMessage({data:e.buffer,success:function(){r()},fail:function(){r(new Error)}})},c._flush=function(e){u.closeSocket({success:function(){e()}})},p=c,f=m.obj(),v||(v=!0,u.onSocketOpen(function(){f.setReadable(p),f.setWritable(p),f.emit("connect")}),u.onSocketMessage(function(e){if("string"==typeof e.data){var t=g.toByteArray(e.data),r=d.from(t);p.push(r)}else{var n=new FileReader;n.addEventListener("load",function(){var e=n.result;e=e instanceof ArrayBuffer?d.from(e):d.from(e,"utf8"),p.push(e)}),n.readAsArrayBuffer(e.data)}}),u.onSocketClose(function(){f.end(),f.destroy()}),u.onSocketError(function(e){f.destroy(e)})),f}}).call(this,e("buffer").Buffer)},{"base64-js":10,buffer:12,duplexify:17,"readable-stream":108}],3:[function(e,t,r){"use strict";var o=e("net");t.exports=function(e,t){var r,n;return t.port=t.port||1883,t.hostname=t.hostname||t.host||"localhost",r=t.port,n=t.hostname,o.createConnection(r,n)}},{net:11}],4:[function(e,t,r){"use strict";var o=e("tls");t.exports=function(t,r){var n;function e(e){r.rejectUnauthorized&&t.emit("error",e),n.end()}return r.port=r.port||8883,r.host=r.hostname||r.host||"localhost",r.rejectUnauthorized=!1!==r.rejectUnauthorized,delete r.path,(n=o.connect(r)).on("secureConnect",function(){r.rejectUnauthorized&&!n.authorized?n.emit("error",new Error("TLS not authorized")):n.removeListener("error",e)}),n.on("error",e),n}},{tls:11}],5:[function(t,r,e){(function(e){"use strict";var c=t("websocket-stream"),n=t("url"),l=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],d="browser"===e.title;function o(e,t){var r,n="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.port||("wss"===r.protocol?r.port=443:r.port=80),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={}),d||"wss"!==r.protocol||l.forEach(function(e){r.hasOwnProperty(e)&&!r.wsOptions.hasOwnProperty(e)&&(r.wsOptions[e]=r[e])});var o,i,s,a=(i=e,s=(o=t).protocol+"://"+o.hostname+":"+o.port+o.path,"function"==typeof o.transformWsUrl&&(s=o.transformWsUrl(s,o,i)),s);return c(a,[n],t.wsOptions)}r.exports=d?function(e,t){if(t.hostname||(t.hostname=t.host),!t.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");var r=n.parse(document.URL);t.hostname=r.hostname,t.port||(t.port=r.port)}return o(e,t)}:function(e,t){return o(e,t)}}).call(this,t("_process"))},{_process:92,url:113,"websocket-stream":118}],6:[function(e,t,r){(function(u,p){"use strict";var f,h,m,g=e("readable-stream").Transform,v=e("duplexify");t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error("Could not determine host. Specify host manually.");var r,n="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={});var o,i,s,a,c,l=(i=e,s="wxs"===(o=t).protocol?"wss":"ws",a=s+"://"+o.hostname+o.path,o.port&&80!==o.port&&443!==o.port&&(a=s+"://"+o.hostname+":"+o.port+o.path),"function"==typeof o.transformWsUrl&&(a=o.transformWsUrl(a,o,i)),a);f=wx.connectSocket({url:l,protocols:n}),(c=new g)._write=function(e,t,r){f.send({data:e.buffer,success:function(){r()},fail:function(e){r(new Error(e))}})},c._flush=function(e){f.close({success:function(){e()}})},h=c,(m=v.obj())._destroy=function(e,t){f.close({success:function(){t&&t(e)}})};var d=m.destroy;return m.destroy=function(){m.destroy=d;var e=this;u.nextTick(function(){f.close({fail:function(){e._destroy(new Error)}})})}.bind(m),f.onOpen(function(){m.setReadable(h),m.setWritable(h),m.emit("connect")}),f.onMessage(function(e){var t=e.data;t=t instanceof ArrayBuffer?p.from(t):p.from(t,"utf8"),h.push(t)}),f.onClose(function(){m.end(),m.destroy()}),f.onError(function(e){m.destroy(new Error(e.errMsg))}),m}}).call(this,e("_process"),e("buffer").Buffer)},{_process:92,buffer:12,duplexify:17,"readable-stream":108}],7:[function(e,c,t){(function(o){"use strict";var t=e("xtend"),i=e("readable-stream").Readable,s={objectMode:!0},r={clean:!0},n=e("es6-map");function a(e){if(!(this instanceof a))return new a(e);this.options=e||{},this.options=t(r,e),this._inflights=new n}a.prototype.put=function(e,t){return this._inflights.set(e.messageId,e),t&&t(),this},a.prototype.createStream=function(){var e=new i(s),t=!1,r=[],n=0;return this._inflights.forEach(function(e,t){r.push(e)}),e._read=function(){!t&&n<r.length?this.push(r[n++]):this.push(null)},e.destroy=function(){if(!t){var e=this;t=!0,o.nextTick(function(){e.emit("close")})}},e},a.prototype.del=function(e,t){return(e=this._inflights.get(e.messageId))?(this._inflights.delete(e.messageId),t(null,e)):t&&t(new Error("missing packet")),this},a.prototype.get=function(e,t){return(e=this._inflights.get(e.messageId))?t(null,e):t&&t(new Error("missing packet")),this},a.prototype.close=function(e){this.options.clean&&(this._inflights=null),e&&e()},c.exports=a}).call(this,e("_process"))},{_process:92,"es6-map":67,"readable-stream":108,xtend:121}],8:[function(e,t,r){"use strict";function n(e){for(var t=e.split("/"),r=0;r<t.length;r++)if("+"!==t[r]){if("#"===t[r])return r===t.length-1;if(-1!==t[r].indexOf("+")||-1!==t[r].indexOf("#"))return!1}return!0}t.exports={validateTopics:function(e){if(0===e.length)return"empty_topic_list";for(var t=0;t<e.length;t++)if(!n(e[t]))return e[t];return null}}},{}],9:[function(n,o,e){(function(e){"use strict";var s=n("../client"),t=n("../store"),a=n("url"),c=n("xtend"),l={};function r(e,t){if("object"!=typeof e||t||(t=e,e=null),t=t||{},e){var r=a.parse(e,!0);if(null!=r.port&&(r.port=Number(r.port)),null===(t=c(r,t)).protocol)throw new Error("Missing protocol");t.protocol=t.protocol.replace(/:$/,"")}var n,o;if((n=t).auth&&((o=n.auth.match(/^(.+):(.+)$/))?(n.username=o[1],n.password=o[2]):n.username=n.auth),t.query&&"string"==typeof t.query.clientId&&(t.clientId=t.query.clientId),t.cert&&t.key){if(!t.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(t.protocol))switch(t.protocol){case"mqtt":t.protocol="mqtts";break;case"ws":t.protocol="wss";break;case"wx":t.protocol="wxs";break;case"ali":t.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+t.protocol+'"!')}}if(!l[t.protocol]){var i=-1!==["mqtts","wss"].indexOf(t.protocol);t.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(e,t){return(!i||t%2!=0)&&"function"==typeof l[e]})[0]}if(!1===t.clean&&!t.clientId)throw new Error("Missing clientId for unclean clients");return t.protocol&&(t.defaultProtocol=t.protocol),new s(function(e){return t.servers&&(e._reconnectCount&&e._reconnectCount!==t.servers.length||(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,t.protocol=t.servers[e._reconnectCount].protocol?t.servers[e._reconnectCount].protocol:t.defaultProtocol,t.hostname=t.host,e._reconnectCount++),l[t.protocol](e,t)},t)}"browser"!==e.title?(l.mqtt=n("./tcp"),l.tcp=n("./tcp"),l.ssl=n("./tls"),l.tls=n("./tls"),l.mqtts=n("./tls")):(l.wx=n("./wx"),l.wxs=n("./wx"),l.ali=n("./ali"),l.alis=n("./ali")),l.ws=n("./ws"),l.wss=n("./ws"),o.exports=r,o.exports.connect=r,o.exports.MqttClient=s,o.exports.Store=t}).call(this,n("_process"))},{"../client":1,"../store":7,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:92,url:113,xtend:121}],10:[function(e,t,r){"use strict";r.byteLength=function(e){var t=f(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){for(var t,r=f(e),n=r[0],o=r[1],i=new p((l=n,d=o,3*(l+d)/4-d)),s=0,a=0<o?n-4:n,c=0;c<a;c+=4)t=u[e.charCodeAt(c)]<<18|u[e.charCodeAt(c+1)]<<12|u[e.charCodeAt(c+2)]<<6|u[e.charCodeAt(c+3)],i[s++]=t>>16&255,i[s++]=t>>8&255,i[s++]=255&t;var l,d;2===o&&(t=u[e.charCodeAt(c)]<<2|u[e.charCodeAt(c+1)]>>4,i[s++]=255&t);1===o&&(t=u[e.charCodeAt(c)]<<10|u[e.charCodeAt(c+1)]<<4|u[e.charCodeAt(c+2)]>>2,i[s++]=t>>8&255,i[s++]=255&t);return i},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,o=[],i=0,s=r-n;i<s;i+=16383)o.push(c(e,i,s<i+16383?s:i+16383));1===n?(t=e[r-1],o.push(a[t>>2]+a[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],o.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return o.join("")};for(var a=[],u=[],p="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=n.length;o<i;++o)a[o]=n[o],u[n.charCodeAt(o)]=o;function f(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var n,o,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(a[(o=n)>>18&63]+a[o>>12&63]+a[o>>6&63]+a[63&o]);return i.join("")}u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},{}],11:[function(e,t,r){},{}],12:[function(e,t,r){"use strict";var n=e("base64-js"),i=e("ieee754");r.Buffer=u,r.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},r.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(o<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=u.prototype,t}function u(e,t,r){if("number"!=typeof e)return a(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}function a(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|f(e,t),n=s(r),o=n.write(e,t);o!==r&&(n=n.slice(0,o));return n}(e,t);if(ArrayBuffer.isView(e))return d(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer))return function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=u.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,r);var o=function(e){if(u.isBuffer(e)){var t=0|p(e.length),r=s(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||N(e.length)?s(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return c(e),s(e<0?0:0|p(e))}function d(e){for(var t=e.length<0?0:0|p(e.length),r=s(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e){if(o<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function f(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return U(e).length;default:if(o)return n?-1:O(e).length;t=(""+t).toLowerCase(),o=!0}}function h(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),N(r=+r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,o){var i,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a/=s=2,c/=2,r/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var d=-1;for(i=r;i<a;i++)if(l(e,i)===l(t,-1===d?0:i-d)){if(-1===d&&(d=i),i-d+1===c)return d*s}else-1!==d&&(i-=i-d),d=-1}else for(a<r+c&&(r=a-c),i=r;0<=i;i--){for(var u=!0,p=0;p<c;p++)if(l(e,i+p)!==l(t,p)){u=!1;break}if(u)return i}return-1}function v(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?o<(n=Number(n))&&(n=o):n=o;var i=t.length;i/2<n&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(N(a))return s;e[r+s]=a}return s}function y(e,t,r,n){return L(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function _(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,s,a,c,l=e[o],d=null,u=239<l?4:223<l?3:191<l?2:1;if(o+u<=r)switch(u){case 1:l<128&&(d=l);break;case 2:128==(192&(i=e[o+1]))&&127<(c=(31&l)<<6|63&i)&&(d=c);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&2047<(c=(15&l)<<12|(63&i)<<6|63&s)&&(c<55296||57343<c)&&(d=c);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&65535<(c=(15&l)<<18|(63&i)<<12|(63&s)<<6|63&a)&&c<1114112&&(d=c)}null===d?(d=65533,u=1):65535<d&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|1023&d),n.push(d),o+=u}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}r.kMaxLength=o,(u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=function(e,t,r){return a(e,t,r)},u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(e,t,r){return o=t,i=r,c(n=e),n<=0?s(n):void 0!==o?"string"==typeof i?s(n).fill(o,i):s(n).fill(o):s(n);var n,o,i},u.allocUnsafe=function(e){return l(e)},u.allocUnsafeSlow=function(e){return l(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(D(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(r=t=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var i=e[r];if(D(i,Uint8Array)&&(i=u.from(i)),!u.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},u.byteLength=f,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},u.prototype.toLocaleString=u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?_(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return _(this,t,r);case"ascii":return w(this,t,r);case"latin1":case"binary":return E(this,t,r);case"base64":return b(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,n,o){if(D(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(o<=n&&r<=t)return 0;if(o<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(i,s),c=this.slice(n,o),l=e.slice(t,r),d=0;d<a;++d)if(c[d]!==l[d]){i=c[d],s=l[d];break}return i<s?-1:s<i?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||o<r)&&(r=o),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i,s,a,c,l,d,u,p,f,h=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return p=t,f=r,L(O(e,(u=this).length-p),u,p,f);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return c=this,l=t,d=r,L(U(e),c,l,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=t,a=r,L(function(e,t){for(var r,n,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(e,(i=this).length-s),i,s,a);default:if(h)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),h=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function w(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function E(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function C(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||n<r)&&(r=n);for(var o="",i=t;i<r;++i)o+=A(e[i]);return o}function T(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function I(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,r,n,o,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<t||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function P(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function x(e,t,r,n,o){return t=+t,r>>>=0,o||P(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function M(e,t,r,n,o){return t=+t,r>>>=0,o||P(e,0,r,8),i.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=u.prototype,n},u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e+--t],o=1;0<t&&(o*=256);)n+=this[e+--t]*o;return n},u.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return(o*=128)<=n&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=t,o=1,i=this[e+--n];0<n&&(o*=256);)i+=this[e+--n]*o;return(o*=128)<=i&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;0<=--o&&(i*=256);)this[t+o]=e/i&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var o=Math.pow(2,8*r-1);R(this,e,t,r,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var o=Math.pow(2,8*r-1);R(this,e,t,r,o-1,-o)}var i=r-1,s=1,a=0;for(this[t+i]=255&e;0<=--i&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,r){return x(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return x(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return M(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return M(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),0<n&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=o-1;0<=i;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return o},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var o=e.charCodeAt(0);("utf8"===n&&o<128||"latin1"===n)&&(e=o)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var s=u.isBuffer(e)?e:u.from(e,n),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%a]}return this};var k=/[^+/0-9A-Za-z-_]/g;function A(e){return e<16?"0"+e.toString(16):e.toString(16)}function O(e,t){var r;t=t||1/0;for(var n=e.length,o=null,i=[],s=0;s<n;++s){if(55295<(r=e.charCodeAt(s))&&r<57344){if(!o){if(56319<r){-1<(t-=3)&&i.push(239,191,189);continue}if(s+1===n){-1<(t-=3)&&i.push(239,191,189);continue}o=r;continue}if(r<56320){-1<(t-=3)&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&-1<(t-=3)&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function U(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(k,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function L(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function N(e){return e!=e}},{"base64-js":10,ieee754:79}],13:[function(e,t,r){var c=Object.create||function(e){var t=function(){};return t.prototype=e,new t},s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},i=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=c(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0;var o,a=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),o=0===l.x}catch(e){o=!1}function d(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var o,i,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]):(i=e._events=c(null),e._eventsCount=0),s){if("function"==typeof s?s=i[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),!s.warned&&(o=d(e))&&0<o&&s.length>o){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else s=i[t]=r,++e._eventsCount;return e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=i.call(p,n);return o.listener=r,n.wrapFn=o}function h(e,t,r){var n=e._events;if(!n)return[];var o=n[t];return o?"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):g(o,o.length):[]}function m(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}o?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');a=e}}):n.defaultMaxListeners=a,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return d(this)},n.prototype.emit=function(e){var t,r,n,o,i,s,a="error"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(1<arguments.length&&(t=arguments[1]),t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");throw c.context=t,c}if(!(r=s[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,o=g(e,n),i=0;i<n;++i)o[i].call(r)}(r,l,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,i=g(e,o),s=0;s<o;++s)i[s].call(r,n)}(r,l,this,arguments[1]);break;case 3:!function(e,t,r,n,o){if(t)e.call(r,n,o);else for(var i=e.length,s=g(e,i),a=0;a<i;++a)s[a].call(r,n,o)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,o,i){if(t)e.call(r,n,o,i);else for(var s=e.length,a=g(e,s),c=0;c<s;++c)a[c].call(r,n,o,i)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];!function(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,i=g(e,o),s=0;s<o;++s)i[s].apply(r,n)}(r,l,this,o)}return!0},n.prototype.on=n.prototype.addListener=function(e,t){return u(this,e,t,!1)},n.prototype.prependListener=function(e,t){return u(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},n.prototype.removeListener=function(e,t){var r,n,o,i,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=c(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length-1;0<=i;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),n.removeListener&&this.emit("removeListener",e,s||t)}return this},n.prototype.removeAllListeners=function(e){var t,r,n;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=c(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=c(null):delete r[e]),this;if(0===arguments.length){var o,i=s(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=c(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(n=t.length-1;0<=n;n--)this.removeListener(e,t[n]);return this},n.prototype.listeners=function(e){return h(this,e,!0)},n.prototype.rawListeners=function(e){return h(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},n.prototype.listenerCount=m,n.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],14:[function(e,t,r){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":81}],15:[function(e,t,r){"use strict";var n,i=e("es5-ext/object/copy"),o=e("es5-ext/object/normalize-options"),s=e("es5-ext/object/valid-callable"),a=e("es5-ext/object/map"),c=e("es5-ext/object/valid-callable"),l=e("es5-ext/object/valid-value"),d=Function.prototype.bind,u=Object.defineProperty,p=Object.prototype.hasOwnProperty;n=function(e,t,r){var n,o=l(t)&&c(t.value);return delete(n=i(t)).writable,delete n.value,n.get=function(){return!r.overwriteDefinition&&p.call(this,e)?o:(t.value=d.call(o,r.resolveContext?r.resolveContext(this):this),u(this,e,t),this[e])},n},t.exports=function(e){var r=o(arguments[1]);return null!=r.resolveContext&&s(r.resolveContext),a(e,function(e,t){return n(t,e,r)})}},{"es5-ext/object/copy":39,"es5-ext/object/map":48,"es5-ext/object/normalize-options":49,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55}],16:[function(e,t,r){"use strict";var a=e("es5-ext/object/assign"),c=e("es5-ext/object/normalize-options"),l=e("es5-ext/object/is-callable"),d=e("es5-ext/string/#/contains");(t.exports=function(e,t){var r,n,o,i,s;return arguments.length<2||"string"!=typeof e?(i=t,t=e,e=null):i=arguments[2],null==e?(r=o=!0,n=!1):(r=d.call(e,"c"),n=d.call(e,"e"),o=d.call(e,"w")),s={value:t,configurable:r,enumerable:n,writable:o},i?a(c(i),s):s}).gs=function(e,t,r){var n,o,i,s;return"string"!=typeof e?(i=r,r=t,t=e,e=null):i=arguments[3],null==t?t=void 0:l(t)?null==r?r=void 0:l(r)||(i=r,r=void 0):(i=t,t=r=void 0),o=null==e?!(n=!0):(n=d.call(e,"c"),d.call(e,"e")),s={get:t,set:r,configurable:n,enumerable:o},i?a(c(i),s):s}},{"es5-ext/object/assign":36,"es5-ext/object/is-callable":42,"es5-ext/object/normalize-options":49,"es5-ext/string/#/contains":56}],17:[function(d,u,e){(function(o,e){var s=d("readable-stream"),a=d("end-of-stream"),t=d("inherits"),r=d("stream-shift"),n=e.from&&e.from!==Uint8Array.from?e.from([0]):new e([0]),i=function(e,t){e._corked?e.once("uncork",t):t()},c=function(n,o){return function(e){var t,r;e?(t=n,r="premature close"===e.message?null:e,t._autoDestroy&&t.destroy(r)):o&&!n._ended&&n.end()}},l=function(e,t,r){if(!(this instanceof l))return new l(e,t,r);s.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),t&&this.setReadable(t)};t(l,s.Duplex),l.obj=function(e,t,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new l(e,t,r)},l.prototype.cork=function(){1==++this._corked&&this.emit("cork")},l.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},l.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed)e&&e.destroy&&e.destroy();else if(null!==e&&!1!==e){var t=this,r=a(e,{writable:!0,readable:!1},c(this,this._forwardEnd)),n=function(){var e=t._ondrain;t._ondrain=null,e&&e()};this._unwrite&&o.nextTick(n),this._writable=e,this._writable.on("drain",n),this._unwrite=function(){t._writable.removeListener("drain",n),r()},this.uncork()}else this.end()},l.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed)e&&e.destroy&&e.destroy();else{if(null===e||!1===e)return this.push(null),void this.resume();var t,r=this,n=a(e,{writable:!1,readable:!0},c(this)),o=function(){r._forward()},i=function(){r.push(null)};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:(t=e,new s.Readable({objectMode:!0,highWaterMark:16}).wrap(t)),this._readable2.on("readable",o),this._readable2.on("end",i),this._unread=function(){r._readable2.removeListener("readable",o),r._readable2.removeListener("end",i),n()},this._forward()}},l.prototype._read=function(){this._drained=!0,this._forward()},l.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var e;for(this._forwarding=!0;this._drained&&null!==(e=r(this._readable2));)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}},l.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0;var t=this;o.nextTick(function(){t._destroy(e)})}},l.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit("error",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},l.prototype._write=function(e,t,r){return this.destroyed?r():this._corked?i(this,this._write.bind(this,e,t,r)):e===n?this._finish(r):this._writable?void(!1===this._writable.write(e)?this._ondrain=r:r()):r()},l.prototype._finish=function(r){var n=this;this.emit("preend"),i(this,function(){var e,t;e=n._forwardEnd&&n._writable,t=function(){!1===n._writableState.prefinished&&(n._writableState.prefinished=!0),n.emit("prefinish"),i(n,r)},e?e._writableState&&e._writableState.finished?t():e._writableState?e.end(t):(e.end(),t()):t()})},l.prototype.end=function(e,t,r){return"function"==typeof e?this.end(null,null,e):"function"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this.write(n),s.Writable.prototype.end.call(this,r))},u.exports=l}).call(this,d("_process"),d("buffer").Buffer)},{_process:92,buffer:12,"end-of-stream":18,inherits:80,"readable-stream":108,"stream-shift":111}],18:[function(e,t,r){var g=e("once"),v=function(){},y=function(t,e,r){if("function"==typeof e)return y(t,null,e);e||(e={}),r=g(r||v);var n,o,i=t._writableState,s=t._readableState,a=e.readable||!1!==e.readable&&t.readable,c=e.writable||!1!==e.writable&&t.writable,l=function(){t.writable||d()},d=function(){c=!1,a||r.call(t)},u=function(){a=!1,c||r.call(t)},p=function(e){r.call(t,e?new Error("exited with error code: "+e):null)},f=function(e){r.call(t,e)},h=function(){return(!a||s&&s.ended)&&(!c||i&&i.ended)?void 0:r.call(t,new Error("premature close"))},m=function(){t.req.on("finish",d)};return(n=t).setHeader&&"function"==typeof n.abort?(t.on("complete",d),t.on("abort",h),t.req?m():t.on("request",m)):c&&!i&&(t.on("end",l),t.on("close",l)),(o=t).stdio&&Array.isArray(o.stdio)&&3===o.stdio.length&&t.on("exit",p),t.on("end",u),t.on("finish",d),!1!==e.error&&t.on("error",f),t.on("close",h),function(){t.removeListener("complete",d),t.removeListener("abort",h),t.removeListener("request",m),t.req&&t.req.removeListener("finish",d),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",d),t.removeListener("exit",p),t.removeListener("end",u),t.removeListener("error",f),t.removeListener("close",h)}};t.exports=y},{once:90}],19:[function(e,t,r){"use strict";var n=e("../../object/valid-value");t.exports=function(){return n(this).length=0,this}},{"../../object/valid-value":55}],20:[function(e,t,r){"use strict";var i=e("../../number/is-nan"),s=e("../../number/to-pos-integer"),a=e("../../object/valid-value"),c=Array.prototype.indexOf,l=Object.prototype.hasOwnProperty,d=Math.abs,u=Math.floor;t.exports=function(e){var t,r,n,o;if(!i(e))return c.apply(this,arguments);for(r=s(a(this).length),n=arguments[1],t=n=isNaN(n)?0:0<=n?u(n):s(this.length)-u(d(n));t<r;++t)if(l.call(this,t)&&(o=this[t],i(o)))return t;return-1}},{"../../number/is-nan":30,"../../number/to-pos-integer":34,"../../object/valid-value":55}],21:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Array.from:e("./shim")},{"./is-implemented":22,"./shim":23}],22:[function(e,t,r){"use strict";t.exports=function(){var e,t,r=Array.from;return"function"==typeof r&&(t=r(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},{}],23:[function(e,t,r){"use strict";var f=e("es6-symbol").iterator,h=e("../../function/is-arguments"),m=e("../../function/is-function"),g=e("../../number/to-pos-integer"),v=e("../../object/valid-callable"),y=e("../../object/valid-value"),b=e("../../object/is-value"),_=e("../../string/is-string"),S=Array.isArray,w=Function.prototype.call,E={configurable:!0,enumerable:!0,writable:!0,value:null},C=Object.defineProperty;t.exports=function(e){var t,r,n,o,i,s,a,c,l,d,u=arguments[1],p=arguments[2];if(e=Object(y(e)),b(u)&&v(u),this&&this!==Array&&m(this))t=this;else{if(!u){if(h(e))return 1!==(i=e.length)?Array.apply(null,e):((o=new Array(1))[0]=e[0],o);if(S(e)){for(o=new Array(i=e.length),r=0;r<i;++r)o[r]=e[r];return o}}o=[]}if(!S(e))if(void 0!==(l=e[f])){for(a=v(l).call(e),t&&(o=new t),c=a.next(),r=0;!c.done;)d=u?w.call(u,p,c.value,r):c.value,t?(E.value=d,C(o,r,E)):o[r]=d,c=a.next(),++r;i=r}else if(_(e)){for(i=e.length,t&&(o=new t),n=r=0;r<i;++r)d=e[r],r+1<i&&55296<=(s=d.charCodeAt(0))&&s<=56319&&(d+=e[++r]),d=u?w.call(u,p,d,n):d,t?(E.value=d,C(o,n,E)):o[n]=d,++n;i=n}if(void 0===i)for(i=g(e.length),t&&(o=new t(i)),r=0;r<i;++r)d=u?w.call(u,p,e[r],r):e[r],t?(E.value=d,C(o,r,E)):o[r]=d;return t&&(E.value=null,o.length=i),o}},{"../../function/is-arguments":24,"../../function/is-function":25,"../../number/to-pos-integer":34,"../../object/is-value":44,"../../object/valid-callable":54,"../../object/valid-value":55,"../../string/is-string":59,"es6-symbol":73}],24:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call(function(){return arguments}());t.exports=function(e){return n.call(e)===o}},{}],25:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call(e("./noop"));t.exports=function(e){return"function"==typeof e&&n.call(e)===o}},{"./noop":26}],26:[function(e,t,r){"use strict";t.exports=function(){}},{}],27:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Math.sign:e("./shim")},{"./is-implemented":28,"./shim":29}],28:[function(e,t,r){"use strict";t.exports=function(){var e=Math.sign;return"function"==typeof e&&(1===e(10)&&-1===e(-20))}},{}],29:[function(e,t,r){"use strict";t.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:0<e?1:-1}},{}],30:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Number.isNaN:e("./shim")},{"./is-implemented":31,"./shim":32}],31:[function(e,t,r){"use strict";t.exports=function(){var e=Number.isNaN;return"function"==typeof e&&(!e({})&&e(NaN)&&!e(34))}},{}],32:[function(e,t,r){"use strict";t.exports=function(e){return e!=e}},{}],33:[function(e,t,r){"use strict";var n=e("../math/sign"),o=Math.abs,i=Math.floor;t.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?n(e)*i(o(e)):e}},{"../math/sign":27}],34:[function(e,t,r){"use strict";var n=e("./to-integer"),o=Math.max;t.exports=function(e){return o(0,n(e))}},{"./to-integer":33}],35:[function(e,t,r){"use strict";var a=e("./valid-callable"),c=e("./valid-value"),l=Function.prototype.bind,d=Function.prototype.call,u=Object.keys,p=Object.prototype.propertyIsEnumerable;t.exports=function(i,s){return function(r,n){var e,o=arguments[2],t=arguments[3];return r=Object(c(r)),a(n),e=u(r),t&&e.sort("function"==typeof t?l.call(t,r):void 0),"function"!=typeof i&&(i=e[i]),d.call(i,e,function(e,t){return p.call(r,e)?d.call(n,o,r[e],e,r,t):s})}}},{"./valid-callable":54,"./valid-value":55}],36:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":37,"./shim":38}],37:[function(e,t,r){"use strict";t.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],38:[function(e,t,r){"use strict";var s=e("../keys"),a=e("../valid-value"),c=Math.max;t.exports=function(t,r){var n,e,o,i=c(arguments.length,2);for(t=Object(a(t)),o=function(e){try{t[e]=r[e]}catch(e){n||(n=e)}},e=1;e<i;++e)r=arguments[e],s(r).forEach(o);if(void 0!==n)throw n;return t}},{"../keys":45,"../valid-value":55}],39:[function(e,t,r){"use strict";var i=e("../array/from"),s=e("./assign"),a=e("./valid-value");t.exports=function(t){var e=Object(a(t)),r=arguments[1],n=Object(arguments[2]);if(e!==t&&!r)return e;var o={};return r?i(r,function(e){(n.ensure||e in t)&&(o[e]=t[e])}):s(o,t),o}},{"../array/from":21,"./assign":36,"./valid-value":55}],40:[function(e,t,r){"use strict";var n,o,i,s,a=Object.create;e("./set-prototype-of/is-implemented")()||(n=e("./set-prototype-of/shim")),t.exports=n?1!==n.level?a:(s={configurable:(i={},!1),enumerable:(o={},!1),writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){i[e]="__proto__"!==e?s:{configurable:!0,enumerable:!1,writable:!0,value:void 0}}),Object.defineProperties(o,i),Object.defineProperty(n,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:o}),function(e,t){return a(null===e?o:e,t)}):a},{"./set-prototype-of/is-implemented":52,"./set-prototype-of/shim":53}],41:[function(e,t,r){"use strict";t.exports=e("./_iterate")("forEach")},{"./_iterate":35}],42:[function(e,t,r){"use strict";t.exports=function(e){return"function"==typeof e}},{}],43:[function(e,t,r){"use strict";var n=e("./is-value"),o={function:!0,object:!0};t.exports=function(e){return n(e)&&o[typeof e]||!1}},{"./is-value":44}],44:[function(e,t,r){"use strict";var n=e("../function/noop")();t.exports=function(e){return e!==n&&null!==e}},{"../function/noop":26}],45:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":46,"./shim":47}],46:[function(e,t,r){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],47:[function(e,t,r){"use strict";var n=e("../is-value"),o=Object.keys;t.exports=function(e){return o(n(e)?Object(e):e)}},{"../is-value":44}],48:[function(e,t,r){"use strict";var n=e("./valid-callable"),a=e("./for-each"),c=Function.prototype.call;t.exports=function(e,o){var i={},s=arguments[2];return n(o),a(e,function(e,t,r,n){i[t]=c.call(o,s,e,t,r,n)}),i}},{"./for-each":41,"./valid-callable":54}],49:[function(e,t,r){"use strict";var n=e("./is-value"),o=Array.prototype.forEach,i=Object.create;t.exports=function(e){var t=i(null);return o.call(arguments,function(e){n(e)&&function(e,t){var r;for(r in e)t[r]=e[r]}(Object(e),t)}),t}},{"./is-value":44}],50:[function(e,t,r){"use strict";var n=Array.prototype.forEach,o=Object.create;t.exports=function(e){var t=o(null);return n.call(arguments,function(e){t[e]=!0}),t}},{}],51:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.setPrototypeOf:e("./shim")},{"./is-implemented":52,"./shim":53}],52:[function(e,t,r){"use strict";var n=Object.create,o=Object.getPrototypeOf,i={};t.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||n;return"function"==typeof e&&o(e(t(null),i))===i}},{}],53:[function(e,t,r){"use strict";var o,n,i,s,a=e("../is-object"),c=e("../valid-value"),l=Object.prototype.isPrototypeOf,d=Object.defineProperty,u={configurable:!0,enumerable:!1,writable:!0,value:void 0};o=function(e,t){if(c(e),null===t||a(t))return e;throw new TypeError("Prototype must be null or an object")},t.exports=(n=function(){var e,t=Object.create(null),r={},n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(n){try{(e=n.set).call(t,r)}catch(e){}if(Object.getPrototypeOf(t)===r)return{set:e,level:2}}return t.__proto__=r,Object.getPrototypeOf(t)===r?{level:2}:((t={}).__proto__=r,Object.getPrototypeOf(t)===r&&{level:1})}())?(i=2===n.level?n.set?(s=n.set,function(e,t){return s.call(o(e,t),t),e}):function(e,t){return o(e,t).__proto__=t,e}:function e(t,r){var n;return o(t,r),(n=l.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===r&&(r=e.nullPolyfill),t.__proto__=r,n&&d(e.nullPolyfill,"__proto__",u),t},Object.defineProperty(i,"level",{configurable:!1,enumerable:!1,writable:!1,value:n.level})):null,e("../create")},{"../create":40,"../is-object":43,"../valid-value":55}],54:[function(e,t,r){"use strict";t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],55:[function(e,t,r){"use strict";var n=e("./is-value");t.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},{"./is-value":44}],56:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":57,"./shim":58}],57:[function(e,t,r){"use strict";var n="razdwatrzy";t.exports=function(){return"function"==typeof n.contains&&(!0===n.contains("dwa")&&!1===n.contains("foo"))}},{}],58:[function(e,t,r){"use strict";var n=String.prototype.indexOf;t.exports=function(e){return-1<n.call(this,e,arguments[1])}},{}],59:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call("");t.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||n.call(e)===o)||!1}},{}],60:[function(e,t,r){"use strict";var n,o=e("es5-ext/object/set-prototype-of"),i=e("es5-ext/string/#/contains"),s=e("d"),a=e("es6-symbol"),c=e("./"),l=Object.defineProperty;n=t.exports=function(e,t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");c.call(this,e),t=t?i.call(t,"key+value")?"key+value":i.call(t,"key")?"key":"value":"value",l(this,"__kind__",s("",t))},o&&o(n,c),delete n.prototype.constructor,n.prototype=Object.create(c.prototype,{_resolve:s(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),l(n.prototype,a.toStringTag,s("c","Array Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es5-ext/string/#/contains":56,"es6-symbol":73}],61:[function(e,t,r){"use strict";var u=e("es5-ext/function/is-arguments"),p=e("es5-ext/object/valid-callable"),f=e("es5-ext/string/is-string"),h=e("./get"),m=Array.isArray,g=Function.prototype.call,v=Array.prototype.some;t.exports=function(e,t){var r,n,o,i,s,a,c,l,d=arguments[2];if(m(e)||u(e)?r="array":f(e)?r="string":e=h(e),p(t),o=function(){i=!0},"array"!==r)if("string"!==r)for(n=e.next();!n.done;){if(g.call(t,d,n.value,o),i)return;n=e.next()}else for(a=e.length,s=0;s<a&&(c=e[s],s+1<a&&55296<=(l=c.charCodeAt(0))&&l<=56319&&(c+=e[++s]),g.call(t,d,c,o),!i);++s);else v.call(e,function(e){return g.call(t,d,e,o),i})}},{"./get":62,"es5-ext/function/is-arguments":24,"es5-ext/object/valid-callable":54,"es5-ext/string/is-string":59}],62:[function(e,t,r){"use strict";var n=e("es5-ext/function/is-arguments"),o=e("es5-ext/string/is-string"),i=e("./array"),s=e("./string"),a=e("./valid-iterable"),c=e("es6-symbol").iterator;t.exports=function(e){return"function"==typeof a(e)[c]?e[c]():n(e)?new i(e):o(e)?new s(e):new i(e)}},{"./array":60,"./string":65,"./valid-iterable":66,"es5-ext/function/is-arguments":24,"es5-ext/string/is-string":59,"es6-symbol":73}],63:[function(e,t,r){"use strict";var n,o=e("es5-ext/array/#/clear"),i=e("es5-ext/object/assign"),s=e("es5-ext/object/valid-callable"),a=e("es5-ext/object/valid-value"),c=e("d"),l=e("d/auto-bind"),d=e("es6-symbol"),u=Object.defineProperty,p=Object.defineProperties;t.exports=n=function(e,t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");p(this,{__list__:c("w",a(e)),__context__:c("w",t),__nextIndex__:c("w",0)}),t&&(s(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete n.prototype.constructor,p(n.prototype,i({_next:c(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:c(function(){return this._createResult(this._next())}),_createResult:c(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:c(function(e){return this.__list__[e]}),_unBind:c(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:c(function(){return"[object "+(this[d.toStringTag]||"Object")+"]"})},l({_onAdd:c(function(r){r>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach(function(e,t){r<=e&&(this.__redo__[t]=++e)},this),this.__redo__.push(r)):u(this,"__redo__",c("c",[r])))}),_onDelete:c(function(r){var e;r>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(e=this.__redo__.indexOf(r))&&this.__redo__.splice(e,1),this.__redo__.forEach(function(e,t){r<e&&(this.__redo__[t]=--e)},this)))}),_onClear:c(function(){this.__redo__&&o.call(this.__redo__),this.__nextIndex__=0})}))),u(n.prototype,d.iterator,c(function(){return this}))},{d:16,"d/auto-bind":15,"es5-ext/array/#/clear":19,"es5-ext/object/assign":36,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-symbol":73}],64:[function(e,t,r){"use strict";var n=e("es5-ext/function/is-arguments"),o=e("es5-ext/object/is-value"),i=e("es5-ext/string/is-string"),s=e("es6-symbol").iterator,a=Array.isArray;t.exports=function(e){return!!o(e)&&(!!a(e)||(!!i(e)||(!!n(e)||"function"==typeof e[s])))}},{"es5-ext/function/is-arguments":24,"es5-ext/object/is-value":44,"es5-ext/string/is-string":59,"es6-symbol":73}],65:[function(e,t,r){"use strict";var n,o=e("es5-ext/object/set-prototype-of"),i=e("d"),s=e("es6-symbol"),a=e("./"),c=Object.defineProperty;n=t.exports=function(e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");e=String(e),a.call(this,e),c(this,"__length__",i("",e.length))},o&&o(n,a),delete n.prototype.constructor,n.prototype=Object.create(a.prototype,{_next:i(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:i(function(e){var t,r=this.__list__[e];return this.__nextIndex__===this.__length__?r:55296<=(t=r.charCodeAt(0))&&t<=56319?r+this.__list__[this.__nextIndex__++]:r})}),c(n.prototype,s.toStringTag,i("c","String Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es6-symbol":73}],66:[function(e,t,r){"use strict";var n=e("./is-iterable");t.exports=function(e){if(!n(e))throw new TypeError(e+" is not iterable");return e}},{"./is-iterable":64}],67:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Map:e("./polyfill")},{"./is-implemented":68,"./polyfill":72}],68:[function(e,t,r){"use strict";t.exports=function(){var e,t;if("function"!=typeof Map)return!1;try{e=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(e){return!1}return"[object Map]"===String(e)&&(3===e.size&&("function"==typeof e.clear&&("function"==typeof e.delete&&("function"==typeof e.entries&&("function"==typeof e.forEach&&("function"==typeof e.get&&("function"==typeof e.has&&("function"==typeof e.keys&&("function"==typeof e.set&&("function"==typeof e.values&&(!1===(t=e.entries().next()).done&&(!!t.value&&("raz"===t.value[0]&&"one"===t.value[1])))))))))))))}},{}],69:[function(e,t,r){"use strict";t.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},{}],70:[function(e,t,r){"use strict";t.exports=e("es5-ext/object/primitive-set")("key","value","key+value")},{"es5-ext/object/primitive-set":50}],71:[function(e,t,r){"use strict";var n,o=e("es5-ext/object/set-prototype-of"),i=e("d"),s=e("es6-iterator"),a=e("es6-symbol").toStringTag,c=e("./iterator-kinds"),l=Object.defineProperties,d=s.prototype._unBind;n=t.exports=function(e,t){if(!(this instanceof n))return new n(e,t);s.call(this,e.__mapKeysData__,e),t&&c[t]||(t="key+value"),l(this,{__kind__:i("",t),__values__:i("w",e.__mapValuesData__)})},o&&o(n,s),n.prototype=Object.create(s.prototype,{constructor:i(n),_resolve:i(function(e){return"value"===this.__kind__?this.__values__[e]:"key"===this.__kind__?this.__list__[e]:[this.__list__[e],this.__values__[e]]}),_unBind:i(function(){this.__values__=null,d.call(this)}),toString:i(function(){return"[object Map Iterator]"})}),Object.defineProperty(n.prototype,a,i("c","Map Iterator"))},{"./iterator-kinds":70,d:16,"es5-ext/object/set-prototype-of":51,"es6-iterator":63,"es6-symbol":73}],72:[function(e,t,r){"use strict";var o,n=e("es5-ext/array/#/clear"),i=e("es5-ext/array/#/e-index-of"),s=e("es5-ext/object/set-prototype-of"),a=e("es5-ext/object/valid-callable"),c=e("es5-ext/object/valid-value"),l=e("d"),d=e("event-emitter"),u=e("es6-symbol"),p=e("es6-iterator/valid-iterable"),f=e("es6-iterator/for-of"),h=e("./lib/iterator"),m=e("./is-native-implemented"),g=Function.prototype.call,v=Object.defineProperties,y=Object.getPrototypeOf;t.exports=o=function(){var r,n,e,t=arguments[0];if(!(this instanceof o))throw new TypeError("Constructor requires 'new'");return e=m&&s&&Map!==o?s(new Map,y(this)):this,null!=t&&p(t),v(e,{__mapKeysData__:l("c",r=[]),__mapValuesData__:l("c",n=[])}),t&&f(t,function(e){var t=c(e)[0];e=e[1],-1===i.call(r,t)&&(r.push(t),n.push(e))},e),e},m&&(s&&s(o,Map),o.prototype=Object.create(Map.prototype,{constructor:l(o)})),d(v(o.prototype,{clear:l(function(){this.__mapKeysData__.length&&(n.call(this.__mapKeysData__),n.call(this.__mapValuesData__),this.emit("_clear"))}),delete:l(function(e){var t=i.call(this.__mapKeysData__,e);return-1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),this.emit("_delete",t,e),!0)}),entries:l(function(){return new h(this,"key+value")}),forEach:l(function(e){var t,r,n=arguments[1];for(a(e),r=(t=this.entries())._next();void 0!==r;)g.call(e,n,this.__mapValuesData__[r],this.__mapKeysData__[r],this),r=t._next()}),get:l(function(e){var t=i.call(this.__mapKeysData__,e);if(-1!==t)return this.__mapValuesData__[t]}),has:l(function(e){return-1!==i.call(this.__mapKeysData__,e)}),keys:l(function(){return new h(this,"key")}),set:l(function(e,t){var r,n=i.call(this.__mapKeysData__,e);return-1===n&&(n=this.__mapKeysData__.push(e)-1,r=!0),this.__mapValuesData__[n]=t,r&&this.emit("_add",n,e),this}),size:l.gs(function(){return this.__mapKeysData__.length}),values:l(function(){return new h(this,"value")}),toString:l(function(){return"[object Map]"})})),Object.defineProperty(o.prototype,u.iterator,l(function(){return this.entries()})),Object.defineProperty(o.prototype,u.toStringTag,l("c","Map"))},{"./is-native-implemented":69,"./lib/iterator":71,d:16,"es5-ext/array/#/clear":19,"es5-ext/array/#/e-index-of":20,"es5-ext/object/set-prototype-of":51,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-iterator/for-of":61,"es6-iterator/valid-iterable":66,"es6-symbol":73,"event-emitter":78}],73:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Symbol:e("./polyfill")},{"./is-implemented":74,"./polyfill":76}],74:[function(e,t,r){"use strict";var n={object:!0,symbol:!0};t.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!n[typeof Symbol.iterator]&&(!!n[typeof Symbol.toPrimitive]&&!!n[typeof Symbol.toStringTag])}},{}],75:[function(e,t,r){"use strict";t.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&("Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag]))}},{}],76:[function(e,t,r){"use strict";var n,o,i,s,a=e("d"),c=e("./validate-symbol"),l=Object.create,d=Object.defineProperties,u=Object.defineProperty,p=Object.prototype,f=l(null);if("function"==typeof Symbol){n=Symbol;try{String(n()),s=!0}catch(e){}}var h,m=(h=l(null),function(e){for(var t,r,n=0;h[e+(n||"")];)++n;return h[e+=n||""]=!0,u(p,t="@@"+e,a.gs(null,function(e){r||(r=!0,u(this,t,a(e)),r=!1)})),t});i=function(e){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return o(e)},t.exports=o=function e(t){var r;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return s?n(t):(r=l(i.prototype),t=void 0===t?"":String(t),d(r,{__description__:a("",t),__name__:a("",m(t))}))},d(o,{for:a(function(e){return f[e]?f[e]:f[e]=o(String(e))}),keyFor:a(function(e){var t;for(t in c(e),f)if(f[t]===e)return t}),hasInstance:a("",n&&n.hasInstance||o("hasInstance")),isConcatSpreadable:a("",n&&n.isConcatSpreadable||o("isConcatSpreadable")),iterator:a("",n&&n.iterator||o("iterator")),match:a("",n&&n.match||o("match")),replace:a("",n&&n.replace||o("replace")),search:a("",n&&n.search||o("search")),species:a("",n&&n.species||o("species")),split:a("",n&&n.split||o("split")),toPrimitive:a("",n&&n.toPrimitive||o("toPrimitive")),toStringTag:a("",n&&n.toStringTag||o("toStringTag")),unscopables:a("",n&&n.unscopables||o("unscopables"))}),d(i.prototype,{constructor:a(o),toString:a("",function(){return this.__name__})}),d(o.prototype,{toString:a(function(){return"Symbol ("+c(this).__description__+")"}),valueOf:a(function(){return c(this)})}),u(o.prototype,o.toPrimitive,a("",function(){var e=c(this);return"symbol"==typeof e?e:e.toString()})),u(o.prototype,o.toStringTag,a("c","Symbol")),u(i.prototype,o.toStringTag,a("c",o.prototype[o.toStringTag])),u(i.prototype,o.toPrimitive,a("c",o.prototype[o.toPrimitive]))},{"./validate-symbol":77,d:16}],77:[function(e,t,r){"use strict";var n=e("./is-symbol");t.exports=function(e){if(!n(e))throw new TypeError(e+" is not a symbol");return e}},{"./is-symbol":75}],78:[function(e,t,r){"use strict";var o,n,i,s,a,c,l,d=e("d"),u=e("es5-ext/object/valid-callable"),p=Function.prototype.apply,f=Function.prototype.call,h=Object.create,m=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};n=function(e,t){var r,n;return u(t),o.call(n=this,e,r=function(){i.call(n,e,r),p.call(t,this,arguments)}),r.__eeOnceListener__=t,this},a={on:o=function(e,t){var r;return u(t),v.call(this,"__ee__")?r=this.__ee__:(r=y.value=h(null),m(this,"__ee__",y),y.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:n,off:i=function(e,t){var r,n,o,i;if(u(t),!v.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==typeof(n=r[e]))for(i=0;o=n[i];++i)o!==t&&o.__eeOnceListener__!==t||(2===n.length?r[e]=n[i?0:1]:n.splice(i,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:s=function(e){var t,r,n,o,i;if(v.call(this,"__ee__")&&(o=this.__ee__[e]))if("object"==typeof o){for(r=arguments.length,i=new Array(r-1),t=1;t<r;++t)i[t-1]=arguments[t];for(o=o.slice(),t=0;n=o[t];++t)p.call(n,this,i)}else switch(arguments.length){case 1:f.call(o,this);break;case 2:f.call(o,this,arguments[1]);break;case 3:f.call(o,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),t=1;t<r;++t)i[t-1]=arguments[t];p.call(o,this,i)}}},c={on:d(o),once:d(n),off:d(i),emit:d(s)},l=g({},c),t.exports=r=function(e){return null==e?h(l):g(Object(e),c)},r.methods=a},{d:16,"es5-ext/object/valid-callable":54}],79:[function(e,t,r){r.read=function(e,t,r,n,o){var i,s,a=8*o-n-1,c=(1<<a)-1,l=c>>1,d=-7,u=r?o-1:0,p=r?-1:1,f=e[t+u];for(u+=p,i=f&(1<<-d)-1,f>>=-d,d+=a;0<d;i=256*i+e[t+u],u+=p,d-=8);for(s=i&(1<<-d)-1,i>>=-d,d+=n;0<d;s=256*s+e[t+u],u+=p,d-=8);if(0===i)i=1-l;else{if(i===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),i-=l}return(f?-1:1)*s*Math.pow(2,i-n)},r.write=function(e,t,r,n,o,i){var s,a,c,l=8*i-o-1,d=(1<<l)-1,u=d>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:i-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),2<=(t+=1<=s+u?p/c:p*Math.pow(2,1-u))*c&&(s++,c/=2),d<=s+u?(a=0,s=d):1<=s+u?(a=(t*c-1)*Math.pow(2,o),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,o),s=0));8<=o;e[r+f]=255&a,f+=h,a/=256,o-=8);for(s=s<<o|a,l+=o;0<l;e[r+f]=255&s,f+=h,s/=256,l-=8);e[r+f-h]|=128*m}},{}],80:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],81:[function(e,t,r){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))||!!e._isBuffer);var t}},{}],82:[function(e,t,r){"use strict";var i=e("safe-buffer").Buffer,s=t.exports;for(var n in s.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},s.codes={},s.types){var o=s.types[n];s.codes[o]=n}for(var a in s.CMD_SHIFT=4,s.CMD_MASK=240,s.DUP_MASK=8,s.QOS_MASK=3,s.QOS_SHIFT=1,s.RETAIN_MASK=1,s.LENGTH_MASK=127,s.LENGTH_FIN_MASK=128,s.SESSIONPRESENT_MASK=1,s.SESSIONPRESENT_HEADER=i.from([s.SESSIONPRESENT_MASK]),s.CONNACK_HEADER=i.from([s.codes.connack<<s.CMD_SHIFT]),s.USERNAME_MASK=128,s.PASSWORD_MASK=64,s.WILL_RETAIN_MASK=32,s.WILL_QOS_MASK=24,s.WILL_QOS_SHIFT=3,s.WILL_FLAG_MASK=4,s.CLEAN_SESSION_MASK=2,s.CONNECT_HEADER=i.from([s.codes.connect<<s.CMD_SHIFT]),s.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},s.propertiesCodes={},s.properties){var c=s.properties[a];s.propertiesCodes[c]=a}function l(o){return[0,1,2].map(function(n){return[0,1].map(function(r){return[0,1].map(function(e){var t=new i(1);return t.writeUInt8(s.codes[o]<<s.CMD_SHIFT|(r?s.DUP_MASK:0)|n<<s.QOS_SHIFT|e,0,!0),t})})})}s.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int32",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},s.PUBLISH_HEADER=l("publish"),s.SUBSCRIBE_HEADER=l("subscribe"),s.SUBSCRIBE_OPTIONS_QOS_MASK=3,s.SUBSCRIBE_OPTIONS_NL_MASK=1,s.SUBSCRIBE_OPTIONS_NL_SHIFT=2,s.SUBSCRIBE_OPTIONS_RAP_MASK=1,s.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,s.SUBSCRIBE_OPTIONS_RH_MASK=3,s.SUBSCRIBE_OPTIONS_RH_SHIFT=4,s.SUBSCRIBE_OPTIONS_RH=[0,16,32],s.SUBSCRIBE_OPTIONS_NL=4,s.SUBSCRIBE_OPTIONS_RAP=8,s.SUBSCRIBE_OPTIONS_QOS=[0,1,2],s.UNSUBSCRIBE_HEADER=l("unsubscribe"),s.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},s.SUBACK_HEADER=i.from([s.codes.suback<<s.CMD_SHIFT]),s.VERSION3=i.from([3]),s.VERSION4=i.from([4]),s.VERSION5=i.from([5]),s.QOS=[0,1,2].map(function(e){return i.from([e])}),s.EMPTY={pingreq:i.from([s.codes.pingreq<<4,0]),pingresp:i.from([s.codes.pingresp<<4,0]),disconnect:i.from([s.codes.disconnect<<4,0])}},{"safe-buffer":110}],83:[function(e,t,r){"use strict";var s=e("safe-buffer").Buffer,n=e("./writeToStream"),o=e("events").EventEmitter;function i(){this._array=new Array(20),this._i=0}e("inherits")(i,o),i.prototype.write=function(e){return this._array[this._i++]=e,!0},i.prototype.concat=function(){var e,t,r=0,n=new Array(this._array.length),o=this._array,i=0;for(e=0;e<o.length&&void 0!==o[e];e++)"string"!=typeof o[e]?n[e]=o[e].length:n[e]=s.byteLength(o[e]),r+=n[e];for(t=s.allocUnsafe(r),e=0;e<o.length&&void 0!==o[e];e++)"string"!=typeof o[e]?o[e].copy(t,i):t.write(o[e],i),i+=n[e];return t},t.exports=function(e,t){var r=new i;return n(e,r,t),r.concat()}},{"./writeToStream":89,events:13,inherits:80,"safe-buffer":110}],84:[function(e,t,r){"use strict";r.parser=e("./parser"),r.generate=e("./generate"),r.writeToStream=e("./writeToStream")},{"./generate":83,"./parser":88,"./writeToStream":89}],85:[function(e,t,r){var n=e("readable-stream/duplex"),o=e("util"),p=e("safe-buffer").Buffer;function i(e){if(!(this instanceof i))return new i(e);if(this._bufs=[],this.length=0,"function"==typeof e){this._callback=e;var t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on("pipe",function(e){e.on("error",t)}),this.on("unpipe",function(e){e.removeListener("error",t)})}else this.append(e);n.call(this)}o.inherits(i,n),i.prototype._offset=function(e){var t,r=0,n=0;if(0===e)return[0,0];for(;n<this._bufs.length;n++){if(e<(t=r+this._bufs[n].length)||n==this._bufs.length-1)return[n,e-r];r=t}},i.prototype.append=function(e){var t=0;if(p.isBuffer(e))this._appendBuffer(e);else if(Array.isArray(e))for(;t<e.length;t++)this.append(e[t]);else if(e instanceof i)for(;t<e._bufs.length;t++)this.append(e._bufs[t]);else null!=e&&("number"==typeof e&&(e=e.toString()),this._appendBuffer(p.from(e)));return this},i.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},i.prototype._write=function(e,t,r){this._appendBuffer(e),"function"==typeof r&&r()},i.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},i.prototype.end=function(e){n.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},i.prototype.get=function(e){return this.slice(e,e+1)[0]},i.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},i.prototype.copy=function(e,t,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return e||p.alloc(0);if(n<=0)return e||p.alloc(0);var o,i,s=!!e,a=this._offset(r),c=n-r,l=c,d=s&&t||0,u=a[1];if(0===r&&n==this.length){if(!s)return 1===this._bufs.length?this._bufs[0]:p.concat(this._bufs,this.length);for(i=0;i<this._bufs.length;i++)this._bufs[i].copy(e,d),d+=this._bufs[i].length;return e}if(l<=this._bufs[a[0]].length-u)return s?this._bufs[a[0]].copy(e,t,u,u+l):this._bufs[a[0]].slice(u,u+l);for(s||(e=p.allocUnsafe(c)),i=a[0];i<this._bufs.length;i++){if(!((o=this._bufs[i].length-u)<l)){this._bufs[i].copy(e,d,u,u+l);break}this._bufs[i].copy(e,d,u),d+=o,l-=o,u&&(u=0)}return e},i.prototype.shallowSlice=function(e,t){e=e||0,t=t||this.length,e<0&&(e+=this.length),t<0&&(t+=this.length);var r=this._offset(e),n=this._offset(t),o=this._bufs.slice(r[0],n[0]+1);return 0==n[1]?o.pop():o[o.length-1]=o[o.length-1].slice(0,n[1]),0!=r[1]&&(o[0]=o[0].slice(r[1])),new i(o)},i.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},i.prototype.consume=function(e){for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},i.prototype.duplicate=function(){for(var e=0,t=new i;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},i.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var r={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var e in r)!function(t){i.prototype[t]=function(e){return this.slice(e,e+r[t])[t](0)}}(e)}(),t.exports=i},{"readable-stream/duplex":97,"safe-buffer":110,util:117}],86:[function(e,t,r){"use strict";var s=e("safe-buffer").Buffer,n={};function o(e){var t=s.allocUnsafe(2);return t.writeUInt8(e>>8,0),t.writeUInt8(255&e,1),t}t.exports={cache:n,generateCache:function(){for(var e=0;e<65536;e++)n[e]=o(e)},generateNumber:o,genBufVariableByteInt:function(e){for(var t,r=0,n=0,o=0<=(t=e)&&t<128?1:128<=t&&t<16384?2:16384<=t&&t<2097152?3:2097152<=t&&t<268435456?4:0,i=s.allocUnsafe(o);r=e%128|0,0<(e=e/128|0)&&(r|=128),i.writeUInt8(r,n++),0<e;);return{data:i,length:o}},generate4ByteBuffer:function(e){var t=s.allocUnsafe(4);return t.writeUInt32BE(e,0),t}}},{"safe-buffer":110}],87:[function(e,t,r){t.exports=function(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}},{}],88:[function(e,t,r){"use strict";var n=e("bl"),o=e("inherits"),i=e("events").EventEmitter,s=e("./packet"),d=e("./constants");function a(e){if(!(this instanceof a))return new a(e);this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState()}o(a,i),a.prototype._resetState=function(){this.packet=new s,this.error=null,this._list=n(),this._stateCounter=0},a.prototype.parse=function(e){for(this.error&&this._resetState(),this._list.append(e);(-1!==this.packet.length||0<this._list.length)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},a.prototype._parseHeader=function(){var e=this._list.readUInt8(0);return this.packet.cmd=d.types[e>>d.CMD_SHIFT],this.packet.retain=0!=(e&d.RETAIN_MASK),this.packet.qos=e>>d.QOS_SHIFT&d.QOS_MASK,this.packet.dup=0!=(e&d.DUP_MASK),this._list.consume(1),!0},a.prototype._parseLength=function(){var e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),!!e},a.prototype._parsePayload=function(){var e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return e},a.prototype._parseConnect=function(){var e,t,r,n,o,i,s={},a=this.packet;if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==e&&"MQIsdp"!==e)return this._emitError(new Error("Invalid protocolId"));if(a.protocolId=e,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(a.protocolVersion=this._list.readUInt8(this._pos),3!==a.protocolVersion&&4!==a.protocolVersion&&5!==a.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.username=this._list.readUInt8(this._pos)&d.USERNAME_MASK,s.password=this._list.readUInt8(this._pos)&d.PASSWORD_MASK,s.will=this._list.readUInt8(this._pos)&d.WILL_FLAG_MASK,s.will&&(a.will={},a.will.retain=0!=(this._list.readUInt8(this._pos)&d.WILL_RETAIN_MASK),a.will.qos=(this._list.readUInt8(this._pos)&d.WILL_QOS_MASK)>>d.WILL_QOS_SHIFT),a.clean=0!=(this._list.readUInt8(this._pos)&d.CLEAN_SESSION_MASK),this._pos++,a.keepalive=this._parseNum(),-1===a.keepalive)return this._emitError(new Error("Packet too short"));if(5===a.protocolVersion){var c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(a.properties=c)}if(null===(t=this._parseString()))return this._emitError(new Error("Packet too short"));if(a.clientId=t,s.will){if(5===a.protocolVersion){var l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(a.will.properties=l)}if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(a.will.topic=r,null===(n=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));a.will.payload=n}if(s.username){if(null===(i=this._parseString()))return this._emitError(new Error("Cannot parse username"));a.username=i}if(s.password){if(null===(o=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));a.password=o}return this.settings=a},a.prototype._parseConnack=function(){var e=this.packet;if(this._list.length<2)return null;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&d.SESSIONPRESENT_MASK),5===this.settings.protocolVersion?e.reasonCode=this._list.readUInt8(this._pos++):e.returnCode=this._list.readUInt8(this._pos++),-1===e.returnCode||-1===e.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}},a.prototype._parsePublish=function(){var e=this.packet;if(e.topic=this._parseString(),null===e.topic)return this._emitError(new Error("Cannot parse topic"));if(!(0<e.qos)||this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}e.payload=this._list.slice(this._pos,e.length)}},a.prototype._parseSubscribe=function(){var e,t,r,n,o,i,s,a=this.packet;if(1!==a.qos)return this._emitError(new Error("Wrong subscribe header"));if(a.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(a.properties=c)}for(;this._pos<a.length;){if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse topic"));r=(t=this._parseByte())&d.SUBSCRIBE_OPTIONS_QOS_MASK,i=0!=(t>>d.SUBSCRIBE_OPTIONS_NL_SHIFT&d.SUBSCRIBE_OPTIONS_NL_MASK),o=0!=(t>>d.SUBSCRIBE_OPTIONS_RAP_SHIFT&d.SUBSCRIBE_OPTIONS_RAP_MASK),n=t>>d.SUBSCRIBE_OPTIONS_RH_SHIFT&d.SUBSCRIBE_OPTIONS_RH_MASK,s={topic:e,qos:r},5===this.settings.protocolVersion&&(s.nl=i,s.rap=o,s.rh=n),a.subscriptions.push(s)}}},a.prototype._parseSuback=function(){var e=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},a.prototype._parseUnsubscribe=function(){var e=this.packet;if(e.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<e.length;){var r;if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse topic"));e.unsubscriptions.push(r)}}},a.prototype._parseUnsuback=function(){var e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var t=this._parseProperties();for(Object.getOwnPropertyNames(t).length&&(e.properties=t),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},a.prototype._parseConfirmation=function(){var e=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion&&2<e.length){e.reasonCode=this._parseByte();var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0},a.prototype._parseDisconnect=function(){var e=this.packet;if(5===this.settings.protocolVersion){e.reasonCode=this._parseByte();var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0},a.prototype._parseAuth=function(){var e=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));e.reasonCode=this._parseByte();var t=this._parseProperties();return Object.getOwnPropertyNames(t).length&&(e.properties=t),!0},a.prototype._parseMessageId=function(){var e=this.packet;return e.messageId=this._parseNum(),null!==e.messageId||(this._emitError(new Error("Cannot parse messageId")),!1)},a.prototype._parseString=function(e){var t,r=this._parseNum(),n=r+this._pos;return-1===r||n>this._list.length||n>this.packet.length?null:(t=this._list.toString("utf8",this._pos,n),this._pos+=r,t)},a.prototype._parseStringPair=function(){return{name:this._parseString(),value:this._parseString()}},a.prototype._parseBuffer=function(){var e,t=this._parseNum(),r=t+this._pos;return-1===t||r>this._list.length||r>this.packet.length?null:(e=this._list.slice(this._pos,r),this._pos+=t,e)},a.prototype._parseNum=function(){if(this._list.length-this._pos<2)return-1;var e=this._list.readUInt16BE(this._pos);return this._pos+=2,e},a.prototype._parse4ByteNum=function(){if(this._list.length-this._pos<4)return-1;var e=this._list.readUInt32BE(this._pos);return this._pos+=4,e},a.prototype._parseVarByteNum=function(e){for(var t,r=0,n=1,o=0,i=!0,s=this._pos?this._pos:0;r<5&&(o+=n*((t=this._list.readUInt8(s+r++))&d.LENGTH_MASK),n*=128,0!=(t&d.LENGTH_FIN_MASK));)if(this._list.length<=r){i=!1;break}return s&&(this._pos+=r),i=!!i&&(e?{bytes:r,value:o}:o)},a.prototype._parseByte=function(){var e=this._list.readUInt8(this._pos);return this._pos++,e},a.prototype._parseByType=function(e){switch(e){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}},a.prototype._parseProperties=function(){for(var e=this._parseVarByteNum(),t=this._pos+e,r={};this._pos<t;){var n=this._parseByte(),o=d.propertiesCodes[n];if(!o)return this._emitError(new Error("Unknown property")),!1;if("userProperties"!==o)r[o]=this._parseByType(d.propertiesTypes[o]);else{r[o]||(r[o]={});var i=this._parseByType(d.propertiesTypes[o]);r[o][i.name]=i.value}}return r},a.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new s,!(this._pos=0)},a.prototype._emitError=function(e){this.error=e,this.emit("error",e)},t.exports=a},{"./constants":82,"./packet":87,bl:85,events:13,inherits:80}],89:[function(e,t,r){"use strict";var I=e("./constants"),R=e("safe-buffer").Buffer,f=R.allocUnsafe(0),l=R.from([0]),n=e("./numbers"),o=e("process-nextick-args").nextTick,i=n.cache,s=n.generateNumber,a=n.generateCache,c=n.genBufVariableByteInt,d=n.generate4ByteBuffer,P=g,u=!0;function p(e,t,r){switch(t.cork&&(t.cork(),o(h,t)),u&&(u=!1,a()),e.cmd){case"connect":return function(e,t,r){var n=e||{},o=n.protocolId||"MQTT",i=n.protocolVersion||4,s=n.will,a=n.clean,c=n.keepalive||0,l=n.clientId||"",d=n.username,u=n.password,p=n.properties;void 0===a&&(a=!0);var f=0;{if(!o||"string"!=typeof o&&!R.isBuffer(o))return t.emit("error",new Error("Invalid protocolId")),!1;f+=o.length+2}{if(3!==i&&4!==i&&5!==i)return t.emit("error",new Error("Invalid protocol version")),!1;f+=1}if("string"!=typeof l&&!R.isBuffer(l)||!l&&4!==i||!l&&!a){if(i<4)return t.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*a==0)return t.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else f+=l.length+2;{if("number"!=typeof c||c<0||65535<c||c%1!=0)return t.emit("error",new Error("Invalid keepalive")),!1;f+=2}if(f+=1,5===i){var h=k(t,p);f+=h.length}if(s){if("object"!=typeof s)return t.emit("error",new Error("Invalid will")),!1;if(!s.topic||"string"!=typeof s.topic)return t.emit("error",new Error("Invalid will topic")),!1;if(f+=R.byteLength(s.topic)+2,s.payload){if(!(0<=s.payload.length))return t.emit("error",new Error("Invalid will payload")),!1;"string"==typeof s.payload?f+=R.byteLength(s.payload)+2:f+=s.payload.length+2;var m={};5===i&&(m=k(t,s.properties),f+=m.length)}}var g=!1;if(null!=d){if(!w(d))return t.emit("error",new Error("Invalid username")),!1;g=!0,f+=R.byteLength(d)+2}if(null!=u){if(!g)return t.emit("error",new Error("Username is required to use password")),!1;if(!w(u))return t.emit("error",new Error("Invalid password")),!1;f+=S(u)+2}t.write(I.CONNECT_HEADER),x(t,f),y(t,o),t.write(4===i?I.VERSION4:5===i?I.VERSION5:I.VERSION3);var v=0;v|=null!=d?I.USERNAME_MASK:0,v|=null!=u?I.PASSWORD_MASK:0,v|=s&&s.retain?I.WILL_RETAIN_MASK:0,v|=s&&s.qos?s.qos<<I.WILL_QOS_SHIFT:0,v|=s?I.WILL_FLAG_MASK:0,v|=a?I.CLEAN_SESSION_MASK:0,t.write(R.from([v])),P(t,c),5===i&&h.write();y(t,l),s&&(5===i&&m.write(),M(t,s.topic),y(t,s.payload));null!=d&&y(t,d);null!=u&&y(t,u);return!0}(e,t);case"connack":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=5===n?o.reasonCode:o.returnCode,s=o.properties,a=2;if("number"!=typeof i)return t.emit("error",new Error("Invalid return code")),!1;var c=null;5===n&&(c=k(t,s),a+=c.length);t.write(I.CONNACK_HEADER),x(t,a),t.write(o.sessionPresent?I.SESSIONPRESENT_HEADER:l),t.write(R.from([i])),null!=c&&c.write();return!0}(e,t,r);case"publish":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.qos||0,s=o.retain?I.RETAIN_MASK:0,a=o.topic,c=o.payload||f,l=o.messageId,d=o.properties,u=0;if("string"==typeof a)u+=R.byteLength(a)+2;else{if(!R.isBuffer(a))return t.emit("error",new Error("Invalid topic")),!1;u+=a.length+2}R.isBuffer(c)?u+=c.length:u+=R.byteLength(c);{if(i&&"number"!=typeof l)return t.emit("error",new Error("Invalid messageId")),!1;i&&(u+=2)}var p=null;5===n&&(p=k(t,d),u+=p.length);t.write(I.PUBLISH_HEADER[i][o.dup?1:0][s?1:0]),x(t,u),P(t,S(a)),t.write(a),0<i&&P(t,l);null!=p&&p.write();return t.write(c)}(e,t,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.cmd||"puback",s=o.messageId,a=o.dup&&"pubrel"===i?I.DUP_MASK:0,c=0,l=o.reasonCode,d=o.properties,u=5===n?3:2;"pubrel"===i&&(c=1);if("number"!=typeof s)return t.emit("error",new Error("Invalid messageId")),!1;var p=null;if(5===n){if(!(p=b(t,d,r,u)))return!1;u+=p.length}t.write(I.ACKS[i][c][a][0]),x(t,u),P(t,s),5===n&&t.write(R.from([l]));null!==p&&p.write();return!0}(e,t,r);case"subscribe":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.dup?I.DUP_MASK:0,s=o.messageId,a=o.subscriptions,c=o.properties,l=0;{if("number"!=typeof s)return t.emit("error",new Error("Invalid messageId")),!1;l+=2}var d=null;5===n&&(d=k(t,c),l+=d.length);{if("object"!=typeof a||!a.length)return t.emit("error",new Error("Invalid subscriptions")),!1;for(var u=0;u<a.length;u+=1){var p=a[u].topic,f=a[u].qos;if("string"!=typeof p)return t.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof f)return t.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===n){var h=a[u].nl||!1;if("boolean"!=typeof h)return t.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;var m=a[u].rap||!1;if("boolean"!=typeof m)return t.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var g=a[u].rh||0;if("number"!=typeof g||2<g)return t.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}l+=R.byteLength(p)+2+1}}t.write(I.SUBSCRIBE_HEADER[1][i?1:0][0]),x(t,l),P(t,s),null!==d&&d.write();for(var v=!0,y=0;y<a.length;y++){var b,_=a[y],S=_.topic,w=_.qos,E=+_.nl,C=+_.rap,T=_.rh;M(t,S),b=I.SUBSCRIBE_OPTIONS_QOS[w],5===n&&(b|=E?I.SUBSCRIBE_OPTIONS_NL:0,b|=C?I.SUBSCRIBE_OPTIONS_RAP:0,b|=T?I.SUBSCRIBE_OPTIONS_RH[T]:0),v=t.write(R.from([b]))}return v}(e,t,r);case"suback":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.messageId,s=o.granted,a=o.properties,c=0;{if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;c+=2}{if("object"!=typeof s||!s.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var l=0;l<s.length;l+=1){if("number"!=typeof s[l])return t.emit("error",new Error("Invalid qos vector")),!1;c+=1}}var d=null;if(5===n){if(!(d=b(t,a,r,c)))return!1;c+=d.length}t.write(I.SUBACK_HEADER),x(t,c),P(t,i),null!==d&&d.write();return t.write(R.from(s))}(e,t,r);case"unsubscribe":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.messageId,s=o.dup?I.DUP_MASK:0,a=o.unsubscriptions,c=o.properties,l=0;{if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;l+=2}{if("object"!=typeof a||!a.length)return t.emit("error",new Error("Invalid unsubscriptions")),!1;for(var d=0;d<a.length;d+=1){if("string"!=typeof a[d])return t.emit("error",new Error("Invalid unsubscriptions")),!1;l+=R.byteLength(a[d])+2}}var u=null;5===n&&(u=k(t,c),l+=u.length);t.write(I.UNSUBSCRIBE_HEADER[1][s?1:0][0]),x(t,l),P(t,i),null!==u&&u.write();for(var p=!0,f=0;f<a.length;f++)p=M(t,a[f]);return p}(e,t,r);case"unsuback":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.messageId,s=o.dup?I.DUP_MASK:0,a=o.granted,c=o.properties,l=o.cmd,d=2;if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;if(5===n){if("object"!=typeof a||!a.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var u=0;u<a.length;u+=1){if("number"!=typeof a[u])return t.emit("error",new Error("Invalid qos vector")),!1;d+=1}}var p=null;if(5===n){if(!(p=b(t,c,r,d)))return!1;d+=p.length}t.write(I.ACKS[l][0][s][0]),x(t,d),P(t,i),null!==p&&p.write();5===n&&t.write(R.from(a));return!0}(e,t,r);case"pingreq":case"pingresp":return n=e,t.write(I.EMPTY[n.cmd]);case"disconnect":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.reasonCode,s=o.properties,a=5===n?1:0,c=null;if(5===n){if(!(c=b(t,s,r,a)))return!1;a+=c.length}t.write(R.from([I.codes.disconnect<<4])),x(t,a),5===n&&t.write(R.from([i]));null!==c&&c.write();return!0}(e,t,r);case"auth":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.reasonCode,s=o.properties,a=5===n?1:0;5!==n&&t.emit("error",new Error("Invalid mqtt version for auth packet"));var c=b(t,s,r,a);if(!c)return!1;a+=c.length,t.write(R.from([I.codes.auth<<4])),x(t,a),t.write(R.from([i])),null!==c&&c.write();return!0}(e,t,r);default:return t.emit("error",new Error("Unknown command")),!1}var n}function h(e){e.uncork()}Object.defineProperty(p,"cacheNumbers",{get:function(){return P===g},set:function(e){P=e?(i&&0!==Object.keys(i).length||(u=!0),g):(u=!1,v)}});var m={};function x(e,t){var r=m[t];r||(r=c(t).data,t<16384&&(m[t]=r)),e.write(r)}function M(e,t){var r=R.byteLength(t);P(e,r),e.write(t,"utf8")}function g(e,t){return e.write(i[t])}function v(e,t){return e.write(s(t))}function y(e,t){"string"==typeof t?M(e,t):t?(P(e,t.length),e.write(t)):P(e,0)}function k(o,i){if("object"!=typeof i||null!=i.length)return{length:1,write:function(){_(o,{},0)}};var e=0;function t(e){var t=I.propertiesTypes[e],r=i[e],n=0;switch(t){case"byte":if("boolean"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=2;break;case"int8":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=2;break;case"binary":if(r&&null===r)return o.emit("error",new Error("Invalid "+e)),!1;n+=1+R.byteLength(r)+2;break;case"int16":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=3;break;case"int32":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=5;break;case"var":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=1+c(r).length;break;case"string":if("string"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=3+R.byteLength(r.toString());break;case"pair":if("object"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=Object.getOwnPropertyNames(r).reduce(function(e,t){return e+=3+R.byteLength(t.toString())+2+R.byteLength(r[t].toString())},0);break;default:return o.emit("error",new Error("Invalid property "+e)),!1}return n}if(i)for(var r in i){var n=t(r);if(!n)return!1;e+=n}return{length:c(e).length+e,write:function(){_(o,i,e)}}}function b(e,t,r,n){var o=["reasonString","userProperties"],i=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,s=k(e,t);if(i)for(;n+s.length>i;){var a=o.shift();if(!a||!t[a])return!1;delete t[a],s=k(e,t)}return s}function _(o,e,t){for(var i in x(o,t),e)if(e.hasOwnProperty(i)&&null!==e[i]){var s=e[i];switch(I.propertiesTypes[i]){case"byte":o.write(R.from([I.properties[i]])),o.write(R.from([+s]));break;case"int8":o.write(R.from([I.properties[i]])),o.write(R.from([s]));break;case"binary":o.write(R.from([I.properties[i]])),y(o,s);break;case"int16":o.write(R.from([I.properties[i]])),P(o,s);break;case"int32":o.write(R.from([I.properties[i]])),r=s,o.write(d(r));break;case"var":o.write(R.from([I.properties[i]])),x(o,s);break;case"string":o.write(R.from([I.properties[i]])),M(o,s);break;case"pair":Object.getOwnPropertyNames(s).forEach(function(e){var t,r,n;o.write(R.from([I.properties[i]])),t=o,r=e.toString(),n=s[e].toString(),M(t,r),M(t,n)});break;default:return o.emit("error",new Error("Invalid property "+i)),!1}}var r}function S(e){return e?e instanceof R?e.length:R.byteLength(e):0}function w(e){return"string"==typeof e||e instanceof R}t.exports=p},{"./constants":82,"./numbers":86,"process-nextick-args":91,"safe-buffer":110}],90:[function(e,t,r){var n=e("wrappy");function o(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function i(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}t.exports=n(o),t.exports.strict=n(i),o.proto=o(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return o(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},{wrappy:120}],91:[function(e,t,r){(function(a){"use strict";!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,i,s=arguments.length;switch(s){case 0:case 1:return a.nextTick(e);case 2:return a.nextTick(function(){e.call(null,t)});case 3:return a.nextTick(function(){e.call(null,t,r)});case 4:return a.nextTick(function(){e.call(null,t,r,n)});default:for(o=new Array(s-1),i=0;i<o.length;)o[i++]=arguments[i];return a.nextTick(function(){e.apply(null,o)})}}}:t.exports=a}).call(this,e("_process"))},{_process:92}],92:[function(e,t,r){var n,o,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var l,d=[],u=!1,p=-1;function f(){u&&l&&(u=!1,l.length?d=l.concat(d):p=-1,d.length&&h())}function h(){if(!u){var e=c(f);u=!0;for(var t=d.length;t;){for(l=d,d=[];++p<t;)l&&l[p].run();p=-1,t=d.length}l=null,u=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new m(e,t)),1!==d.length||u||c(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],93:[function(e,A,O){(function(k){!function(e){var t="object"==typeof O&&O&&!O.nodeType&&O,r="object"==typeof A&&A&&!A.nodeType&&A,n="object"==typeof k&&k;n.global!==n&&n.window!==n&&n.self!==n||(e=n);var o,i,v=2147483647,y=36,b=1,_=26,s=38,a=700,S=72,w=128,E="-",c=/^xn--/,l=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=y-b,C=Math.floor,T=String.fromCharCode;function I(e){throw new RangeError(u[e])}function f(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function h(e,t){var r=e.split("@"),n="";return 1<r.length&&(n=r[0]+"@",e=r[1]),n+f((e=e.replace(d,".")).split("."),t).join(".")}function R(e){for(var t,r,n=[],o=0,i=e.length;o<i;)55296<=(t=e.charCodeAt(o++))&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function P(e){return f(e,function(e){var t="";return 65535<e&&(t+=T((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=T(e)}).join("")}function x(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function M(e,t,r){var n=0;for(e=r?C(e/a):e>>1,e+=C(e/t);p*_>>1<e;n+=y)e=C(e/p);return C(n+(p+1)*e/(e+s))}function m(e){var t,r,n,o,i,s,a,c,l,d,u,p=[],f=e.length,h=0,m=w,g=S;for((r=e.lastIndexOf(E))<0&&(r=0),n=0;n<r;++n)128<=e.charCodeAt(n)&&I("not-basic"),p.push(e.charCodeAt(n));for(o=0<r?r+1:0;o<f;){for(i=h,s=1,a=y;f<=o&&I("invalid-input"),u=e.charCodeAt(o++),(y<=(c=u-48<10?u-22:u-65<26?u-65:u-97<26?u-97:y)||c>C((v-h)/s))&&I("overflow"),h+=c*s,!(c<(l=a<=g?b:g+_<=a?_:a-g));a+=y)s>C(v/(d=y-l))&&I("overflow"),s*=d;g=M(h-i,t=p.length+1,0==i),C(h/t)>v-m&&I("overflow"),m+=C(h/t),h%=t,p.splice(h++,0,m)}return P(p)}function g(e){var t,r,n,o,i,s,a,c,l,d,u,p,f,h,m,g=[];for(p=(e=R(e)).length,t=w,i=S,s=r=0;s<p;++s)(u=e[s])<128&&g.push(T(u));for(n=o=g.length,o&&g.push(E);n<p;){for(a=v,s=0;s<p;++s)t<=(u=e[s])&&u<a&&(a=u);for(a-t>C((v-r)/(f=n+1))&&I("overflow"),r+=(a-t)*f,t=a,s=0;s<p;++s)if((u=e[s])<t&&++r>v&&I("overflow"),u==t){for(c=r,l=y;!(c<(d=l<=i?b:i+_<=l?_:l-i));l+=y)m=c-d,h=y-d,g.push(T(x(d+m%h,0))),c=C(m/h);g.push(T(x(c,0))),i=M(r,f,n==o),r=0,++n}++r,++t}return g.join("")}if(o={version:"1.4.1",ucs2:{decode:R,encode:P},decode:m,encode:g,toASCII:function(e){return h(e,function(e){return l.test(e)?"xn--"+g(e):e})},toUnicode:function(e){return h(e,function(e){return c.test(e)?m(e.slice(4).toLowerCase()):e})}},t&&r)if(A.exports==t)r.exports=o;else for(i in o)o.hasOwnProperty(i)&&(t[i]=o[i]);else e.punycode=o}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],94:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var i=/\+/g;e=e.split(t);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a,c,l=e.length;0<s&&s<l&&(l=s);for(var d=0;d<l;++d){var u,p,f,h,m=e[d].replace(i,"%20"),g=m.indexOf(r);p=0<=g?(u=m.substr(0,g),m.substr(g+1)):(u=m,""),f=decodeURIComponent(u),h=decodeURIComponent(p),a=o,c=f,Object.prototype.hasOwnProperty.call(a,c)?v(o[f])?o[f].push(h):o[f]=[o[f],h]:o[f]=h}return o};var v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],95:[function(e,t,r){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(r,n,o,e){return n=n||"&",o=o||"=",null===r&&(r=void 0),"object"==typeof r?a(c(r),function(e){var t=encodeURIComponent(i(e))+o;return s(r[e])?a(r[e],function(e){return t+encodeURIComponent(i(e))}).join(n):t+encodeURIComponent(i(r[e]))}).join(n):e?encodeURIComponent(i(e))+o+encodeURIComponent(i(r)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var c=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],96:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":94,"./encode":95}],97:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":98}],98:[function(e,t,r){"use strict";var n=e("process-nextick-args"),o=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=u;var i=e("core-util-is");i.inherits=e("inherits");var s=e("./_stream_readable"),a=e("./_stream_writable");i.inherits(u,s);for(var c=o(a.prototype),l=0;l<c.length;l++){var d=c[l];u.prototype[d]||(u.prototype[d]=a.prototype[d])}function u(e){if(!(this instanceof u))return new u(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",p)}function p(){this.allowHalfOpen||this._writableState.ended||n.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),u.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},{"./_stream_readable":100,"./_stream_writable":102,"core-util-is":14,inherits:80,"process-nextick-args":91}],99:[function(e,t,r){"use strict";t.exports=i;var n=e("./_stream_transform"),o=e("core-util-is");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}o.inherits=e("inherits"),o.inherits(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":101,"core-util-is":14,inherits:80}],100:[function(O,U,e){(function(g,e){"use strict";var v=O("process-nextick-args");U.exports=p;var s,y=O("isarray");p.ReadableState=i;O("events").EventEmitter;var b=function(e,t){return e.listeners(t).length},o=O("./internal/streams/stream"),l=O("safe-buffer").Buffer,d=e.Uint8Array||function(){};var t=O("core-util-is");t.inherits=O("inherits");var r=O("util"),_=void 0;_=r&&r.debuglog?r.debuglog("stream"):function(){};var a,c=O("./internal/streams/BufferList"),n=O("./internal/streams/destroy");t.inherits(p,o);var u=["error","close","destroy","pause","resume"];function i(e,t){e=e||{};var r=t instanceof(s=s||O("./_stream_duplex"));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,o=e.readableHighWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(o||0===o)?o:i,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new c,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(a||(a=O("string_decoder/").StringDecoder),this.decoder=new a(e.encoding),this.encoding=e.encoding)}function p(e){if(s=s||O("./_stream_duplex"),!(this instanceof p))return new p(e);this._readableState=new i(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function f(e,t,r,n,o){var i,s,a,c=e._readableState;null===t?(c.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,w(e)}(e,c)):(o||(i=function(e,t){var r;n=t,l.isBuffer(n)||n instanceof d||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(c,t)),i?e.emit("error",i):c.objectMode||t&&0<t.length?("string"==typeof t||c.objectMode||Object.getPrototypeOf(t)===l.prototype||(s=t,t=l.from(s)),n?c.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):h(e,c,t,!0):c.ended?e.emit("error",new Error("stream.push() after EOF")):(c.reading=!1,c.decoder&&!r?(t=c.decoder.write(t),c.objectMode||0!==t.length?h(e,c,t,!1):C(e,c)):h(e,c,t,!1))):n||(c.reading=!1));return!(a=c).ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function h(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&w(e)),C(e,t)}Object.defineProperty(p.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),p.prototype.destroy=n.destroy,p.prototype._undestroy=n.undestroy,p.prototype._destroy=function(e,t){this.push(null),t(e)},p.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=l.from(e,t),t=""),r=!0),f(this,e,t,!1,r)},p.prototype.unshift=function(e){return f(this,e,null,!0,!1)},p.prototype.isPaused=function(){return!1===this._readableState.flowing},p.prototype.setEncoding=function(e){return a||(a=O("string_decoder/").StringDecoder),this._readableState.decoder=new a(e),this._readableState.encoding=e,this};var m=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=(m<=(r=e)?r=m:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var r}function w(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(_("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?v.nextTick(E,e):E(e))}function E(e){_("emit readable"),e.emit("readable"),P(e)}function C(e,t){t.readingMore||(t.readingMore=!0,v.nextTick(T,e,t))}function T(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(_("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function I(e){_("readable nexttick read 0"),e.read(0)}function R(e,t){t.reading||(_("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),P(e),t.flowing&&!t.reading&&e.read(0)}function P(e){var t=e._readableState;for(_("flow",t.flowing);t.flowing&&null!==e.read(););}function x(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,o=r.data;e-=o.length;for(;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(s===i.length?o+=i:o+=i.slice(0,e),0===(e-=s)){s===i.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=i.slice(s);break}++n}return t.length-=n,o}(e,t):function(e,t){var r=l.allocUnsafe(e),n=t.head,o=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var i=n.data,s=e>i.length?i.length:e;if(i.copy(r,r.length-e,0,s),0===(e-=s)){s===i.length?(++o,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=i.slice(s);break}++o}return t.length-=o,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function M(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,v.nextTick(k,t,e))}function k(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function A(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}p.prototype.read=function(e){_("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return _("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?M(this):w(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&M(this),null;var n,o=t.needReadable;return _("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&_("length less than watermark",o=!0),t.ended||t.reading?_("reading or ended",o=!1):o&&(_("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(r,t))),null===(n=0<e?x(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&M(this)),null!==n&&this.emit("data",n),n},p.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},p.prototype.pipe=function(r,e){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=r;break;case 1:o.pipes=[o.pipes,r];break;default:o.pipes.push(r)}o.pipesCount+=1,_("pipe count=%d opts=%j",o.pipesCount,e);var t=(!e||!1!==e.end)&&r!==g.stdout&&r!==g.stderr?s:m;function i(e,t){_("onunpipe"),e===n&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,_("cleanup"),r.removeListener("close",f),r.removeListener("finish",h),r.removeListener("drain",c),r.removeListener("error",p),r.removeListener("unpipe",i),n.removeListener("end",s),n.removeListener("end",m),n.removeListener("data",u),l=!0,!o.awaitDrain||r._writableState&&!r._writableState.needDrain||c())}function s(){_("onend"),r.end()}o.endEmitted?v.nextTick(t):n.once("end",t),r.on("unpipe",i);var a,c=(a=n,function(){var e=a._readableState;_("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&b(a,"data")&&(e.flowing=!0,P(a))});r.on("drain",c);var l=!1;var d=!1;function u(e){_("ondata"),(d=!1)!==r.write(e)||d||((1===o.pipesCount&&o.pipes===r||1<o.pipesCount&&-1!==A(o.pipes,r))&&!l&&(_("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function p(e){_("onerror",e),m(),r.removeListener("error",p),0===b(r,"error")&&r.emit("error",e)}function f(){r.removeListener("finish",h),m()}function h(){_("onfinish"),r.removeListener("close",f),m()}function m(){_("unpipe"),n.unpipe(r)}return n.on("data",u),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?y(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(r,"error",p),r.once("close",f),r.once("finish",h),r.emit("pipe",n),o.flowing||(_("pipe resume"),n.resume()),r},p.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<o;i++)n[i].emit("unpipe",this,r);return this}var s=A(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},p.prototype.addListener=p.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&w(this):v.nextTick(I,this))}return r},p.prototype.resume=function(){var e,t,r=this._readableState;return r.flowing||(_("resume"),r.flowing=!0,e=this,(t=r).resumeScheduled||(t.resumeScheduled=!0,v.nextTick(R,e,t))),this},p.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this},p.prototype.wrap=function(t){var r=this,n=this._readableState,o=!1;for(var e in t.on("end",function(){if(_("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),t.on("data",function(e){(_("wrapped data"),n.decoder&&(e=n.decoder.write(e)),n.objectMode&&null==e)||(n.objectMode||e&&e.length)&&(r.push(e)||(o=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var i=0;i<u.length;i++)t.on(u[i],this.emit.bind(this,u[i]));return this._read=function(e){_("wrapped _read",e),o&&(o=!1,t.resume())},this},Object.defineProperty(p.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),p._fromList=x}).call(this,O("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":98,"./internal/streams/BufferList":103,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,events:13,inherits:80,isarray:106,"process-nextick-args":91,"safe-buffer":110,"string_decoder/":107,util:11}],101:[function(e,t,r){"use strict";t.exports=i;var n=e("./_stream_duplex"),o=e("core-util-is");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,(r.writecb=null)!=t&&this.push(t),n(e);var o=this._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var r=this;"function"==typeof this._flush?this._flush(function(e,t){a(r,e,t)}):a(this,null,null)}function a(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}o.inherits=e("inherits"),o.inherits(i,n),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var o=this._readableState;(n.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},{"./_stream_duplex":98,"core-util-is":14,inherits:80}],102:[function(E,C,e){(function(e,t,r){"use strict";var v=E("process-nextick-args");function u(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var o=n.callback;t.pendingcb--,o(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}C.exports=d;var a,p=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?r:v.nextTick;d.WritableState=l;var n=E("core-util-is");n.inherits=E("inherits");var o={deprecate:E("util-deprecate")},i=E("./internal/streams/stream"),y=E("safe-buffer").Buffer,b=t.Uint8Array||function(){};var s,c=E("./internal/streams/destroy");function _(){}function l(e,t){a=a||E("./_stream_duplex"),e=e||{};var r=t instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,o=e.writableHighWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(o||0===o)?o:i,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var s=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,o=r.writecb;if(u=r,u.writing=!1,u.writecb=null,u.length-=u.writelen,u.writelen=0,t)s=e,a=r,c=n,l=t,d=o,--a.pendingcb,c?(v.nextTick(d,l),v.nextTick(w,s,a),s._writableState.errorEmitted=!0,s.emit("error",l)):(d(l),s._writableState.errorEmitted=!0,s.emit("error",l),w(s,a));else{var i=m(r);i||r.corked||r.bufferProcessing||!r.bufferedRequest||h(e,r),n?p(f,e,r,i,o):f(e,r,i,o)}var s,a,c,l,d;var u}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new u(this)}function d(e){if(a=a||E("./_stream_duplex"),!(s.call(d,this)||this instanceof a))return new d(e);this._writableState=new l(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),i.call(this)}function S(e,t,r,n,o,i,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(o,t.onwrite):e._write(o,i,t.onwrite),t.sync=!1}function f(e,t,r,n){var o,i;r||(o=e,0===(i=t).length&&i.needDrain&&(i.needDrain=!1,o.emit("drain"))),t.pendingcb--,n(),w(e,t)}function h(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,o=new Array(n),i=t.corkedRequestsFree;i.entry=r;for(var s=0,a=!0;r;)(o[s]=r).isBuf||(a=!1),r=r.next,s+=1;o.allBuffers=a,S(e,t,!0,t.length,o,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new u(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,l=r.encoding,d=r.callback;if(S(e,t,!1,t.objectMode?1:c.length,c,l,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function m(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function g(t,r){t._final(function(e){r.pendingcb--,e&&t.emit("error",e),r.prefinished=!0,t.emit("prefinish"),w(t,r)})}function w(e,t){var r,n,o=m(t);return o&&(r=e,(n=t).prefinished||n.finalCalled||("function"==typeof r._final?(n.pendingcb++,n.finalCalled=!0,v.nextTick(g,r,n)):(n.prefinished=!0,r.emit("prefinish"))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),o}n.inherits(d,i),l.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(l.prototype,"buffer",{get:o.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(d,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===d&&(e&&e._writableState instanceof l)}})):s=function(e){return e instanceof this},d.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},d.prototype.write=function(e,t,r){var n,o,i,s,a,c,l,d,u,p,f,h=this._writableState,m=!1,g=!h.objectMode&&(n=e,y.isBuffer(n)||n instanceof b);return g&&!y.isBuffer(e)&&(o=e,e=y.from(o)),"function"==typeof t&&(r=t,t=null),g?t="buffer":t||(t=h.defaultEncoding),"function"!=typeof r&&(r=_),h.ended?(u=this,p=r,f=new Error("write after end"),u.emit("error",f),v.nextTick(p,f)):(g||(i=this,s=h,c=r,d=!(l=!0),null===(a=e)?d=new TypeError("May not write null values to stream"):"string"==typeof a||void 0===a||s.objectMode||(d=new TypeError("Invalid non-string/buffer chunk")),d&&(i.emit("error",d),v.nextTick(c,d),l=!1),l))&&(h.pendingcb++,m=function(e,t,r,n,o,i){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=y.from(t,r));return t}(t,n,o);n!==s&&(r=!0,o="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:o,isBuf:r,callback:i,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else S(e,t,!1,a,n,o,i);return c}(this,h,g,e,t,r)),m},d.prototype.cork=function(){this._writableState.corked++},d.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||h(this,e))},d.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),d.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},d.prototype._writev=null,d.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,t=e=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,w(e,t),r&&(t.finished?v.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),d.prototype.destroy=c.destroy,d.prototype._undestroy=c.undestroy,d.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,E("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},E("timers").setImmediate)},{"./_stream_duplex":98,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,inherits:80,"process-nextick-args":91,"safe-buffer":110,timers:112,"util-deprecate":115}],103:[function(e,t,r){"use strict";var a=e("safe-buffer").Buffer,n=e("util");t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return a.alloc(0);if(1===this.length)return this.head.data;for(var t,r,n,o=a.allocUnsafe(e>>>0),i=this.head,s=0;i;)t=i.data,r=o,n=s,t.copy(r,n),s+=i.data.length,i=i.next;return o},e}(),n&&n.inspect&&n.inspect.custom&&(t.exports.prototype[n.inspect.custom]=function(){var e=n.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":110,util:11}],104:[function(e,t,r){"use strict";var i=e("process-nextick-args");function s(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return n||o?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(s,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(i.nextTick(s,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":91}],105:[function(e,t,r){t.exports=e("events").EventEmitter},{events:13}],106:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],107:[function(e,t,r){"use strict";var n=e("safe-buffer").Buffer,o=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===o||!o(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=d,this.end=u,t=3;break;default:return this.write=p,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(55296<=n&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function d(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}(r.StringDecoder=i).prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},i.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var o=s(t[n]);if(0<=o)return 0<o&&(e.lastNeed=o-1),o;if(--n<r||-2===o)return 0;if(0<=(o=s(t[n])))return 0<o&&(e.lastNeed=o-2),o;if(--n<r||-2===o)return 0;if(0<=(o=s(t[n])))return 0<o&&(2===o?o=0:e.lastNeed=o-3),o;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":110}],108:[function(e,t,r){(((r=t.exports=e("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":98,"./lib/_stream_passthrough.js":99,"./lib/_stream_readable.js":100,"./lib/_stream_transform.js":101,"./lib/_stream_writable.js":102}],109:[function(e,t,r){"use strict";function n(e,t,r){var n=this;this._callback=e,this._args=r,this._interval=setInterval(e,t,this._args),this.reschedule=function(e){e||(e=n._interval),n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,e,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}t.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");var e;if(0<arguments.length){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new n(arguments[0],arguments[1],e)}},{}],110:[function(e,t,r){var n=e("buffer"),o=n.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return o(e,t,r)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?t.exports=n:(i(n,r),r.Buffer=s),i(o,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=o(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:12}],111:[function(e,t,r){t.exports=function(e){var t=e._readableState;return t?t.objectMode?e.read():e.read((r=t,r.buffer.length?r.buffer.head?r.buffer.head.data.length:r.buffer[0].length:r.length)):null;var r}},{}],112:[function(c,e,l){(function(e,t){var n=c("process/browser.js").nextTick,r=Function.prototype.apply,o=Array.prototype.slice,i={},s=0;function a(e,t){this._id=e,this._clearFn=t}l.setTimeout=function(){return new a(r.call(setTimeout,window,arguments),clearTimeout)},l.setInterval=function(){return new a(r.call(setInterval,window,arguments),clearInterval)},l.clearTimeout=l.clearInterval=function(e){e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},l.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},l.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},l._unrefActive=l.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},l.setImmediate="function"==typeof e?e:function(e){var t=s++,r=!(arguments.length<2)&&o.call(arguments,1);return i[t]=!0,n(function(){i[t]&&(r?e.apply(null,r):e.call(null),l.clearImmediate(t))}),t},l.clearImmediate="function"==typeof t?t:function(e){delete i[e]}}).call(this,c("timers").setImmediate,c("timers").clearImmediate)},{"process/browser.js":92,timers:112}],113:[function(e,t,r){"use strict";var O=e("punycode"),U=e("./util");function R(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=i,r.resolve=function(e,t){return i(e,!1,!0).resolve(t)},r.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},r.format=function(e){U.isString(e)&&(e=i(e));return e instanceof R?e.format():R.prototype.format.call(e)},r.Url=R;var L=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,D=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,o=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),N=["'"].concat(o),B=["%","/","?",";","#"].concat(N),j=["/","?","#"],F=/^[+a-z0-9A-Z_-]{0,63}$/,V=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,q={javascript:!0,"javascript:":!0},G={javascript:!0,"javascript:":!0},W={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},H=e("querystring");function i(e,t,r){if(e&&U.isObject(e)&&e instanceof R)return e;var n=new R;return n.parse(e,t,r),n}R.prototype.parse=function(e,t,r){if(!U.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),o=-1!==n&&n<e.indexOf("#")?"?":"#",i=e.split(o);i[0]=i[0].replace(/\\/g,"/");var s=e=i.join(o);if(s=s.trim(),!r&&1===e.split("#").length){var a=D.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=t?H.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var c=L.exec(s);if(c){var l=(c=c[0]).toLowerCase();this.protocol=l,s=s.substr(c.length)}if(r||c||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var d="//"===s.substr(0,2);!d||c&&G[c]||(s=s.substr(2),this.slashes=!0)}if(!G[c]&&(d||c&&!W[c])){for(var u,p,f=-1,h=0;h<j.length;h++){-1!==(m=s.indexOf(j[h]))&&(-1===f||m<f)&&(f=m)}-1!==(p=-1===f?s.lastIndexOf("@"):s.lastIndexOf("@",f))&&(u=s.slice(0,p),s=s.slice(p+1),this.auth=decodeURIComponent(u)),f=-1;for(h=0;h<B.length;h++){var m;-1!==(m=s.indexOf(B[h]))&&(-1===f||m<f)&&(f=m)}-1===f&&(f=s.length),this.host=s.slice(0,f),s=s.slice(f),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var v=this.hostname.split(/\./),y=(h=0,v.length);h<y;h++){var b=v[h];if(b&&!b.match(F)){for(var _="",S=0,w=b.length;S<w;S++)127<b.charCodeAt(S)?_+="x":_+=b[S];if(!_.match(F)){var E=v.slice(0,h),C=v.slice(h+1),T=b.match(V);T&&(E.push(T[1]),C.unshift(T[2])),C.length&&(s="/"+C.join(".")+s),this.hostname=E.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=O.toASCII(this.hostname));var I=this.port?":"+this.port:"",R=this.hostname||"";this.host=R+I,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!q[l])for(h=0,y=N.length;h<y;h++){var P=N[h];if(-1!==s.indexOf(P)){var x=encodeURIComponent(P);x===P&&(x=escape(P)),s=s.split(P).join(x)}}var M=s.indexOf("#");-1!==M&&(this.hash=s.substr(M),s=s.slice(0,M));var k=s.indexOf("?");if(-1!==k?(this.search=s.substr(k),this.query=s.substr(k+1),t&&(this.query=H.parse(this.query)),s=s.slice(0,k)):t&&(this.search="",this.query={}),s&&(this.pathname=s),W[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){I=this.pathname||"";var A=this.search||"";this.path=I+A}return this.href=this.format(),this},R.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&U.isObject(this.query)&&Object.keys(this.query).length&&(i=H.stringify(this.query));var s=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||W[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+n},R.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},R.prototype.resolveObject=function(e){if(U.isString(e)){var t=new R;t.parse(e,!1,!0),e=t}for(var r=new R,n=Object.keys(this),o=0;o<n.length;o++){var i=n[o];r[i]=this[i]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),a=0;a<s.length;a++){var c=s[a];"protocol"!==c&&(r[c]=e[c])}return W[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!W[e.protocol]){for(var l=Object.keys(e),d=0;d<l.length;d++){var u=l[d];r[u]=e[u]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||G[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var f=r.pathname||"",h=r.search||"";r.path=f+h}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),v=g||m||r.host&&e.pathname,y=v,b=r.pathname&&r.pathname.split("/")||[],_=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!W[r.protocol]);if(_&&(r.hostname="",r.port=null,r.host&&(""===b[0]?b[0]=r.host:b.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),v=v&&(""===p[0]||""===b[0])),g)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,b=p;else if(p.length)b||(b=[]),b.pop(),b=b.concat(p),r.search=e.search,r.query=e.query;else if(!U.isNullOrUndefined(e.search)){if(_)r.hostname=r.host=b.shift(),(T=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=T.shift(),r.host=r.hostname=T.shift());return r.search=e.search,r.query=e.query,U.isNull(r.pathname)&&U.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!b.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var S=b.slice(-1)[0],w=(r.host||e.host||1<b.length)&&("."===S||".."===S)||""===S,E=0,C=b.length;0<=C;C--)"."===(S=b[C])?b.splice(C,1):".."===S?(b.splice(C,1),E++):E&&(b.splice(C,1),E--);if(!v&&!y)for(;E--;E)b.unshift("..");!v||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),w&&"/"!==b.join("/").substr(-1)&&b.push("");var T,I=""===b[0]||b[0]&&"/"===b[0].charAt(0);_&&(r.hostname=r.host=I?"":b.length?b.shift():"",(T=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=T.shift(),r.host=r.hostname=T.shift()));return(v=v||r.host&&b.length)&&!I&&b.unshift(""),b.length?r.pathname=b.join("/"):(r.pathname=null,r.path=null),U.isNull(r.pathname)&&U.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},R.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":114,punycode:93,querystring:96}],114:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],115:[function(e,t,r){(function(r){function n(e){try{if(!r.localStorage)return!1}catch(e){return!1}var t=r.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}t.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],116:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],117:[function(p,e,R){(function(n,o){var a=/%[sdj%]/g;R.format=function(e){if(!_(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(c(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,i=String(e).replace(a,function(e){if("%%"===e)return"%";if(o<=r)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),s=n[r];r<o;s=n[++r])y(s)||!d(s)?i+=" "+s:i+=" "+c(s);return i},R.deprecate=function(e,t){if(S(o.process))return function(){return R.deprecate(e,t).apply(this,arguments)};if(!0===n.noDeprecation)return e;var r=!1;return function(){if(!r){if(n.throwDeprecation)throw new Error(t);n.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}};var e,i={};function c(e,t){var r={seen:[],stylize:l};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),v(t)?r.showHidden=t:t&&R._extend(r,t),S(r.showHidden)&&(r.showHidden=!1),S(r.depth)&&(r.depth=2),S(r.colors)&&(r.colors=!1),S(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),f(r,e,r.depth)}function s(e,t){var r=c.styles[t];return r?"["+c.colors[r][0]+"m"+e+"["+c.colors[r][1]+"m":e}function l(e,t){return e}function f(t,r,n){if(t.customInspect&&r&&T(r.inspect)&&r.inspect!==R.inspect&&(!r.constructor||r.constructor.prototype!==r)){var e=r.inspect(n,t);return _(e)||(e=f(t,e,n)),e}var o=function(e,t){if(S(t))return e.stylize("undefined","undefined");if(_(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(b(t))return e.stylize(""+t,"number");if(v(t))return e.stylize(""+t,"boolean");if(y(t))return e.stylize("null","null")}(t,r);if(o)return o;var i,s=Object.keys(r),a=(i={},s.forEach(function(e,t){i[e]=!0}),i);if(t.showHidden&&(s=Object.getOwnPropertyNames(r)),C(r)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return h(r);if(0===s.length){if(T(r)){var c=r.name?": "+r.name:"";return t.stylize("[Function"+c+"]","special")}if(w(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return t.stylize(Date.prototype.toString.call(r),"date");if(C(r))return h(r)}var l,d="",u=!1,p=["{","}"];(g(r)&&(u=!0,p=["[","]"]),T(r))&&(d=" [Function"+(r.name?": "+r.name:"")+"]");return w(r)&&(d=" "+RegExp.prototype.toString.call(r)),E(r)&&(d=" "+Date.prototype.toUTCString.call(r)),C(r)&&(d=" "+h(r)),0!==s.length||u&&0!=r.length?n<0?w(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),l=u?function(t,r,n,o,e){for(var i=[],s=0,a=r.length;s<a;++s)I(r,String(s))?i.push(m(t,r,n,o,String(s),!0)):i.push("");return e.forEach(function(e){e.match(/^\d+$/)||i.push(m(t,r,n,o,e,!0))}),i}(t,r,n,a,s):s.map(function(e){return m(t,r,n,a,e,u)}),t.seen.pop(),function(e,t,r){if(60<e.reduce(function(e,t){return 0,0<=t.indexOf("\n")&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0))return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(l,d,p)):p[0]+d+p[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,r,n,o,i){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),I(n,o)||(s="["+o+"]"),a||(e.seen.indexOf(c.value)<0?-1<(a=y(r)?f(e,c.value,null):f(e,c.value,r-1)).indexOf("\n")&&(a=i?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),S(s)){if(i&&o.match(/^\d+$/))return a;s=(s=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(s,"string"))}return s+": "+a}function g(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function y(e){return null===e}function b(e){return"number"==typeof e}function _(e){return"string"==typeof e}function S(e){return void 0===e}function w(e){return d(e)&&"[object RegExp]"===t(e)}function d(e){return"object"==typeof e&&null!==e}function E(e){return d(e)&&"[object Date]"===t(e)}function C(e){return d(e)&&("[object Error]"===t(e)||e instanceof Error)}function T(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function r(e){return e<10?"0"+e.toString(10):e.toString(10)}R.debuglog=function(t){if(S(e)&&(e=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!i[t])if(new RegExp("\\b"+t+"\\b","i").test(e)){var r=n.pid;i[t]=function(){var e=R.format.apply(R,arguments);console.error("%s %d: %s",t,r,e)}}else i[t]=function(){};return i[t]},(R.inspect=c).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},R.isArray=g,R.isBoolean=v,R.isNull=y,R.isNullOrUndefined=function(e){return null==e},R.isNumber=b,R.isString=_,R.isSymbol=function(e){return"symbol"==typeof e},R.isUndefined=S,R.isRegExp=w,R.isObject=d,R.isDate=E,R.isError=C,R.isFunction=T,R.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},R.isBuffer=p("./support/isBuffer");var u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}R.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[r(e.getHours()),r(e.getMinutes()),r(e.getSeconds())].join(":"),[e.getDate(),u[e.getMonth()],t].join(" ")),R.format.apply(R,arguments))},R.inherits=p("inherits"),R._extend=function(e,t){if(!t||!d(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,p("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":116,_process:92,inherits:80}],118:[function(e,t,r){(function(g,v){"use strict";var y=e("readable-stream").Transform,b=e("duplexify"),_=e("ws"),S=e("safe-buffer").Buffer;t.exports=function(e,t,r){var n,o,i="browser"===g.title,s=!!v.WebSocket,a=i?function e(t,r,n){if(o.bufferedAmount>f)return void setTimeout(e,h,t,r,n);m&&"string"==typeof t&&(t=S.from(t,"utf8"));try{o.send(t)}catch(e){return n(e)}n()}:function(e,t,r){if(o.readyState!==o.OPEN)return void r();m&&"string"==typeof e&&(e=S.from(e,"utf8"));o.send(e,r)};t&&!Array.isArray(t)&&"object"==typeof t&&(r=t,t=null,("string"==typeof r.protocol||Array.isArray(r.protocol))&&(t=r.protocol));r||(r={});void 0===r.objectMode&&(r.objectMode=!(!0===r.binary||void 0===r.binary));var c=(l=r,d=a,u=function(e){o.close(),e()},p=new y({objectMode:l.objectMode}),p._write=d,p._flush=u,p);var l,d,u,p;r.objectMode||(c._writev=function(e,t){for(var r=new Array(e.length),n=0;n<e.length;n++)"string"==typeof e[n].chunk?r[n]=S.from(e[n],"utf8"):r[n]=e[n].chunk;this._write(S.concat(r),"binary",t)});var f=r.browserBufferSize||524288,h=r.browserBufferTimeout||1e3;"object"==typeof e?o=e:(o=s&&i?new _(e,t):new _(e,t,r)).binaryType="arraybuffer";o.readyState===o.OPEN?n=c:(n=b.obj(),o.onopen=function(){n.setReadable(c),n.setWritable(c),n.emit("connect")});(n.socket=o).onclose=function(){n.end(),n.destroy()},o.onerror=function(e){n.destroy(e)},o.onmessage=function(e){var t=e.data;t=t instanceof ArrayBuffer?S.from(t):S.from(t,"utf8");c.push(t)},c.on("close",function(){o.close()});var m=!r.objectMode;return n}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:92,duplexify:17,"readable-stream":108,"safe-buffer":110,ws:119}],119:[function(e,t,r){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:"undefined"!=typeof window&&(n=window.WebSocket||window.MozWebSocket),t.exports=n},{}],120:[function(e,t,r){t.exports=function e(o,t){if(o&&t)return e(o)(t);if("function"!=typeof o)throw new TypeError("need wrapper function");Object.keys(o).forEach(function(e){r[e]=o[e]});return r;function r(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];var r=o.apply(this,e),n=e[e.length-1];return"function"==typeof r&&r!==n&&Object.keys(n).forEach(function(e){r[e]=n[e]}),r}}},{}],121:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)o.call(r,n)&&(e[n]=r[n])}return e};var o=Object.prototype.hasOwnProperty},{}]},{},[9])(9)}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.zrender={})}(this,function(e){"use strict";var t=2311,n=function(){return t++},d="undefined"==typeof document&&"undefined"!=typeof self?{browser:{},os:{},node:!1,worker:!0,canvasSupported:!0}:"undefined"==typeof navigator?{browser:{},os:{},node:!0,worker:!1,canvasSupported:!0,svgSupported:!0}:function(e){var t={},r=e.match(/Firefox\/([\d.]+)/),n=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/.+?rv:(([\d.]+))/),o=e.match(/Edge\/([\d.]+)/),i=/micromessenger/i.test(e);r&&(t.firefox=!0,t.version=r[1]);n&&(t.ie=!0,t.version=n[1]);o&&(t.edge=!0,t.version=o[1]);i&&(t.weChat=!0);return{browser:t,os:{},node:!1,canvasSupported:!!document.createElement("canvas").getContext,svgSupported:"undefined"!=typeof SVGRect,touchEventsSupported:"ontouchstart"in window&&!t.ie&&!t.edge,pointerEventsSupported:"onpointerdown"in window&&(t.edge||t.ie&&11<=t.version)}}(navigator.userAgent);var a={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},c={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},l=Object.prototype.toString,r=Array.prototype,s=r.forEach,u=r.filter,o=r.slice,p=r.map,f=r.reduce,i={};function h(e){if(null==e||"object"!=typeof e)return e;var t=e,r=l.call(e);if("[object Array]"===r){if(!B(e)){t=[];for(var n=0,o=e.length;n<o;n++)t[n]=h(e[n])}}else if(c[r]){if(!B(e)){var i=e.constructor;if(e.constructor.from)t=i.from(e);else{t=new i(e.length);for(n=0,o=e.length;n<o;n++)t[n]=h(e[n])}}}else if(!a[r]&&!B(e)&&!A(e))for(var s in t={},e)e.hasOwnProperty(s)&&(t[s]=h(e[s]));return t}function m(e,t,r){if(!M(t)||!M(e))return r?h(t):e;for(var n in t)if(t.hasOwnProperty(n)){var o=e[n],i=t[n];!M(i)||!M(o)||R(i)||R(o)||A(i)||A(o)||k(i)||k(o)||B(i)||B(o)?!r&&n in e||(e[n]=h(t[n])):m(o,i,r)}return e}function g(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function v(e,t,r){for(var n in t)t.hasOwnProperty(n)&&(r?null!=t[n]:null==e[n])&&(e[n]=t[n]);return e}var y,b=function(){return i.createCanvas()};function _(){return y||(y=b().getContext("2d")),y}function S(e,t){if(e){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r}return-1}function w(e,t){var r=e.prototype;function n(){}for(var o in n.prototype=t.prototype,e.prototype=new n,r)e.prototype[o]=r[o];(e.prototype.constructor=e).superClass=t}function E(e,t,r){v(e="prototype"in e?e.prototype:e,t="prototype"in t?t.prototype:t,r)}function U(e){if(e)return"string"!=typeof e&&"number"==typeof e.length}function C(e,t,r){if(e&&t)if(e.forEach&&e.forEach===s)e.forEach(t,r);else if(e.length===+e.length)for(var n=0,o=e.length;n<o;n++)t.call(r,e[n],n,e);else for(var i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i,e)}function T(e,t,r){if(e&&t){if(e.map&&e.map===p)return e.map(t,r);for(var n=[],o=0,i=e.length;o<i;o++)n.push(t.call(r,e[o],o,e));return n}}function I(e,t){var r=o.call(arguments,2);return function(){return e.apply(t,r.concat(o.call(arguments)))}}function R(e){return"[object Array]"===l.call(e)}function P(e){return"function"==typeof e}function x(e){return"[object String]"===l.call(e)}function M(e){var t=typeof e;return"function"===t||!!e&&"object"==t}function k(e){return!!a[l.call(e)]}function A(e){return"object"==typeof e&&"number"==typeof e.nodeType&&"object"==typeof e.ownerDocument}function O(e,t){return null!=e?e:t}function L(e,t,r){return null!=e?e:null!=t?t:r}function D(e){if("number"==typeof e)return[e,e,e,e];var t=e.length;return 2===t?[e[0],e[1],e[0],e[1]]:3===t?[e[0],e[1],e[2],e[1]]:e}i.createCanvas=function(){return document.createElement("canvas")};var N="__ec_primitive__";function B(e){return e[N]}function j(e){e&&C(e,function(e,t){this.set(t,e)},this)}j.prototype={constructor:j,get:function(e){return this["_ec_"+e]},set:function(e,t){return this["_ec_"+e]=t},each:function(e,t){for(var r in void 0!==t&&(e=I(e,t)),this)this.hasOwnProperty(r)&&e(this[r],r.slice(4))},removeKey:function(e){delete this["_ec_"+e]}};var F=(Object.freeze||Object)({$override:function(e,t){i[e]=t},clone:h,merge:m,mergeAll:function(e,t){for(var r=e[0],n=1,o=e.length;n<o;n++)r=m(r,e[n],t);return r},extend:g,defaults:v,createCanvas:b,getContext:_,indexOf:S,inherits:w,mixin:E,isArrayLike:U,each:C,map:T,reduce:function(e,t,r,n){if(e&&t){if(e.reduce&&e.reduce===f)return e.reduce(t,r,n);for(var o=0,i=e.length;o<i;o++)r=t.call(n,r,e[o],o,e);return r}},filter:function(e,t,r){if(e&&t){if(e.filter&&e.filter===u)return e.filter(t,r);for(var n=[],o=0,i=e.length;o<i;o++)t.call(r,e[o],o,e)&&n.push(e[o]);return n}},find:function(e,t,r){if(e&&t)for(var n=0,o=e.length;n<o;n++)if(t.call(r,e[n],n,e))return e[n]},bind:I,curry:function(e){var t=o.call(arguments,1);return function(){return e.apply(this,t.concat(o.call(arguments)))}},isArray:R,isFunction:P,isString:x,isObject:M,isBuiltInObject:k,isDom:A,eqNaN:function(e){return e!=e},retrieve:function(e){for(var t=0,r=arguments.length;t<r;t++)if(null!=arguments[t])return arguments[t]},retrieve2:O,retrieve3:L,slice:function(){return Function.call.apply(o,arguments)},normalizeCssArray:D,assert:function(e,t){if(!e)throw new Error(t)},setAsPrimitive:function(e){e[N]=!0},isPrimitive:B,createHashMap:function(e){return new j(e)},noop:function(){}}),V="undefined"==typeof Float32Array?Array:Float32Array;function q(e,t){var r=new V(2);return null==e&&(e=0),null==t&&(t=0),r[0]=e,r[1]=t,r}function G(e){var t=new V(2);return t[0]=e[0],t[1]=e[1],t}function W(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function H(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function z(e){return Math.sqrt(Q(e))}var Y=z;function Q(e){return e[0]*e[0]+e[1]*e[1]}var K=Q;function J(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function X(e,t){var r=z(t);return 0===r?(e[0]=0,e[1]=0):(e[0]=t[0]/r,e[1]=t[1]/r),e}function $(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}var Z=$;function ee(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var te=ee;function re(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o+r[4],e[1]=r[1]*n+r[3]*o+r[5],e}function ne(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function oe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}var ie=(Object.freeze||Object)({create:q,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},clone:G,set:function(e,t,r){return e[0]=t,e[1]=r,e},add:W,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},sub:H,len:z,length:Y,lenSquare:Q,lengthSquare:K,mul:function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},div:function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},scale:J,normalize:X,distance:$,dist:Z,distanceSquare:ee,distSquare:te,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},lerp:function(e,t,r,n){return e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e},applyTransform:re,min:ne,max:oe});function se(){this.on("mousedown",this._dragStart,this),this.on("mousemove",this._drag,this),this.on("mouseup",this._dragEnd,this),this.on("globalout",this._dragEnd,this)}function ae(e,t){return{target:e,topTarget:t&&t.topTarget}}se.prototype={constructor:se,_dragStart:function(e){var t=e.target;t&&t.draggable&&((this._draggingTarget=t).dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.dispatchToElement(ae(t,e),"dragstart",e.event))},_drag:function(e){var t=this._draggingTarget;if(t){var r=e.offsetX,n=e.offsetY,o=r-this._x,i=n-this._y;this._x=r,this._y=n,t.drift(o,i,e),this.dispatchToElement(ae(t,e),"drag",e.event);var s=this.findHover(r,n,t).target,a=this._dropTarget;t!==(this._dropTarget=s)&&(a&&s!==a&&this.dispatchToElement(ae(a,e),"dragleave",e.event),s&&s!==a&&this.dispatchToElement(ae(s,e),"dragenter",e.event))}},_dragEnd:function(e){var t=this._draggingTarget;t&&(t.dragging=!1),this.dispatchToElement(ae(t,e),"dragend",e.event),this._dropTarget&&this.dispatchToElement(ae(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null}};var ce=Array.prototype.slice,le=function(){this._$handlers={}};le.prototype={constructor:le,one:function(e,t,r){var n=this._$handlers;if(!t||!e)return this;n[e]||(n[e]=[]);for(var o=0;o<n[e].length;o++)if(n[e][o].h===t)return this;return n[e].push({h:t,one:!0,ctx:r||this}),this},on:function(e,t,r){var n=this._$handlers;if(!t||!e)return this;n[e]||(n[e]=[]);for(var o=0;o<n[e].length;o++)if(n[e][o].h===t)return this;return n[e].push({h:t,one:!1,ctx:r||this}),this},isSilent:function(e){var t=this._$handlers;return t[e]&&t[e].length},off:function(e,t){var r=this._$handlers;if(!e)return this._$handlers={},this;if(t){if(r[e]){for(var n=[],o=0,i=r[e].length;o<i;o++)r[e][o].h!=t&&n.push(r[e][o]);r[e]=n}r[e]&&0===r[e].length&&delete r[e]}else delete r[e];return this},trigger:function(e){if(this._$handlers[e]){var t=arguments,r=t.length;3<r&&(t=ce.call(t,1));for(var n=this._$handlers[e],o=n.length,i=0;i<o;){switch(r){case 1:n[i].h.call(n[i].ctx);break;case 2:n[i].h.call(n[i].ctx,t[1]);break;case 3:n[i].h.call(n[i].ctx,t[1],t[2]);break;default:n[i].h.apply(n[i].ctx,t)}n[i].one?(n.splice(i,1),o--):i++}}return this},triggerWithContext:function(e){if(this._$handlers[e]){var t=arguments,r=t.length;4<r&&(t=ce.call(t,1,t.length-1));for(var n=t[t.length-1],o=this._$handlers[e],i=o.length,s=0;s<i;){switch(r){case 1:o[s].h.call(n);break;case 2:o[s].h.call(n,t[1]);break;case 3:o[s].h.call(n,t[1],t[2]);break;default:o[s].h.apply(n,t)}o[s].one?(o.splice(s,1),i--):s++}}return this}};var de="silent";function ue(){}ue.prototype.dispose=function(){};var pe=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],fe=function(e,t,r,n){le.call(this),this.storage=e,this.painter=t,this.painterRoot=n,r=r||new ue,this.proxy=null,this._hovered={},this._lastTouchMoment,this._lastX,this._lastY,se.call(this),this.setHandlerProxy(r)};function he(e,t,r){if(e[e.rectHover?"rectContain":"contain"](t,r)){for(var n,o=e;o;){if(o.clipPath&&!o.clipPath.contain(t,r))return!1;o.silent&&(n=!0),o=o.parent}return!n||de}return!1}fe.prototype={constructor:fe,setHandlerProxy:function(t){this.proxy&&this.proxy.dispose(),t&&(C(pe,function(e){t.on&&t.on(e,this[e],this)},this),t.handler=this),this.proxy=t},mousemove:function(e){var t=e.zrX,r=e.zrY,n=this._hovered,o=n.target;o&&!o.__zr&&(o=(n=this.findHover(n.x,n.y)).target);var i=this._hovered=this.findHover(t,r),s=i.target,a=this.proxy;a.setCursor&&a.setCursor(s?s.cursor:"default"),o&&s!==o&&this.dispatchToElement(n,"mouseout",e),this.dispatchToElement(i,"mousemove",e),s&&s!==o&&this.dispatchToElement(i,"mouseover",e)},mouseout:function(e){this.dispatchToElement(this._hovered,"mouseout",e);for(var t,r=e.toElement||e.relatedTarget;(r=r&&r.parentNode)&&9!=r.nodeType&&!(t=r===this.painterRoot););!t&&this.trigger("globalout",{event:e})},resize:function(e){this._hovered={}},dispatch:function(e,t){var r=this[e];r&&r.call(this,t)},dispose:function(){this.proxy.dispose(),this.storage=this.proxy=this.painter=null},setCursorStyle:function(e){var t=this.proxy;t.setCursor&&t.setCursor(e)},dispatchToElement:function(e,t,r){var n=(e=e||{}).target;if(!n||!n.silent){for(var o,i,s="on"+t,a={type:t,event:i=r,target:(o=e).target,topTarget:o.topTarget,cancelBubble:!1,offsetX:i.zrX,offsetY:i.zrY,gestureEvent:i.gestureEvent,pinchX:i.pinchX,pinchY:i.pinchY,pinchScale:i.pinchScale,wheelDelta:i.zrDelta,zrByTouch:i.zrByTouch,which:i.which};n&&(n[s]&&(a.cancelBubble=n[s].call(n,a)),n.trigger(t,a),n=n.parent,!a.cancelBubble););a.cancelBubble||(this.trigger(t,a),this.painter&&this.painter.eachOtherLayer(function(e){"function"==typeof e[s]&&e[s].call(e,a),e.trigger&&e.trigger(t,a)}))}},findHover:function(e,t,r){for(var n=this.storage.getDisplayList(),o={x:e,y:t},i=n.length-1;0<=i;i--){var s;if(n[i]!==r&&!n[i].ignore&&(s=he(n[i],e,t))&&(!o.topTarget&&(o.topTarget=n[i]),s!==de)){o.target=n[i];break}}return o}},C(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(n){fe.prototype[n]=function(e){var t=this.findHover(e.zrX,e.zrY),r=t.target;if("mousedown"===n)this._downEl=r,this._downPoint=[e.zrX,e.zrY],this._upEl=r;else if("mosueup"===n)this._upEl=r;else if("click"===n){if(this._downEl!==this._upEl||!this._downPoint||4<Z(this._downPoint,[e.zrX,e.zrY]))return;this._downPoint=null}this.dispatchToElement(t,n,e)}}),E(fe,le),E(fe,se);var me="undefined"==typeof Float32Array?Array:Float32Array;function ge(){var e=new me(6);return ve(e),e}function ve(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function ye(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function be(e,t,r){var n=t[0]*r[0]+t[2]*r[1],o=t[1]*r[0]+t[3]*r[1],i=t[0]*r[2]+t[2]*r[3],s=t[1]*r[2]+t[3]*r[3],a=t[0]*r[4]+t[2]*r[5]+t[4],c=t[1]*r[4]+t[3]*r[5]+t[5];return e[0]=n,e[1]=o,e[2]=i,e[3]=s,e[4]=a,e[5]=c,e}function _e(e,t,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+r[0],e[5]=t[5]+r[1],e}function Se(e,t,r){var n=t[0],o=t[2],i=t[4],s=t[1],a=t[3],c=t[5],l=Math.sin(r),d=Math.cos(r);return e[0]=n*d+s*l,e[1]=-n*l+s*d,e[2]=o*d+a*l,e[3]=-o*l+d*a,e[4]=d*i+l*c,e[5]=d*c-l*i,e}function we(e,t,r){var n=r[0],o=r[1];return e[0]=t[0]*n,e[1]=t[1]*o,e[2]=t[2]*n,e[3]=t[3]*o,e[4]=t[4]*n,e[5]=t[5]*o,e}function Ee(e,t){var r=t[0],n=t[2],o=t[4],i=t[1],s=t[3],a=t[5],c=r*s-i*n;return c?(c=1/c,e[0]=s*c,e[1]=-i*c,e[2]=-n*c,e[3]=r*c,e[4]=(n*a-s*o)*c,e[5]=(i*o-r*a)*c,e):null}var Ce=(Object.freeze||Object)({create:ge,identity:ve,copy:ye,mul:be,translate:_e,rotate:Se,scale:we,invert:Ee}),Te=ve;function Ie(e){return 5e-5<e||e<-5e-5}var Re=function(e){(e=e||{}).position||(this.position=[0,0]),null==e.rotation&&(this.rotation=0),e.scale||(this.scale=[1,1]),this.origin=this.origin||null},Pe=Re.prototype;Pe.transform=null,Pe.needLocalTransform=function(){return Ie(this.rotation)||Ie(this.position[0])||Ie(this.position[1])||Ie(this.scale[0]-1)||Ie(this.scale[1]-1)},Pe.updateTransform=function(){var e=this.parent,t=e&&e.transform,r=this.needLocalTransform(),n=this.transform;r||t?(n=n||ge(),r?this.getLocalTransform(n):Te(n),t&&(r?be(n,e.transform,n):ye(n,e.transform)),this.transform=n,this.invTransform=this.invTransform||ge(),Ee(this.invTransform,n)):n&&Te(n)},Pe.getLocalTransform=function(e){return Re.getLocalTransform(this,e)},Pe.setTransform=function(e){var t=this.transform,r=e.dpr||1;t?e.setTransform(r*t[0],r*t[1],r*t[2],r*t[3],r*t[4],r*t[5]):e.setTransform(r,0,0,r,0,0)},Pe.restoreTransform=function(e){var t=e.dpr||1;e.setTransform(t,0,0,t,0,0)};var xe=[];Pe.decomposeTransform=function(){if(this.transform){var e=this.parent,t=this.transform;e&&e.transform&&(be(xe,e.invTransform,t),t=xe);var r=t[0]*t[0]+t[1]*t[1],n=t[2]*t[2]+t[3]*t[3],o=this.position,i=this.scale;Ie(r-1)&&(r=Math.sqrt(r)),Ie(n-1)&&(n=Math.sqrt(n)),t[0]<0&&(r=-r),t[3]<0&&(n=-n),o[0]=t[4],o[1]=t[5],i[0]=r,i[1]=n,this.rotation=Math.atan2(-t[1]/n,t[0]/r)}},Pe.getGlobalScale=function(){var e=this.transform;if(!e)return[1,1];var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]),r=Math.sqrt(e[2]*e[2]+e[3]*e[3]);return e[0]<0&&(t=-t),e[3]<0&&(r=-r),[t,r]},Pe.transformCoordToLocal=function(e,t){var r=[e,t],n=this.invTransform;return n&&re(r,r,n),r},Pe.transformCoordToGlobal=function(e,t){var r=[e,t],n=this.transform;return n&&re(r,r,n),r},Re.getLocalTransform=function(e,t){Te(t=t||[]);var r=e.origin,n=e.scale||[1,1],o=e.rotation||0,i=e.position||[0,0];return r&&(t[4]-=r[0],t[5]-=r[1]),we(t,t,n),o&&Se(t,t,o),r&&(t[4]+=r[0],t[5]+=r[1]),t[4]+=i[0],t[5]+=i[1],t};var Me={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return 0===e?0:Math.pow(1024,e-1)},exponentialOut:function(e){return 1===e?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},elasticOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},elasticInOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),(e*=2)<1?r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:r*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)},backIn:function(e){return e*e*(2.70158*e-1.70158)},backOut:function(e){return--e*e*(2.70158*e+1.70158)+1},backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:function(e){return 1-Me.bounceOut(1-e)},bounceOut:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bounceInOut:function(e){return e<.5?.5*Me.bounceIn(2*e):.5*Me.bounceOut(2*e-1)+.5}};function ke(e){this._target=e.target,this._life=e.life||1e3,this._delay=e.delay||0,this._initialized=!1,this.loop=null!=e.loop&&e.loop,this.gap=e.gap||0,this.easing=e.easing||"Linear",this.onframe=e.onframe,this.ondestroy=e.ondestroy,this.onrestart=e.onrestart,this._pausedTime=0,this._paused=!1}ke.prototype={constructor:ke,step:function(e,t){if(this._initialized||(this._startTime=e+this._delay,this._initialized=!0),this._paused)this._pausedTime+=t;else{var r=(e-this._startTime-this._pausedTime)/this._life;if(!(r<0)){r=Math.min(r,1);var n=this.easing,o="string"==typeof n?Me[n]:n,i="function"==typeof o?o(r):r;return this.fire("frame",i),1==r?this.loop?(this.restart(e),"restart"):(this._needsRemove=!0,"destroy"):null}}},restart:function(e){var t=(e-this._startTime-this._pausedTime)%this._life;this._startTime=e-t+this.gap,this._pausedTime=0,this._needsRemove=!1},fire:function(e,t){this[e="on"+e]&&this[e](this._target,t)},pause:function(){this._paused=!0},resume:function(){this._paused=!1}};var Ae=function(){this.head=null,this.tail=null,this._len=0},Oe=Ae.prototype;Oe.insert=function(e){var t=new Ue(e);return this.insertEntry(t),t},Oe.insertEntry=function(e){this.head?((this.tail.next=e).prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},Oe.remove=function(e){var t=e.prev,r=e.next;t?t.next=r:this.head=r,r?r.prev=t:this.tail=t,e.next=e.prev=null,this._len--},Oe.len=function(){return this._len},Oe.clear=function(){this.head=this.tail=null,this._len=0};var Ue=function(e){this.value=e,this.next,this.prev},Le=function(e){this._list=new Ae,this._map={},this._maxSize=e||10,this._lastRemovedEntry=null},De=Le.prototype;De.put=function(e,t){var r=this._list,n=this._map,o=null;if(null==n[e]){var i=r.len(),s=this._lastRemovedEntry;if(i>=this._maxSize&&0<i){var a=r.head;r.remove(a),delete n[a.key],o=a.value,this._lastRemovedEntry=a}s?s.value=t:s=new Ue(t),s.key=e,r.insertEntry(s),n[e]=s}return o},De.get=function(e){var t=this._map[e],r=this._list;if(null!=t)return t!==r.tail&&(r.remove(t),r.insertEntry(t)),t.value},De.clear=function(){this._list.clear(),this._map={}};var Ne={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Be(e){return(e=Math.round(e))<0?0:255<e?255:e}function je(e){return e<0?0:1<e?1:e}function Fe(e){return e.length&&"%"===e.charAt(e.length-1)?Be(parseFloat(e)/100*255):Be(parseInt(e,10))}function Ve(e){return e.length&&"%"===e.charAt(e.length-1)?je(parseFloat(e)/100):je(parseFloat(e))}function qe(e,t,r){return r<0?r+=1:1<r&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function Ge(e,t,r){return e+(t-e)*r}function We(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e}function He(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}var ze=new Le(20),Ye=null;function Qe(e,t){Ye&&He(Ye,t),Ye=ze.put(e,Ye||t.slice())}function Ke(e,t){if(e){t=t||[];var r=ze.get(e);if(r)return He(t,r);var n,o=(e+="").replace(/ /g,"").toLowerCase();if(o in Ne)return He(t,Ne[o]),Qe(e,t),t;if("#"===o.charAt(0))return 4===o.length?0<=(n=parseInt(o.substr(1),16))&&n<=4095?(We(t,(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1),Qe(e,t),t):void We(t,0,0,0,1):7===o.length?0<=(n=parseInt(o.substr(1),16))&&n<=16777215?(We(t,(16711680&n)>>16,(65280&n)>>8,255&n,1),Qe(e,t),t):void We(t,0,0,0,1):void 0;var i=o.indexOf("("),s=o.indexOf(")");if(-1!==i&&s+1===o.length){var a=o.substr(0,i),c=o.substr(i+1,s-(i+1)).split(","),l=1;switch(a){case"rgba":if(4!==c.length)return void We(t,0,0,0,1);l=Ve(c.pop());case"rgb":return 3!==c.length?void We(t,0,0,0,1):(We(t,Fe(c[0]),Fe(c[1]),Fe(c[2]),l),Qe(e,t),t);case"hsla":return 4!==c.length?void We(t,0,0,0,1):(c[3]=Ve(c[3]),Je(c,t),Qe(e,t),t);case"hsl":return 3!==c.length?void We(t,0,0,0,1):(Je(c,t),Qe(e,t),t);default:return}}We(t,0,0,0,1)}}function Je(e,t){var r=(parseFloat(e[0])%360+360)%360/360,n=Ve(e[1]),o=Ve(e[2]),i=o<=.5?o*(n+1):o+n-o*n,s=2*o-i;return We(t=t||[],Be(255*qe(s,i,r+1/3)),Be(255*qe(s,i,r)),Be(255*qe(s,i,r-1/3)),1),4===e.length&&(t[3]=e[3]),t}function Xe(e,t,r){if(t&&t.length&&0<=e&&e<=1){r=r||[];var n=e*(t.length-1),o=Math.floor(n),i=Math.ceil(n),s=t[o],a=t[i],c=n-o;return r[0]=Be(Ge(s[0],a[0],c)),r[1]=Be(Ge(s[1],a[1],c)),r[2]=Be(Ge(s[2],a[2],c)),r[3]=je(Ge(s[3],a[3],c)),r}}var $e=Xe;function Ze(e,t,r){if(t&&t.length&&0<=e&&e<=1){var n=e*(t.length-1),o=Math.floor(n),i=Math.ceil(n),s=Ke(t[o]),a=Ke(t[i]),c=n-o,l=tt([Be(Ge(s[0],a[0],c)),Be(Ge(s[1],a[1],c)),Be(Ge(s[2],a[2],c)),je(Ge(s[3],a[3],c))],"rgba");return r?{color:l,leftIndex:o,rightIndex:i,value:n}:l}}var et=Ze;function tt(e,t){if(e&&e.length){var r=e[0]+","+e[1]+","+e[2];return"rgba"!==t&&"hsva"!==t&&"hsla"!==t||(r+=","+e[3]),t+"("+r+")"}}var rt=(Object.freeze||Object)({parse:Ke,lift:function(e,t){var r=Ke(e);if(r){for(var n=0;n<3;n++)r[n]=t<0?r[n]*(1-t)|0:(255-r[n])*t+r[n]|0;return tt(r,4===r.length?"rgba":"rgb")}},toHex:function(e){var t=Ke(e);if(t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)},fastLerp:Xe,fastMapToColor:$e,lerp:Ze,mapToColor:et,modifyHSL:function(e,t,r,n){if(e=Ke(e))return e=function(e){if(e){var t,r,n=e[0]/255,o=e[1]/255,i=e[2]/255,s=Math.min(n,o,i),a=Math.max(n,o,i),c=a-s,l=(a+s)/2;if(0===c)r=t=0;else{r=l<.5?c/(a+s):c/(2-a-s);var d=((a-n)/6+c/2)/c,u=((a-o)/6+c/2)/c,p=((a-i)/6+c/2)/c;n===a?t=p-u:o===a?t=1/3+d-p:i===a&&(t=2/3+u-d),t<0&&(t+=1),1<t&&(t-=1)}var f=[360*t,r,l];return null!=e[3]&&f.push(e[3]),f}}(e),null!=t&&(e[0]=(o=t,(o=Math.round(o))<0?0:360<o?360:o)),null!=r&&(e[1]=Ve(r)),null!=n&&(e[2]=Ve(n)),tt(Je(e),"rgba");var o},modifyAlpha:function(e,t){if((e=Ke(e))&&null!=t)return e[3]=je(t),tt(e,"rgba")},stringify:tt}),nt=Array.prototype.slice;function ot(e,t){return e[t]}function it(e,t,r){e[t]=r}function st(e,t,r){return(t-e)*r+e}function at(e,t,r){return.5<r?t:e}function ct(e,t,r,n,o){var i=e.length;if(1==o)for(var s=0;s<i;s++)n[s]=st(e[s],t[s],r);else{var a=i&&e[0].length;for(s=0;s<i;s++)for(var c=0;c<a;c++)n[s][c]=st(e[s][c],t[s][c],r)}}function lt(e,t,r){var n=e.length,o=t.length;if(n!==o)if(o<n)e.length=o;else for(var i=n;i<o;i++)e.push(1===r?t[i]:nt.call(t[i]));var s=e[0]&&e[0].length;for(i=0;i<e.length;i++)if(1===r)isNaN(e[i])&&(e[i]=t[i]);else for(var a=0;a<s;a++)isNaN(e[i][a])&&(e[i][a]=t[i][a])}function dt(e,t,r){if(e===t)return!0;var n=e.length;if(n!==t.length)return!1;if(1===r){for(var o=0;o<n;o++)if(e[o]!==t[o])return!1}else{var i=e[0].length;for(o=0;o<n;o++)for(var s=0;s<i;s++)if(e[o][s]!==t[o][s])return!1}return!0}function ut(e,t,r,n,o,i,s,a,c){var l=e.length;if(1==c)for(var d=0;d<l;d++)a[d]=pt(e[d],t[d],r[d],n[d],o,i,s);else{var u=e[0].length;for(d=0;d<l;d++)for(var p=0;p<u;p++)a[d][p]=pt(e[d][p],t[d][p],r[d][p],n[d][p],o,i,s)}}function pt(e,t,r,n,o,i,s){var a=.5*(r-e),c=.5*(n-t);return(2*(t-r)+a+c)*s+(-3*(t-r)-2*a-c)*i+a*o+t}function ft(e){if(U(e)){var t=e.length;if(U(e[0])){for(var r=[],n=0;n<t;n++)r.push(nt.call(e[n]));return r}return nt.call(e)}return e}function ht(e){return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.floor(e[2]),"rgba("+e.join(",")+")"}function mt(e,t,r,n,i,o){var s=e._getter,a=e._setter,c="spline"===t,l=n.length;if(l){var d,u,p,f=U(n[0].value),h=!1,m=!1,g=f?U((u=(d=n)[d.length-1].value)&&u[0])?2:1:0;n.sort(function(e,t){return e.time-t.time}),p=n[l-1].time;for(var v=[],y=[],b=n[0].value,_=!0,S=0;S<l;S++){v.push(n[S].time/p);var w=n[S].value;if(f&&dt(w,b,g)||!f&&w===b||(_=!1),"string"==typeof(b=w)){var E=Ke(w);E?(w=E,h=!0):m=!0}y.push(w)}if(o||!_){var C=y[l-1];for(S=0;S<l-1;S++)f?lt(y[S],C,g):!isNaN(y[S])||isNaN(C)||m||h||(y[S]=C);f&&lt(s(e._target,i),C,g);var T,I,R,P,x,M=0,k=0;if(h)var A=[0,0,0,0];var O=new ke({target:e._target,life:p,loop:e._loop,delay:e._delay,onframe:function(e,t){var r;if(t<0)r=0;else if(t<k){for(r=Math.min(M+1,l-1);0<=r&&!(v[r]<=t);r--);r=Math.min(r,l-2)}else{for(r=M;r<l&&!(v[r]>t);r++);r=Math.min(r-1,l-2)}k=t;var n=v[(M=r)+1]-v[r];if(0!==n)if(T=(t-v[r])/n,c)if(R=y[r],I=y[0===r?r:r-1],P=y[l-2<r?l-1:r+1],x=y[l-3<r?l-1:r+2],f)ut(I,R,P,x,T,T*T,T*T*T,s(e,i),g);else{if(h)o=ut(I,R,P,x,T,T*T,T*T*T,A,1),o=ht(A);else{if(m)return at(R,P,T);o=pt(I,R,P,x,T,T*T,T*T*T)}a(e,i,o)}else if(f)ct(y[r],y[r+1],T,s(e,i),g);else{var o;if(h)ct(y[r],y[r+1],T,A,1),o=ht(A);else{if(m)return at(y[r],y[r+1],T);o=st(y[r],y[r+1],T)}a(e,i,o)}},ondestroy:r});return t&&"spline"!==t&&(O.easing=t),O}}}var gt=function(e,t,r,n){this._tracks={},this._target=e,this._loop=t||!1,this._getter=r||ot,this._setter=n||it,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};gt.prototype={when:function(e,t){var r=this._tracks;for(var n in t)if(t.hasOwnProperty(n)){if(!r[n]){r[n]=[];var o=this._getter(this._target,n);if(null==o)continue;0!==e&&r[n].push({time:0,value:ft(o)})}r[n].push({time:e,value:t[n]})}return this},during:function(e){return this._onframeList.push(e),this},pause:function(){for(var e=0;e<this._clipList.length;e++)this._clipList[e].pause();this._paused=!0},resume:function(){for(var e=0;e<this._clipList.length;e++)this._clipList[e].resume();this._paused=!1},isPaused:function(){return!!this._paused},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var e=this._doneList,t=e.length,r=0;r<t;r++)e[r].call(this)},start:function(e,t){var r,n=this,o=0,i=function(){--o||n._doneCallback()};for(var s in this._tracks)if(this._tracks.hasOwnProperty(s)){var a=mt(this,e,i,this._tracks[s],s,t);a&&(this._clipList.push(a),o++,this.animation&&this.animation.addClip(a),r=a)}if(r){var c=r.onframe;r.onframe=function(e,t){c(e,t);for(var r=0;r<n._onframeList.length;r++)n._onframeList[r](e,t)}}return o||this._doneCallback(),this},stop:function(e){for(var t=this._clipList,r=this.animation,n=0;n<t.length;n++){var o=t[n];e&&o.onframe(this._target,1),r&&r.removeClip(o)}t.length=0},delay:function(e){return this._delay=e,this},done:function(e){return e&&this._doneList.push(e),this},getClips:function(){return this._clipList}};var vt=1;"undefined"!=typeof window&&(vt=Math.max(window.devicePixelRatio||1,1));var yt=vt,bt=function(){};var _t=bt,St=function(){this.animators=[]};St.prototype={constructor:St,animate:function(e,t){var r,n=!1,o=this,i=this.__zr;if(e){var s=e.split("."),a=o;n="shape"===s[0];for(var c=0,l=s.length;c<l;c++)a&&(a=a[s[c]]);a&&(r=a)}else r=o;if(r){var d=o.animators,u=new gt(r,t);return u.during(function(e){o.dirty(n)}).done(function(){d.splice(S(d,u),1)}),d.push(u),i&&i.animation.addAnimator(u),u}_t('Property "'+e+'" is not existed in element '+o.id)},stopAnimation:function(e){for(var t=this.animators,r=t.length,n=0;n<r;n++)t[n].stop(e);return t.length=0,this},animateTo:function(e,t,r,n,o,i){x(r)?(o=n,n=r,r=0):P(n)?(o=n,n="linear",r=0):P(r)?(o=r,r=0):P(t)?(o=t,t=500):t||(t=500),this.stopAnimation(),this._animateToShallow("",this,e,t,r);var s=this.animators.slice(),a=s.length;function c(){--a||o&&o()}a||o&&o();for(var l=0;l<s.length;l++)s[l].done(c).start(n,i)},_animateToShallow:function(e,t,r,n,o){var i={},s=0;for(var a in r)if(r.hasOwnProperty(a))if(null!=t[a])M(r[a])&&!U(r[a])?this._animateToShallow(e?e+"."+a:a,t[a],r[a],n,o):(i[a]=r[a],s++);else if(null!=r[a])if(e){var c={};c[e]={},c[e][a]=r[a],this.attr(c)}else this.attr(a,r[a]);return 0<s&&this.animate(e,!1).when(null==n?500:n,i).delay(o||0),this}};var wt=function(e){Re.call(this,e),le.call(this,e),St.call(this,e),this.id=e.id||n()};wt.prototype={type:"element",name:"",__zr:null,ignore:!1,clipPath:null,isGroup:!1,drift:function(e,t){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0}var r=this.transform;r||(r=this.transform=[1,0,0,1,0,0]),r[4]+=e,r[5]+=t,this.decomposeTransform(),this.dirty(!1)},beforeUpdate:function(){},afterUpdate:function(){},update:function(){this.updateTransform()},traverse:function(e,t){},attrKV:function(e,t){if("position"===e||"scale"===e||"origin"===e){if(t){var r=this[e];r||(r=this[e]=[]),r[0]=t[0],r[1]=t[1]}}else this[e]=t},hide:function(){this.ignore=!0,this.__zr&&this.__zr.refresh()},show:function(){this.ignore=!1,this.__zr&&this.__zr.refresh()},attr:function(e,t){if("string"==typeof e)this.attrKV(e,t);else if(M(e))for(var r in e)e.hasOwnProperty(r)&&this.attrKV(r,e[r]);return this.dirty(!1),this},setClipPath:function(e){var t=this.__zr;t&&e.addSelfToZr(t),this.clipPath&&this.clipPath!==e&&this.removeClipPath(),(this.clipPath=e).__zr=t,(e.__clipTarget=this).dirty(!1)},removeClipPath:function(){var e=this.clipPath;e&&(e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__clipTarget=null,this.clipPath=null,this.dirty(!1))},addSelfToZr:function(e){this.__zr=e;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.addAnimator(t[r]);this.clipPath&&this.clipPath.addSelfToZr(e)},removeSelfFromZr:function(e){this.__zr=null;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.removeAnimator(t[r]);this.clipPath&&this.clipPath.removeSelfFromZr(e)}},E(wt,St),E(wt,Re),E(wt,le);var Et,Ct,Tt,It,Rt=re,Pt=Math.min,xt=Math.max;function Mt(e,t,r,n){r<0&&(e+=r,r=-r),n<0&&(t+=n,n=-n),this.x=e,this.y=t,this.width=r,this.height=n}Mt.prototype={constructor:Mt,union:function(e){var t=Pt(e.x,this.x),r=Pt(e.y,this.y);this.width=xt(e.x+e.width,this.x+this.width)-t,this.height=xt(e.y+e.height,this.y+this.height)-r,this.x=t,this.y=r},applyTransform:(Et=[],Ct=[],Tt=[],It=[],function(e){if(e){Et[0]=Tt[0]=this.x,Et[1]=It[1]=this.y,Ct[0]=It[0]=this.x+this.width,Ct[1]=Tt[1]=this.y+this.height,Rt(Et,Et,e),Rt(Ct,Ct,e),Rt(Tt,Tt,e),Rt(It,It,e),this.x=Pt(Et[0],Ct[0],Tt[0],It[0]),this.y=Pt(Et[1],Ct[1],Tt[1],It[1]);var t=xt(Et[0],Ct[0],Tt[0],It[0]),r=xt(Et[1],Ct[1],Tt[1],It[1]);this.width=t-this.x,this.height=r-this.y}}),calculateTransform:function(e){var t=e.width/this.width,r=e.height/this.height,n=ge();return _e(n,n,[-this.x,-this.y]),we(n,n,[t,r]),_e(n,n,[e.x,e.y]),n},intersect:function(e){if(!e)return!1;e instanceof Mt||(e=Mt.create(e));var t=this.x,r=this.x+this.width,n=this.y,o=this.y+this.height,i=e.x,s=e.x+e.width,a=e.y,c=e.y+e.height;return!(r<i||s<t||o<a||c<n)},contain:function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height},clone:function(){return new Mt(this.x,this.y,this.width,this.height)},copy:function(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}};var kt=function(e){for(var t in e=e||{},wt.call(this,e),e)e.hasOwnProperty(t)&&(this[t]=e[t]);this._children=[],this.__storage=null,this.__dirty=!0};kt.prototype={constructor:kt,isGroup:!0,type:"group",silent:!(Mt.create=function(e){return new Mt(e.x,e.y,e.width,e.height)}),children:function(){return this._children.slice()},childAt:function(e){return this._children[e]},childOfName:function(e){for(var t=this._children,r=0;r<t.length;r++)if(t[r].name===e)return t[r]},childCount:function(){return this._children.length},add:function(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this},addBefore:function(e,t){if(e&&e!==this&&e.parent!==this&&t&&t.parent===this){var r=this._children,n=r.indexOf(t);0<=n&&(r.splice(n,0,e),this._doAdd(e))}return this},_doAdd:function(e){e.parent&&e.parent.remove(e);var t=(e.parent=this).__storage,r=this.__zr;t&&t!==e.__storage&&(t.addToStorage(e),e instanceof kt&&e.addChildrenToStorage(t)),r&&r.refresh()},remove:function(e){var t=this.__zr,r=this.__storage,n=this._children,o=S(n,e);return o<0||(n.splice(o,1),e.parent=null,r&&(r.delFromStorage(e),e instanceof kt&&e.delChildrenFromStorage(r)),t&&t.refresh()),this},removeAll:function(){var e,t,r=this._children,n=this.__storage;for(t=0;t<r.length;t++)e=r[t],n&&(n.delFromStorage(e),e instanceof kt&&e.delChildrenFromStorage(n)),e.parent=null;return r.length=0,this},eachChild:function(e,t){for(var r=this._children,n=0;n<r.length;n++){var o=r[n];e.call(t,o,n)}return this},traverse:function(e,t){for(var r=0;r<this._children.length;r++){var n=this._children[r];e.call(t,n),"group"===n.type&&n.traverse(e,t)}return this},addChildrenToStorage:function(e){for(var t=0;t<this._children.length;t++){var r=this._children[t];e.addToStorage(r),r instanceof kt&&r.addChildrenToStorage(e)}},delChildrenFromStorage:function(e){for(var t=0;t<this._children.length;t++){var r=this._children[t];e.delFromStorage(r),r instanceof kt&&r.delChildrenFromStorage(e)}},dirty:function(){return this.__dirty=!0,this.__zr&&this.__zr.refresh(),this},getBoundingRect:function(e){for(var t=null,r=new Mt(0,0,0,0),n=e||this._children,o=[],i=0;i<n.length;i++){var s=n[i];if(!s.ignore&&!s.invisible){var a=s.getBoundingRect(),c=s.getLocalTransform(o);c?(r.copy(a),r.applyTransform(c),(t=t||r.clone()).union(r)):(t=t||a.clone()).union(a)}}return t||r}},w(kt,wt);var At=32,Ot=7;function Ut(e,t,r,n){var o=t+1;if(o===r)return 1;if(n(e[o++],e[t])<0){for(;o<r&&n(e[o],e[o-1])<0;)o++;!function(e,t,r){r--;for(;t<r;){var n=e[t];e[t++]=e[r],e[r--]=n}}(e,t,o)}else for(;o<r&&0<=n(e[o],e[o-1]);)o++;return o-t}function Lt(e,t,r,n,o){for(n===t&&n++;n<r;n++){for(var i,s=e[n],a=t,c=n;a<c;)o(s,e[i=a+c>>>1])<0?c=i:a=i+1;var l=n-a;switch(l){case 3:e[a+3]=e[a+2];case 2:e[a+2]=e[a+1];case 1:e[a+1]=e[a];break;default:for(;0<l;)e[a+l]=e[a+l-1],l--}e[a]=s}}function Dt(e,t,r,n,o,i){var s=0,a=0,c=1;if(0<i(e,t[r+o])){for(a=n-o;c<a&&0<i(e,t[r+o+c]);)(c=1+((s=c)<<1))<=0&&(c=a);a<c&&(c=a),s+=o,c+=o}else{for(a=o+1;c<a&&i(e,t[r+o-c])<=0;)(c=1+((s=c)<<1))<=0&&(c=a);a<c&&(c=a);var l=s;s=o-c,c=o-l}for(s++;s<c;){var d=s+(c-s>>>1);0<i(e,t[r+d])?s=d+1:c=d}return c}function Nt(e,t,r,n,o,i){var s=0,a=0,c=1;if(i(e,t[r+o])<0){for(a=o+1;c<a&&i(e,t[r+o-c])<0;)(c=1+((s=c)<<1))<=0&&(c=a);a<c&&(c=a);var l=s;s=o-c,c=o-l}else{for(a=n-o;c<a&&0<=i(e,t[r+o+c]);)(c=1+((s=c)<<1))<=0&&(c=a);a<c&&(c=a),s+=o,c+=o}for(s++;s<c;){var d=s+(c-s>>>1);i(e,t[r+d])<0?c=d:s=d+1}return c}function Bt(h,m){var s,a,g=Ot,c=0,v=[];function t(e){var t=s[e],r=a[e],n=s[e+1],o=a[e+1];a[e]=r+o,e===c-3&&(s[e+1]=s[e+2],a[e+1]=a[e+2]),c--;var i=Nt(h[n],h,t,r,0,m);t+=i,0!==(r-=i)&&0!==(o=Dt(h[t+r-1],h,n,o,o-1,m))&&(r<=o?function(e,t,r,n){var o=0;for(o=0;o<t;o++)v[o]=h[e+o];var i=0,s=r,a=e;if(h[a++]=h[s++],0==--n){for(o=0;o<t;o++)h[a+o]=v[i+o];return}if(1===t){for(o=0;o<n;o++)h[a+o]=h[s+o];return h[a+n]=v[i]}var c,l,d,u=g;for(;;){l=c=0,d=!1;do{if(m(h[s],v[i])<0){if(h[a++]=h[s++],l++,(c=0)==--n){d=!0;break}}else if(h[a++]=v[i++],c++,l=0,1==--t){d=!0;break}}while((c|l)<u);if(d)break;do{if(0!==(c=Nt(h[s],v,i,t,0,m))){for(o=0;o<c;o++)h[a+o]=v[i+o];if(a+=c,i+=c,(t-=c)<=1){d=!0;break}}if(h[a++]=h[s++],0==--n){d=!0;break}if(0!==(l=Dt(v[i],h,s,n,0,m))){for(o=0;o<l;o++)h[a+o]=h[s+o];if(a+=l,s+=l,0===(n-=l)){d=!0;break}}if(h[a++]=v[i++],1==--t){d=!0;break}u--}while(Ot<=c||Ot<=l);if(d)break;u<0&&(u=0),u+=2}if((g=u)<1&&(g=1),1===t){for(o=0;o<n;o++)h[a+o]=h[s+o];h[a+n]=v[i]}else{if(0===t)throw new Error;for(o=0;o<t;o++)h[a+o]=v[i+o]}}(t,r,n,o):function(e,t,r,n){var o=0;for(o=0;o<n;o++)v[o]=h[r+o];var i=e+t-1,s=n-1,a=r+n-1,c=0,l=0;if(h[a--]=h[i--],0==--t){for(c=a-(n-1),o=0;o<n;o++)h[c+o]=v[o];return}if(1===n){for(l=(a-=t)+1,c=(i-=t)+1,o=t-1;0<=o;o--)h[l+o]=h[c+o];return h[a]=v[s]}var d=g;for(;;){var u=0,p=0,f=!1;do{if(m(v[s],h[i])<0){if(h[a--]=h[i--],u++,(p=0)==--t){f=!0;break}}else if(h[a--]=v[s--],p++,u=0,1==--n){f=!0;break}}while((u|p)<d);if(f)break;do{if(0!==(u=t-Nt(v[s],h,e,t,t-1,m))){for(t-=u,l=(a-=u)+1,c=(i-=u)+1,o=u-1;0<=o;o--)h[l+o]=h[c+o];if(0===t){f=!0;break}}if(h[a--]=v[s--],1==--n){f=!0;break}if(0!==(p=n-Dt(h[i],v,0,n,n-1,m))){for(n-=p,l=(a-=p)+1,c=(s-=p)+1,o=0;o<p;o++)h[l+o]=v[c+o];if(n<=1){f=!0;break}}if(h[a--]=h[i--],0==--t){f=!0;break}d--}while(Ot<=u||Ot<=p);if(f)break;d<0&&(d=0),d+=2}(g=d)<1&&(g=1);if(1===n){for(l=(a-=t)+1,c=(i-=t)+1,o=t-1;0<=o;o--)h[l+o]=h[c+o];h[a]=v[s]}else{if(0===n)throw new Error;for(c=a-(n-1),o=0;o<n;o++)h[c+o]=v[o]}}(t,r,n,o))}s=[],a=[],this.mergeRuns=function(){for(;1<c;){var e=c-2;if(1<=e&&a[e-1]<=a[e]+a[e+1]||2<=e&&a[e-2]<=a[e]+a[e-1])a[e-1]<a[e+1]&&e--;else if(a[e]>a[e+1])break;t(e)}},this.forceMergeRuns=function(){for(;1<c;){var e=c-2;0<e&&a[e-1]<a[e+1]&&e--,t(e)}},this.pushRun=function(e,t){s[c]=e,a[c]=t,c+=1}}function jt(e,t,r,n){r||(r=0),n||(n=e.length);var o=n-r;if(!(o<2)){var i=0;if(o<At)Lt(e,r,n,r+(i=Ut(e,r,n,t)),t);else{var s=new Bt(e,t),a=function(e){for(var t=0;At<=e;)t|=1&e,e>>=1;return e+t}(o);do{if((i=Ut(e,r,n,t))<a){var c=o;a<c&&(c=a),Lt(e,r,r+c,r+i,t),i=c}s.pushRun(r,i),s.mergeRuns(),o-=i,r+=i}while(0!==o);s.forceMergeRuns()}}}function Ft(e,t){return e.zlevel===t.zlevel?e.z===t.z?e.z2-t.z2:e.z-t.z:e.zlevel-t.zlevel}var Vt=function(){this._roots=[],this._displayList=[],this._displayListLen=0};Vt.prototype={constructor:Vt,_needsUpdateList:!0,traverse:function(e,t){for(var r=0;r<this._roots.length;r++)this._roots[r].traverse(e,t)},getDisplayList:function(e,t){return t=t||!1,e&&this.updateDisplayList(t),this._displayList},updateDisplayList:function(e){this._needsUpdateList&&(this._displayListLen=0);for(var t=this._roots,r=this._displayList,n=0,o=t.length;n<o;n++)this._updateAndAddDisplayable(t[n],null,e);this._needsUpdateList&&(r.length=this._displayListLen),d.canvasSupported&&jt(r,Ft),this._needsUpdateList=!1},_updateAndAddDisplayable:function(e,t,r){if(!e.ignore||r){e.beforeUpdate(),e.__dirty&&e.update(),e.afterUpdate();var n=e.clipPath;if(n){t=t?t.slice():[];for(var o=n,i=e;o;)o.parent=i,o.updateTransform(),t.push(o),o=(i=o).clipPath}if(e.isGroup){for(var s=e._children,a=0;a<s.length;a++){var c=s[a];e.__dirty&&(c.__dirty=!0),this._updateAndAddDisplayable(c,t,r)}e.__dirty=!1}else e.__clipPaths=t,this._needsUpdateList&&(this._displayList[this._displayListLen++]=e)}},addRoot:function(e){e.__storage!==this&&(e instanceof kt&&e.addChildrenToStorage(this),this.addToStorage(e),this._roots.push(e))},delRoot:function(e){if(null==e){for(var t=0;t<this._roots.length;t++){var r=this._roots[t];r instanceof kt&&r.delChildrenFromStorage(this)}return this._roots=[],this._displayList=[],void(this._displayListLen=0)}if(e instanceof Array){t=0;for(var n=e.length;t<n;t++)this.delRoot(e[t])}else{var o=S(this._roots,e);0<=o&&(this.delFromStorage(e),this._roots.splice(o,1),e instanceof kt&&e.delChildrenFromStorage(this))}},addToStorage:function(e){return e&&(e.__storage=this,e.dirty(!1),this._needsUpdateList=!0),this},delFromStorage:function(e){return e&&(e.__storage=null,this._needsUpdateList=!0),this},dispose:function(){this._renderList=this._roots=null},displayableSortFunc:Ft};var qt={shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,textShadowBlur:1,textShadowOffsetX:1,textShadowOffsetY:1,textBoxShadowBlur:1,textBoxShadowOffsetX:1,textBoxShadowOffsetY:1},Gt=function(e,t,r){return qt.hasOwnProperty(t)?r*e.dpr:r},Wt=[["shadowBlur",0],["shadowOffsetX",0],["shadowOffsetY",0],["shadowColor","#000"],["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]],Ht=function(e,t){this.extendFrom(e,!1),this.host=t};function zt(e,t,r){var n=null==t.x?0:t.x,o=null==t.x2?1:t.x2,i=null==t.y?0:t.y,s=null==t.y2?0:t.y2;return t.global||(n=n*r.width+r.x,o=o*r.width+r.x,i=i*r.height+r.y,s=s*r.height+r.y),e.createLinearGradient(n,i,o,s)}function Yt(e,t,r){var n=r.width,o=r.height,i=Math.min(n,o),s=null==t.x?.5:t.x,a=null==t.y?.5:t.y,c=null==t.r?.5:t.r;return t.global||(s=s*n+r.x,a=a*o+r.y,c*=i),e.createRadialGradient(s,a,0,s,a,c)}Ht.prototype={constructor:Ht,host:null,fill:"#000",stroke:null,opacity:1,lineDash:null,lineDashOffset:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineWidth:1,strokeNoScale:!1,text:null,font:null,textFont:null,fontStyle:null,fontWeight:null,fontSize:null,fontFamily:null,textTag:null,textFill:"#000",textStroke:null,textWidth:null,textHeight:null,textStrokeWidth:0,textLineHeight:null,textPosition:"inside",textRect:null,textOffset:null,textAlign:null,textVerticalAlign:null,textDistance:5,textShadowColor:"transparent",textShadowBlur:0,textShadowOffsetX:0,textShadowOffsetY:0,textBoxShadowColor:"transparent",textBoxShadowBlur:0,textBoxShadowOffsetX:0,textBoxShadowOffsetY:0,transformText:!1,textRotation:0,textOrigin:null,textBackgroundColor:null,textBorderColor:null,textBorderWidth:0,textBorderRadius:0,textPadding:null,rich:null,truncate:null,blend:null,bind:function(e,t,r){for(var n=this,o=r&&r.style,i=!o,s=0;s<Wt.length;s++){var a=Wt[s],c=a[0];(i||n[c]!==o[c])&&(e[c]=Gt(e,c,n[c]||a[1]))}if((i||n.fill!==o.fill)&&(e.fillStyle=n.fill),(i||n.stroke!==o.stroke)&&(e.strokeStyle=n.stroke),(i||n.opacity!==o.opacity)&&(e.globalAlpha=null==n.opacity?1:n.opacity),(i||n.blend!==o.blend)&&(e.globalCompositeOperation=n.blend||"source-over"),this.hasStroke()){var l=n.lineWidth;e.lineWidth=l/(this.strokeNoScale&&t&&t.getLineScale?t.getLineScale():1)}},hasFill:function(){var e=this.fill;return null!=e&&"none"!==e},hasStroke:function(){var e=this.stroke;return null!=e&&"none"!==e&&0<this.lineWidth},extendFrom:function(e,t){if(e)for(var r in e)!e.hasOwnProperty(r)||!0!==t&&(!1===t?this.hasOwnProperty(r):null==e[r])||(this[r]=e[r])},set:function(e,t){"string"==typeof e?this[e]=t:this.extendFrom(e,!0)},clone:function(){var e=new this.constructor;return e.extendFrom(this,!0),e},getGradient:function(e,t,r){for(var n=("radial"===t.type?Yt:zt)(e,t,r),o=t.colorStops,i=0;i<o.length;i++)n.addColorStop(o[i].offset,o[i].color);return n}};for(var Qt=Ht.prototype,Kt=0;Kt<Wt.length;Kt++){var Jt=Wt[Kt];Jt[0]in Qt||(Qt[Jt[0]]=Jt[1])}Ht.getGradient=Qt.getGradient;var Xt=function(e,t){this.image=e,this.repeat=t,this.type="pattern"};function $t(){return!1}function Zt(e,t,r){var n=b(),o=t.getWidth(),i=t.getHeight(),s=n.style;return s.position="absolute",s.left=0,s.top=0,s.width=o+"px",s.height=i+"px",n.width=o*r,n.height=i*r,n.setAttribute("data-zr-dom-id",e),n}var er=function(e,t,r){var n;r=r||yt,"string"==typeof e?n=Zt(e,t,r):M(e)&&(e=(n=e).id),this.id=e;var o=(this.dom=n).style;o&&(n.onselectstart=$t,o["-webkit-user-select"]="none",o["user-select"]="none",o["-webkit-touch-callout"]="none",o["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",o.padding=0,o.margin=0,o["border-width"]=0),this.domBack=null,this.ctxBack=null,this.painter=t,this.config=null,this.clearColor=0,this.motionBlur=!1,this.lastFrameAlpha=.7,this.dpr=r};er.prototype={constructor:er,__dirty:!0,__used:!(Xt.prototype.getCanvasPattern=function(e){return e.createPattern(this.image,this.repeat||"repeat")}),__drawIndex:0,__startIndex:0,__endIndex:0,isIncremental:!1,getElementCount:function(){return this.__endIndex-this.__startIndex},initContext:function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},createBackBuffer:function(){var e=this.dpr;this.domBack=Zt("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),1!=e&&this.ctxBack.scale(e,e)},resize:function(e,t){var r=this.dpr,n=this.dom,o=n.style,i=this.domBack;o.width=e+"px",o.height=t+"px",n.width=e*r,n.height=t*r,i&&(i.width=e*r,i.height=t*r,1!=r&&this.ctxBack.scale(r,r))},clear:function(e){var t,r=this.dom,n=this.ctx,o=r.width,i=r.height,s=this.clearColor,a=this.motionBlur&&!e,c=this.lastFrameAlpha,l=this.dpr;(a&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(r,0,0,o/l,i/l)),n.clearRect(0,0,o,i),s)&&(s.colorStops?(t=s.__canvasGradient||Ht.getGradient(n,s,{x:0,y:0,width:o,height:i}),s.__canvasGradient=t):s.image&&(t=Xt.prototype.getCanvasPattern.call(s,n)),n.save(),n.fillStyle=t||s,n.fillRect(0,0,o,i),n.restore());if(a){var d=this.domBack;n.save(),n.globalAlpha=c,n.drawImage(d,0,0,o,i),n.restore()}}};var tr="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){setTimeout(e,16)},rr=new Le(50);function nr(e){if("string"!=typeof e)return e;var t=rr.get(e);return t&&t.image}function or(e,t,r,n,o){if(e){if("string"!=typeof e)return e;if(t&&t.__zrImageSrc===e||!r)return t;var i=rr.get(e),s={hostEl:r,cb:n,cbPayload:o};return i?!sr(t=i.image)&&i.pending.push(s):(!t&&(t=new Image),t.onload=ir,rr.put(e,t.__cachedImgObj={image:t,pending:[s]}),t.src=t.__zrImageSrc=e),t}return t}function ir(){var e=this.__cachedImgObj;this.onload=this.__cachedImgObj=null;for(var t=0;t<e.pending.length;t++){var r=e.pending[t],n=r.cb;n&&n(this,r.cbPayload),r.hostEl.dirty()}e.pending.length=0}function sr(e){return e&&e.width&&e.height}var ar={},cr=0,lr=5e3,dr=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g,ur="12px sans-serif",pr={};function fr(e,t){var r=e+":"+(t=t||ur);if(ar[r])return ar[r];for(var n,o,i=(e+"").split("\n"),s=0,a=0,c=i.length;a<c;a++)s=Math.max((n=i[a],o=t,pr.measureText(n,o)).width,s);return lr<cr&&(cr=0,ar={}),cr++,ar[r]=s}function hr(e,t,r,n,o,i,s){return i?(c=n,l=Cr(e,{rich:i,truncate:s,font:t,textAlign:a=r,textPadding:o}),d=l.outerWidth,u=l.outerHeight,p=mr(0,d,a),f=gr(0,u,c),new Mt(p,f,d,u)):function(e,t,r,n,o,i){var s=Er(e,t,o,i),a=fr(e,t);o&&(a+=o[1]+o[3]);var c=s.outerHeight,l=mr(0,a,r),d=gr(0,c,n),u=new Mt(l,d,a,c);return u.lineHeight=s.lineHeight,u}(e,t,r,n,o,s);var a,c,l,d,u,p,f}function mr(e,t,r){return"right"===r?e-=t:"center"===r&&(e-=t/2),e}function gr(e,t,r){return"middle"===r?e-=t/2:"bottom"===r&&(e-=t),e}function vr(e,t,r){var n=t.x,o=t.y,i=t.height,s=t.width,a=i/2,c="left",l="top";switch(e){case"left":n-=r,o+=a,c="right",l="middle";break;case"right":n+=r+s,o+=a,l="middle";break;case"top":n+=s/2,o-=r,c="center",l="bottom";break;case"bottom":n+=s/2,o+=i+r,c="center";break;case"inside":n+=s/2,o+=a,c="center",l="middle";break;case"insideLeft":n+=r,o+=a,l="middle";break;case"insideRight":n+=s-r,o+=a,c="right",l="middle";break;case"insideTop":n+=s/2,o+=r,c="center";break;case"insideBottom":n+=s/2,o+=i-r,c="center",l="bottom";break;case"insideTopLeft":n+=r,o+=r;break;case"insideTopRight":n+=s-r,o+=r,c="right";break;case"insideBottomLeft":n+=r,o+=i-r,l="bottom";break;case"insideBottomRight":n+=s-r,o+=i-r,c="right",l="bottom"}return{x:n,y:o,textAlign:c,textVerticalAlign:l}}function yr(e,t,r,n,o){if(!t)return"";var i=(e+"").split("\n");o=br(t,r,n,o);for(var s=0,a=i.length;s<a;s++)i[s]=_r(i[s],o);return i.join("\n")}function br(e,t,r,n){(n=g({},n)).font=t;r=O(r,"...");n.maxIterations=O(n.maxIterations,2);var o=n.minChar=O(n.minChar,0);n.cnCharWidth=fr("国",t);var i=n.ascCharWidth=fr("a",t);n.placeholder=O(n.placeholder,"");for(var s=e=Math.max(0,e-1),a=0;a<o&&i<=s;a++)s-=i;var c=fr(r);return s<c&&(r="",c=0),s=e-c,n.ellipsis=r,n.ellipsisWidth=c,n.contentWidth=s,n.containerWidth=e,n}function _r(e,t){var r=t.containerWidth,n=t.font,o=t.contentWidth;if(!r)return"";var i=fr(e,n);if(i<=r)return e;for(var s=0;;s++){if(i<=o||s>=t.maxIterations){e+=t.ellipsis;break}var a=0===s?Sr(e,o,t.ascCharWidth,t.cnCharWidth):0<i?Math.floor(e.length*o/i):0;i=fr(e=e.substr(0,a),n)}return""===e&&(e=t.placeholder),e}function Sr(e,t,r,n){for(var o=0,i=0,s=e.length;i<s&&o<t;i++){var a=e.charCodeAt(i);o+=0<=a&&a<=127?r:n}return i}function wr(e){return fr("国",e)}function Er(e,t,r,n){null!=e&&(e+="");var o=wr(t),i=e?e.split("\n"):[],s=i.length*o,a=s;if(r&&(a+=r[0]+r[2]),e&&n){var c=n.outerHeight,l=n.outerWidth;if(null!=c&&c<a)e="",i=[];else if(null!=l)for(var d=br(l-(r?r[1]+r[3]:0),t,n.ellipsis,{minChar:n.minChar,placeholder:n.placeholder}),u=0,p=i.length;u<p;u++)i[u]=_r(i[u],d)}return{lines:i,height:s,outerHeight:a,lineHeight:o}}function Cr(e,t){var r={lines:[],width:0,height:0};if(null!=e&&(e+=""),!e)return r;for(var n,o=dr.lastIndex=0;null!=(n=dr.exec(e));){var i=n.index;o<i&&Tr(r,e.substring(o,i)),Tr(r,n[2],n[1]),o=dr.lastIndex}o<e.length&&Tr(r,e.substring(o,e.length));var s=r.lines,a=0,c=0,l=[],d=t.textPadding,u=t.truncate,p=u&&u.outerWidth,f=u&&u.outerHeight;d&&(null!=p&&(p-=d[1]+d[3]),null!=f&&(f-=d[0]+d[2]));for(var h=0;h<s.length;h++){for(var m=s[h],g=0,v=0,y=0;y<m.tokens.length;y++){var b=(x=m.tokens[y]).styleName&&t.rich[x.styleName]||{},_=x.textPadding=b.textPadding,S=x.font=b.font||t.font,w=x.textHeight=O(b.textHeight,wr(S));if(_&&(w+=_[0]+_[2]),x.height=w,x.lineHeight=L(b.textLineHeight,t.textLineHeight,w),x.textAlign=b&&b.textAlign||t.textAlign,x.textVerticalAlign=b&&b.textVerticalAlign||"middle",null!=f&&a+x.lineHeight>f)return{lines:[],width:0,height:0};x.textWidth=fr(x.text,S);var E=b.textWidth,C=null==E||"auto"===E;if("string"==typeof E&&"%"===E.charAt(E.length-1))x.percentWidth=E,l.push(x),E=0;else{if(C){E=x.textWidth;var T=b.textBackgroundColor,I=T&&T.image;I&&sr(I=nr(I))&&(E=Math.max(E,I.width*w/I.height))}var R=_?_[1]+_[3]:0;E+=R;var P=null!=p?p-v:null;null!=P&&P<E&&(!C||P<R?(x.text="",x.textWidth=E=0):(x.text=yr(x.text,P-R,S,u.ellipsis,{minChar:u.minChar}),x.textWidth=fr(x.text,S),E=x.textWidth+R))}v+=x.width=E,b&&(g=Math.max(g,x.lineHeight))}m.width=v,a+=m.lineHeight=g,c=Math.max(c,v)}r.outerWidth=r.width=O(t.textWidth,c),r.outerHeight=r.height=O(t.textHeight,a),d&&(r.outerWidth+=d[1]+d[3],r.outerHeight+=d[0]+d[2]);for(h=0;h<l.length;h++){var x,M=(x=l[h]).percentWidth;x.width=parseInt(M,10)/100*c}return r}function Tr(e,t,r){for(var n=""===t,o=t.split("\n"),i=e.lines,s=0;s<o.length;s++){var a=o[s],c={styleName:r,text:a,isLineHolder:!a&&!n};if(s)i.push({tokens:[c]});else{var l=(i[i.length-1]||(i[0]={tokens:[]})).tokens,d=l.length;1===d&&l[0].isLineHolder?l[0]=c:(a||!d||n)&&l.push(c)}}}function Ir(e,t){var r,n,o,i,s,a=t.x,c=t.y,l=t.width,d=t.height,u=t.r;l<0&&(a+=l,l=-l),d<0&&(c+=d,d=-d),"number"==typeof u?r=n=o=i=u:u instanceof Array?1===u.length?r=n=o=i=u[0]:2===u.length?(r=o=u[0],n=i=u[1]):3===u.length?(r=u[0],n=i=u[1],o=u[2]):(r=u[0],n=u[1],o=u[2],i=u[3]):r=n=o=i=0,l<r+n&&(r*=l/(s=r+n),n*=l/s),l<o+i&&(o*=l/(s=o+i),i*=l/s),d<n+o&&(n*=d/(s=n+o),o*=d/s),d<r+i&&(r*=d/(s=r+i),i*=d/s),e.moveTo(a+r,c),e.lineTo(a+l-n,c),0!==n&&e.quadraticCurveTo(a+l,c,a+l,c+n),e.lineTo(a+l,c+d-o),0!==o&&e.quadraticCurveTo(a+l,c+d,a+l-o,c+d),e.lineTo(a+i,c+d),0!==i&&e.quadraticCurveTo(a,c+d,a,c+d-i),e.lineTo(a,c+r),0!==r&&e.quadraticCurveTo(a,c,a+r,c)}pr.measureText=function(e,t){var r=_();return r.font=t||ur,r.measureText(e)};var Rr={left:1,right:1,center:1},Pr={top:1,bottom:1,middle:1};function xr(e){return Mr(e),C(e.rich,Mr),e}function Mr(e){if(e){e.font=((n=e).fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ")||n.textFont||n.font;var t=e.textAlign;"middle"===t&&(t="center"),e.textAlign=null==t||Rr[t]?t:"left";var r=e.textVerticalAlign||e.textBaseline;"center"===r&&(r="middle"),e.textVerticalAlign=null==r||Pr[r]?r:"top",e.textPadding&&(e.textPadding=D(e.textPadding))}var n}function kr(e,t,r,n,o){n.rich?function(e,t,r,n,o){var i=e.__textCotentBlock;i&&!e.__dirty||(i=e.__textCotentBlock=Cr(r,n));!function(e,t,r,n,o){var i=r.width,s=r.outerWidth,a=r.outerHeight,c=n.textPadding,l=Nr(a,n,o),d=l.baseX,u=l.baseY,p=l.textAlign,f=l.textVerticalAlign;Ar(t,n,o,d,u);var h=mr(d,s,p),m=gr(u,a,f),g=h,v=m;c&&(g+=c[3],v+=c[0]);var y=g+i;Ur(n)&&Lr(e,t,n,h,m,s,a);for(var b=0;b<r.lines.length;b++){for(var _,S=r.lines[b],w=S.tokens,E=w.length,C=S.lineHeight,T=S.width,I=0,R=g,P=y,x=E-1;I<E&&(!(_=w[I]).textAlign||"left"===_.textAlign);)Or(e,t,_,n,C,v,R,"left"),T-=_.width,R+=_.width,I++;for(;0<=x&&"right"===(_=w[x]).textAlign;)Or(e,t,_,n,C,v,P,"right"),T-=_.width,P-=_.width,x--;for(R+=(i-(R-g)-(y-P)-T)/2;I<=x;)_=w[I],Or(e,t,_,n,C,v,R+_.width/2,"center"),R+=_.width,I++;v+=C}}(e,t,i,n,o)}(e,t,r,n,o):function(e,t,r,n,o){var i=Br(t,"font",n.font||ur),s=n.textPadding,a=e.__textCotentBlock;a&&!e.__dirty||(a=e.__textCotentBlock=Er(r,i,s,n.truncate));var c=a.outerHeight,l=a.lines,d=a.lineHeight,u=Nr(c,n,o),p=u.baseX,f=u.baseY,h=u.textAlign,m=u.textVerticalAlign;Ar(t,n,o,p,f);var g=gr(f,c,m),v=p,y=g,b=Ur(n);if(b||s){var _=fr(r,i),S=_;s&&(S+=s[1]+s[3]);var w=mr(p,S,h);b&&Lr(e,t,n,w,g,S,c),s&&(v=qr(p,h,s),y+=s[0])}Br(t,"textAlign",h||"left"),Br(t,"textBaseline","middle"),Br(t,"shadowBlur",n.textShadowBlur||0),Br(t,"shadowColor",n.textShadowColor||"transparent"),Br(t,"shadowOffsetX",n.textShadowOffsetX||0),Br(t,"shadowOffsetY",n.textShadowOffsetY||0),y+=d/2;var E=n.textStrokeWidth,C=jr(n.textStroke,E),T=Fr(n.textFill);C&&(Br(t,"lineWidth",E),Br(t,"strokeStyle",C));T&&Br(t,"fillStyle",T);for(var I=0;I<l.length;I++)C&&t.strokeText(l[I],v,y),T&&t.fillText(l[I],v,y),y+=d}(e,t,r,n,o)}function Ar(e,t,r,n,o){if(r&&t.textRotation){var i=t.textOrigin;"center"===i?(n=r.width/2+r.x,o=r.height/2+r.y):i&&(n=i[0]+r.x,o=i[1]+r.y),e.translate(n,o),e.rotate(-t.textRotation),e.translate(-n,-o)}}function Or(e,t,r,n,o,i,s,a){var c=n.rich[r.styleName]||{},l=r.textVerticalAlign,d=i+o/2;"top"===l?d=i+r.height/2:"bottom"===l&&(d=i+o-r.height/2),!r.isLineHolder&&Ur(c)&&Lr(e,t,c,"right"===a?s-r.width:"center"===a?s-r.width/2:s,d-r.height/2,r.width,r.height);var u=r.textPadding;u&&(s=qr(s,a,u),d-=r.height/2-u[2]-r.textHeight/2),Br(t,"shadowBlur",L(c.textShadowBlur,n.textShadowBlur,0)),Br(t,"shadowColor",c.textShadowColor||n.textShadowColor||"transparent"),Br(t,"shadowOffsetX",L(c.textShadowOffsetX,n.textShadowOffsetX,0)),Br(t,"shadowOffsetY",L(c.textShadowOffsetY,n.textShadowOffsetY,0)),Br(t,"textAlign",a),Br(t,"textBaseline","middle"),Br(t,"font",r.font||ur);var p=jr(c.textStroke||n.textStroke,h),f=Fr(c.textFill||n.textFill),h=O(c.textStrokeWidth,n.textStrokeWidth);p&&(Br(t,"lineWidth",h),Br(t,"strokeStyle",p),t.strokeText(r.text,s,d)),f&&(Br(t,"fillStyle",f),t.fillText(r.text,s,d))}function Ur(e){return e.textBackgroundColor||e.textBorderWidth&&e.textBorderColor}function Lr(e,t,r,n,o,i,s){var a=r.textBackgroundColor,c=r.textBorderWidth,l=r.textBorderColor,d=x(a);if(Br(t,"shadowBlur",r.textBoxShadowBlur||0),Br(t,"shadowColor",r.textBoxShadowColor||"transparent"),Br(t,"shadowOffsetX",r.textBoxShadowOffsetX||0),Br(t,"shadowOffsetY",r.textBoxShadowOffsetY||0),d||c&&l){t.beginPath();var u=r.textBorderRadius;u?Ir(t,{x:n,y:o,width:i,height:s,r:u}):t.rect(n,o,i,s),t.closePath()}if(d)Br(t,"fillStyle",a),t.fill();else if(M(a)){var p=a.image;(p=or(p,null,e,Dr,a))&&sr(p)&&t.drawImage(p,n,o,i,s)}c&&l&&(Br(t,"lineWidth",c),Br(t,"strokeStyle",l),t.stroke())}function Dr(e,t){t.image=e}function Nr(e,t,r){var n=t.x||0,o=t.y||0,i=t.textAlign,s=t.textVerticalAlign;if(r){var a=t.textPosition;if(a instanceof Array)n=r.x+Vr(a[0],r.width),o=r.y+Vr(a[1],r.height);else{var c=vr(a,r,t.textDistance);n=c.x,o=c.y,i=i||c.textAlign,s=s||c.textVerticalAlign}var l=t.textOffset;l&&(n+=l[0],o+=l[1])}return{baseX:n,baseY:o,textAlign:i,textVerticalAlign:s}}function Br(e,t,r){return e[t]=Gt(e,t,r),e[t]}function jr(e,t){return null==e||t<=0||"transparent"===e||"none"===e?null:e.image||e.colorStops?"#000":e}function Fr(e){return null==e||"none"===e?null:e.image||e.colorStops?"#000":e}function Vr(e,t){return"string"==typeof e?0<=e.lastIndexOf("%")?parseFloat(e)/100*t:parseFloat(e):e}function qr(e,t,r){return"right"===t?e-r[1]:"center"===t?e+r[3]/2-r[1]/2:e+r[3]}function Gr(e,t){return null!=e&&(e||t.textBackgroundColor||t.textBorderWidth&&t.textBorderColor||t.textPadding)}var Wr=new Mt,Hr=function(){};function zr(e){for(var t in e=e||{},wt.call(this,e),e)e.hasOwnProperty(t)&&"style"!==t&&(this[t]=e[t]);this.style=new Ht(e.style,this),this._rect=null,this.__clipPaths=[]}function Yr(e){zr.call(this,e)}function Qr(e){return parseInt(e,10)}zr.prototype={constructor:zr,type:"displayable",__dirty:!0,invisible:!(Hr.prototype={constructor:Hr,drawRectText:function(e,t){var r=this.style;t=r.textRect||t,this.__dirty&&xr(r);var n=r.text;if(null!=n&&(n+=""),Gr(n,r)){e.save();var o=this.transform;r.transformText?this.setTransform(e):o&&(Wr.copy(t),Wr.applyTransform(o),t=Wr),kr(this,e,n,r,t),e.restore()}}}),z:0,z2:0,zlevel:0,draggable:!1,dragging:!1,silent:!1,culling:!1,cursor:"pointer",rectHover:!1,progressive:!1,isIncremental:!1,beforeBrush:function(e){},afterBrush:function(e){},brush:function(e,t){},getBoundingRect:function(){},contain:function(e,t){return this.rectContain(e,t)},traverse:function(e,t){e.call(t,this)},rectContain:function(e,t){var r=this.transformCoordToLocal(e,t);return this.getBoundingRect().contain(r[0],r[1])},dirty:function(){this.__dirty=!0,this._rect=null,this.__zr&&this.__zr.refresh()},animateStyle:function(e){return this.animate("style",e)},attrKV:function(e,t){"style"!==e?wt.prototype.attrKV.call(this,e,t):this.style.set(t)},setStyle:function(e,t){return this.style.set(e,t),this.dirty(!1),this},useStyle:function(e){return this.style=new Ht(e,this),this.dirty(!1),this}},w(zr,wt),E(zr,Hr),Yr.prototype={constructor:Yr,type:"image",brush:function(e,t){var r=this.style,n=r.image;r.bind(e,this,t);var o=this._image=or(n,this._image,this,this.onload);if(o&&sr(o)){var i=r.x||0,s=r.y||0,a=r.width,c=r.height,l=o.width/o.height;if(null==a&&null!=c?a=c*l:null==c&&null!=a?c=a/l:null==a&&null==c&&(a=o.width,c=o.height),this.setTransform(e),r.sWidth&&r.sHeight){var d=r.sx||0,u=r.sy||0;e.drawImage(o,d,u,r.sWidth,r.sHeight,i,s,a,c)}else if(r.sx&&r.sy){var p=a-(d=r.sx),f=c-(u=r.sy);e.drawImage(o,d,u,p,f,i,s,a,c)}else e.drawImage(o,i,s,a,c);null!=r.text&&(this.restoreTransform(e),this.drawRectText(e,this.getBoundingRect()))}},getBoundingRect:function(){var e=this.style;return this._rect||(this._rect=new Mt(e.x||0,e.y||0,e.width||0,e.height||0)),this._rect}},w(Yr,zr);var Kr=new Mt(0,0,0,0),Jr=new Mt(0,0,0,0);var Xr=function(e,t,r){this.type="canvas";var n=!e.nodeName||"CANVAS"===e.nodeName.toUpperCase();this._opts=r=g({},r||{}),this.dpr=r.devicePixelRatio||yt,this._singleCanvas=n;var o=(this.root=e).style;o&&(o["-webkit-tap-highlight-color"]="transparent",o["-webkit-user-select"]=o["user-select"]=o["-webkit-touch-callout"]="none",e.innerHTML=""),this.storage=t;var i,s,a,c=this._zlevelList=[],l=this._layers={};if(this._layerConfig={},n){null!=r.width&&(e.width=r.width),null!=r.height&&(e.height=r.height);var d=e.width,u=e.height;this._width=d,this._height=u;var p=new er(e,this,1);p.initContext(),l[0]=p,c.push(0),this._domRoot=e}else{this._width=this._getSize(0),this._height=this._getSize(1);var f=this._domRoot=(i=this._width,s=this._height,(a=document.createElement("div")).style.cssText=["position:relative","overflow:hidden","width:"+i+"px","height:"+s+"px","padding:0","margin:0","border-width:0"].join(";")+";",a);e.appendChild(f)}this._hoverlayer=null,this._hoverElements=[]};Xr.prototype={constructor:Xr,getType:function(){return"canvas"},isSingleCanvas:function(){return this._singleCanvas},getViewportRoot:function(){return this._domRoot},getViewportRootOffset:function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},refresh:function(e){var t=this.storage.getDisplayList(!0),r=this._zlevelList;this._paintList(t,e);for(var n=0;n<r.length;n++){var o=r[n],i=this._layers[o];!i.__builtin__&&i.refresh&&i.refresh()}return this.refreshHover(),this},addHover:function(e,t){if(!e.__hoverMir){var r=new e.constructor({style:e.style,shape:e.shape});((r.__from=e).__hoverMir=r).setStyle(t),this._hoverElements.push(r)}},removeHover:function(e){var t=e.__hoverMir,r=this._hoverElements,n=S(r,t);0<=n&&r.splice(n,1),e.__hoverMir=null},clearHover:function(e){for(var t=this._hoverElements,r=0;r<t.length;r++){var n=t[r].__from;n&&(n.__hoverMir=null)}t.length=0},refreshHover:function(){var e=this._hoverElements,t=e.length,r=this._hoverlayer;if(r&&r.clear(),t){jt(e,this.storage.displayableSortFunc),r||(r=this._hoverlayer=this.getLayer(1e5));var n={};r.ctx.save();for(var o=0;o<t;){var i=e[o],s=i.__from;s&&s.__zr?(o++,s.invisible||(i.transform=s.transform,i.invTransform=s.invTransform,i.__clipPaths=s.__clipPaths,this._doPaintEl(i,r,!0,n))):(e.splice(o,1),s.__hoverMir=null,t--)}r.ctx.restore()}},getHoverLayer:function(){return this._hoverlayer},_paintList:function(e,t){null==t&&(t=!1),this._updateLayerStatus(e),this._doPaintList(e,t)},_doPaintList:function(e,t){for(var r=[],n=0;n<this._zlevelList.length;n++){var o=this._zlevelList[n];(s=this._layers[o]).__builtin__&&s!==this._hoverlayer&&(s.__dirty||t)&&r.push(s)}for(var i=0;i<r.length;i++){var s,a=(s=r[i]).ctx,c={};if(a.save(),s.__startIndex===s.__drawIndex)if(s.isIncremental){var l=e[s.__drawIndex];l&&l.needsClear()&&s.clear()}else s.clear();for(var d=s.__drawIndex;d<s.__endIndex;d++){var u=e[d];this._doPaintEl(u,s,t,c),u.__dirty=!1}a.restore()}},_doPaintEl:function(e,t,r,n){var o,i,s,a=t.ctx,c=e.transform;if((t.__dirty||r)&&!e.invisible&&0!==e.style.opacity&&(!c||c[0]||c[3])&&(!e.culling||(o=e,i=this._width,s=this._height,Kr.copy(o.getBoundingRect()),o.transform&&Kr.applyTransform(o.transform),Jr.width=i,Jr.height=s,Kr.intersect(Jr)))){var l=e.__clipPaths;(n.prevClipLayer!==t||function(e,t){if(e==t)return!1;if(!e||!t||e.length!==t.length)return!0;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!0}(l,n.prevElClipPaths))&&(n.prevElClipPaths&&(n.prevClipLayer.ctx.restore(),n.prevClipLayer=n.prevElClipPaths=null,n.prevEl=null),l&&(a.save(),function(e,t){for(var r=0;r<e.length;r++){var n=e[r];n.setTransform(t),t.beginPath(),n.buildPath(t,n.shape),t.clip(),n.restoreTransform(t)}}(l,a),n.prevClipLayer=t,n.prevElClipPaths=l)),e.beforeBrush&&e.beforeBrush(a),e.brush(a,n.prevEl||null),(n.prevEl=e).afterBrush&&e.afterBrush(a)}},getLayer:function(e){if(this._singleCanvas)return this._layers[0];var t=this._layers[e];return t||((t=new er("zr_"+e,this,this.dpr)).__builtin__=!0,this._layerConfig[e]&&m(t,this._layerConfig[e],!0),this.insertLayer(e,t),t.initContext()),t},insertLayer:function(e,t){var r=this._layers,n=this._zlevelList,o=n.length,i=null,s=-1,a=this._domRoot;if(r[e])_t("ZLevel "+e+" has been used already");else if((c=t)&&(c.__builtin__||"function"==typeof c.resize&&"function"==typeof c.refresh)){var c;if(0<o&&e>n[0]){for(s=0;s<o-1&&!(n[s]<e&&n[s+1]>e);s++);i=r[n[s]]}if(n.splice(s+1,0,e),!(r[e]=t).virtual)if(i){var l=i.dom;l.nextSibling?a.insertBefore(t.dom,l.nextSibling):a.appendChild(t.dom)}else a.firstChild?a.insertBefore(t.dom,a.firstChild):a.appendChild(t.dom)}else _t("Layer of zlevel "+e+" is not valid")},eachLayer:function(e,t){var r,n,o=this._zlevelList;for(n=0;n<o.length;n++)r=o[n],e.call(t,this._layers[r],r)},eachBuiltinLayer:function(e,t){var r,n,o,i=this._zlevelList;for(o=0;o<i.length;o++)n=i[o],(r=this._layers[n]).__builtin__&&e.call(t,r,n)},eachOtherLayer:function(e,t){var r,n,o,i=this._zlevelList;for(o=0;o<i.length;o++)n=i[o],(r=this._layers[n]).__builtin__||e.call(t,r,n)},getLayers:function(){return this._layers},_updateLayerStatus:function(e){function t(e){r&&(r.__endIndex!==e&&(r.__dirty=!0),r.__endIndex=e)}this.eachBuiltinLayer(function(e,t){e.__dirty=e.__used=!1});for(var r=null,n=0,o=0;o<e.length;o++){var i,s=e[o],a=this._singleCanvas?0:s.zlevel;s.isIncremental?((i=this.getLayer(a+.001)).isIncremental=!0,n=1):i=this.getLayer(0<a+n?.01:0),i.__builtin__||_t("ZLevel "+a+" has been used by unkown layer "+i.id),i!==r&&(i.__used=!0,i.__startIndex!==o&&(i.__dirty=!0),i.__startIndex=i.__drawIndex=o,t(o),r=i),i.__dirty=i.__dirty||s.__dirty}t(o),this.eachBuiltinLayer(function(e,t){!e.__used&&0<e.getElementCount()&&(e.__dirty=!0,e.__startIndex=e.__endIndex=e.__drawIndex=0)})},clear:function(){return this.eachBuiltinLayer(this._clearLayer),this},_clearLayer:function(e){e.clear()},configLayer:function(e,t){if(t){var r=this._layerConfig;r[e]?m(r[e],t,!0):r[e]=t;var n=this._layers[e];n&&m(n,r[e],!0)}},delLayer:function(e){var t=this._layers,r=this._zlevelList,n=t[e];n&&(n.dom.parentNode.removeChild(n.dom),delete t[e],r.splice(S(r,e),1))},resize:function(t,r){if(this._domRoot.style){var e=this._domRoot;e.style.display="none";var n=this._opts;if(null!=t&&(n.width=t),null!=r&&(n.height=r),t=this._getSize(0),r=this._getSize(1),e.style.display="",this._width!=t||r!=this._height){for(var o in e.style.width=t+"px",e.style.height=r+"px",this._layers)this._layers.hasOwnProperty(o)&&this._layers[o].resize(t,r);C(this._progressiveLayers,function(e){e.resize(t,r)}),this.refresh(!0)}this._width=t,this._height=r}else{if(null==t||null==r)return;this._width=t,this._height=r,this.getLayer(0).resize(t,r)}return this},clearLayer:function(e){var t=this._layers[e];t&&t.clear()},dispose:function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},getRenderedCanvas:function(e){if(e=e||{},this._singleCanvas)return this._layers[0].dom;var a=new er("image",this,e.pixelRatio||this.dpr);a.initContext(),a.clearColor=e.backgroundColor,a.clear();var t,r=this.storage.getDisplayList(!0),n={},c=this;function o(e,t){var r,n=c._zlevelList;null==e&&(e=-1/0);for(var o=0;o<n.length;o++){var i=n[o],s=c._layers[i];if(!s.__builtin__&&e<i&&i<t){r=s;break}}r&&r.renderToCanvas&&(a.ctx.save(),r.renderToCanvas(a.ctx),a.ctx.restore())}for(var i=0;i<r.length;i++){var s=r[i];s.zlevel!==t&&(o(t,s.zlevel),t=s.zlevel),this._doPaintEl(s,a,!0,n)}return o(t,1/0),a.dom},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(e){var t=this._opts,r=["width","height"][e],n=["clientWidth","clientHeight"][e],o=["paddingLeft","paddingTop"][e],i=["paddingRight","paddingBottom"][e];if(null!=t[r]&&"auto"!==t[r])return parseFloat(t[r]);var s=this.root,a=document.defaultView.getComputedStyle(s);return(s[n]||Qr(a[r])||Qr(s.style[r]))-(Qr(a[o])||0)-(Qr(a[i])||0)|0},pathToImage:function(e,t){t=t||this.dpr;var r=document.createElement("canvas"),n=r.getContext("2d"),o=e.getBoundingRect(),i=e.style,s=i.shadowBlur*t,a=i.shadowOffsetX*t,c=i.shadowOffsetY*t,l=i.hasStroke()?i.lineWidth:0,d=Math.max(l/2,-a+s),u=Math.max(l/2,a+s),p=Math.max(l/2,-c+s),f=Math.max(l/2,c+s),h=o.width+d+u,m=o.height+p+f;r.width=h*t,r.height=m*t,n.scale(t,t),n.clearRect(0,0,h,m),n.dpr=t;var g={position:e.position,rotation:e.rotation,scale:e.scale};e.position=[d-o.x,p-o.y],e.rotation=0,e.scale=[1,1],e.updateTransform(),e&&e.brush(n);var v=new Yr({style:{x:0,y:0,image:r}});return null!=g.position&&(v.position=e.position=g.position),null!=g.rotation&&(v.rotation=e.rotation=g.rotation),null!=g.scale&&(v.scale=e.scale=g.scale),v}};var $r="undefined"!=typeof window&&!!window.addEventListener,Zr=/^(?:mouse|pointer|contextmenu|drag|drop)|click/;function en(e,t,r,n){return r=r||{},n||!d.canvasSupported?tn(e,t,r):d.browser.firefox&&null!=t.layerX&&t.layerX!==t.offsetX?(r.zrX=t.layerX,r.zrY=t.layerY):null!=t.offsetX?(r.zrX=t.offsetX,r.zrY=t.offsetY):tn(e,t,r),r}function tn(e,t,r){var n,o=(n=e).getBoundingClientRect?n.getBoundingClientRect():{left:0,top:0};r.zrX=t.clientX-o.left,r.zrY=t.clientY-o.top}function rn(e,t,r){if(null!=(t=t||window.event).zrX)return t;var n=t.type;if(n&&0<=n.indexOf("touch")){var o="touchend"!=n?t.targetTouches[0]:t.changedTouches[0];o&&en(e,o,t,r)}else en(e,t,t,r),t.zrDelta=t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3;var i=t.button;return null==t.which&&void 0!==i&&Zr.test(t.type)&&(t.which=1&i?1:2&i?3:4&i?2:0),t}var nn=function(e){e=e||{},this.stage=e.stage||{},this.onframe=e.onframe||function(){},this._clips=[],this._running=!1,this._time,this._pausedTime,this._pauseStart,this._paused=!1,le.call(this)};nn.prototype={constructor:nn,addClip:function(e){this._clips.push(e)},addAnimator:function(e){e.animation=this;for(var t=e.getClips(),r=0;r<t.length;r++)this.addClip(t[r])},removeClip:function(e){var t=S(this._clips,e);0<=t&&this._clips.splice(t,1)},removeAnimator:function(e){for(var t=e.getClips(),r=0;r<t.length;r++)this.removeClip(t[r]);e.animation=null},_update:function(){for(var e=(new Date).getTime()-this._pausedTime,t=e-this._time,r=this._clips,n=r.length,o=[],i=[],s=0;s<n;s++){var a=r[s],c=a.step(e,t);c&&(o.push(c),i.push(a))}for(s=0;s<n;)r[s]._needsRemove?(r[s]=r[n-1],r.pop(),n--):s++;n=o.length;for(s=0;s<n;s++)i[s].fire(o[s]);this._time=e,this.onframe(t),this.trigger("frame",t),this.stage.update&&this.stage.update()},_startLoop:function(){var t=this;this._running=!0,tr(function e(){t._running&&(tr(e),!t._paused&&t._update())})},start:function(){this._time=(new Date).getTime(),this._pausedTime=0,this._startLoop()},stop:function(){this._running=!1},pause:function(){this._paused||(this._pauseStart=(new Date).getTime(),this._paused=!0)},resume:function(){this._paused&&(this._pausedTime+=(new Date).getTime()-this._pauseStart,this._paused=!1)},clear:function(){this._clips=[]},animate:function(e,t){var r=new gt(e,(t=t||{}).loop,t.getter,t.setter);return this.addAnimator(r),r}},E(nn,le);var on=function(){this._track=[]};function sn(e){var t=e[1][0]-e[0][0],r=e[1][1]-e[0][1];return Math.sqrt(t*t+r*r)}on.prototype={constructor:on,recognize:function(e,t,r){return this._doTrack(e,t,r),this._recognize(e)},clear:function(){return this._track.length=0,this},_doTrack:function(e,t,r){var n=e.touches;if(n){for(var o={points:[],touches:[],target:t,event:e},i=0,s=n.length;i<s;i++){var a=n[i],c=en(r,a,{});o.points.push([c.zrX,c.zrY]),o.touches.push(a)}this._track.push(o)}},_recognize:function(e){for(var t in an)if(an.hasOwnProperty(t)){var r=an[t](this._track,e);if(r)return r}}};var an={pinch:function(e,t){var r=e.length;if(r){var n,o=(e[r-1]||{}).points,i=(e[r-2]||{}).points||o;if(i&&1<i.length&&o&&1<o.length){var s=sn(o)/sn(i);!isFinite(s)&&(s=1),t.pinchScale=s;var a=[((n=o)[0][0]+n[1][0])/2,(n[0][1]+n[1][1])/2];return t.pinchX=a[0],t.pinchY=a[1],{type:"pinch",target:e[0].target,event:t}}}}},cn=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],ln=["touchstart","touchend","touchmove"],dn={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},un=T(cn,function(e){var t=e.replace("mouse","pointer");return dn[t]?t:e});function pn(e){return"mousewheel"===e&&d.browser.firefox?"DOMMouseScroll":e}function fn(e,t,r){var n=e._gestureMgr;"start"===r&&n.clear();var o=n.recognize(t,e.handler.findHover(t.zrX,t.zrY,null).target,e.dom);if("end"===r&&n.clear(),o){var i=o.type;t.gestureEvent=i,e.handler.dispatchToElement({target:o.target},i,o.event)}}function hn(e){e._touching=!0,clearTimeout(e._touchTimer),e._touchTimer=setTimeout(function(){e._touching=!1},700)}var mn={mousemove:function(e){e=rn(this.dom,e),this.trigger("mousemove",e)},mouseout:function(e){var t=(e=rn(this.dom,e)).toElement||e.relatedTarget;if(t!=this.dom)for(;t&&9!=t.nodeType;){if(t===this.dom)return;t=t.parentNode}this.trigger("mouseout",e)},touchstart:function(e){(e=rn(this.dom,e)).zrByTouch=!0,this._lastTouchMoment=new Date,fn(this,e,"start"),mn.mousemove.call(this,e),mn.mousedown.call(this,e),hn(this)},touchmove:function(e){(e=rn(this.dom,e)).zrByTouch=!0,fn(this,e,"change"),mn.mousemove.call(this,e),hn(this)},touchend:function(e){(e=rn(this.dom,e)).zrByTouch=!0,fn(this,e,"end"),mn.mouseup.call(this,e),+new Date-this._lastTouchMoment<300&&mn.click.call(this,e),hn(this)},pointerdown:function(e){mn.mousedown.call(this,e)},pointermove:function(e){gn(e)||mn.mousemove.call(this,e)},pointerup:function(e){mn.mouseup.call(this,e)},pointerout:function(e){gn(e)||mn.mouseout.call(this,e)}};function gn(e){var t=e.pointerType;return"pen"===t||"touch"===t}function vn(i){var n;function e(e,o){C(e,function(e){var t,r,n;t=i,r=pn(e),n=o._handlers[e],$r?t.addEventListener(r,n):t.attachEvent("on"+r,n)},o)}le.call(this),this.dom=i,this._touching=!1,this._touchTimer,this._gestureMgr=new on,this._handlers={},n=this,C(ln,function(e){n._handlers[e]=I(mn[e],n)}),C(un,function(e){n._handlers[e]=I(mn[e],n)}),C(cn,function(e){var t,r;n._handlers[e]=(t=mn[e],r=n,function(){if(!r._touching)return t.apply(r,arguments)})}),d.pointerEventsSupported?e(un,this):(d.touchEventsSupported&&e(ln,this),e(cn,this))}C(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(t){mn[t]=function(e){e=rn(this.dom,e),this.trigger(t,e)}});var yn=vn.prototype;yn.dispose=function(){for(var e,t,r,n=cn.concat(ln),o=0;o<n.length;o++){var i=n[o];e=this.dom,t=pn(i),r=this._handlers[i],$r?e.removeEventListener(t,r):e.detachEvent("on"+t,r)}},yn.setCursor=function(e){this.dom.style.cursor=this.cursor||"default"},E(vn,le);var bn=!d.canvasSupported,_n={canvas:Xr},Sn={};function wn(e,t){_n[e]=t}var En=function(e,t,r){r=r||{},this.dom=t,this.id=e;var n=this,o=new Vt,i=r.renderer;if(bn){if(!_n.vml)throw new Error("You need to require 'zrender/vml/vml' to support IE8");i="vml"}else i&&_n[i]||(i="canvas");var s=new _n[i](t,o,r);this.storage=o,this.painter=s;var a=d.node||d.worker?null:new vn(s.getViewportRoot());this.handler=new fe(o,s,a,s.root),this.animation=new nn({stage:{update:I(this.flush,this)}}),this.animation.start(),this._needsRefresh;var c=o.delFromStorage,l=o.addToStorage;o.delFromStorage=function(e){c.call(o,e),e&&e.removeSelfFromZr(n)},o.addToStorage=function(e){l.call(o,e),e.addSelfToZr(n)}};En.prototype={constructor:En,getId:function(){return this.id},add:function(e){this.storage.addRoot(e),this._needsRefresh=!0},remove:function(e){this.storage.delRoot(e),this._needsRefresh=!0},configLayer:function(e,t){this.painter.configLayer(e,t),this._needsRefresh=!0},refreshImmediately:function(){this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},refresh:function(){this._needsRefresh=!0},flush:function(){this._needsRefresh&&this.refreshImmediately(),this._needsRefreshHover&&this.refreshHoverImmediately()},addHover:function(e,t){this.painter.addHover&&(this.painter.addHover(e,t),this.refreshHover())},removeHover:function(e){this.painter.removeHover&&(this.painter.removeHover(e),this.refreshHover())},clearHover:function(){this.painter.clearHover&&(this.painter.clearHover(),this.refreshHover())},refreshHover:function(){this._needsRefreshHover=!0},refreshHoverImmediately:function(){this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.refreshHover()},resize:function(e){e=e||{},this.painter.resize(e.width,e.height),this.handler.resize()},clearAnimation:function(){this.animation.clear()},getWidth:function(){return this.painter.getWidth()},getHeight:function(){return this.painter.getHeight()},pathToImage:function(e,t){return this.painter.pathToImage(e,t)},setCursorStyle:function(e){this.handler.setCursorStyle(e)},findHover:function(e,t){return this.handler.findHover(e,t)},on:function(e,t,r){this.handler.on(e,t,r)},off:function(e,t){this.handler.off(e,t)},trigger:function(e,t){this.handler.trigger(e,t)},clear:function(){this.storage.delRoot(),this.painter.clear()},dispose:function(){var e;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,e=this.id,delete Sn[e]}};var Cn=Math.pow,Tn=Math.sqrt,In=1e-8,Rn=1e-4,Pn=Tn(3),xn=1/3,Mn=q(),kn=q(),An=q();function On(e){return-In<e&&e<In}function Un(e){return In<e||e<-In}function Ln(e,t,r,n,o){var i=1-o;return i*i*(i*e+3*o*t)+o*o*(o*n+3*i*r)}function Dn(e,t,r,n,o){var i=1-o;return 3*(((t-e)*i+2*(r-t)*o)*i+(n-r)*o*o)}function Nn(e,t,r,n,o){var i=6*r-12*t+6*e,s=9*t+3*n-3*e-9*r,a=3*t-3*e,c=0;if(On(s)){if(Un(i))0<=(d=-a/i)&&d<=1&&(o[c++]=d)}else{var l=i*i-4*s*a;if(On(l))o[0]=-i/(2*s);else if(0<l){var d,u=Tn(l),p=(-i-u)/(2*s);0<=(d=(-i+u)/(2*s))&&d<=1&&(o[c++]=d),0<=p&&p<=1&&(o[c++]=p)}}return c}function Bn(e,t,r,n,o,i){var s=(t-e)*o+e,a=(r-t)*o+t,c=(n-r)*o+r,l=(a-s)*o+s,d=(c-a)*o+a,u=(d-l)*o+l;i[0]=e,i[1]=s,i[2]=l,i[3]=u,i[4]=u,i[5]=d,i[6]=c,i[7]=n}function jn(e,t,r,n){var o=1-n;return o*(o*e+2*n*t)+n*n*r}function Fn(e,t,r,n){return 2*((1-n)*(t-e)+n*(r-t))}function Vn(e,t,r){var n=e+r-2*t;return 0===n?.5:(e-t)/n}function qn(e,t,r,n,o){var i=(t-e)*n+e,s=(r-t)*n+t,a=(s-i)*n+i;o[0]=e,o[1]=i,o[2]=a,o[3]=a,o[4]=s,o[5]=r}var Gn=Math.min,Wn=Math.max,Hn=Math.sin,zn=Math.cos,Yn=2*Math.PI,Qn=q(),Kn=q(),Jn=q();function Xn(e,t,r,n,o,i){o[0]=Gn(e,r),o[1]=Gn(t,n),i[0]=Wn(e,r),i[1]=Wn(t,n)}var $n=[],Zn=[];function eo(e,t,r,n,o,i,s,a,c,l){var d,u=Nn,p=Ln,f=u(e,r,o,s,$n);for(c[0]=1/0,c[1]=1/0,l[0]=-1/0,l[1]=-1/0,d=0;d<f;d++){var h=p(e,r,o,s,$n[d]);c[0]=Gn(h,c[0]),l[0]=Wn(h,l[0])}for(f=u(t,n,i,a,Zn),d=0;d<f;d++){var m=p(t,n,i,a,Zn[d]);c[1]=Gn(m,c[1]),l[1]=Wn(m,l[1])}c[0]=Gn(e,c[0]),l[0]=Wn(e,l[0]),c[0]=Gn(s,c[0]),l[0]=Wn(s,l[0]),c[1]=Gn(t,c[1]),l[1]=Wn(t,l[1]),c[1]=Gn(a,c[1]),l[1]=Wn(a,l[1])}function to(e,t,r,n,o,i,s,a,c){var l=ne,d=oe,u=Math.abs(o-i);if(u%Yn<1e-4&&1e-4<u)return a[0]=e-r,a[1]=t-n,c[0]=e+r,void(c[1]=t+n);if(Qn[0]=zn(o)*r+e,Qn[1]=Hn(o)*n+t,Kn[0]=zn(i)*r+e,Kn[1]=Hn(i)*n+t,l(a,Qn,Kn),d(c,Qn,Kn),(o%=Yn)<0&&(o+=Yn),(i%=Yn)<0&&(i+=Yn),i<o&&!s?i+=Yn:o<i&&s&&(o+=Yn),s){var p=i;i=o,o=p}for(var f=0;f<i;f+=Math.PI/2)o<f&&(Jn[0]=zn(f)*r+e,Jn[1]=Hn(f)*n+t,l(a,Jn,a),d(c,Jn,c))}var ro={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},no=[],oo=[],io=[],so=[],ao=Math.min,co=Math.max,lo=Math.cos,uo=Math.sin,po=Math.sqrt,fo=Math.abs,ho="undefined"!=typeof Float32Array,mo=function(e){this._saveData=!e,this._saveData&&(this.data=[]),this._ctx=null};function go(e,t,r,n,o,i,s){if(0===o)return!1;var a=o,c=0;if(t+a<s&&n+a<s||s<t-a&&s<n-a||e+a<i&&r+a<i||i<e-a&&i<r-a)return!1;if(e===r)return Math.abs(i-e)<=a/2;var l=(c=(t-n)/(e-r))*i-s+(e*n-r*t)/(e-r);return l*l/(c*c+1)<=a/2*a/2}function vo(e,t,r,n,o,i,s,a,c,l,d){if(0===c)return!1;var u=c;return!(t+u<d&&n+u<d&&i+u<d&&a+u<d||d<t-u&&d<n-u&&d<i-u&&d<a-u||e+u<l&&r+u<l&&o+u<l&&s+u<l||l<e-u&&l<r-u&&l<o-u&&l<s-u)&&function(e,t,r,n,o,i,s,a,c,l,d){var u,p,f,h,m,g=.005,v=1/0;Mn[0]=c,Mn[1]=l;for(var y=0;y<1;y+=.05)kn[0]=Ln(e,r,o,s,y),kn[1]=Ln(t,n,i,a,y),(h=te(Mn,kn))<v&&(u=y,v=h);v=1/0;for(var b=0;b<32&&!(g<Rn);b++)p=u-g,f=u+g,kn[0]=Ln(e,r,o,s,p),kn[1]=Ln(t,n,i,a,p),h=te(kn,Mn),0<=p&&h<v?(u=p,v=h):(An[0]=Ln(e,r,o,s,f),An[1]=Ln(t,n,i,a,f),m=te(An,Mn),f<=1&&m<v?(u=f,v=m):g*=.5);return d&&(d[0]=Ln(e,r,o,s,u),d[1]=Ln(t,n,i,a,u)),Tn(v)}(e,t,r,n,o,i,s,a,l,d,null)<=u/2}function yo(e,t,r,n,o,i,s,a,c){if(0===s)return!1;var l=s;return!(t+l<c&&n+l<c&&i+l<c||c<t-l&&c<n-l&&c<i-l||e+l<a&&r+l<a&&o+l<a||a<e-l&&a<r-l&&a<o-l)&&function(e,t,r,n,o,i,s,a,c){var l,d=.005,u=1/0;Mn[0]=s,Mn[1]=a;for(var p=0;p<1;p+=.05)kn[0]=jn(e,r,o,p),kn[1]=jn(t,n,i,p),(g=te(Mn,kn))<u&&(l=p,u=g);u=1/0;for(var f=0;f<32&&!(d<Rn);f++){var h=l-d,m=l+d;kn[0]=jn(e,r,o,h),kn[1]=jn(t,n,i,h);var g=te(kn,Mn);if(0<=h&&g<u)l=h,u=g;else{An[0]=jn(e,r,o,m),An[1]=jn(t,n,i,m);var v=te(An,Mn);m<=1&&v<u?(l=m,u=v):d*=.5}}return c&&(c[0]=jn(e,r,o,l),c[1]=jn(t,n,i,l)),Tn(u)}(e,t,r,n,o,i,a,c,null)<=l/2}mo.prototype={constructor:mo,_xi:0,_yi:0,_x0:0,_y0:0,_ux:0,_uy:0,_len:0,_lineDash:null,_dashOffset:0,_dashIdx:0,_dashSum:0,setScale:function(e,t){this._ux=fo(1/yt/e)||0,this._uy=fo(1/yt/t)||0},getContext:function(){return this._ctx},beginPath:function(e){return(this._ctx=e)&&e.beginPath(),e&&(this.dpr=e.dpr),this._saveData&&(this._len=0),this._lineDash&&(this._lineDash=null,this._dashOffset=0),this},moveTo:function(e,t){return this.addData(ro.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this},lineTo:function(e,t){var r=fo(e-this._xi)>this._ux||fo(t-this._yi)>this._uy||this._len<5;return this.addData(ro.L,e,t),this._ctx&&r&&(this._needsDash()?this._dashedLineTo(e,t):this._ctx.lineTo(e,t)),r&&(this._xi=e,this._yi=t),this},bezierCurveTo:function(e,t,r,n,o,i){return this.addData(ro.C,e,t,r,n,o,i),this._ctx&&(this._needsDash()?this._dashedBezierTo(e,t,r,n,o,i):this._ctx.bezierCurveTo(e,t,r,n,o,i)),this._xi=o,this._yi=i,this},quadraticCurveTo:function(e,t,r,n){return this.addData(ro.Q,e,t,r,n),this._ctx&&(this._needsDash()?this._dashedQuadraticTo(e,t,r,n):this._ctx.quadraticCurveTo(e,t,r,n)),this._xi=r,this._yi=n,this},arc:function(e,t,r,n,o,i){return this.addData(ro.A,e,t,r,r,n,o-n,0,i?0:1),this._ctx&&this._ctx.arc(e,t,r,n,o,i),this._xi=lo(o)*r+e,this._yi=uo(o)*r+e,this},arcTo:function(e,t,r,n,o){return this._ctx&&this._ctx.arcTo(e,t,r,n,o),this},rect:function(e,t,r,n){return this._ctx&&this._ctx.rect(e,t,r,n),this.addData(ro.R,e,t,r,n),this},closePath:function(){this.addData(ro.Z);var e=this._ctx,t=this._x0,r=this._y0;return e&&(this._needsDash()&&this._dashedLineTo(t,r),e.closePath()),this._xi=t,this._yi=r,this},fill:function(e){e&&e.fill(),this.toStatic()},stroke:function(e){e&&e.stroke(),this.toStatic()},setLineDash:function(e){if(e instanceof Array){this._lineDash=e;for(var t=this._dashIdx=0,r=0;r<e.length;r++)t+=e[r];this._dashSum=t}return this},setLineDashOffset:function(e){return this._dashOffset=e,this},len:function(){return this._len},setData:function(e){var t=e.length;this.data&&this.data.length==t||!ho||(this.data=new Float32Array(t));for(var r=0;r<t;r++)this.data[r]=e[r];this._len=t},appendPath:function(e){e instanceof Array||(e=[e]);for(var t=e.length,r=0,n=this._len,o=0;o<t;o++)r+=e[o].len();ho&&this.data instanceof Float32Array&&(this.data=new Float32Array(n+r));for(o=0;o<t;o++)for(var i=e[o].data,s=0;s<i.length;s++)this.data[n++]=i[s];this._len=n},addData:function(e){if(this._saveData){var t=this.data;this._len+arguments.length>t.length&&(this._expandData(),t=this.data);for(var r=0;r<arguments.length;r++)t[this._len++]=arguments[r];this._prevCmd=e}},_expandData:function(){if(!(this.data instanceof Array)){for(var e=[],t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}},_needsDash:function(){return this._lineDash},_dashedLineTo:function(e,t){var r,n,o=this._dashSum,i=this._dashOffset,s=this._lineDash,a=this._ctx,c=this._xi,l=this._yi,d=e-c,u=t-l,p=po(d*d+u*u),f=c,h=l,m=s.length;for(i<0&&(i=o+i),f-=(i%=o)*(d/=p),h-=i*(u/=p);0<d&&f<=e||d<0&&e<=f||0==d&&(0<u&&h<=t||u<0&&t<=h);)f+=d*(r=s[n=this._dashIdx]),h+=u*r,this._dashIdx=(n+1)%m,0<d&&f<c||d<0&&c<f||0<u&&h<l||u<0&&l<h||a[n%2?"moveTo":"lineTo"](0<=d?ao(f,e):co(f,e),0<=u?ao(h,t):co(h,t));d=f-e,u=h-t,this._dashOffset=-po(d*d+u*u)},_dashedBezierTo:function(e,t,r,n,o,i){var s,a,c,l,d,u=this._dashSum,p=this._dashOffset,f=this._lineDash,h=this._ctx,m=this._xi,g=this._yi,v=Ln,y=0,b=this._dashIdx,_=f.length,S=0;for(p<0&&(p=u+p),p%=u,s=0;s<1;s+=.1)a=v(m,e,r,o,s+.1)-v(m,e,r,o,s),c=v(g,t,n,i,s+.1)-v(g,t,n,i,s),y+=po(a*a+c*c);for(;b<_&&!(p<(S+=f[b]));b++);for(s=(S-p)/y;s<=1;)l=v(m,e,r,o,s),d=v(g,t,n,i,s),b%2?h.moveTo(l,d):h.lineTo(l,d),s+=f[b]/y,b=(b+1)%_;b%2!=0&&h.lineTo(o,i),a=o-l,c=i-d,this._dashOffset=-po(a*a+c*c)},_dashedQuadraticTo:function(e,t,r,n){var o=r,i=n;r=(r+2*e)/3,n=(n+2*t)/3,e=(this._xi+2*e)/3,t=(this._yi+2*t)/3,this._dashedBezierTo(e,t,r,n,o,i)},toStatic:function(){var e=this.data;e instanceof Array&&(e.length=this._len,ho&&(this.data=new Float32Array(e)))},getBoundingRect:function(){no[0]=no[1]=io[0]=io[1]=Number.MAX_VALUE,oo[0]=oo[1]=so[0]=so[1]=-Number.MAX_VALUE;for(var e,t,r,n,o,i,s,a,c,l,d,u,p,f,h=this.data,m=0,g=0,v=0,y=0,b=0;b<h.length;){var _=h[b++];switch(1==b&&(v=m=h[b],y=g=h[b+1]),_){case ro.M:m=v=h[b++],g=y=h[b++],io[0]=v,io[1]=y,so[0]=v,so[1]=y;break;case ro.L:Xn(m,g,h[b],h[b+1],io,so),m=h[b++],g=h[b++];break;case ro.C:eo(m,g,h[b++],h[b++],h[b++],h[b++],h[b],h[b+1],io,so),m=h[b++],g=h[b++];break;case ro.Q:e=m,t=g,r=h[b++],n=h[b++],o=h[b],i=h[b+1],s=io,a=so,l=c=void 0,l=jn,d=Wn(Gn((c=Vn)(e,r,o),1),0),u=Wn(Gn(c(t,n,i),1),0),p=l(e,r,o,d),f=l(t,n,i,u),s[0]=Gn(e,o,p),s[1]=Gn(t,i,f),a[0]=Wn(e,o,p),a[1]=Wn(t,i,f),m=h[b++],g=h[b++];break;case ro.A:var S=h[b++],w=h[b++],E=h[b++],C=h[b++],T=h[b++],I=h[b++]+T,R=(h[b++],1-h[b++]);1==b&&(v=lo(T)*E+S,y=uo(T)*C+w),to(S,w,E,C,T,I,R,io,so),m=lo(I)*E+S,g=uo(I)*C+w;break;case ro.R:Xn(v=m=h[b++],y=g=h[b++],v+h[b++],y+h[b++],io,so);break;case ro.Z:m=v,g=y}ne(no,no,io),oe(oo,oo,so)}return 0===b&&(no[0]=no[1]=oo[0]=oo[1]=0),new Mt(no[0],no[1],oo[0]-no[0],oo[1]-no[1])},rebuildPath:function(e){for(var t,r,n,o,i,s,a=this.data,c=this._ux,l=this._uy,d=this._len,u=0;u<d;){var p=a[u++];switch(1==u&&(t=n=a[u],r=o=a[u+1]),p){case ro.M:t=n=a[u++],r=o=a[u++],e.moveTo(n,o);break;case ro.L:i=a[u++],s=a[u++],(fo(i-n)>c||fo(s-o)>l||u===d-1)&&(e.lineTo(i,s),n=i,o=s);break;case ro.C:e.bezierCurveTo(a[u++],a[u++],a[u++],a[u++],a[u++],a[u++]),n=a[u-2],o=a[u-1];break;case ro.Q:e.quadraticCurveTo(a[u++],a[u++],a[u++],a[u++]),n=a[u-2],o=a[u-1];break;case ro.A:var f=a[u++],h=a[u++],m=a[u++],g=a[u++],v=a[u++],y=a[u++],b=a[u++],_=a[u++],S=g<m?m:g,w=g<m?1:m/g,E=g<m?g/m:1,C=v+y;.001<Math.abs(m-g)?(e.translate(f,h),e.rotate(b),e.scale(w,E),e.arc(0,0,S,v,C,1-_),e.scale(1/w,1/E),e.rotate(-b),e.translate(-f,-h)):e.arc(f,h,S,v,C,1-_),1==u&&(t=lo(v)*m+f,r=uo(v)*g+h),n=lo(C)*m+f,o=uo(C)*g+h;break;case ro.R:t=n=a[u],r=o=a[u+1],e.rect(a[u++],a[u++],a[u++],a[u++]);break;case ro.Z:e.closePath(),n=t,o=r}}}},mo.CMD=ro;var bo=2*Math.PI;function _o(e){return(e%=bo)<0&&(e+=bo),e}var So=2*Math.PI;function wo(e,t,r,n,o,i,s,a,c){if(0===s)return!1;var l=s;a-=e,c-=t;var d=Math.sqrt(a*a+c*c);if(r<d-l||d+l<r)return!1;if(Math.abs(n-o)%So<1e-4)return!0;if(i){var u=n;n=_o(o),o=_o(u)}else n=_o(n),o=_o(o);o<n&&(o+=So);var p=Math.atan2(c,a);return p<0&&(p+=So),n<=p&&p<=o||n<=p+So&&p+So<=o}function Eo(e,t,r,n,o,i){if(t<i&&n<i||i<t&&i<n)return 0;if(n===t)return 0;var s=n<t?1:-1,a=(i-t)/(n-t);return 1!==a&&0!==a||(s=n<t?.5:-.5),o<a*(r-e)+e?s:0}var Co=mo.CMD,To=2*Math.PI,Io=1e-4;var Ro=[-1,-1,-1],Po=[-1,-1];function xo(e,t,r,n,o,i,s,a,c,l){if(t<l&&n<l&&i<l&&a<l||l<t&&l<n&&l<i&&l<a)return 0;var d,u=function(e,t,r,n,o,i){var s=n+3*(t-r)-e,a=3*(r-2*t+e),c=3*(t-e),l=e-o,d=a*a-3*s*c,u=a*c-9*s*l,p=c*c-3*a*l,f=0;if(On(d)&&On(u))On(a)?i[0]=0:0<=(C=-c/a)&&C<=1&&(i[f++]=C);else{var h=u*u-4*d*p;if(On(h)){var m=u/d,g=-m/2;0<=(C=-a/s+m)&&C<=1&&(i[f++]=C),0<=g&&g<=1&&(i[f++]=g)}else if(0<h){var v=Tn(h),y=d*a+1.5*s*(-u+v),b=d*a+1.5*s*(-u-v);0<=(C=(-a-((y=y<0?-Cn(-y,xn):Cn(y,xn))+(b=b<0?-Cn(-b,xn):Cn(b,xn))))/(3*s))&&C<=1&&(i[f++]=C)}else{var _=(2*d*a-3*s*u)/(2*Tn(d*d*d)),S=Math.acos(_)/3,w=Tn(d),E=Math.cos(S),C=(-a-2*w*E)/(3*s),T=(g=(-a+w*(E+Pn*Math.sin(S)))/(3*s),(-a+w*(E-Pn*Math.sin(S)))/(3*s));0<=C&&C<=1&&(i[f++]=C),0<=g&&g<=1&&(i[f++]=g),0<=T&&T<=1&&(i[f++]=T)}}return f}(t,n,i,a,l,Ro);if(0===u)return 0;for(var p,f,h=0,m=-1,g=0;g<u;g++){var v=Ro[g],y=0===v||1===v?.5:1;Ln(e,r,o,s,v)<c||(m<0&&(m=Nn(t,n,i,a,Po),Po[1]<Po[0]&&1<m&&(void 0,d=Po[0],Po[0]=Po[1],Po[1]=d),p=Ln(t,n,i,a,Po[0]),1<m&&(f=Ln(t,n,i,a,Po[1]))),2==m?v<Po[0]?h+=p<t?y:-y:v<Po[1]?h+=f<p?y:-y:h+=a<f?y:-y:v<Po[0]?h+=p<t?y:-y:h+=a<p?y:-y)}return h}function Mo(e,t,r,n,o,i,s,a){if(t<a&&n<a&&i<a||a<t&&a<n&&a<i)return 0;var c=function(e,t,r,n,o){var i=e-2*t+r,s=2*(t-e),a=e-n,c=0;if(On(i))Un(s)&&0<=(d=-a/s)&&d<=1&&(o[c++]=d);else{var l=s*s-4*i*a;if(On(l))0<=(d=-s/(2*i))&&d<=1&&(o[c++]=d);else if(0<l){var d,u=Tn(l),p=(-s-u)/(2*i);0<=(d=(-s+u)/(2*i))&&d<=1&&(o[c++]=d),0<=p&&p<=1&&(o[c++]=p)}}return c}(t,n,i,a,Ro);if(0===c)return 0;var l=Vn(t,n,i);if(0<=l&&l<=1){for(var d=0,u=jn(t,n,i,l),p=0;p<c;p++){var f=0===Ro[p]||1===Ro[p]?.5:1;jn(e,r,o,Ro[p])<s||(Ro[p]<l?d+=u<t?f:-f:d+=i<u?f:-f)}return d}f=0===Ro[0]||1===Ro[0]?.5:1;return jn(e,r,o,Ro[0])<s?0:i<t?f:-f}function ko(e,t,r,n,o,i,s,a){if(r<(a-=t)||a<-r)return 0;var c=Math.sqrt(r*r-a*a);Ro[0]=-c,Ro[1]=c;var l=Math.abs(n-o);if(l<1e-4)return 0;if(l%To<1e-4){o=To;var d=i?1:-1;return s>=Ro[n=0]+e&&s<=Ro[1]+e?d:0}if(i){c=n;n=_o(o),o=_o(c)}else n=_o(n),o=_o(o);o<n&&(o+=To);for(var u=0,p=0;p<2;p++){var f=Ro[p];if(s<f+e){var h=Math.atan2(a,f);d=i?1:-1;h<0&&(h=To+h),(n<=h&&h<=o||n<=h+To&&h+To<=o)&&(h>Math.PI/2&&h<1.5*Math.PI&&(d=-d),u+=d)}}return u}function Ao(e,t,r,n,o){for(var i,s,a=0,c=0,l=0,d=0,u=0,p=0;p<e.length;){var f=e[p++];switch(f===Co.M&&1<p&&(r||(a+=Eo(c,l,d,u,n,o))),1==p&&(d=c=e[p],u=l=e[p+1]),f){case Co.M:c=d=e[p++],l=u=e[p++];break;case Co.L:if(r){if(go(c,l,e[p],e[p+1],t,n,o))return!0}else a+=Eo(c,l,e[p],e[p+1],n,o)||0;c=e[p++],l=e[p++];break;case Co.C:if(r){if(vo(c,l,e[p++],e[p++],e[p++],e[p++],e[p],e[p+1],t,n,o))return!0}else a+=xo(c,l,e[p++],e[p++],e[p++],e[p++],e[p],e[p+1],n,o)||0;c=e[p++],l=e[p++];break;case Co.Q:if(r){if(yo(c,l,e[p++],e[p++],e[p],e[p+1],t,n,o))return!0}else a+=Mo(c,l,e[p++],e[p++],e[p],e[p+1],n,o)||0;c=e[p++],l=e[p++];break;case Co.A:var h=e[p++],m=e[p++],g=e[p++],v=e[p++],y=e[p++],b=e[p++],_=(e[p++],1-e[p++]),S=Math.cos(y)*g+h,w=Math.sin(y)*v+m;1<p?a+=Eo(c,l,S,w,n,o):(d=S,u=w);var E=(n-h)*v/g+h;if(r){if(wo(h,m,v,y,y+b,_,t,E,o))return!0}else a+=ko(h,m,v,y,y+b,_,E,o);c=Math.cos(y+b)*g+h,l=Math.sin(y+b)*v+m;break;case Co.R:d=c=e[p++],u=l=e[p++];S=d+e[p++],w=u+e[p++];if(r){if(go(d,u,S,u,t,n,o)||go(S,u,S,w,t,n,o)||go(S,w,d,w,t,n,o)||go(d,w,d,u,t,n,o))return!0}else a+=Eo(S,u,S,w,n,o),a+=Eo(d,w,d,u,n,o);break;case Co.Z:if(r){if(go(c,l,d,u,t,n,o))return!0}else a+=Eo(c,l,d,u,n,o);c=d,l=u}}return r||(i=l,s=u,Math.abs(i-s)<Io)||(a+=Eo(c,l,d,u,n,o)||0),0!==a}var Oo=Xt.prototype.getCanvasPattern,Uo=Math.abs,Lo=new mo(!0);function Do(e){zr.call(this,e),this.path=null}Do.prototype={constructor:Do,type:"path",__dirtyPath:!0,strokeContainThreshold:5,brush:function(e,t){var r,n=this.style,o=this.path||Lo,i=n.hasStroke(),s=n.hasFill(),a=n.fill,c=n.stroke,l=s&&!!a.colorStops,d=i&&!!c.colorStops,u=s&&!!a.image,p=i&&!!c.image;(n.bind(e,this,t),this.setTransform(e),this.__dirty)&&(l&&(r=r||this.getBoundingRect(),this._fillGradient=n.getGradient(e,a,r)),d&&(r=r||this.getBoundingRect(),this._strokeGradient=n.getGradient(e,c,r)));l?e.fillStyle=this._fillGradient:u&&(e.fillStyle=Oo.call(a,e)),d?e.strokeStyle=this._strokeGradient:p&&(e.strokeStyle=Oo.call(c,e));var f=n.lineDash,h=n.lineDashOffset,m=!!e.setLineDash,g=this.getGlobalScale();o.setScale(g[0],g[1]),this.__dirtyPath||f&&!m&&i?(o.beginPath(e),f&&!m&&(o.setLineDash(f),o.setLineDashOffset(h)),this.buildPath(o,this.shape,!1),this.path&&(this.__dirtyPath=!1)):(e.beginPath(),this.path.rebuildPath(e)),s&&o.fill(e),f&&m&&(e.setLineDash(f),e.lineDashOffset=h),i&&o.stroke(e),f&&m&&e.setLineDash([]),null!=n.text&&(this.restoreTransform(e),this.drawRectText(e,this.getBoundingRect()))},buildPath:function(e,t,r){},createPathProxy:function(){this.path=new mo},getBoundingRect:function(){var e=this._rect,t=this.style,r=!e;if(r){var n=this.path;n||(n=this.path=new mo),this.__dirtyPath&&(n.beginPath(),this.buildPath(n,this.shape,!1)),e=n.getBoundingRect()}if(this._rect=e,t.hasStroke()){var o=this._rectWithStroke||(this._rectWithStroke=e.clone());if(this.__dirty||r){o.copy(e);var i=t.lineWidth,s=t.strokeNoScale?this.getLineScale():1;t.hasFill()||(i=Math.max(i,this.strokeContainThreshold||4)),1e-10<s&&(o.width+=i/s,o.height+=i/s,o.x-=i/s/2,o.y-=i/s/2)}return o}return e},contain:function(e,t){var r=this.transformCoordToLocal(e,t),n=this.getBoundingRect(),o=this.style;if(e=r[0],t=r[1],n.contain(e,t)){var i=this.path.data;if(o.hasStroke()){var s=o.lineWidth,a=o.strokeNoScale?this.getLineScale():1;if(1e-10<a&&(o.hasFill()||(s=Math.max(s,this.strokeContainThreshold)),Ao(i,s/a,!0,e,t)))return!0}if(o.hasFill())return Ao(i,0,!1,e,t)}return!1},dirty:function(e){null==e&&(e=!0),e&&(this.__dirtyPath=e,this._rect=null),this.__dirty=!0,this.__zr&&this.__zr.refresh(),this.__clipTarget&&this.__clipTarget.dirty()},animateShape:function(e){return this.animate("shape",e)},attrKV:function(e,t){"shape"===e?(this.setShape(t),this.__dirtyPath=!0,this._rect=null):zr.prototype.attrKV.call(this,e,t)},setShape:function(e,t){var r=this.shape;if(r){if(M(e))for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);else r[e]=t;this.dirty(!0)}return this},getLineScale:function(){var e=this.transform;return e&&1e-10<Uo(e[0]-1)&&1e-10<Uo(e[3]-1)?Math.sqrt(Uo(e[0]*e[3]-e[2]*e[1])):1}},Do.extend=function(o){var e=function(e){Do.call(this,e),o.style&&this.style.extendFrom(o.style,!1);var t=o.shape;if(t){this.shape=this.shape||{};var r=this.shape;for(var n in t)!r.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(r[n]=t[n])}o.init&&o.init.call(this,e)};for(var t in w(e,Do),o)"style"!==t&&"shape"!==t&&(e.prototype[t]=o[t]);return e},w(Do,zr);var No=mo.CMD,Bo=[[],[],[]],jo=Math.sqrt,Fo=Math.atan2,Vo=function(e,t){var r,n,o,i,s,a=e.data,c=No.M,l=No.C,d=No.L,u=No.R,p=No.A,f=No.Q;for(i=o=0;o<a.length;){switch(r=a[o++],i=o,n=0,r){case c:case d:n=1;break;case l:n=3;break;case f:n=2;break;case p:var h=t[4],m=t[5],g=jo(t[0]*t[0]+t[1]*t[1]),v=jo(t[2]*t[2]+t[3]*t[3]),y=Fo(-t[1]/v,t[0]/g);a[o]*=g,a[o++]+=h,a[o]*=v,a[o++]+=m,a[o++]*=g,a[o++]*=v,a[o++]+=y,a[o++]+=y,i=o+=2;break;case u:b[0]=a[o++],b[1]=a[o++],re(b,b,t),a[i++]=b[0],a[i++]=b[1],b[0]+=a[o++],b[1]+=a[o++],re(b,b,t),a[i++]=b[0],a[i++]=b[1]}for(s=0;s<n;s++){var b;(b=Bo[s])[0]=a[o++],b[1]=a[o++],re(b,b,t),a[i++]=b[0],a[i++]=b[1]}}},qo=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"],Go=Math.sqrt,Wo=Math.sin,Ho=Math.cos,zo=Math.PI,Yo=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},Qo=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(Yo(e)*Yo(t))},Ko=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(Qo(e,t))};function Jo(e,t,r,n,o,i,s,a,c,l,d){var u=c*(zo/180),p=Ho(u)*(e-r)/2+Wo(u)*(t-n)/2,f=-1*Wo(u)*(e-r)/2+Ho(u)*(t-n)/2,h=p*p/(s*s)+f*f/(a*a);1<h&&(s*=Go(h),a*=Go(h));var m=(o===i?-1:1)*Go((s*s*(a*a)-s*s*(f*f)-a*a*(p*p))/(s*s*(f*f)+a*a*(p*p)))||0,g=m*s*f/a,v=m*-a*p/s,y=(e+r)/2+Ho(u)*g-Wo(u)*v,b=(t+n)/2+Wo(u)*g+Ho(u)*v,_=Ko([1,0],[(p-g)/s,(f-v)/a]),S=[(p-g)/s,(f-v)/a],w=[(-1*p-g)/s,(-1*f-v)/a],E=Ko(S,w);Qo(S,w)<=-1&&(E=zo),1<=Qo(S,w)&&(E=0),0===i&&0<E&&(E-=2*zo),1===i&&E<0&&(E+=2*zo),d.addData(l,y,b,s,a,_,E,u,i)}function Xo(e,t){var r=function(e){if(!e)return[];var t,r=e.replace(/-/g," -").replace(/  /g," ").replace(/ /g,",").replace(/,,/g,",");for(t=0;t<qo.length;t++)r=r.replace(new RegExp(qo[t],"g"),"|"+qo[t]);var n,o=r.split("|"),i=0,s=0,a=new mo,c=mo.CMD;for(t=1;t<o.length;t++){var l,d=o[t],u=d.charAt(0),p=0,f=d.slice(1).replace(/e,-/g,"e-").split(",");0<f.length&&""===f[0]&&f.shift();for(var h=0;h<f.length;h++)f[h]=parseFloat(f[h]);for(;p<f.length&&!isNaN(f[p])&&!isNaN(f[0]);){var m,g,v,y,b,_,S,w=i,E=s;switch(u){case"l":i+=f[p++],s+=f[p++],l=c.L,a.addData(l,i,s);break;case"L":i=f[p++],s=f[p++],l=c.L,a.addData(l,i,s);break;case"m":i+=f[p++],s+=f[p++],l=c.M,a.addData(l,i,s),u="l";break;case"M":i=f[p++],s=f[p++],l=c.M,a.addData(l,i,s),u="L";break;case"h":i+=f[p++],l=c.L,a.addData(l,i,s);break;case"H":i=f[p++],l=c.L,a.addData(l,i,s);break;case"v":s+=f[p++],l=c.L,a.addData(l,i,s);break;case"V":s=f[p++],l=c.L,a.addData(l,i,s);break;case"C":l=c.C,a.addData(l,f[p++],f[p++],f[p++],f[p++],f[p++],f[p++]),i=f[p-2],s=f[p-1];break;case"c":l=c.C,a.addData(l,f[p++]+i,f[p++]+s,f[p++]+i,f[p++]+s,f[p++]+i,f[p++]+s),i+=f[p-2],s+=f[p-1];break;case"S":m=i,g=s;var C=a.len(),T=a.data;n===c.C&&(m+=i-T[C-4],g+=s-T[C-3]),l=c.C,w=f[p++],E=f[p++],i=f[p++],s=f[p++],a.addData(l,m,g,w,E,i,s);break;case"s":m=i,g=s,C=a.len(),T=a.data,n===c.C&&(m+=i-T[C-4],g+=s-T[C-3]),l=c.C,w=i+f[p++],E=s+f[p++],i+=f[p++],s+=f[p++],a.addData(l,m,g,w,E,i,s);break;case"Q":w=f[p++],E=f[p++],i=f[p++],s=f[p++],l=c.Q,a.addData(l,w,E,i,s);break;case"q":w=f[p++]+i,E=f[p++]+s,i+=f[p++],s+=f[p++],l=c.Q,a.addData(l,w,E,i,s);break;case"T":m=i,g=s,C=a.len(),T=a.data,n===c.Q&&(m+=i-T[C-4],g+=s-T[C-3]),i=f[p++],s=f[p++],l=c.Q,a.addData(l,m,g,i,s);break;case"t":m=i,g=s,C=a.len(),T=a.data,n===c.Q&&(m+=i-T[C-4],g+=s-T[C-3]),i+=f[p++],s+=f[p++],l=c.Q,a.addData(l,m,g,i,s);break;case"A":v=f[p++],y=f[p++],b=f[p++],_=f[p++],S=f[p++],Jo(w=i,E=s,i=f[p++],s=f[p++],_,S,v,y,b,l=c.A,a);break;case"a":v=f[p++],y=f[p++],b=f[p++],_=f[p++],S=f[p++],Jo(w=i,E=s,i+=f[p++],s+=f[p++],_,S,v,y,b,l=c.A,a)}}"z"!==u&&"Z"!==u||(l=c.Z,a.addData(l)),n=l}return a.toStatic(),a}(e);return(t=t||{}).buildPath=function(e){if(e.setData){e.setData(r.data),(t=e.getContext())&&e.rebuildPath(t)}else{var t=e;r.rebuildPath(t)}},t.applyTransform=function(e){Vo(r,e),this.dirty(!0)},t}var $o=(Object.freeze||Object)({createFromString:function(e,t){return new Do(Xo(e,t))},extendFromString:function(e,t){return Do.extend(Xo(e,t))},mergePath:function(e,t){for(var r=[],n=e.length,o=0;o<n;o++){var i=e[o];i.path||i.createPathProxy(),i.__dirtyPath&&i.buildPath(i.path,i.shape,!0),r.push(i.path)}var s=new Do(t);return s.createPathProxy(),s.buildPath=function(e){e.appendPath(r);var t=e.getContext();t&&e.rebuildPath(t)},s}}),Zo=Do.extend({type:"compound",shape:{paths:null},_updatePathDirty:function(){for(var e=this.__dirtyPath,t=this.shape.paths,r=0;r<t.length;r++)e=e||t[r].__dirtyPath;this.__dirtyPath=e,this.__dirty=this.__dirty||e},beforeBrush:function(){this._updatePathDirty();for(var e=this.shape.paths||[],t=this.getGlobalScale(),r=0;r<e.length;r++)e[r].path||e[r].createPathProxy(),e[r].path.setScale(t[0],t[1])},buildPath:function(e,t){for(var r=t.paths||[],n=0;n<r.length;n++)r[n].buildPath(e,r[n].shape,!0)},afterBrush:function(){for(var e=this.shape.paths||[],t=0;t<e.length;t++)e[t].__dirtyPath=!1},getBoundingRect:function(){return this._updatePathDirty(),Do.prototype.getBoundingRect.call(this)}}),ei=function(e){zr.call(this,e)};function ti(e){zr.call(this,e),this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this._needsClear=!0}ei.prototype={constructor:ei,type:"text",brush:function(e,t){var r=this.style;this.__dirty&&xr(r),r.fill=r.stroke=r.shadowBlur=r.shadowColor=r.shadowOffsetX=r.shadowOffsetY=null;var n=r.text;null!=n&&(n+=""),r.bind(e,this,t),Gr(n,r)&&(this.setTransform(e),kr(this,e,n,r),this.restoreTransform(e))},getBoundingRect:function(){var e=this.style;if(this.__dirty&&xr(e),!this._rect){var t=e.text;null!=t?t+="":t="";var r=hr(e.text+"",e.font,e.textAlign,e.textVerticalAlign,e.textPadding,e.rich);if(r.x+=e.x||0,r.y+=e.y||0,jr(e.textStroke,e.textStrokeWidth)){var n=e.textStrokeWidth;r.x-=n/2,r.y-=n/2,r.width+=n,r.height+=n}this._rect=r}return this._rect}},w(ei,zr),ti.prototype.isIncremental=!0,ti.prototype.needsClear=function(){return this._needsClear},ti.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.dirty(),this._needsClear=!0},ti.prototype.addDisplayable=function(e,t){t?this._temporaryDisplayables.push(e):this._displayables.push(e),this.dirty()},ti.prototype.addDisplayables=function(e,t){t=t||!1;for(var r=0;r<e.length;r++)this.addDisplayable(e[r],t)},ti.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){(t=this._displayables[e]).parent=this,t.update(),t.parent=null}for(e=0;e<this._temporaryDisplayables.length;e++){var t;(t=this._temporaryDisplayables[e]).parent=this,t.update(),t.parent=null}},ti.prototype.brush=function(e,t){for(var r=this._cursor;r<this._displayables.length;r++)this._displayables[r].brush(e,r===this._cursor?null:this._displayables[r-1]);this._cursor=r;for(r=0;r<this._temporaryDisplayables.length;r++)this._temporaryDisplayables[r].brush(e,0===r?null:this._temporaryDisplayables[r-1]);this._temporaryDisplayables=[],this._needsClear=!1};var ri=[];ti.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new Mt(1/0,1/0,-1/0,-1/0),t=0;t<this._displayables.length;t++){var r=this._displayables[t],n=r.getBoundingRect().clone();r.needLocalTransform()&&n.applyTransform(r.getLocalTransform(ri)),e.union(n)}this._rect=e}return this._rect},ti.prototype.contain=function(e,t){var r=this.transformCoordToLocal(e,t);if(this.getBoundingRect().contain(r[0],r[1]))for(var n=0;n<this._displayables.length;n++){if(this._displayables[n].contain(e,t))return!0}return!1},w(ti,zr);var ni=Do.extend({type:"arc",shape:{cx:0,cy:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.cx,n=t.cy,o=Math.max(t.r,0),i=t.startAngle,s=t.endAngle,a=t.clockwise,c=Math.cos(i),l=Math.sin(i);e.moveTo(c*o+r,l*o+n),e.arc(r,n,o,i,s,!a)}}),oi=[];function ii(e,t,r){var n=e.cpx2,o=e.cpy2;return null===n||null===o?[(r?Dn:Ln)(e.x1,e.cpx1,e.cpx2,e.x2,t),(r?Dn:Ln)(e.y1,e.cpy1,e.cpy2,e.y2,t)]:[(r?Fn:jn)(e.x1,e.cpx1,e.x2,t),(r?Fn:jn)(e.y1,e.cpy1,e.y2,t)]}var si=Do.extend({type:"bezier-curve",shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.x1,n=t.y1,o=t.x2,i=t.y2,s=t.cpx1,a=t.cpy1,c=t.cpx2,l=t.cpy2,d=t.percent;0!==d&&(e.moveTo(r,n),null==c||null==l?(d<1&&(qn(r,s,o,d,oi),s=oi[1],o=oi[2],qn(n,a,i,d,oi),a=oi[1],i=oi[2]),e.quadraticCurveTo(s,a,o,i)):(d<1&&(Bn(r,s,c,o,d,oi),s=oi[1],c=oi[2],o=oi[3],Bn(n,a,l,i,d,oi),a=oi[1],l=oi[2],i=oi[3]),e.bezierCurveTo(s,a,c,l,o,i)))},pointAt:function(e){return ii(this.shape,e,!1)},tangentAt:function(e){var t=ii(this.shape,e,!0);return X(t,t)}}),ai=Do.extend({type:"circle",shape:{cx:0,cy:0,r:0},buildPath:function(e,t,r){r&&e.moveTo(t.cx+t.r,t.cy),e.arc(t.cx,t.cy,t.r,0,2*Math.PI,!0)}}),ci=Do.extend({type:"droplet",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var r=t.cx,n=t.cy,o=t.width,i=t.height;e.moveTo(r,n+o),e.bezierCurveTo(r+o,n+o,r+3*o/2,n-o/3,r,n-i),e.bezierCurveTo(r-3*o/2,n-o/3,r-o,n+o,r,n+o),e.closePath()}}),li=Do.extend({type:"ellipse",shape:{cx:0,cy:0,rx:0,ry:0},buildPath:function(e,t){var r=t.cx,n=t.cy,o=t.rx,i=t.ry,s=.5522848*o,a=.5522848*i;e.moveTo(r-o,n),e.bezierCurveTo(r-o,n-a,r-s,n-i,r,n-i),e.bezierCurveTo(r+s,n-i,r+o,n-a,r+o,n),e.bezierCurveTo(r+o,n+a,r+s,n+i,r,n+i),e.bezierCurveTo(r-s,n+i,r-o,n+a,r-o,n),e.closePath()}}),di=Do.extend({type:"heart",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var r=t.cx,n=t.cy,o=t.width,i=t.height;e.moveTo(r,n),e.bezierCurveTo(r+o/2,n-2*i/3,r+2*o,n+i/3,r,n+i),e.bezierCurveTo(r-2*o,n+i/3,r-o/2,n-2*i/3,r,n)}}),ui=Math.PI,pi=Math.sin,fi=Math.cos,hi=Do.extend({type:"isogon",shape:{x:0,y:0,r:0,n:0},buildPath:function(e,t){var r=t.n;if(r&&!(r<2)){var n=t.x,o=t.y,i=t.r,s=2*ui/r,a=-ui/2;e.moveTo(n+i*fi(a),o+i*pi(a));for(var c=0,l=r-1;c<l;c++)a+=s,e.lineTo(n+i*fi(a),o+i*pi(a));e.closePath()}}}),mi=Do.extend({type:"line",shape:{x1:0,y1:0,x2:0,y2:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.x1,n=t.y1,o=t.x2,i=t.y2,s=t.percent;0!==s&&(e.moveTo(r,n),s<1&&(o=r*(1-s)+o*s,i=n*(1-s)+i*s),e.lineTo(o,i))},pointAt:function(e){var t=this.shape;return[t.x1*(1-e)+t.x2*e,t.y1*(1-e)+t.y2*e]}});function gi(e,t,r,n,o,i,s){var a=.5*(r-e),c=.5*(n-t);return(2*(t-r)+a+c)*s+(-3*(t-r)-2*a-c)*i+a*o+t}function vi(e,t,r){var n=t.points,o=t.smooth;if(n&&2<=n.length){if(o&&"spline"!==o){var i=function(e,t,r,n){var o,i,s,a,c=[],l=[],d=[],u=[];if(n){s=[1/0,1/0],a=[-1/0,-1/0];for(var p=0,f=e.length;p<f;p++)ne(s,s,e[p]),oe(a,a,e[p]);ne(s,s,n[0]),oe(a,a,n[1])}for(p=0,f=e.length;p<f;p++){var h=e[p];if(r)o=e[p?p-1:f-1],i=e[(p+1)%f];else{if(0===p||p===f-1){c.push(G(e[p]));continue}o=e[p-1],i=e[p+1]}H(l,i,o),J(l,l,t);var m=$(h,o),g=$(h,i),v=m+g;0!==v&&(m/=v,g/=v),J(d,l,-m),J(u,l,g);var y=W([],h,d),b=W([],h,u);n&&(oe(y,y,s),ne(y,y,a),oe(b,b,s),ne(b,b,a)),c.push(y),c.push(b)}return r&&c.push(c.shift()),c}(n,o,r,t.smoothConstraint);e.moveTo(n[0][0],n[0][1]);for(var s=n.length,a=0;a<(r?s:s-1);a++){var c=i[2*a],l=i[2*a+1],d=n[(a+1)%s];e.bezierCurveTo(c[0],c[1],l[0],l[1],d[0],d[1])}}else{"spline"===o&&(n=function(e,t){for(var r=e.length,n=[],o=0,i=1;i<r;i++)o+=$(e[i-1],e[i]);var s=o/2;s=s<r?r:s;for(i=0;i<s;i++){var a,c,l,d=i/(s-1)*(t?r:r-1),u=Math.floor(d),p=d-u,f=e[u%r];l=t?(a=e[(u-1+r)%r],c=e[(u+1)%r],e[(u+2)%r]):(a=e[0===u?u:u-1],c=e[r-2<u?r-1:u+1],e[r-3<u?r-1:u+2]);var h=p*p,m=p*h;n.push([gi(a[0],f[0],c[0],l[0],p,h,m),gi(a[1],f[1],c[1],l[1],p,h,m)])}return n}(n,r)),e.moveTo(n[0][0],n[0][1]);a=1;for(var u=n.length;a<u;a++)e.lineTo(n[a][0],n[a][1])}r&&e.closePath()}}var yi,bi=Do.extend({type:"polygon",shape:{points:null,smooth:!1,smoothConstraint:null},buildPath:function(e,t){vi(e,t,!0)}}),_i=Do.extend({type:"polyline",shape:{points:null,smooth:!1,smoothConstraint:null},style:{stroke:"#000",fill:null},buildPath:function(e,t){vi(e,t,!1)}}),Si=Do.extend({type:"rect",shape:{r:0,x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y,o=t.width,i=t.height;t.r?Ir(e,t):e.rect(r,n,o,i),e.closePath()}}),wi=Do.extend({type:"ring",shape:{cx:0,cy:0,r:0,r0:0},buildPath:function(e,t){var r=t.cx,n=t.cy,o=2*Math.PI;e.moveTo(r+t.r,n),e.arc(r,n,t.r,0,o,!1),e.moveTo(r+t.r0,n),e.arc(r,n,t.r0,0,o,!0)}}),Ei=Do.extend({type:"Arrowline",shape:{x1:0,y1:0,x2:0,y2:0,percent:1,arrowlength:10,arrowtype:1,points:[]},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.x1,n=t.y1,o=t.x2,i=t.y2,s=t.percent,a=t.arrowlength;if(0!==s)if(e.moveTo(r,n),s<1&&(o=r*(1-s)+o*s,i=n*(1-s)+i*s),e.lineTo(o,i),1==t.arrowtype);else{var c=[],l=Math.sqrt((o-r)*(o-r)+(i-n)*(i-n)),d=-(i-n)/l,u=(o-r)/l,p=a*(Math.cos(5*Math.PI/6)*u-Math.sin(5*Math.PI/6)*d),f=a*(Math.cos(5*Math.PI/6)*d+Math.sin(5*Math.PI/6)*u),h=r*(1-(s=1-a*(Math.cos(Math.PI/6)-.5)/l))+o*s,m=n*(1-s)+i*s,g=a*(Math.cos(7*Math.PI/6)*u-Math.sin(7*Math.PI/6)*d),v=a*(Math.cos(7*Math.PI/6)*d+Math.sin(7*Math.PI/6)*u),y=r*(1-(s=1-s))+o*s,b=n*(1-s)+i*s;3==t.arrowtype?(c.push([o,i]),c.push([o+p,i-f]),c.push([h,m]),c.push([o+g,i-v]),c.push([o,i])):2==t.arrowtype?(c.push([r,n]),c.push([r-p,n+f]),c.push([y,b]),c.push([r-g,n+v]),c.push([r,n])):4==t.arrowtype&&(c.push([o,i]),c.push([o+p,i-f]),c.push([h,m]),c.push([o+g,i-v]),c.push([o,i]),c.push([r,n]),c.push([r-p,n+f]),c.push([y,b]),c.push([r-g,n+v]),c.push([r,n])),t.points=c,vi(e,t,!0)}}}),Ci=Math.sin,Ti=Math.cos,Ii=Math.PI/180,Ri=Do.extend({type:"rose",shape:{cx:0,cy:0,r:[],k:0,n:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r,n,o,i=t.r,s=t.k,a=t.n,c=t.cx,l=t.cy;e.moveTo(c,l);for(var d=0,u=i.length;d<u;d++){o=i[d];for(var p=0;p<=360*a;p++)r=o*Ci(s/a*p%360*Ii)*Ti(p*Ii)+c,n=o*Ci(s/a*p%360*Ii)*Ci(p*Ii)+l,e.lineTo(r,n)}}}),Pi=[["shadowBlur",0],["shadowColor","#000"],["shadowOffsetX",0],["shadowOffsetY",0]],xi=Do.extend({type:"sector",shape:{cx:0,cy:0,r0:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},brush:(yi=Do.prototype.brush,d.browser.ie&&11<=d.browser.version?function(){var e,t=this.__clipPaths,r=this.style;if(t)for(var n=0;n<t.length;n++){var o=t[n],i=o&&o.shape,s=o&&o.type;if(i&&("sector"===s&&i.startAngle===i.endAngle||"rect"===s&&(!i.width||!i.height))){for(var a=0;a<Pi.length;a++)Pi[a][2]=r[Pi[a][0]],r[Pi[a][0]]=Pi[a][1];e=!0;break}}if(yi.apply(this,arguments),e)for(a=0;a<Pi.length;a++)r[Pi[a][0]]=Pi[a][2]}:yi),buildPath:function(e,t){var r=t.cx,n=t.cy,o=Math.max(t.r0||0,0),i=Math.max(t.r,0),s=t.startAngle,a=t.endAngle,c=t.clockwise,l=Math.cos(s),d=Math.sin(s);e.moveTo(l*o+r,d*o+n),e.lineTo(l*i+r,d*i+n),e.arc(r,n,i,s,a,!c),e.lineTo(Math.cos(a)*o+r,Math.sin(a)*o+n),0!==o&&e.arc(r,n,o,a,s,c),e.closePath()}}),Mi=Math.PI,ki=Math.cos,Ai=Math.sin,Oi=Do.extend({type:"star",shape:{cx:0,cy:0,n:3,r0:null,r:0},buildPath:function(e,t){var r=t.n;if(r&&!(r<2)){var n=t.cx,o=t.cy,i=t.r,s=t.r0;null==s&&(s=4<r?i*ki(2*Mi/r)/ki(Mi/r):i/3);var a=Mi/r,c=-Mi/2,l=n+i*ki(c),d=o+i*Ai(c);c+=a,e.moveTo(l,d);for(var u,p=0,f=2*r-1;p<f;p++)u=p%2==0?s:i,e.lineTo(n+u*ki(c),o+u*Ai(c)),c+=a;e.closePath()}}}),Ui=Math.cos,Li=Math.sin,Di=Do.extend({type:"trochoid",shape:{cx:0,cy:0,r:0,r0:0,d:0,location:"out"},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r,n,o,i,s=t.r,a=t.r0,c=t.d,l=t.cx,d=t.cy,u="out"==t.location?1:-1;if(!(t.location&&s<=a)){var p,f=0,h=1;for(r=(s+u*a)*Ui(0)-u*c*Ui(0)+l,n=(s+u*a)*Li(0)-c*Li(0)+d,e.moveTo(r,n);a*++f%(s+u*a)!=0;);for(;p=Math.PI/180*h,o=(s+u*a)*Ui(p)-u*c*Ui((s/a+u)*p)+l,i=(s+u*a)*Li(p)-c*Li((s/a+u)*p)+d,e.lineTo(o,i),++h<=a*f/(s+u*a)*360;);}}}),Ni=function(e){this.colorStops=e||[]};Ni.prototype={constructor:Ni,addColorStop:function(e,t){this.colorStops.push({offset:e,color:t})}};var Bi=function(e,t,r,n,o,i){this.x=null==e?0:e,this.y=null==t?0:t,this.x2=null==r?1:r,this.y2=null==n?0:n,this.type="linear",this.global=i||!1,Ni.call(this,o)};Bi.prototype={constructor:Bi},w(Bi,Ni);var ji=function(e,t,r,n,o){this.x=null==e?.5:e,this.y=null==t?.5:t,this.r=null==r?.5:r,this.type="radial",this.global=o||!1,Ni.call(this,n)};ji.prototype={constructor:ji},w(ji,Ni);function Fi(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}var Vi=mo.CMD,qi=Array.prototype.join,Gi="none",Wi=Math.round,Hi=Math.sin,zi=Math.cos,Yi=Math.PI,Qi=2*Math.PI,Ki=180/Yi,Ji=1e-4;function Xi(e){return Wi(1e4*e)/1e4}function $i(e){return e<Ji&&-Ji<e}function Zi(e,t){t&&es(e,"transform","matrix("+qi.call(t,",")+")")}function es(e,t,r){(!r||"linear"!==r.type&&"radial"!==r.type)&&e.setAttribute(t,r)}function ts(e,t,r){if(o=t,null!=(i=r?o.textFill:o.fill)&&i!==Gi){var n=r?t.textFill:t.fill;n="transparent"===n?Gi:n,"none"!==e.getAttribute("clip-path")&&n===Gi&&(n="rgba(0, 0, 0, 0.002)"),es(e,"fill",n),es(e,"fill-opacity",t.opacity)}else es(e,"fill",Gi);var o,i,s,a;if(s=t,null!=(a=r?s.textStroke:s.stroke)&&a!==Gi){var c=r?t.textStroke:t.stroke;es(e,"stroke",c="transparent"===c?Gi:c),es(e,"stroke-width",(r?t.textStrokeWidth:t.lineWidth)/(!r&&t.strokeNoScale?t.host.getLineScale():1)),es(e,"paint-order","stroke"),es(e,"stroke-opacity",t.opacity),t.lineDash?(es(e,"stroke-dasharray",t.lineDash.join(",")),es(e,"stroke-dashoffset",Wi(t.lineDashOffset||0))):es(e,"stroke-dasharray",""),t.lineCap&&es(e,"stroke-linecap",t.lineCap),t.lineJoin&&es(e,"stroke-linejoin",t.lineJoin),t.miterLimit&&es(e,"stroke-miterlimit",t.miterLimit)}else es(e,"stroke",Gi)}var rs={};rs.brush=function(e){var t=e.style,r=e.__svgEl;r||(r=Fi("path"),e.__svgEl=r),e.path||e.createPathProxy();var n=e.path;if(e.__dirtyPath){n.beginPath(),e.buildPath(n,e.shape),e.__dirtyPath=!1;var o=function(e){for(var t=[],r=e.data,n=e.len(),o=0;o<n;){var i="",s=0;switch(r[o++]){case Vi.M:i="M",s=2;break;case Vi.L:i="L",s=2;break;case Vi.Q:i="Q",s=4;break;case Vi.C:i="C",s=6;break;case Vi.A:var a=r[o++],c=r[o++],l=r[o++],d=r[o++],u=r[o++],p=r[o++],f=r[o++],h=r[o++],m=Math.abs(p),g=$i(m%Qi)&&!$i(m),v=!1;v=Qi<=m||!$i(m)&&(-Yi<p&&p<0||Yi<p)==!!h;var y=Xi(a+l*zi(u)),b=Xi(c+d*Hi(u));g&&(p=h?Qi-1e-4:1e-4-Qi,v=!0,9===o&&t.push("M",y,b));var _=Xi(a+l*zi(u+p)),S=Xi(c+d*Hi(u+p));t.push("A",Xi(l),Xi(d),Wi(f*Ki),+v,+h,_,S);break;case Vi.Z:i="Z";break;case Vi.R:_=Xi(r[o++]),S=Xi(r[o++]);var w=Xi(r[o++]),E=Xi(r[o++]);t.push("M",_,S,"L",_+w,S,"L",_+w,S+E,"L",_,S+E,"L",_,S)}i&&t.push(i);for(var C=0;C<s;C++)t.push(Xi(r[o++]))}return t.join(" ")}(n);o.indexOf("NaN")<0&&es(r,"d",o)}ts(r,t),Zi(r,e.transform),null!=t.text&&ss(e,e.getBoundingRect())};var ns={brush:function(e){var t=e.style,r=t.image;r instanceof HTMLImageElement&&(r=r.src);if(r){var n,o,i=t.x||0,s=t.y||0,a=t.width,c=t.height,l=e.__svgEl;l||(l=Fi("image"),e.__svgEl=l),r!==e.__imageSrc&&(n="href",o=r,l.setAttributeNS("http://www.w3.org/1999/xlink",n,o),e.__imageSrc=r),es(l,"width",a),es(l,"height",c),es(l,"x",i),es(l,"y",s),Zi(l,e.transform),null!=t.text&&ss(e,e.getBoundingRect())}}},os={},is=new Mt,ss=function(e,t,r){var n=e.style;e.__dirty&&xr(n);var o=n.text;if(null!=o){o+="";var i,s,a=e.__textSvgEl;if(a||(a=Fi("text"),e.__textSvgEl=a),ts(a,n,!0),e instanceof ei||e.style.transformText)Zi(a,e.transform);else if(e.transform)is.copy(t),is.applyTransform(e.transform),t=is;else{var c=e.transformCoordToGlobal(t.x,t.y);t.x=c[0],t.y=c[1]}var l=n.textPosition,d=n.textDistance,u=n.textAlign||"left";"number"==typeof n.fontSize&&(n.fontSize+="px");var p=n.font||[n.fontStyle||"",n.fontWeight||"",n.fontSize||"",n.fontFamily||""].join(" ")||ur,f=as(n.textVerticalAlign),h=(r=hr(o,p,u,f)).lineHeight;if(l instanceof Array)i=t.x+l[0],s=t.y+l[1];else{var m=vr(l,t,d);i=m.x,s=m.y,f=as(m.textVerticalAlign),u=m.textAlign}es(a,"alignment-baseline",f),p&&(a.style.font=p);var g=n.textPadding;es(a,"x",i),es(a,"y",s);var v=o.split("\n"),y=v.length,b=u;"left"===b?(b="start",g&&(i+=g[3])):"right"===b?(b="end",g&&(i-=g[1])):"center"===b&&(b="middle",g&&(i+=(g[3]-g[1])/2));var _=0;if("baseline"===f?(_=-r.height+h,g&&(_-=g[2])):"middle"===f?(_=(-r.height+h)/2,g&&(s+=(g[0]-g[2])/2)):g&&(_+=g[0]),e.__text!==o||e.__textFont!==p){var S=e.__tspanList||[];e.__tspanList=S;for(var w=0;w<y;w++){(C=S[w])?C.innerHTML="":(C=S[w]=Fi("tspan"),a.appendChild(C),es(C,"alignment-baseline",f),es(C,"text-anchor",b)),es(C,"x",i),es(C,"y",s+w*h+_),C.appendChild(document.createTextNode(v[w]))}for(;w<S.length;w++)a.removeChild(S[w]);S.length=y,e.__text=o,e.__textFont=p}else if(e.__tspanList.length){var E=e.__tspanList.length;for(w=0;w<E;++w){var C;(C=e.__tspanList[w])&&(es(C,"x",i),es(C,"y",s+w*h+_))}}}};function as(e){return"middle"===e?"middle":"bottom"===e?"baseline":"hanging"}function cs(){}function ls(e,t,r,n){for(var o=0,i=t.length,s=0,a=0;o<i;o++){var c=t[o];if(c.removed){for(l=[],d=a;d<a+c.count;d++)l.push(d);c.indices=l,a+=c.count}else{for(var l=[],d=s;d<s+c.count;d++)l.push(d);c.indices=l,s+=c.count,c.added||(a+=c.count)}}return t}os.drawRectText=ss,os.brush=function(e){var t=e.style;null!=t.text&&(t.textPosition=[0,0],ss(e,{x:t.x||0,y:t.y||0,width:0,height:0},e.getBoundingRect()))},cs.prototype={diff:function(c,l,e){e||(e=function(e,t){return e===t}),this.equals=e;var d=this;c=c.slice();var u=(l=l.slice()).length,p=c.length,f=1,t=u+p,h=[{newPos:-1,components:[]}],r=this.extractCommon(h[0],l,c,0);if(h[0].newPos+1>=u&&p<=r+1){for(var n=[],o=0;o<l.length;o++)n.push(o);return[{indices:n,count:l.length}]}function i(){for(var e=-1*f;e<=f;e+=2){var t,r=h[e-1],n=h[e+1],o=(n?n.newPos:0)-e;r&&(h[e-1]=void 0);var i=r&&r.newPos+1<u,s=n&&0<=o&&o<p;if(i||s){if(!i||s&&r.newPos<n.newPos?(t={newPos:(a=n).newPos,components:a.components.slice(0)},d.pushComponent(t.components,void 0,!0)):((t=r).newPos++,d.pushComponent(t.components,!0,void 0)),o=d.extractCommon(t,l,c,e),t.newPos+1>=u&&p<=o+1)return ls(d,t.components,l,c);h[e]=t}else h[e]=void 0}var a;f++}for(;f<=t;){var s=i();if(s)return s}},pushComponent:function(e,t,r){var n=e[e.length-1];n&&n.added===t&&n.removed===r?e[e.length-1]={count:n.count+1,added:t,removed:r}:e.push({count:1,added:t,removed:r})},extractCommon:function(e,t,r,n){for(var o=t.length,i=r.length,s=e.newPos,a=s-n,c=0;s+1<o&&a+1<i&&this.equals(t[s+1],r[a+1]);)s++,a++,c++;return c&&e.components.push({count:c}),e.newPos=s,a},tokenize:function(e){return e.slice()},join:function(e){return e.slice()}};var ds=new cs;function us(e,t,r,n){this._svgRoot=e,this._tagNames="string"==typeof t?[t]:t,this._markLabel=r,this._domName=n||"_dom",this.nextId=0}function ps(e){us.call(this,e,["linearGradient","radialGradient"],"__gradient_in_use__")}function fs(e){us.call(this,e,"clipPath","__clippath_in_use__")}function hs(e){us.call(this,e,["filter"],"__filter_in_use__","_shadowDom")}function ms(e){return e&&(e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY||e.textShadowBlur||e.textShadowOffsetX||e.textShadowOffsetY)}function gs(e){return parseInt(e,10)}function vs(e,t){return t&&e&&t.parentNode!==e}function ys(e,t,r){if(vs(e,t)&&r){var n=r.nextSibling;n?e.insertBefore(t,n):e.appendChild(t)}}function bs(e,t){if(vs(e,t)){var r=e.firstChild;r?e.insertBefore(t,r):e.appendChild(t)}}function _s(e,t){t&&e&&t.parentNode===e&&e.removeChild(t)}function Ss(e){return e.__textSvgEl}function ws(e){return e.__svgEl}us.prototype.createElement=Fi,us.prototype.getDefs=function(e){var t=this._svgRoot,n=this._svgRoot.getElementsByTagName("defs");return 0===n.length?e?((n=t.insertBefore(this.createElement("defs"),t.firstChild)).contains||(n.contains=function(e){var t=n.children;if(!t)return!1;for(var r=t.length-1;0<=r;--r)if(t[r]===e)return!0;return!1}),n):null:n[0]},us.prototype.update=function(e,t){if(e){var r=this.getDefs(!1);if(e[this._domName]&&r.contains(e[this._domName]))"function"==typeof t&&t(e);else{var n=this.add(e);n&&(e[this._domName]=n)}}},us.prototype.addDom=function(e){this.getDefs(!0).appendChild(e)},us.prototype.removeDom=function(e){var t=this.getDefs(!1);t&&(t.removeChild(e[this._domName]),e[this._domName]=null)},us.prototype.getDoms=function(){var r=this.getDefs(!1);if(!r)return[];var n=[];return C(this._tagNames,function(e){var t=r.getElementsByTagName(e);n=n.concat([].slice.call(t))}),n},us.prototype.markAllUnused=function(){var e=this.getDoms(),t=this;C(e,function(e){e[t._markLabel]="0"})},us.prototype.markUsed=function(e){e&&(e[this._markLabel]="1")},us.prototype.removeUnused=function(){var t=this.getDefs(!1);if(t){var e=this.getDoms(),r=this;C(e,function(e){"1"!==e[r._markLabel]&&t.removeChild(e)})}},us.prototype.getSvgProxy=function(e){return e instanceof Do?rs:e instanceof Yr?ns:e instanceof ei?os:rs},us.prototype.getTextSvgElement=function(e){return e.__textSvgEl},us.prototype.getSvgElement=function(e){return e.__svgEl},w(ps,us),ps.prototype.addWithoutUpdate=function(i,s){if(s&&s.style){var a=this;C(["fill","stroke"],function(e){if(s.style[e]&&("linear"===s.style[e].type||"radial"===s.style[e].type)){var t,r=s.style[e],n=a.getDefs(!0);r._dom?(t=r._dom,n.contains(r._dom)||a.addDom(t)):t=a.add(r),a.markUsed(s);var o=t.getAttribute("id");i.setAttribute(e,"url(#"+o+")")}})}},ps.prototype.add=function(e){var t;if("linear"===e.type)t=this.createElement("linearGradient");else{if("radial"!==e.type)return _t("Illegal gradient type."),null;t=this.createElement("radialGradient")}return e.id=e.id||this.nextId++,t.setAttribute("id","zr-gradient-"+e.id),this.updateDom(e,t),this.addDom(t),t},ps.prototype.update=function(r){var n=this;us.prototype.update.call(this,r,function(){var e=r.type,t=r._dom.tagName;"linear"===e&&"linearGradient"===t||"radial"===e&&"radialGradient"===t?n.updateDom(r,r._dom):(n.removeDom(r),n.add(r))})},ps.prototype.updateDom=function(e,t){if("linear"===e.type)t.setAttribute("x1",e.x),t.setAttribute("y1",e.y),t.setAttribute("x2",e.x2),t.setAttribute("y2",e.y2);else{if("radial"!==e.type)return void _t("Illegal gradient type.");t.setAttribute("cx",e.x),t.setAttribute("cy",e.y),t.setAttribute("r",e.r)}e.global?t.setAttribute("gradientUnits","userSpaceOnUse"):t.setAttribute("gradientUnits","objectBoundingBox"),t.innerHTML="";for(var r=e.colorStops,n=0,o=r.length;n<o;++n){var i=this.createElement("stop");i.setAttribute("offset",100*r[n].offset+"%"),i.setAttribute("stop-color",r[n].color),t.appendChild(i)}e._dom=t},ps.prototype.markUsed=function(e){if(e.style){var t=e.style.fill;t&&t._dom&&us.prototype.markUsed.call(this,t._dom),(t=e.style.stroke)&&t._dom&&us.prototype.markUsed.call(this,t._dom)}},w(fs,us),fs.prototype.update=function(e){var t=this.getSvgElement(e);t&&this.updateDom(t,e.__clipPaths,!1);var r=this.getTextSvgElement(e);r&&this.updateDom(r,e.__clipPaths,!0),this.markUsed(e)},fs.prototype.updateDom=function(e,t,r){if(t&&0<t.length){var n,o,i=this.getDefs(!0),s=t[0],a=r?"_textDom":"_dom";s[a]?(o=s[a].getAttribute("id"),n=s[a],i.contains(n)||i.appendChild(n)):(o="zr-clip-"+this.nextId,++this.nextId,(n=this.createElement("clipPath")).setAttribute("id",o),i.appendChild(n),s[a]=n);var c=this.getSvgProxy(s);if(s.transform&&s.parent.invTransform&&!r){var l=Array.prototype.slice.call(s.transform);be(s.transform,s.parent.invTransform,s.transform),c.brush(s),s.transform=l}else c.brush(s);var d=this.getSvgElement(s);n.innerHTML="",n.appendChild(d.cloneNode()),e.setAttribute("clip-path","url(#"+o+")"),1<t.length&&this.updateDom(n,t.slice(1),r)}else e&&e.setAttribute("clip-path","none")},fs.prototype.markUsed=function(e){var t=this;e.__clipPaths&&0<e.__clipPaths.length&&C(e.__clipPaths,function(e){e._dom&&us.prototype.markUsed.call(t,e._dom),e._textDom&&us.prototype.markUsed.call(t,e._textDom)})},w(hs,us),hs.prototype.addWithoutUpdate=function(e,t){if(t&&ms(t.style)){var r,n=t.style;if(n._shadowDom)r=n._shadowDom,this.getDefs(!0).contains(n._shadowDom)||this.addDom(r);else r=this.add(t);this.markUsed(t);var o=r.getAttribute("id");e.style.filter="url(#"+o+")"}},hs.prototype.add=function(e){var t=this.createElement("filter"),r=e.style;return r._shadowDomId=r._shadowDomId||this.nextId++,t.setAttribute("id","zr-shadow-"+r._shadowDomId),this.updateDom(e,t),this.addDom(t),t},hs.prototype.update=function(e,t){var r=t.style;if(ms(r)){var n=this;us.prototype.update.call(this,t,function(e){n.updateDom(t,e._shadowDom)})}else this.remove(e,r)},hs.prototype.remove=function(e,t){null!=t._shadowDomId&&(this.removeDom(t),e.style.filter="")},hs.prototype.updateDom=function(e,t){var r=t.getElementsByTagName("feDropShadow");r=0===r.length?this.createElement("feDropShadow"):r[0];var n,o,i,s,a=e.style,c=e.scale&&e.scale[0]||1,l=e.scale&&e.scale[1]||1;if(a.shadowBlur||a.shadowOffsetX||a.shadowOffsetY)n=a.shadowOffsetX,o=a.shadowOffsetY,i=a.shadowBlur,s=a.shadowColor;else{if(!a.textShadowBlur)return void this.removeDom(t,a);n=a.textShadowOffsetX,o=a.textShadowOffsetY,i=a.textShadowBlur,s=a.textShadowColor}r.setAttribute("dx",n/c),r.setAttribute("dy",o/l),r.setAttribute("flood-color",s);var d=i/2/c+" "+i/2/l;r.setAttribute("stdDeviation",d),t.setAttribute("x","-100%"),t.setAttribute("y","-100%"),t.setAttribute("width",Math.ceil(i/2*200)+"%"),t.setAttribute("height",Math.ceil(i/2*200)+"%"),t.appendChild(r),a._shadowDom=t},hs.prototype.markUsed=function(e){var t=e.style;t&&t._shadowDom&&us.prototype.markUsed.call(this,t._shadowDom)};var Es=function(e,t,r){this.root=e,this.storage=t,this._opts=r=g({},r||{});var n=Fi("svg");n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("version","1.1"),n.setAttribute("baseProfile","full"),n.style.cssText="user-select:none;position:absolute;left:0;top:0;",this.gradientManager=new ps(n),this.clipPathManager=new fs(n),this.shadowManager=new hs(n);var o=document.createElement("div");o.style.cssText="overflow:hidden;position:relative",this._svgRoot=n,this._viewport=o,e.appendChild(o),o.appendChild(n),this.resize(r.width,r.height),this._visibleList=[]};Es.prototype={constructor:Es,getType:function(){return"svg"},getViewportRoot:function(){return this._viewport},getViewportRootOffset:function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},refresh:function(){var e=this.storage.getDisplayList(!0);this._paintList(e)},_paintList:function(e){this.gradientManager.markAllUnused(),this.clipPathManager.markAllUnused(),this.shadowManager.markAllUnused();var t,r,n=this._svgRoot,o=this._visibleList,i=e.length,s=[];for(t=0;t<i;t++){var a=e[t],c=(r=a)instanceof Do?rs:r instanceof Yr?ns:r instanceof ei?os:rs,l=ws(a)||Ss(a);a.invisible||(a.__dirty&&(c&&c.brush(a),this.clipPathManager.update(a),a.style&&(this.gradientManager.update(a.style.fill),this.gradientManager.update(a.style.stroke),this.shadowManager.update(l,a)),a.__dirty=!1),s.push(a))}var d,u,p,f,h=(d=o,u=s,ds.diff(d,u,p));for(t=0;t<h.length;t++){if((v=h[t]).removed)for(var m=0;m<v.count;m++){l=ws(a=o[v.indices[m]]);var g=Ss(a);_s(n,l),_s(n,g)}}for(t=0;t<h.length;t++){var v;if((v=h[t]).added)for(m=0;m<v.count;m++){l=ws(a=s[v.indices[m]]),g=Ss(a);f?ys(n,l,f):bs(n,l),l?ys(n,g,l):f?ys(n,g,f):bs(n,g),ys(n,g,l),f=g||l||f,this.gradientManager.addWithoutUpdate(l,a),this.shadowManager.addWithoutUpdate(f,a),this.clipPathManager.markUsed(a)}else if(!v.removed)for(m=0;m<v.count;m++){f=l=Ss(a=s[v.indices[m]])||ws(a)||f,this.gradientManager.markUsed(a),this.gradientManager.addWithoutUpdate(l,a),this.shadowManager.markUsed(a),this.shadowManager.addWithoutUpdate(l,a),this.clipPathManager.markUsed(a)}}this.gradientManager.removeUnused(),this.clipPathManager.removeUnused(),this.shadowManager.removeUnused(),this._visibleList=s},_getDefs:function(e){var n,t=this._svgRoot;return 0!==(n=this._svgRoot.getElementsByTagName("defs")).length?n[0]:e?((n=t.insertBefore(Fi("defs"),t.firstChild)).contains||(n.contains=function(e){var t=n.children;if(!t)return!1;for(var r=t.length-1;0<=r;--r)if(t[r]===e)return!0;return!1}),n):null},resize:function(e,t){var r=this._viewport;r.style.display="none";var n=this._opts;if(null!=e&&(n.width=e),null!=t&&(n.height=t),e=this._getSize(0),t=this._getSize(1),r.style.display="",this._width!==e&&this._height!==t){this._width=e,this._height=t;var o=r.style;o.width=e+"px",o.height=t+"px";var i=this._svgRoot;i.setAttribute("width",e),i.setAttribute("height",t)}},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(e){var t=this._opts,r=["width","height"][e],n=["clientWidth","clientHeight"][e],o=["paddingLeft","paddingTop"][e],i=["paddingRight","paddingBottom"][e];if(null!=t[r]&&"auto"!==t[r])return parseFloat(t[r]);var s=this.root,a=document.defaultView.getComputedStyle(s);return(s[n]||gs(a[r])||gs(s.style[r]))-(gs(a[o])||0)-(gs(a[i])||0)|0},dispose:function(){this.root.innerHTML="",this._svgRoot=this._viewport=this.storage=null},clear:function(){this._viewport&&this.root.removeChild(this._viewport)},pathToSvg:function(){this.refresh();var e=this._svgRoot.outerHTML;return"data:img/svg+xml;utf-8,"+unescape(e)}},C(["getLayer","insertLayer","eachLayer","eachBuiltinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],function(e){var t;Es.prototype[e]=(t=e,function(){_t('In SVG mode painter not support method "'+t+'"')})}),wn("svg",Es);var Cs,Ts="urn:schemas-microsoft-com:vml",Is="undefined"==typeof window?null:window,Rs=!1,Ps=Is&&Is.document;function xs(e){return Cs(e)}if(Ps&&!d.canvasSupported)try{!Ps.namespaces.zrvml&&Ps.namespaces.add("zrvml",Ts),Cs=function(e){return Ps.createElement("<zrvml:"+e+' class="zrvml">')}}catch(e){Cs=function(e){return Ps.createElement("<"+e+' xmlns="'+Ts+'" class="zrvml">')}}var Ms,ks=mo.CMD,As=Math.round,Os=Math.sqrt,Us=Math.abs,Ls=Math.cos,Ds=Math.sin,Ns=Math.max;if(!d.canvasSupported){var Bs="progid:DXImageTransform.Microsoft",js=21600,Fs=10800,Vs=function(e){e.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px;",e.coordsize=js+","+js,e.coordorigin="0,0"},qs=function(e,t,r){return"rgb("+[e,t,r].join(",")+")"},Gs=function(e,t){t&&e&&t.parentNode!==e&&e.appendChild(t)},Ws=function(e,t){t&&e&&t.parentNode===e&&e.removeChild(t)},Hs=function(e,t,r){return 1e5*(parseFloat(e)||0)+1e3*(parseFloat(t)||0)+r},zs=function(e,t){return"string"==typeof e?0<=e.lastIndexOf("%")?parseFloat(e)/100*t:parseFloat(e):e},Ys=function(e,t,r){var n=Ke(t);r=+r,isNaN(r)&&(r=1),n&&(e.color=qs(n[0],n[1],n[2]),e.opacity=r*n[3])},Qs=function(e,t,r,n){var o,i,s="fill"==t,a=e.getElementsByTagName(t)[0];null!=r[t]&&"none"!==r[t]&&(s||!s&&r.lineWidth)?(e[s?"filled":"stroked"]="true",r[t]instanceof Ni&&Ws(e,a),a||(a=xs(t)),s?function(e,t,r){var n,o,i=t.fill;if(null!=i)if(i instanceof Ni){var s,a=0,c=[0,0],l=0,d=1,u=r.getBoundingRect(),p=u.width,f=u.height;if("linear"===i.type){s="gradient";var h=r.transform,m=[i.x*p,i.y*f],g=[i.x2*p,i.y2*f];h&&(re(m,m,h),re(g,g,h));var v=g[0]-m[0],y=g[1]-m[1];(a=180*Math.atan2(v,y)/Math.PI)<0&&(a+=360),a<1e-6&&(a=0)}else{s="gradientradial",m=[i.x*p,i.y*f],h=r.transform;var b=r.scale,_=p,S=f;c=[(m[0]-u.x)/_,(m[1]-u.y)/S],h&&re(m,m,h),_/=b[0]*js,S/=b[1]*js;var w=Ns(_,S);l=0/w,d=2*i.r/w-l}var E=i.colorStops.slice();E.sort(function(e,t){return e.offset-t.offset});for(var C=E.length,T=[],I=[],R=0;R<C;R++){var P=E[R],x=(n=P.color,o=Ke(n),[qs(o[0],o[1],o[2]),o[3]]);I.push(P.offset*d+l+" "+x[0]),0!==R&&R!==C-1||T.push(x)}if(2<=C){var M=T[0][0],k=T[1][0],A=T[0][1]*t.opacity,O=T[1][1]*t.opacity;e.type=s,e.method="none",e.focus="100%",e.angle=a,e.color=M,e.color2=k,e.colors=I.join(","),e.opacity=O,e.opacity2=A}"radial"===s&&(e.focusposition=c.join(","))}else Ys(e,i,t.opacity)}(a,r,n):(o=a,null!=(i=r).lineDash&&(o.dashstyle=i.lineDash.join(" ")),null==i.stroke||i.stroke instanceof Ni||Ys(o,i.stroke,i.opacity)),Gs(e,a)):(e[s?"filled":"stroked"]="false",Ws(e,a))},Ks=[[],[],[]];Do.prototype.brushVML=function(e){var t=this.style,r=this._vmlEl;r||(r=xs("shape"),Vs(r),this._vmlEl=r),Qs(r,"fill",t,this),Qs(r,"stroke",t,this);var n=this.transform,o=null!=n,i=r.getElementsByTagName("stroke")[0];if(i){var s=t.lineWidth;if(o&&!t.strokeNoScale){var a=n[0]*n[3]-n[1]*n[2];s*=Os(Us(a))}i.weight=s+"px"}var c=this.path||(this.path=new mo);this.__dirtyPath&&(c.beginPath(),this.buildPath(c,this.shape),c.toStatic(),this.__dirtyPath=!1),r.path=function(e,t){var r,n,o,i,s,a,c=ks.M,l=ks.C,d=ks.L,u=ks.A,p=ks.Q,f=[],h=e.data,m=e.len();for(i=0;i<m;){switch(n="",r=0,o=h[i++]){case c:n=" m ",r=1,s=h[i++],a=h[i++],Ks[0][0]=s,Ks[0][1]=a;break;case d:n=" l ",r=1,s=h[i++],a=h[i++],Ks[0][0]=s,Ks[0][1]=a;break;case p:case l:n=" c ",r=3;var g,v,y=h[i++],b=h[i++],_=h[i++],S=h[i++];o===p?(_=((g=_)+2*y)/3,S=((v=S)+2*b)/3,y=(s+2*y)/3,b=(a+2*b)/3):(g=h[i++],v=h[i++]),Ks[0][0]=y,Ks[0][1]=b,Ks[1][0]=_,Ks[1][1]=S,s=Ks[2][0]=g,a=Ks[2][1]=v;break;case u:var w=0,E=0,C=1,T=1,I=0;t&&(w=t[4],E=t[5],C=Os(t[0]*t[0]+t[1]*t[1]),T=Os(t[2]*t[2]+t[3]*t[3]),I=Math.atan2(-t[1]/T,t[0]/C));var R=h[i++],P=h[i++],x=h[i++],M=h[i++],k=h[i++]+I,A=h[i++]+k+I;i++;var O=h[i++],U=R+Ls(k)*x,L=P+Ds(k)*M,D=(y=R+Ls(A)*x,b=P+Ds(A)*M,O?" wa ":" at ");Math.abs(U-y)<1e-4&&(.01<Math.abs(A-k)?O&&(U+=.0125):Math.abs(L-P)<1e-4?O&&U<R||!O&&R<U?b-=.0125:b+=.0125:O&&L<P||!O&&P<L?y+=.0125:y-=.0125),f.push(D,As(((R-x)*C+w)*js-Fs),",",As(((P-M)*T+E)*js-Fs),",",As(((R+x)*C+w)*js-Fs),",",As(((P+M)*T+E)*js-Fs),",",As((U*C+w)*js-Fs),",",As((L*T+E)*js-Fs),",",As((y*C+w)*js-Fs),",",As((b*T+E)*js-Fs)),s=y,a=b;break;case ks.R:var N=Ks[0],B=Ks[1];N[0]=h[i++],N[1]=h[i++],B[0]=N[0]+h[i++],B[1]=N[1]+h[i++],t&&(re(N,N,t),re(B,B,t)),N[0]=As(N[0]*js-Fs),B[0]=As(B[0]*js-Fs),N[1]=As(N[1]*js-Fs),B[1]=As(B[1]*js-Fs),f.push(" m ",N[0],",",N[1]," l ",B[0],",",N[1]," l ",B[0],",",B[1]," l ",N[0],",",B[1]);break;case ks.Z:f.push(" x ")}if(0<r){f.push(n);for(var j=0;j<r;j++){var F=Ks[j];t&&re(F,F,t),f.push(As(F[0]*js-Fs),",",As(F[1]*js-Fs),j<r-1?",":"")}}}return f.join("")}(c,this.transform),r.style.zIndex=Hs(this.zlevel,this.z,this.z2),Gs(e,r),null!=t.text?this.drawRectText(e,this.getBoundingRect()):this.removeRectText(e)},Do.prototype.onRemove=function(e){Ws(e,this._vmlEl),this.removeRectText(e)},Do.prototype.onAdd=function(e){Gs(e,this._vmlEl),this.appendRectText(e)};Yr.prototype.brushVML=function(e){var t,r,n,o=this.style,i=o.image;if("object"==typeof(n=i)&&n.tagName&&"IMG"===n.tagName.toUpperCase()){var s=i.src;if(s===this._imageSrc)t=this._imageWidth,r=this._imageHeight;else{var a=i.runtimeStyle,c=a.width,l=a.height;a.width="auto",a.height="auto",t=i.width,r=i.height,a.width=c,a.height=l,this._imageSrc=s,this._imageWidth=t,this._imageHeight=r}i=s}else i===this._imageSrc&&(t=this._imageWidth,r=this._imageHeight);if(i){var d=o.x||0,u=o.y||0,p=o.width,f=o.height,h=o.sWidth,m=o.sHeight,g=o.sx||0,v=o.sy||0,y=h&&m,b=this._vmlEl;b||(b=Ps.createElement("div"),Vs(b),this._vmlEl=b);var _,S=b.style,w=!1,E=1,C=1;if(this.transform&&(_=this.transform,E=Os(_[0]*_[0]+_[1]*_[1]),C=Os(_[2]*_[2]+_[3]*_[3]),w=_[1]||_[2]),w){var T=[d,u],I=[d+p,u],R=[d,u+f],P=[d+p,u+f];re(T,T,_),re(I,I,_),re(R,R,_),re(P,P,_);var x=Ns(T[0],I[0],R[0],P[0]),M=Ns(T[1],I[1],R[1],P[1]),k=[];k.push("M11=",_[0]/E,",","M12=",_[2]/C,",","M21=",_[1]/E,",","M22=",_[3]/C,",","Dx=",As(d*E+_[4]),",","Dy=",As(u*C+_[5])),S.padding="0 "+As(x)+"px "+As(M)+"px 0",S.filter=Bs+".Matrix("+k.join("")+", SizingMethod=clip)"}else _&&(d=d*E+_[4],u=u*C+_[5]),S.filter="",S.left=As(d)+"px",S.top=As(u)+"px";var A=this._imageEl,O=this._cropEl;A||(A=Ps.createElement("div"),this._imageEl=A);var U=A.style;if(y){if(t&&r)U.width=As(E*t*p/h)+"px",U.height=As(C*r*f/m)+"px";else{var L=new Image,D=this;L.onload=function(){L.onload=null,t=L.width,r=L.height,U.width=As(E*t*p/h)+"px",U.height=As(C*r*f/m)+"px",D._imageWidth=t,D._imageHeight=r,D._imageSrc=i},L.src=i}O||((O=Ps.createElement("div")).style.overflow="hidden",this._cropEl=O);var N=O.style;N.width=As((p+g*p/h)*E),N.height=As((f+v*f/m)*C),N.filter=Bs+".Matrix(Dx="+-g*p/h*E+",Dy="+-v*f/m*C+")",O.parentNode||b.appendChild(O),A.parentNode!=O&&O.appendChild(A)}else U.width=As(E*p)+"px",U.height=As(C*f)+"px",b.appendChild(A),O&&O.parentNode&&(b.removeChild(O),this._cropEl=null);var B="",j=o.opacity;j<1&&(B+=".Alpha(opacity="+As(100*j)+") "),B+=Bs+".AlphaImageLoader(src="+i+", SizingMethod=scale)",U.filter=B,b.style.zIndex=Hs(this.zlevel,this.z,this.z2),Gs(e,b),null!=o.text&&this.drawRectText(e,this.getBoundingRect())}},Yr.prototype.onRemove=function(e){Ws(e,this._vmlEl),this._vmlEl=null,this._cropEl=null,this._imageEl=null,this.removeRectText(e)},Yr.prototype.onAdd=function(e){Gs(e,this._vmlEl),this.appendRectText(e)};var Js,Xs="normal",$s={},Zs=0,ea=document.createElement("div");Ms=function(e,t){var r=Ps;Js||((Js=r.createElement("div")).style.cssText="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;",Ps.body.appendChild(Js));try{Js.style.font=t}catch(e){}return Js.innerHTML="",Js.appendChild(r.createTextNode(e)),{width:Js.offsetWidth}},pr["measureText"]=Ms;for(var ta=new Mt,ra=function(e,t,r,n){var o=this.style;this.__dirty&&xr(o);var i=o.text;if(null!=i&&(i+=""),i){if(o.rich){var s=Cr(i,o);i=[];for(var a=0;a<s.lines.length;a++){for(var c=s.lines[a].tokens,l=[],d=0;d<c.length;d++)l.push(c[d].text);i.push(l.join(""))}i=i.join("\n")}var u,p,f=o.textAlign,h=o.textVerticalAlign,m=function(e){var t=$s[e];if(!t){100<Zs&&(Zs=0,$s={});var r,n=ea.style;try{n.font=e,r=n.fontFamily.split(",")[0]}catch(e){}t={style:n.fontStyle||Xs,variant:n.fontVariant||Xs,weight:n.fontWeight||Xs,size:0|parseFloat(n.fontSize||12),family:r||"Microsoft YaHei"},$s[e]=t,Zs++}return t}(o.font),g=m.style+" "+m.variant+" "+m.weight+" "+m.size+'px "'+m.family+'"';r=r||hr(i,g,f,h);var v=this.transform;if(v&&!n&&(ta.copy(t),ta.applyTransform(v),t=ta),n)u=t.x,p=t.y;else{var y=o.textPosition,b=o.textDistance;if(y instanceof Array)u=t.x+zs(y[0],t.width),p=t.y+zs(y[1],t.height),f=f||"left";else{var _=vr(y,t,b);u=_.x,p=_.y,f=f||_.textAlign,h=h||_.textVerticalAlign}}u=mr(u,r.width,f),p=gr(p,r.height,h),p+=r.height/2;var S,w,E,C=xs,T=this._textVmlEl;T?w=(S=(E=T.firstChild).nextSibling).nextSibling:(T=C("line"),S=C("path"),w=C("textpath"),E=C("skew"),w.style["v-text-align"]="left",Vs(T),S.textpathok=!0,w.on=!0,T.from="0 0",T.to="1000 0.05",Gs(T,E),Gs(T,S),Gs(T,w),this._textVmlEl=T);var I=[u,p],R=T.style;v&&n?(re(I,I,v),E.on=!0,E.matrix=v[0].toFixed(3)+","+v[2].toFixed(3)+","+v[1].toFixed(3)+","+v[3].toFixed(3)+",0,0",E.offset=(As(I[0])||0)+","+(As(I[1])||0),E.origin="0 0",R.left="0px",R.top="0px"):(E.on=!1,R.left=As(u)+"px",R.top=As(p)+"px"),w.string=String(i).replace(/&/g,"&amp;").replace(/"/g,"&quot;");try{w.style.font=g}catch(e){}Qs(T,"fill",{fill:o.textFill,opacity:o.opacity},this),Qs(T,"stroke",{stroke:o.textStroke,opacity:o.opacity,lineDash:o.lineDash},this),T.style.zIndex=Hs(this.zlevel,this.z,this.z2),Gs(e,T)}},na=function(e){Ws(e,this._textVmlEl),this._textVmlEl=null},oa=function(e){Gs(e,this._textVmlEl)},ia=[Hr,zr,Yr,Do,ei],sa=0;sa<ia.length;sa++){var aa=ia[sa].prototype;aa.drawRectText=ra,aa.removeRectText=na,aa.appendRectText=oa}ei.prototype.brushVML=function(e){var t=this.style;null!=t.text?this.drawRectText(e,{x:t.x||0,y:t.y||0,width:0,height:0},this.getBoundingRect(),!0):this.removeRectText(e)},ei.prototype.onRemove=function(e){this.removeRectText(e)},ei.prototype.onAdd=function(e){this.appendRectText(e)}}function ca(e){return parseInt(e,10)}function la(e,t){!function(){if(!Rs&&Ps){Rs=!0;var e=Ps.styleSheets;e.length<31?Ps.createStyleSheet().addRule(".zrvml","behavior:url(#default#VML)"):e[0].addRule(".zrvml","behavior:url(#default#VML)")}}(),this.root=e,this.storage=t;var r=document.createElement("div"),n=document.createElement("div");r.style.cssText="display:inline-block;overflow:hidden;position:relative;width:300px;height:150px;",n.style.cssText="position:absolute;left:0;top:0;",e.appendChild(r),this._vmlRoot=n,this._vmlViewport=r,this.resize();var o=t.delFromStorage,i=t.addToStorage;t.delFromStorage=function(e){o.call(t,e),e&&e.onRemove&&e.onRemove(n)},t.addToStorage=function(e){e.onAdd&&e.onAdd(n),i.call(t,e)},this._firstPaint=!0}la.prototype={constructor:la,getType:function(){return"vml"},getViewportRoot:function(){return this._vmlViewport},getViewportRootOffset:function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},refresh:function(){var e=this.storage.getDisplayList(!0,!0);this._paintList(e)},_paintList:function(e){for(var t=this._vmlRoot,r=0;r<e.length;r++){var n=e[r];n.invisible||n.ignore?(n.__alreadyNotVisible||n.onRemove(t),n.__alreadyNotVisible=!0):(n.__alreadyNotVisible&&n.onAdd(t),n.__alreadyNotVisible=!1,n.__dirty&&(n.beforeBrush&&n.beforeBrush(),(n.brushVML||n.brush).call(n,t),n.afterBrush&&n.afterBrush())),n.__dirty=!1}this._firstPaint&&(this._vmlViewport.appendChild(t),this._firstPaint=!1)},resize:function(e,t){e=null==e?this._getWidth():e,t=null==t?this._getHeight():t;if(this._width!=e||this._height!=t){this._width=e,this._height=t;var r=this._vmlViewport.style;r.width=e+"px",r.height=t+"px"}},dispose:function(){this.root.innerHTML="",this._vmlRoot=this._vmlViewport=this.storage=null},getWidth:function(){return this._width},getHeight:function(){return this._height},clear:function(){this._vmlViewport&&this.root.removeChild(this._vmlViewport)},_getWidth:function(){var e=this.root,t=e.currentStyle;return(e.clientWidth||ca(t.width))-ca(t.paddingLeft)-ca(t.paddingRight)|0},_getHeight:function(){var e=this.root,t=e.currentStyle;return(e.clientHeight||ca(t.height))-ca(t.paddingTop)-ca(t.paddingBottom)|0}},C(["getLayer","insertLayer","eachLayer","eachBuiltinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],function(e){var t;la.prototype[e]=(t=e,function(){_t('In IE8.0 VML mode painter not support method "'+t+'"')})}),wn("vml",la),e.version="3.7.4",e.init=function(e,t){var r=new En(n(),e,t);return Sn[r.id]=r},e.dispose=function(e){if(e)e.dispose();else{for(var t in Sn)Sn.hasOwnProperty(t)&&Sn[t].dispose();Sn={}}return this},e.getInstance=function(e){return Sn[e]},e.registerPainter=wn,e.matrix=Ce,e.vector=ie,e.color=rt,e.path=$o,e.util=F,e.Group=kt,e.Path=Do,e.Image=Yr,e.CompoundPath=Zo,e.Text=ei,e.IncrementalDisplayable=ti,e.Arc=ni,e.BezierCurve=si,e.Circle=ai,e.Droplet=ci,e.Ellipse=li,e.Heart=di,e.Isogon=hi,e.Line=mi,e.Polygon=bi,e.Polyline=_i,e.Rect=Si,e.Ring=wi,e.Rose=Ri,e.Arrowline=Ei,e.Sector=xi,e.Star=Oi,e.Trochoid=Di,e.LinearGradient=Bi,e.RadialGradient=ji,e.Pattern=Xt,e.BoundingRect=Mt});var ErrorConstant={check_webrtc_supported:{code:2e3,message:"此浏览器不支持WebRTC"},not_support_mediaStreamTrack:{code:2001,message:"此浏览器不支持MediaStreamTrack."},screen_sharing_plugin_not_accessible:{code:2003,message:"屏幕共享插件找不到"},screen_sharing_response_is_null:{code:2004,message:"没有屏幕共享"},not_join_room:{code:2005,message:"还未加会"},navigatorUserMediaError_notSupportedError:{code:2010,message:"打开设备权限不足，原因是非https访问"},navigatorUserMediaError_overconstrainedError:{code:2011,message:"设备打开失败，因为设备约束可能不满足"},navigatorUserMediaError_trackStartError:{code:2012,message:"设备打开失败，因为设备已被占用"},navigatorUserMediaError_notAllowedError:{code:2013,message:"打开设备权限不足，原因是用户拒绝了媒体访问请求"},navigatorUserMediaError_typeError:{code:2014,message:"设备打开失败，因为至少有一个音频和视频被请求"},navigatorUserMediaError_unknown:{code:2015,message:"设备打开失败未知错误"},navigatorUserMediaError_notFoundError:{code:2016,message:"设备打开失败，请确保想要打开的音/视频设备连接正常"},navigatorDisplayMediaError_notSupportedError:{code:2030,message:"打开桌面共享权限不足，原因是非https访问"},navigatorDisplayMediaError_overconstrainedError:{code:2031,message:"打开桌面共享失败，因为桌面共享约束可能不满足"},navigatorDisplayMediaError_notAllowedError:{code:2033,message:"打开桌面共享失败，原因用户没有选择共享内容，就做了退出操作"},navigatorDisplayMediaError_unknown:{code:2035,message:"桌面共享打开失败未知错误"},cameraId_does_not_exist:{code:2017,message:"摄像头ID不存在"},closeVideo_before_operation_warnings:{code:2018,message:"请关闭摄像头以后再进行此操作"},open_device_no_response:{code:2019,message:"设备打开无响应，请重启浏览器后重试"},websock_create_error:{code:2020,message:"Websocket创建失败"},websock_catch_exception:{code:2021,message:"Websocket操作失败"},join_room_timeout:{code:1014,message:"加会超时"},oemname_notfound:{code:1017,message:"OEM名称没找到"},avdEngine_init_failed:{code:1018,message:"sdk引擎初始化失败"},userId_format:{code:1309,message:"userId不能带_字符"},userId_required:{code:1300,message:"userId是必须项，不能为空"},mulLanding_error:{code:1301,message:"同一个userId不能多次登录"},roomId_required:{code:1302,message:"roomId是必须项，不能为空"},params_require:{code:1303,message:"params是必须项，不能为空"},userAddress_require:{code:1304,message:"userAddress是必须项，不能为空"},ft_no_authorization:{code:1305,message:"模块无授权."},exporter_parameter_type_error:{code:1401,message:"参数类型错误"},exporter_parameter_number_error:{code:1402,message:"参数范围错误，x,y,width,height请输入0 - 1 之间的数值"},exporter_parameter_number1_error:{code:1403,message:"参数范围错误，zorder请输入0 - 10 之间的数值"},exporter_parameter_lack_error:{code:1404,message:"缺少必要的参数"},video_not_exporter_error:{code:1405,message:"该视频还未开始录制"},video_has_exporter_error:{code:1406,message:"该视频已经开始录制不要重复录制"},exporter_mix_start_error:{code:1407,message:"还未添加任何视频，无法进行混屏录制"},video_and_userId_error:{code:1408,message:"用户Id和设备Id不匹配"},exporter_has_stop_error:{code:1409,message:"录制已经停止"}},FTConstant={datachannel:{name:"透明通道",value:"ft_datachannel"},chat:{name:"聊天",value:"ft_chat"},audio:{name:"语音",value:"ft_audio"},video:{name:"普通视频",value:"ft_video"},video_hd:{name:"高清视频",value:"ft_video_hd"},screen:{name:"屏幕共享",value:"ft_screen"},annotation:{name:"注释白板",value:"ft_annotation"},p2p:{name:"P2P房间",value:"ft_p2p"},avei:{name:"音视频导入导出",value:"ft_avei"},h265:{name:"H265模块",value:"ft_h265"},client_record_audio:{name:"客户端音频录制",value:"ft_client_record_audio"},client_record_video:{name:"客户端视频录制",value:"ft_client_record_video"},clinet_livebroadcast:{name:"客户端直播路数",value:"ft_clinet_livebroadcast"},record_audio:{name:"录制音频",value:"ft_record_audio"},record_video:{name:"录制视频",value:"ft_record_video"},outgoing:{name:"设备集成，如rtsp、h323、sip等",value:"ft_outgoing"},livebroadcast:{name:"旁路直播",value:"ft_livebroadcast"},platform_android:{name:"Android系统",value:"ft_platform_android"},platform_ios:{name:"ios系统",value:"ft_platform_ios"},platform_win:{name:"windows桌面系统",value:"ft_platform_win"},platform_mac:{name:"mac ox桌面系统",value:"ft_platform_mac"},platform_linux:{name:"linux桌面系统",value:"ft_platform_linux"},platform_web:{name:"web js系统",value:"ft_platform_web"},server_platform_linux:{name:"服务器平台linux",value:"ft_server_platform_linux"},server_platform_win:{name:"服务器平台windows",value:"ft_server_platform_win"},server_platform_linux_cluster:{name:"服务器平台linux集群",value:"ft_server_platform_linux_cluster"}},USER_AGENT_AVD_DEFAULT="web",USER_AGENT_AVD_VIDEO_TRANSCODING="avd_video_transcoding",USER_AGENT_AVD_MEDIA_MIXER="avd_media_mixer",USER_AGENT_AVD_MEDIA_MIXER_ADMIN="avd_media_mixer_admin",USER_AGENT_AVD_THROWING_SCREEN_ANONYM="avd_throwing_screen_anonym",ModulesEnum={avdEngine:"AVDEngine",browserDetect:"BrowserDetect",video:"Video",audio:"Audio",error:"Error",annotation:"Annotation",client:"Client"},Appender={alert:1,inpage:2,popup:3,browserConsole:4},LogLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},SignalType={websocket:"websocket",dataChannel:"dataChannel"},RoomTypeEnum={join_host_first:"join.host.first",net_acc:"net.acc",host_control:"host.control",free_speech:"free.speech"},roomTypePrivilige={join_host_first:2,net_acc:4,host_control:8},EngineCallback={room_join_success:"room.join.success",room_join_error:"room.join.error",room_join_websocket_reconnection_success:"room.join.websocket.reconnection.success",pub_roomresourcemsg_rep_success:"pub.roomresourcemsg.rep.success",pub_roomresourcemsg_rep_error:"pub.roomresourcemsg.rep.error"},VideoCodingType={VP8:0,VP9:1,H264:2},AudioCodingType={ISAC_16k:0,ISAC_32k:1,opus:2,G722:3,PCMA:4,PCMU:5},Resolution={"1920*1280":{width:1920,height:1280,order:16},"1920*1080":{width:1920,height:1080,order:15},"1280*1024":{width:1280,height:1024,order:14},"1280*720":{width:1280,height:720,order:13},"960*720":{width:960,height:720,order:12},"640*1024":{width:640,height:1024,order:11},"640*960":{width:640,height:960,order:10},"640*480":{width:640,height:480,order:9},"640*360":{width:640,height:360,order:8},"508*360":{width:508,height:360,order:7},"480*854":{width:480,height:854,order:6},"480*800":{width:480,height:800,order:5},"320*480":{width:320,height:480,order:4},"320*240":{width:320,height:240,order:3},"320*180":{width:320,height:180,order:2},"160*120":{width:160,height:120,order:1}},ResolutionSetType={exact:0,ideal:1},ConnectionStatus={init:0,connecting:1,connected:2,connectFailed:3,reJoinRoomTimeOut:4,reJoinConnected:5,reconnected:6},MCUPeerConnectionStatus={failed:0,completed:1},RoomStatus={scheduled:0,opening:1,locked:2,closed:3};StreamStatus={none:0,init:1,published:2,muted:3,forbided:4,subed:5,opened:6},CameraType={unknown:0,front:1,back:2},VideoQualityType={high:4,normal:3,low:2};var RoomCallback={connection_status:"connection.status",connection_indicator:"connection.indicator",room_status_notify:"room.status.notify",app_data_notify:"app.data.notify",user_data_notify:"user.data.notify",user_name_notify:"user.name.notify",public_data:"public.data",private_data:"private.data",public_message:"public.message ",private_message:"private.message",user_join_notify:"user.join.notify",user_leave_notify:"user.leave.notify",leave_indication:"leave.indication",close_room_result:"close.room.result",close_room_notify:"close.room.notify",screen_sharing_ended:"screen.sharing.ended",mcu_peerconnection_completed:"mcu.peerconnection.completed",outgoing_invite_status_notify:"outgoing.invite.status.notify",room_control_change_notify:"room.control.change.notify"},UserCallback={microphone_status_notify:"microphone.status.notify",camera_status_notify:"camera.status.notify",screen_status_notify:"screen.status.notify",camera_data_notify:"camera.data.notify",screen_data_notify:"screen.data.notify",publish_camera_notify:"publish.camera.notify",unpublish_camera_notify:"unpublish.camera.notify",subscrible_camera_result:"subscrible.camera.result",unsubscrible_camera_result:"unsubscrible.camera.result",publish_screen_notify:"publish.screen.notify",unpublish_screen_notify:"unpublish.screen.notify",subscrible_screen_result:"subscrible.screen.result",unsubscrible_screen_result:"unsubscrible.screen.result",publish_microphone_notify:"publish.microphone.notify",unpublish_microphone_notify:"unpublish.microphone.notify",subscrible_microphone_result:"subscrible.microphone.result",unsubscrible_microphone_result:"unsubscrible.microphone.result",board_add_result:"board.add.result",board_remove_result:"board.remove.result",board_share_result:"board.share.result",board_close_result:"board.close.result",room_set_stream_name_rep_success:"room.set.stream.name.rep.success",room_set_stream_name_rep_error:"room.set.stream.name.rep.error"},ExporderCallBack={stop_stream_rep_success:"stop.stream.rep.success",stop_stream_rep_error:"stop.stream.rep.error",pause_stream_rep_error:"pause.stream.rep.error",pause_stream_rep_success:"pause.stream.rep.success",mix_media_rep_error:"mix.media.rep.error",mix_media_rep_success:"mix.media.rep.success",select_stream_rep_success:"select.stream.rep.success",select_stream_rep_error:"select.stream.rep.error",create_server_recorder_rep_success:"create.server.recorder.rep.success",create_server_recorder_rep_error:"create.server.recorder.rep.error",bind_audio2video_rep_success:"bind.audio2video.rep.success",bind_audio2video_rep_error:"bind.audio2video.rep.error",set_focus_video_rep_success:"set.focus.video.rep.success",set_focus_video_rep_error:"set.focus.video.rep.error",get_exporter_info_rep_success:"get.exporter.info.rep.success",get_exporter_info_rep_error:"get.exporter.info.rep.error"};OperType={add:1,remove:2,update:3,share:4,close:5};var RecordEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2},FileType:{mp4:0,webM:1}},LiveEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2}},shapeTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17},boardStatusEnum={close:0,open:1},annoSelectTypeEnum={mouse:1,draw:2,eraser:3},canvasTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17},fillTypeEnum={none:1,full:2},arrowTypeEnum={none:1,begin:2,end:3,double:4},connectionEventTypeEnum={sendVideo:1,recvVideo:2,sendAudio:3,recvAudio:4,conndidate:5},exporterTypeEnum={record:0,record_real_time:1,liver:2,avc_media_mixer:7},viewLayoutModeEnum={fixation:0,auto:1,auto_orato:2},exporterStatusEnum={stop:0,live:1,pause:2},recorderAudioEnum={AVD_userId_allUser:"userId2allUser",AVD_userId_allUserWithoutMe:"userId2withoutMe",AVD_userId_noneUser:"userId2None"},appDataKeyEnum={lecturer:"meeting_lecturer",voiceActivated:"voice_activated"},arrayUtil={intersection:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=e[n];for(n=0,o=t.length;n<o;n++)r[t[n]]=t[n];var i=new Array;n=0;for(var s in r)i[n++]=r[s];return i},chaji:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=1;for(n=0,o=t.length;n<o;n++)r[t[n]]=r[t[n]]?2:1;var i=new Array;n=0;for(var s in r)1==r[s]&&(i[n++]=s);return i},chajiObject:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n].nodeId]=1;for(n=0,o=t.length;n<o;n++)r[t[n].nodeId]=r[t[n].nodeId]?2:1;var i=new Array;n=0;for(var s in r)1==r[s]&&(i[n++]=s);return i},inANotInB:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=1;for(n=0,o=t.length;n<o;n++)r.hasOwnProperty(t[n])&&(r[t[n]]=void 0);var i=new Array;n=0;for(var s in r)r[s]&&(i[n++]=s);return i},baseSplice:function(e,t){for(var r,n=0;n<e.length;n++){if(e[n]==t){r=n;break}}-1<r&&e.splice(r,1)},objectSplice:function(e,t){for(var r,n=0;n<e.length;n++){if(e[n].id==t){r=n;break}}-1<r&&e.splice(r,1)},userIdSplice:function(e,t){for(var r,n=0;n<e.length;n++){if(e[n].userId==t){r=n;break}}-1<r&&e.splice(r,1)}};function getRandomNum(e,t){var r=t-e,n=Math.random();return e+Math.round(n*r)}var typeConversionUtil={String2ArrayBuffer:function(e){e=btoa(unescape(encodeURIComponent(e)));for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,o=e.length;n<o;n++)r[n]=e.charCodeAt(n);return t},ArrayBuffer2String:function(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(atob(t)))},Uint8ArrayToString:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},stringToUint8Array:function(e){for(var t=[],r=0,n=e.length;r<n;++r)t.push(e.charCodeAt(r));return new Uint8Array(t)}};function resizeVideo(e,t,r){doResizeVideo(e,t,r,!1)}function resizeRealVideo(e,t,r){doResizeVideo(e,t,r,!0)}function doResizeVideo(n,o,i,s){o||(o=window.innerWidth),i||(i=window.innerHeight),n.addEventListener("loadedmetadata",function(e){var t=this.videoWidth,r=this.videoHeight;positionLarge(n,t,r,o,i,s)})}function positionLarge(e,t,r,n,o,i){var s,a=(s=i?getCameraRealVideoSize(t,r,n,o):getCameraVideoSize(t,r,n,o))[0],c=s[1],l=getCameraVideoPosition(a,c,n,o),d=l[0],u=l[1];i?positionRealVideo(e,a,c,d,u):positionVideo(e,a,c,d,u)}function getCameraVideoSize(e,t,r,n){var o=e/t;return(r=Math.max(e,r))/o<(n=Math.max(t,n))&&(r=(n=n)*o),n*o<r&&(n=(r=r)/o),[r,n]}function getCameraRealVideoSize(e,t,r,n){var o=e/t,i=Math.max(e,r),s=Math.max(t,n);e<=i&&t<=s?r/n<o?n=(r=r)/o:r=(n=n)*o:((n=s)<(r=i)/o&&(r=(n=n)*o),r<n*o&&(n=(r=r)/o));return[r,n]}function getCameraVideoPosition(e,t,r,n){return[(r-e)/2,(n-t)/2]}function positionVideo(e,t,r,n,o){e.setAttribute("width",t),e.setAttribute("height",r)}function positionRealVideo(e,t,r,n,o){e.setAttribute("width",t),e.setAttribute("height",r);var i=e.parentNode;i.style.top=o+"px",i.style.bottom=o+"px",i.style.left=n+"px",i.style.right=n+"px"}function fullScreenInit(){document.cancelFullScreen=document.webkitCancelFullScreen||document.mozCancelFullScreen||document.cancelFullScreen,document.body.requestFullScreen=document.body.webkitRequestFullScreen||document.body.mozRequestFullScreen||document.body.requestFullScreen,document.onfullscreenchange=document.onwebkitfullscreenchange=document.onmozfullscreenchange=displayFullScreenStatus,displayFullScreenStatus()}function doFullScreen(e,t){e.requestFullScreen=e.webkitRequestFullScreen||e.mozRequestFullScreen||e.requestFullScreen,isFullScreen()&&t.target!==e||fullScreenElement()===e?document.cancelFullScreen():(t.target,e.requestFullScreen())}function displayFullScreenStatus(){isFullScreen()}function isFullScreen(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.isFullScreen)}function fullScreenElement(){return document.webkitFullScreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullScreenElement}function doFullScreenInIE(e){window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth);var t=window.createPopup(),r=t.document.body;r.style.backgroundColor="lime",r.style.border="solid black 1px",r.innerHTML="在鼠标点击窗口以外区域时自动关闭";var n=t.document.createElement("object");if(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window){var o=t.document.createElement("param");o.setAttribute("name","windowless"),o.setAttribute("value",!0),n.appendChild(o),n.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53")}else n.setAttribute("type","application/avd-plugin");n.setAttribute("id","fullScreen"),n.setAttribute("width",winWidth),n.setAttribute("height",winHeight),n.src=e,r.appendChild(n),t.show(0,0,winWidth,winHeight,document.body)}function getLocalClientIP(){var o=when.defer(),e=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;return e?function(){var t=new e({iceServers:[]});t.createDataChannel("",{reliable:!1}),t.onicecandidate=function(e){e.candidate&&r("a="+e.candidate.candidate)},t.createOffer(function(e){r(e.sdp),t.setLocalDescription(e)},function(e){console.warn("offer failed",e)});var n=Object.create(null);function i(e){if(!(e in n)){n[e]=!0;for(var t=Object.keys(n).filter(function(e){return n[e]}),r=0;r<t.length;r++)16<t[r].length&&(t.splice(r,1),r--);o.resolve(t[0])}}function r(e){e.split("\r\n").forEach(function(e,t,r){if(~e.indexOf("a=candidate")){var n=(o=e.split(" "))[4];"host"===o[7]&&i(n)}else if(~e.indexOf("c=")){var o;i(n=(o=e.split(" "))[2])}})}n["0.0.0.0"]=!1}():o.reject(""),o.promise}function getEffectiveType(){return navigator.connection.effectiveType}if(function(){var o={},a={},i=function(){},e={define:function(e,t,r){if(!o[e]){var n={name:e,dependencies:t,factory:r};o[e]=n}return o[e]},use:function(e){var t=o[e];if(!t)return null;if(!t.entity){for(var r=[],n=0;n<t.dependencies.length;n++)o[t.dependencies[n]].entity?r.push(o[t.dependencies[n]].entity):r.push(this.use(t.dependencies[n]));t.entity=t.factory.apply(i,r)}return t.entity},require:function(r,n){for(var e=0;e<r.length;e++){var t=r[e];if(!a[t]){var o=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.async="true",i.src=t+".js",i.onload=function(){a[t]=!0,o.removeChild(i),s()},o.appendChild(i)}}function s(){for(var e=!0,t=0;t<r.length;t++)if(!a[r[t]]){e=!1;break}e&&n()}}};window.ModuleBase=e}(),ModuleBase.define("Error",[],function(){var e=function(e,t){"object"==typeof e&&void 0===t?(this.code=e.code,this.message=e.message):(this.code=e,this.message=t)};return e.prototype.errorShow=function(){return"error code:"+this.code+"; error message:"+this.message},e}),dcodeIO)var dcodeIO=dcodeIO.ProtoBuf;else var dcodeIO=module.exports;var cmdBuilder=dcodeIO.newBuilder({}).import({package:"room_pdu",messages:[{name:"Packet",fields:[{rule:"required",type:"RoomPduType",name:"type",id:1},{rule:"required",type:"int32",name:"priority",id:2,options:{default:0}},{rule:"required",type:"int32",name:"src",id:3},{rule:"required",type:"int32",name:"dst",id:4,options:{default:0}},{rule:"optional",type:"bytes",name:"body",id:5}]},{name:"MultiPacket",fields:[{rule:"repeated",type:"Packet",name:"packets",id:1}]},{name:"Webcam",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"CameraType",name:"ctype",id:7},{rule:"optional",type:"string",name:"stream_nick_name",id:8},{rule:"optional",type:"string",name:"stream_name",id:9}]},{name:"Speaker",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"Desktop",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"DocFile",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"required",type:"string",name:"uri",id:5}]},{name:"AddWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Webcam",name:"webcam",id:2}]},{name:"RemoveWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Speaker",name:"speaker",id:2}]},{name:"RemoveSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"DocFile",name:"docfile",id:2}]},{name:"RemoveDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"RoomResourceInfo",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"int32",name:"owner_id",id:2},{rule:"optional",type:"MediaStream",name:"stream",id:3},{rule:"optional",type:"MediaStream",name:"stream_assist1",id:4},{rule:"optional",type:"MediaStream",name:"stream_assist2",id:5},{rule:"optional",type:"int32",name:"publishQualities",id:6},{rule:"optional",type:"string",name:"rtmp_play_url",id:7}]},{name:"RoomInfo",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"required",type:"RoomStatus",name:"room_status",id:2,options:{default:"init_room"}}]},{name:"UserPolicy",fields:[{rule:"optional",type:"bool",name:"join_chat",id:1},{rule:"optional",type:"bool",name:"join_audio",id:2},{rule:"optional",type:"bool",name:"join_video",id:3}]},{name:"JoinInfo",fields:[{rule:"repeated",type:"Webcam",name:"webcams",id:1},{rule:"repeated",type:"Speaker",name:"speakers",id:2},{rule:"optional",type:"string",name:"user_agent",id:3},{rule:"required",type:"UserPolicy",name:"user_policy",id:4},{rule:"optional",type:"string",name:"user_resources",id:5}]},{name:"UserInfo",fields:[{rule:"optional",type:"string",name:"user_id",id:1},{rule:"required",type:"string",name:"user_name",id:2},{rule:"required",type:"UserRole",name:"role",id:3},{rule:"required",type:"int32",name:"privileges",id:4},{rule:"required",type:"UserStatus",name:"status",id:5},{rule:"repeated",type:"Webcam",name:"webcams",id:6},{rule:"repeated",type:"Speaker",name:"speakers",id:7},{rule:"optional",type:"string",name:"user_agent",id:8},{rule:"required",type:"int32",name:"node_id",id:9},{rule:"optional",type:"UserPolicy",name:"user_policy",id:10},{rule:"repeated",type:"Desktop",name:"desktops",id:11},{rule:"optional",type:"string",name:"user_data",id:12}]},{name:"MediaStream",fields:[{rule:"required",type:"string",name:"stream_name",id:1},{rule:"required",type:"MediaType",name:"type",id:2},{rule:"optional",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"width",id:4},{rule:"optional",type:"int32",name:"height",id:5},{rule:"optional",type:"int32",name:"frame_rate",id:6},{rule:"optional",type:"int32",name:"payload",id:7},{rule:"optional",type:"uint32",name:"sdp_version",id:8}]},{name:"MediaStreamInfo",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"MediaStream",name:"stream",id:3}]},{name:"ResourceIndiction",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"ResourceOpt",name:"opt",id:2},{rule:"required",type:"int32",name:"owner_id",id:3},{rule:"required",type:"int32",name:"operator_id",id:4},{rule:"optional",type:"string",name:"host_tocken",id:5}]},{name:"AddDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Desktop",name:"desktop",id:2}]},{name:"UpdateSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Speaker",name:"speaker",id:3}]},{name:"UpdateWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Webcam",name:"webcam",id:3}]},{name:"UpdateDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Desktop",name:"desktop",id:3}]},{name:"JoinReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"version",id:2},{rule:"required",type:"string",name:"room_tocken",id:3},{rule:"optional",type:"string",name:"user_id",id:4},{rule:"required",type:"string",name:"user_name",id:5},{rule:"optional",type:"JoinInfo",name:"join_info",id:6},{rule:"optional",type:"string",name:"password",id:7}]},{name:"JoinRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomInfo",name:"room_info",id:4},{rule:"optional",type:"int32",name:"node_id",id:5},{rule:"optional",type:"UserInfo",name:"user_info",id:6}]},{name:"LeaveMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"reason",id:2}]},{name:"UpdateRoomStatusMsg",fields:[{rule:"required",type:"RoomStatus",name:"status",id:1}]},{name:"PubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"optional",type:"int32",name:"id",id:2}]},{name:"UnpubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"SubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3},{rule:"optional",type:"int32",name:"video_level",id:4}]},{name:"UnsubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3}]},{name:"PubResourceReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2}]},{name:"PubResourceRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RepResultType",name:"type",id:2},{rule:"optional",type:"int32",name:"reason",id:3}]},{name:"RoomKV",fields:[{rule:"required",type:"string",name:"key",id:1},{rule:"required",type:"string",name:"value",id:2}]},{name:"RoomDataInfo",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"repeated",type:"RoomKV",name:"kvs",id:2}]},{name:"PubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"SubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"RoomResourceInfos",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"optional",type:"string",name:"room_id",id:2}]},{name:"UpdateStreamSsrcMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"uint32",name:"old_ssrc",id:3},{rule:"required",type:"uint32",name:"new_ssrc",id:4}]},{name:"ClientTranceInfo",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"level",id:2},{rule:"required",type:"string",name:"msg",id:3}]},{name:"CloseRoomReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"node_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"CloseRoomRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"StartVideoDataMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"StopVideoDataMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"ModifyResourceReq",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"optional",type:"int32",name:"video_level",id:3}]},{name:"ModifyResourceRep",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"UnsubRoomResourceMsgRep",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"GetMiniProgramStreamUrlReq",fields:[{rule:"optional",type:"int32",name:"id",id:1}]},{name:"GetMiniProgramStreamUrlRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"url",id:3}]},{name:"BindAudioToVideoReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"audio_resource_id",id:2},{rule:"required",type:"string",name:"video_resouce_id",id:3}]},{name:"BindAudioToVideoRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"TextMsg",fields:[{rule:"required",type:"string",name:"content",id:1},{rule:"optional",type:"int32",name:"timestamp",id:2}]},{name:"DATA",fields:[{rule:"required",type:"bytes",name:"content",id:1}]},{name:"UserInfoMsg",fields:[{rule:"repeated",type:"UserInfo",name:"user",id:1}]},{name:"UserMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserMsgOpt",name:"opt",id:2},{rule:"optional",type:"int32",name:"reason",id:3},{rule:"optional",type:"int32",name:"opt_node_id",id:4}]},{name:"UpdateUserRolePriviledgeMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"old",id:2},{rule:"required",type:"int32",name:"new",id:3}]},{name:"UpdateUserStatusMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserStatus",name:"old",id:2},{rule:"required",type:"UserStatus",name:"new",id:3}]},{name:"UpdateUserRoleMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserRole",name:"old",id:2},{rule:"required",type:"UserRole",name:"new",id:3}]},{name:"UserIndiction",fields:[{rule:"required",type:"int32",name:"operator_id",id:1},{rule:"required",type:"RoomPduType",name:"type",id:2},{rule:"optional",type:"bytes",name:"body",id:3}]},{name:"UpdateUserDataMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"user_data",id:2}]},{name:"RejoinRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"CloseRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"UpdateUserName",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"optional",type:"string",name:"new_name",id:2}]},{name:"ChangeHost",fields:[{rule:"required",type:"int32",name:"host_node_id",id:1},{rule:"optional",type:"int32",name:"newhost_node_id",id:2}]},{name:"OfferReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"sdp",id:2},{rule:"required",type:"int32",name:"node_id",id:3}]},{name:"OfferRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"sdp",id:4},{rule:"optional",type:"int32",name:"node_id",id:5}]},{name:"CandidateMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"int32",name:"node_id",id:4}]},{name:"SubRoomResourceReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"required",type:"int32",name:"sub_node_id",id:3}]},{name:"SubRoomResourceRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomResourceInfo",name:"info",id:4}]},{name:"OpenReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"access_tocken",id:2},{rule:"optional",type:"string",name:"signal_tocken",id:3},{rule:"optional",type:"string",name:"version",id:4},{rule:"optional",type:"string",name:"thread_id",id:5},{rule:"optional",type:"int32",name:"is_cluster",id:6}]},{name:"OpenRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"signal_tocken",id:4},{rule:"optional",type:"int32",name:"ping_timeout",id:5},{rule:"optional",type:"int32",name:"ping_interval",id:6},{rule:"optional",type:"string",name:"version",id:7}]},{name:"InviteRoomReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"node_id",id:4}]},{name:"InviteRoomReq1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"version",id:3},{rule:"required",type:"string",name:"access_tocken",id:4},{rule:"optional",type:"string",name:"user_id",id:5},{rule:"required",type:"string",name:"user_name",id:6},{rule:"optional",type:"JoinInfo",name:"join_info",id:7},{rule:"optional",type:"string",name:"password",id:8},{rule:"optional",type:"int32",name:"node_id",id:9},{rule:"optional",type:"bool",name:"is_dtls",id:10},{rule:"optional",type:"string",name:"user_data",id:11},{rule:"optional",type:"string",name:"ice_ufrag",id:12},{rule:"optional",type:"string",name:"ice_pwd",id:13},{rule:"optional",type:"bytes",name:"routes_json",id:20}]},{name:"RoomInfo1",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"topic",id:2},{rule:"optional",type:"string",name:"owner_id",id:3},{rule:"optional",type:"string",name:"host_id",id:4},{rule:"optional",type:"bool",name:"has_pwd",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"int32",name:"timezone",id:7},{rule:"optional",type:"int32",name:"start_time",id:8},{rule:"optional",type:"int32",name:"end_time",id:9},{rule:"optional",type:"RoomMode",name:"room_mode",id:10},{rule:"optional",type:"int32",name:"attendee_max",id:11},{rule:"optional",type:"int32",name:"bandwidth",id:12},{rule:"optional",type:"int32",name:"max_audio",id:13},{rule:"optional",type:"int32",name:"max_video",id:14},{rule:"optional",type:"string",name:"room_extend_id",id:15},{rule:"optional",type:"RoomStatus",name:"room_status",id:16,options:{default:"init_room"}},{rule:"optional",type:"int32",name:"attributes",id:17},{rule:"optional",type:"string",name:"is_host_room",id:18}]},{name:"InviteRoomRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"string",name:"sdp",id:5},{rule:"optional",type:"RoomInfo1",name:"room_info",id:6}]},{name:"InviteRoomRep1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"RoomInfo1",name:"room_info",id:5},{rule:"optional",type:"string",name:"finger_print",id:6},{rule:"optional",type:"int32",name:"node_id",id:7},{rule:"optional",type:"int32",name:"ping_timeout",id:8},{rule:"optional",type:"int32",name:"ping_interval",id:9},{rule:"optional",type:"string",name:"ice_ufrag",id:10},{rule:"optional",type:"string",name:"ice_pwd",id:11},{rule:"optional",type:"UserRole",name:"role",id:12},{rule:"optional",type:"string",name:"setup",id:13,options:{default:"active"}},{rule:"optional",type:"string",name:"candidate_string",id:14}]},{name:"CandidateMsg1",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"CloseMsg",fields:[{rule:"required",type:"string",name:"room_tocken",id:1}]},{name:"IceRestartMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"OutgoingInviteStatusNotify",fields:[{rule:"required",type:"OutgoingInviteType",name:"type",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sip_addr",id:3},{rule:"required",type:"int32",name:"status",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"RoomControl",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"attributes",id:2}]},{name:"RoomAttributeChangeNotify",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"attributes",id:2}]},{name:"RoomAvcControl",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"int32",name:"handler",id:2}]},{name:"RoomAvcControlRep",fields:[{rule:"required",type:"int32",name:"ret",id:1},{rule:"required",type:"string",name:"msg",id:2}]},{name:"RoomSetStreamNameReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"string",name:"stream_name",id:5},{rule:"optional",type:"string",name:"stream_nick_name",id:6}]},{name:"RoomSetStreamNameRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"int32",name:"ret",id:6},{rule:"optional",type:"string",name:"msg",id:7}]},{name:"RoomStreamNameChangedNotify",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"user_id",id:2},{rule:"required",type:"string",name:"video_resource_id",id:3},{rule:"optional",type:"string",name:"stream_name",id:4},{rule:"optional",type:"string",name:"stream_nick_name",id:5}]},{name:"UserActionEventsReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"events",id:4}]},{name:"UserActionEventsRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"optional",type:"int32",name:"ret",id:4},{rule:"optional",type:"string",name:"msg",id:5},{rule:"optional",type:"string",name:"rsp_data",id:6}]},{name:"UserSetKeepAliveTimeReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"int32",name:"keepAliveTime",id:4}]},{name:"UserSetKeepAliveTimeRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"int32",name:"ret",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"Point",fields:[{rule:"required",type:"int32",name:"x",id:1},{rule:"required",type:"int32",name:"y",id:2}]},{name:"color",fields:[{rule:"required",type:"int32",name:"a",id:1},{rule:"required",type:"int32",name:"r",id:2},{rule:"required",type:"int32",name:"g",id:3},{rule:"required",type:"int32",name:"b",id:4}]},{name:"Rect",fields:[{rule:"required",type:"int32",name:"left",id:1},{rule:"required",type:"int32",name:"right",id:2},{rule:"required",type:"int32",name:"top",id:3},{rule:"required",type:"int32",name:"bottom",id:4}]},{name:"AnnotationObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"string",name:"annotationId",id:2},{rule:"required",type:"int32",name:"ownerNodeId",id:3},{rule:"required",type:"string",name:"ownerUserId",id:4},{rule:"required",type:"AnnotationType",name:"type",id:5},{rule:"required",type:"LineArrow",name:"arrow",id:6},{rule:"required",type:"int32",name:"lineWidth",id:7},{rule:"required",type:"color",name:"lineColor",id:8},{rule:"required",type:"color",name:"fillColor",id:9},{rule:"required",type:"Rect",name:"objectRect",id:10}]},{name:"Annotation2Point",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"Point",name:"start",id:2},{rule:"required",type:"Point",name:"end",id:3}]},{name:"AnnotationMultiPoint",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"Point",name:"points",id:2}]},{name:"AnnotationList",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"string",name:"eraserIds",id:2}]},{name:"AnnotationMsgInternal",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2},{rule:"optional",type:"string",name:"annotationId",id:3},{rule:"optional",type:"int32",name:"srcNodeId",id:4},{rule:"optional",type:"int32",name:"dstNodeId",id:5}]},{name:"AnnotationMsg",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2}]},{name:"UpdateAnnotationMsg",fields:[{rule:"required",type:"uint32",name:"operType",id:1},{rule:"required",type:"string",name:"objectId",id:2},{rule:"required",type:"uint32",name:"annotationType",id:3},{rule:"optional",type:"string",name:"annotationId",id:4},{rule:"required",type:"int32",name:"operNodeId",id:5},{rule:"required",type:"string",name:"operUserId",id:6},{rule:"optional",type:"Annotation2Point",name:"ann2pt",id:7},{rule:"optional",type:"AnnotationMultiPoint",name:"annMutlipt",id:8},{rule:"optional",type:"AnnotationList",name:"annList",id:9}]},{name:"BoardObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"int32",name:"ownerNodeId",id:2},{rule:"required",type:"string",name:"ownerUserId",id:3},{rule:"required",type:"int32",name:"width",id:4},{rule:"required",type:"int32",name:"height",id:5},{rule:"optional",type:"color",name:"bgColor",id:6},{rule:"optional",type:"string",name:"bgImage",id:7},{rule:"repeated",type:"AnnotationObject",name:"annotations",id:8},{rule:"optional",type:"string",name:"title",id:9},{rule:"optional",type:"string",name:"description",id:10},{rule:"optional",type:"string",name:"extendData",id:11}]},{name:"UpdateBoardMsg",fields:[{rule:"required",type:"uint32",name:"operType",id:1},{rule:"required",type:"int32",name:"operNodeId",id:2},{rule:"required",type:"string",name:"operUserId",id:3},{rule:"optional",type:"string",name:"boardId",id:4},{rule:"optional",type:"BoardObject",name:"board",id:5}]},{name:"BoardsInfoMsg",fields:[{rule:"repeated",type:"BoardObject",name:"boards",id:2}]},{name:"OutgoingCreateLiver",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"liver_name",id:8},{rule:"optional",type:"string",name:"app_data",id:9}]},{name:"OutgoingCreateLiverRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4},{rule:"optional",type:"string",name:"publish_url",id:5},{rule:"optional",type:"string",name:"rtmp_url",id:6},{rule:"optional",type:"string",name:"hls_url",id:7}]},{name:"OutgoingSelectMediaLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6}]},{name:"OutgoingSelectMediaLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingVideoInfo",fields:[{rule:"required",type:"string",name:"owner_user_id",id:1},{rule:"required",type:"int32",name:"zoder",id:2},{rule:"optional",type:"float",name:"x",id:5},{rule:"optional",type:"float",name:"y",id:6},{rule:"optional",type:"float",name:"w",id:7},{rule:"optional",type:"float",name:"h",id:8},{rule:"optional",type:"string",name:"video_resource_id",id:9},{rule:"optional",type:"string",name:"video_data",id:10}]},{name:"OutgoingMixMediaLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"int32",name:"viewWidth",id:6},{rule:"optional",type:"int32",name:"viewHeight",id:7},{rule:"optional",type:"string",name:"audio_user_id",id:8}]},{name:"OutgoingMixMediaLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingDestroyLiver",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"OutgoingDestroyLiverRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingPauseResumeLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"liver_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4}]},{name:"OutgoingPauseResumeLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingGetLivers",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"liver_id",id:3}]},{name:"OutGoingLiverInfo",fields:[{rule:"required",type:"string",name:"liver_id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"optional",type:"string",name:"creator_id",id:3},{rule:"optional",type:"string",name:"createTime",id:4},{rule:"optional",type:"string",name:"duration",id:5},{rule:"optional",type:"string",name:"room_id",id:6},{rule:"optional",type:"LiveStatus",name:"status",id:7},{rule:"optional",type:"string",name:"publish_url",id:8},{rule:"optional",type:"string",name:"rtmp_url",id:9},{rule:"optional",type:"string",name:"hls_url",id:10}]},{name:"OutgoingGetLiversRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"count",id:2},{rule:"repeated",type:"OutGoingLiverInfo",name:"liverInfos",id:3}]},{name:"OutgoingCreateRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"record_name",id:5},{rule:"optional",type:"string",name:"app_data",id:6},{rule:"optional",type:"int32",name:"file_type",id:7}]},{name:"OutgoingCreateRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4},{rule:"optional",type:"string",name:"play_url",id:5}]},{name:"OutgoingSelectMediaRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6}]},{name:"OutgoingSelectMediaRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingMixMediaRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"int32",name:"viewWidth",id:6},{rule:"optional",type:"int32",name:"viewHeight",id:7},{rule:"optional",type:"string",name:"audio_user_id",id:8}]},{name:"OutgoingMixMediaRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingDestroyRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"OutgoingDestroyRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingPauseResumeRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"record_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4}]},{name:"OutgoingPauseResumeRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingGetRecords",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"record_id",id:3}]},{name:"OutGoingRecordInfo",fields:[{rule:"required",type:"string",name:"record_id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"optional",type:"string",name:"creator_id",id:3},{rule:"optional",type:"MediaFileType",name:"file_type",id:4},{rule:"optional",type:"string",name:"url",id:5},{rule:"optional",type:"int64",name:"file_size",id:6},{rule:"optional",type:"string",name:"create_time",id:7},{rule:"optional",type:"int64",name:"duration",id:8},{rule:"optional",type:"string",name:"room_id",id:9},{rule:"optional",type:"RecordStatus",name:"status",id:10}]},{name:"OutgoingGetRecordsRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"count",id:2},{rule:"repeated",type:"OutGoingRecordInfo",name:"recordInfos",id:3}]},{name:"OutgoingCreateStreamsExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"exporter_name",id:5},{rule:"optional",type:"ExporterType",name:"exporter_type",id:6},{rule:"optional",type:"int32",name:"viewWidth",id:7},{rule:"optional",type:"int32",name:"viewHeight",id:8},{rule:"optional",type:"int32",name:"outBitrate",id:9},{rule:"optional",type:"int32",name:"outFps",id:10},{rule:"optional",type:"string",name:"app_data",id:11},{rule:"optional",type:"bool",name:"auto_close",id:12},{rule:"optional",type:"int32",name:"view_bg_color",id:13},{rule:"optional",type:"int32",name:"view_bg_image",id:14},{rule:"optional",type:"string",name:"main_video_resource_id",id:15},{rule:"optional",type:"string",name:"exporter_nick_name",id:16},{rule:"optional",type:"int32",name:"max_video_number",id:17},{rule:"optional",type:"string",name:"pulish_urls",id:18}]},{name:"OutgoingCreateStreamsExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5},{rule:"optional",type:"string",name:"play_urls",id:6},{rule:"optional",type:"string",name:"exporter_name",id:7}]},{name:"OutgoingSelectStreamReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6},{rule:"optional",type:"string",name:"stream_name",id:7},{rule:"optional",type:"ExporterType",name:"exporter_type",id:8}]},{name:"OutgoingSelectStreamRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingMixStreamsReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6},{rule:"optional",type:"ExporterType",name:"exporter_type",id:7}]},{name:"OutgoingMixStreamsRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingDestroyExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"ExporterType",name:"exporter_type",id:4}]},{name:"OutgoingDestroyExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingPauseResumeExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"exporter_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingPauseResumeExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingExporterErrorNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"error_no",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingExporterSetFocusVideoReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingExporterSetFocusVideoRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"required",type:"int32",name:"ret",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"OutgoingGetExporterInfoReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"ExporterType",name:"exporter_type",id:4}]},{name:"OutgoingGetExporterInfoRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"view_stream_id",id:3},{rule:"optional",type:"string",name:"view_name",id:4},{rule:"optional",type:"int32",name:"view_bitrate",id:5},{rule:"optional",type:"int32",name:"view_fps",id:6},{rule:"optional",type:"int32",name:"view_width",id:7},{rule:"optional",type:"int32",name:"view_height",id:8},{rule:"optional",type:"int32",name:"view_bg_color",id:9},{rule:"optional",type:"int32",name:"view_bg_image",id:10},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:11},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:12},{rule:"optional",type:"string",name:"focus_video_resource_id",id:13},{rule:"optional",type:"string",name:"exporter_name",id:14},{rule:"optional",type:"string",name:"exporter_nick_name",id:15},{rule:"optional",type:"int32",name:"max_video_number",id:16},{rule:"optional",type:"int32",name:"ret",id:17},{rule:"optional",type:"string",name:"msg",id:18}]},{name:"MouseParams",fields:[{rule:"optional",type:"string",name:"paramStr",id:1},{rule:"optional",type:"int32",name:"paramInt",id:2}]},{name:"MouseMsg",fields:[{rule:"required",type:"uint32",name:"mouseT",id:1},{rule:"required",type:"int32",name:"x_pos",id:2},{rule:"required",type:"int32",name:"y_pos",id:3},{rule:"repeated",type:"MouseParams",name:"params",id:4}]},{name:"KeyCtrl",fields:[{rule:"required",type:"uint32",name:"keyC",id:1}]},{name:"KeyValue",fields:[{rule:"required",type:"uint32",name:"keyV",id:1}]},{name:"KeyBoardMsg",fields:[{rule:"repeated",type:"KeyCtrl",name:"cc",id:1},{rule:"repeated",type:"KeyValue",name:"vv",id:2}]},{name:"RequestCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"CmdType",name:"cmtype",id:2},{rule:"required",type:"ClientType",name:"client",id:3},{rule:"required",type:"string",name:"bectrluserId",id:4},{rule:"required",type:"string",name:"ctrluserid",id:5},{rule:"required",type:"int64",name:"timestamp",id:6}]},{name:"RespondCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"CmdType",name:"cmtype",id:3},{rule:"required",type:"string",name:"token",id:4},{rule:"required",type:"string",name:"ctruserId",id:5},{rule:"required",type:"string",name:"beCtrleduserId",id:6},{rule:"optional",type:"int32",name:"desk_width",id:7},{rule:"optional",type:"int32",name:"desk_height",id:8},{rule:"optional",type:"int64",name:"timestamp",id:9}]},{name:"RespondCtrlAsk",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"CmdType",name:"cmtype",id:3},{rule:"required",type:"string",name:"token",id:4},{rule:"optional",type:"string",name:"ctruserId",id:5},{rule:"optional",type:"string",name:"beCtrleduserId",id:6},{rule:"optional",type:"int64",name:"timestamp",id:7}]},{name:"RequestInvite",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"string",name:"token",id:2},{rule:"required",type:"string",name:"ctruserId",id:3},{rule:"required",type:"string",name:"beCtrleduserId",id:4},{rule:"required",type:"int32",name:"desk_width",id:5},{rule:"required",type:"int32",name:"desk_height",id:6},{rule:"optional",type:"int64",name:"timestamp",id:7}]},{name:"RespondInvite",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"token",id:3},{rule:"required",type:"string",name:"ctruserId",id:4},{rule:"required",type:"string",name:"beCtrleduserId",id:5},{rule:"optional",type:"int64",name:"timestamp",id:6}]},{name:"RequestTermialCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"string",name:"ctruserId",id:2},{rule:"required",type:"string",name:"beCtrleduserId",id:3},{rule:"optional",type:"int64",name:"timestamp",id:4}]},{name:"RespondTermialCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"ctruserId",id:3},{rule:"required",type:"string",name:"beCtrleduserId",id:4},{rule:"optional",type:"int64",name:"timestamp",id:5}]},{name:"CmdCtrlMsg",fields:[{rule:"required",type:"int32",name:"otype",id:1},{rule:"required",type:"string",name:"token",id:2},{rule:"required",type:"int32",name:"requestid",id:3},{rule:"required",type:"MouseMsg",name:"mouseV",id:4},{rule:"required",type:"KeyBoardMsg",name:"keyV",id:5}]},{name:"CmdCtrlMsgRespond",fields:[{rule:"required",type:"int32",name:"requestid",id:1},{rule:"required",type:"int32",name:"result",id:3}]}],enums:[{name:"RoomPduType",values:[{name:"RoomPduType_Unkonw",id:0},{name:"PING",id:1},{name:"PONG",id:2},{name:"MULTI_PACKET",id:10},{name:"ADD_WEBCAM_MSG",id:1001},{name:"REMOVE_WEBCAM_MSG",id:1002},{name:"ADD_SPEAKER_MSG",id:1003},{name:"REMOVE_SPEAKER_MSG",id:1004},{name:"ADD_DOC_MSG",id:1005},{name:"REMOVE_DOC_MSG",id:1006},{name:"VIDEO_INDICTION",id:1007},{name:"AUDIO_INDICTION",id:1008},{name:"ADD_DESKTOP_MSG",id:1009},{name:"UPDATE_SPEAKER_MSG",id:1010},{name:"UPDATE_WEBCAM_MSG",id:1011},{name:"UPDATE_DESKTOP_MSG",id:1012},{name:"JOIN_REQ",id:2001},{name:"JOIN_REP",id:2002},{name:"LEAVE_MSG",id:2003},{name:"UPDATE_ROOM_STATUS_MSG",id:2004},{name:"PUB_ROOM_RESOURCE_MSG",id:2005},{name:"UNPUB_ROOM_RESOURCE_MSG",id:2006},{name:"SUB_ROOM_RESOURCE_MSG",id:2007},{name:"UNSUB_ROOM_RESOURCE_MSG",id:2008},{name:"PUB_VIDEO_REQ",id:2009},{name:"PUB_AUDIO_REQ",id:2010},{name:"PUB_VIDEO_REP",id:2011},{name:"PUB_AUDIO_REP",id:2012},{name:"ROOM_DATA_INFO",id:2013},{name:"PUB_ROOM_RESOURCE_MSG_REP",id:2014},{name:"SUB_ROOM_RESOURCE_MSG_REP",id:2015},{name:"ROOM_RESOURCE_INFOS",id:2016},{name:"UPDATE_STREAM_SSRC_MSG",id:2017},{name:"CLIENT_TRACE_INFO",id:2018},{name:"CLOSE_ROOM_REQ",id:2019},{name:"CLOSE_ROOM_REP",id:2020},{name:"START_VIDEO_DATA_MSG",id:2021},{name:"STOP_VIDEO_DATA_MSG",id:2022},{name:"MODIFY_RESOURCE_REQ",id:2023},{name:"MODIFY_RESOURCE_REP",id:2024},{name:"UNSUB_ROOM_RESOURCE_MSG_REP",id:2025},{name:"GET_MINI_PROGRAM_STREAM_URL_REQ",id:2026},{name:"GET_MINI_PROGRAM_STREAM_URL_REP",id:2027},{name:"BIND_AUDIO_TO_VIDEO_REQ",id:2028},{name:"BIND_AUDIO_TO_VIDEO_REP",id:2029},{name:"PUBLIC_TEXT_MSG",id:3001},{name:"PRIVATE_TEXT_MSG",id:3002},{name:"PUBLIC_DATA",id:3003},{name:"PRIVATE_DATA",id:3004},{name:"USER_INFO_MSG",id:2051},{name:"USER_MSG",id:2052},{name:"UPDATA_USER_ROLE_PRIVILEDGE_MSG",id:2053},{name:"UPDATE_USER_STATUS_MSG",id:2054},{name:"UPDATE_USER_ROLE_MSG",id:2055},{name:"USER_INDICTION",id:2056},{name:"UPDATE_USER_DATA_MSG",id:2057},{name:"REJOIN_ROOM_MSG",id:2058},{name:"CLOSE_ROOM_MSG",id:2059},{name:"UPDATE_USER_NAME",id:2060},{name:"CHANGE_HOST",id:2061},{name:"OFFER_REQ",id:6001},{name:"OFFER_REP",id:6002},{name:"CANDIDATE_MSG",id:6003},{name:"SUB_ROOM_RESOURCE_REQ",id:6004},{name:"SUB_ROOM_RESOURCE_REP",id:6005},{name:"OPEN_REQ",id:7001},{name:"OPEN_REP",id:7002},{name:"INVITE_ROOM_REQ",id:7003},{name:"INVITE_ROOM_REQ1",id:7020},{name:"INVITE_ROOM_REP",id:7004},{name:"INVITE_ROOM_REP1",id:7021},{name:"CANDIDATE_MSG1",id:7005},{name:"CLOSE_MSG",id:7006},{name:"ICE_RESTART_MSG",id:7007},{name:"OUTGOING_INVITE_STATUS_NOTIFY",id:7008},{name:"ROOM_CONTROL",id:7009},{name:"ROOM_ATTRIBUTE_CHANGE_NOTIFY",id:7022},{name:"ROOM_START_AVC_MIXER_MEDIA",id:7023},{name:"ROOM_START_AVC_MIXER_MEDIA_REP",id:7024},{name:"ROOM_SET_STREAM_NAME_REQ",id:7025},{name:"ROOM_SET_STREAM_NAME_RSP",id:7026},{name:"ROOM_STREAM_NAME_CHANGED_NOTIFY",id:7027},{name:"USER_ACTION_EVENTS_REQ",id:7028},{name:"USER_ACTION_EVENTS_Rsp",id:7029},{name:"USER_SET_KEEP_ALIVE_TIME_REQ",id:7030},{name:"USER_SET_KEEP_ALIVE_TIME_RSP",id:7031},{name:"ANNOTATION_MSG",id:2100},{name:"UPDATE_ANNOTATION_MSG",id:2101},{name:"UPDATE_BOARD_MSG",id:2102},{name:"BOARDS_INFO_PDU",id:2103},{name:"OUTGOING_CREATE_LIVER",id:9001},{name:"OUTGOING_CREATE_LIVER_REP",id:9002},{name:"OUTGOING_SELECT_MEDIA_LIVE",id:9003},{name:"OUTGOING_SELECT_MEDIA_LIVE_REP",id:9004},{name:"OUTGOING_MIX_MEDIA_LIVE",id:9005},{name:"OUTGOING_MIX_MEDIA_LIVE_REP",id:9006},{name:"OUTGOING_DESTROY_LIVER",id:9007},{name:"OUTGOING_DESTROY_LIVER_REP",id:9008},{name:"OUTGOING_PAUSE_RESUME_LIVE",id:9009},{name:"OUTGOING_PAUSE_RESUME_LIVE_REP",id:9010},{name:"OUTGOING_GET_LIVERS",id:9011},{name:"OUTGOING_GET_LIVERS_REP",id:9012},{name:"OUTGOING_CREATE_RECORD",id:9013},{name:"OUTGOING_CREATE_RECORD_REP",id:9014},{name:"OUTGOING_SELECT_MEDIA_RECORD",id:9015},{name:"OUTGOING_SELECT_MEDIA_RECORD_REP",id:9016},{name:"OUTGOING_MIX_MEDIA_RECORD",id:9017},{name:"OUTGOING_MIX_MEDIA_RECORD_REP",id:9018},{name:"OUTGOING_DESTROY_RECORD",id:9019},{name:"OUTGOING_DESTROY_RECORD_REP",id:9020},{name:"OUTGOING_PAUSE_RESUME_RECORD",id:9021},{name:"OUTGOING_PAUSE_RESUME_RECORD_REP",id:9022},{name:"OUTGOING_GET_RECORDS",id:9023},{name:"OUTGOING_GET_RECORDS_REP",id:9024},{name:"OUTGOING_CREATE_STREAMS_EXPORTER_REQ",id:9025},{name:"OUTGOING_CREATE_STREAMS_EXPORTER_REP",id:9026},{name:"OUTGOING_SELECT_STREAM_REQ",id:9027},{name:"OUTGOING_SELECT_STREAM_REP",id:9028},{name:"OUTGOING_MIX_STREAMS_REQ",id:9029},{name:"OUTGOING_MIX_STREAMS_REP",id:9030},{name:"OUTGOING_DESTROY_EXPORTER_REQ",id:9031},{name:"OUTGOING_DESTROY_EXPORTER_REP",id:9032},{name:"OUTGOING_PAUSE_RESUME_EXPORTER_REQ",id:9033},{name:"OUTGOING_PAUSE_RESUME_EXPORTER_REP",id:9034},{name:"OUTGOING_EXPORTER_ERROR_NOTIFY",id:9035},{name:"OUTGOING_EXPORTER_SET_FOCUS_VIDEO_REQ",id:9036},{name:"OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP",id:9037},{name:"OUTGOING_GET_EXPORTER_INFO_REQ",id:9038},{name:"OUTGOING_GET_EXPORTER_INFO_RSP",id:9039},{name:"REQUEST_CTRL",id:20001},{name:"RESPOND_CTRL",id:20002},{name:"RESPOND_CTRL_ASK",id:20003},{name:"REQUEST_INVITE",id:20004},{name:"RESPOND_INVITE",id:20005},{name:"REQUEST_TERMIAL_CTRL",id:20006},{name:"RESPOND_TERMIAL_CTRL",id:20007},{name:"CMD_CTRL_MSG",id:20008},{name:"CMD_CTRL_MSG_RESPOND",id:20009}]},{name:"RoomStatus",values:[{name:"init_room",id:1},{name:"open_room",id:2},{name:"locked_room",id:3},{name:"closed_room",id:4}]},{name:"ResourceOpt",values:[{name:"pub",id:1},{name:"unpub",id:2},{name:"sub",id:3},{name:"unsub",id:4},{name:"mute",id:5},{name:"unmute",id:6},{name:"forbid",id:7},{name:"unforbid",id:8}]},{name:"ResourceStatus",values:[{name:"init",id:1},{name:"published",id:2},{name:"muted",id:3},{name:"forbided",id:4},{name:"subed",id:5}]},{name:"CameraType",values:[{name:"unknown",id:0},{name:"front",id:1},{name:"back",id:2}]},{name:"UserStatus",values:[{name:"online",id:0},{name:"offline",id:1}]},{name:"UserRole",values:[{name:"host",id:1},{name:"presenter",id:2},{name:"attendee",id:3}]},{name:"MediaType",values:[{name:"video",id:1},{name:"audio",id:2},{name:"desktop",id:3}]},{name:"SessionType",values:[{name:"Chat",id:1},{name:"Audio",id:2},{name:"Video",id:3},{name:"ShareScreen",id:4},{name:"ShareDoc",id:5},{name:"WhiteBoard",id:6}]},{name:"RepResultType",values:[{name:"allowed",id:1},{name:"rejected",id:2}]},{name:"UserMsgOpt",values:[{name:"leave",id:1},{name:"kickoff",id:2},{name:"server_kickoff",id:3},{name:"timeout",id:4}]},{name:"RoomMode",values:[{name:"free",id:1},{name:"host1",id:2},{name:"p2pfree",id:3},{name:"p2phost",id:4}]},{name:"OutgoingInviteType",values:[{name:"OutgoingInviteTypeSIP",id:1},{name:"OutgoingInviteTypeH323",id:2},{name:"OutgoingInviteTypeRTSP",id:3}]},{name:"LineArrow",values:[{name:"none",id:1},{name:"begin",id:2},{name:"end",id:3},{name:"arrow2",id:4}]},{name:"AnnotationType",values:[{name:"annotation_tool_mouse",id:1},{name:"annotation_tool_line",id:2},{name:"annotation_tool_rectangle",id:3},{name:"annotation_tool_ellipse",id:4},{name:"annotation_tool_polyline",id:5},{name:"annotation_tool_polygon",id:6},{name:"annotation_tool_hlight_point",id:7},{name:"annotation_tool_hlight_texttag",id:8},{name:"annotation_tool_eraser_line",id:9},{name:"annotation_tool_eraser_rectangle",id:10},{name:"annotation_tool_rhomb",id:11},{name:"annotation_tool_arrow",id:12},{name:"annotation_tool_success",id:13},{name:"annotation_tool_failure",id:14},{name:"annotation_tool_undo",id:15},{name:"annotation_tool_redo",id:16},{name:"annotation_tool_clear",id:17}]},{name:"OutGoingViewLayoutMode",values:[{name:"Outgoing_View_Layout_Fixation",id:0},{name:"Outgoing_View_Layout_Auto",id:1},{name:"Outgoing_View_Layout_Auto_Orato",id:2}]},{name:"LiveStatus",values:[{name:"LIVE_STATUS_LIVEING",id:0},{name:"LIVE_STATUS_PAUSED",id:1}]},{name:"RecordStatus",values:[{name:"RECORD_STATUS_LIVEING",id:0},{name:"RECORD_STATUS_PAUSED",id:1}]},{name:"MediaFileType",values:[{name:"TbMediaFormat_AVI",id:0},{name:"TbMediaFormat_WEBM",id:1},{name:"TbMediaFormat_MP4",id:2},{name:"TbMediaFormat_WAV",id:3}]},{name:"ExporterType",values:[{name:"EXPORTER_TYPE_RECORD",id:0},{name:"EXPORTER_TYPE_RECORD_REAL_TIME",id:1},{name:"EXPORTER_TYPE_LIVER",id:2},{name:"EXPORTER_TYPE_RECORD_AUTO",id:3},{name:"EXPORTER_TYPE_LIVER_AUTO",id:4},{name:"EXPORTER_TYPE_LIVER_AUTO_VIEW",id:5},{name:"EXPORTER_TYPE_RECORD_AUTO_VIEW",id:6},{name:"EXPORTER_TYPE_AVC_MEDIA_MIXER",id:7}]},{name:"CmdType",values:[{name:"ctrl",id:1},{name:"cancle_ctr",id:2},{name:"extend_ctr1",id:3}]},{name:"ClientType",values:[{name:"Win_pc",id:1},{name:"android",id:2},{name:"ios",id:3}]},{name:"CmdResult",values:[{name:"allow",id:1},{name:"notallow",id:2},{name:"terminal",id:3}]}]}).build(),mqttBuilder=dcodeIO.newBuilder({}).import({package:"signal_pdu",messages:[{name:"signal_header",fields:[{rule:"required",type:"string",name:"version",id:1},{rule:"required",type:"signal_group_type",name:"group_type",id:2},{rule:"required",type:"signal_cmd_type",name:"cmd_type",id:3},{rule:"required",type:"uint32",name:"timestamp",id:4},{rule:"required",type:"string",name:"from",id:5},{rule:"required",type:"string",name:"to",id:6},{rule:"required",type:"bytes",name:"content",id:7}]},{name:"Invite",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteCancel",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteOk",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteReject",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteRinging",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteTimeOut",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteBye",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"MsgData",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3},{rule:"required",type:"uint32",name:"create_time",id:4},{rule:"required",type:"MsgType",name:"msg_type",id:5},{rule:"required",type:"bytes",name:"msg_content",id:6}]},{name:"MsgDataDelivered",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRead",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRecalled",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MouseEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"int32",name:"video_x",id:2},{rule:"optional",type:"int32",name:"video_y",id:3},{rule:"optional",type:"int32",name:"video_w",id:4},{rule:"optional",type:"int32",name:"video_h",id:5},{rule:"optional",type:"mouse_events_type",name:"eventsType",id:6}]},{name:"KeyBoardEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"repeated",type:"int32",name:"keyc",id:2},{rule:"repeated",type:"int32",name:"keyv",id:3},{rule:"optional",type:"keyboard_events_type",name:"eventsType",id:4}]},{name:"RpcCallRequest",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"required",type:"bytes",name:"rpc_data",id:2}]},{name:"RpcCallResponse",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"required",type:"bytes",name:"rpc_data",id:2}]},{name:"RpcNotification",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"required",type:"bytes",name:"rpc_data",id:2}]}],enums:[{name:"signal_group_type",values:[{name:"SIGNALE_GROUP_TYPE_SYS",id:0},{name:"SIGNALE_GROUP_TYPE_MESSAGE",id:1},{name:"SIGNALE_GROUP_TYPE_INVITE",id:3},{name:"SIGNALE_GROUP_TYPE_RPC",id:4},{name:"SIGNALE_GROUP_TYPE_ADDRESS_BOOK",id:5},{name:"SIGNALE_GROUP_TYPE_REMOTE_CONTROL",id:6}]},{name:"signal_cmd_type",values:[{name:"SIGNALE_CMD_TYPE_INVITE",id:0},{name:"SIGNALE_CMD_TYPE_INVITE_CANCEL",id:1},{name:"SIGNALE_CMD_TYPE_INVITE_RINGING",id:2},{name:"SIGNALE_CMD_TYPE_INVITE_OK",id:3},{name:"SIGNALE_CMD_TYPE_INVITE_REJECT",id:4},{name:"SIGNALE_CMD_TYPE_INVITE_TIMEOUT",id:5},{name:"SIGNALE_CMD_TYPE_INVITE_BYE",id:6},{name:"SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS",id:32},{name:"SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS",id:33},{name:"SIGNALE_CMD_TYPE_MESSAGE_DATA",id:48},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECEIVED",id:49},{name:"SIGNALE_CMD_TYPE_MESSAGE_READ",id:50},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECALLED",id:51},{name:"SIGNALE_CMD_TYPE_RPC_CALL_REQUEST",id:64},{name:"SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE",id:65},{name:"SIGNALE_CMD_TYPE_RPC_NOTIFICATION",id:66}]},{name:"SessionType",values:[{name:"SESSION_TYPE_PEERS",id:1},{name:"SESSION_TYPE_GROUP",id:2},{name:"SESSION_TYPE_CHATROOM",id:3}]},{name:"MsgType",values:[{name:"MSG_TYPE_TEXT",id:1},{name:"MSG_TYPE_IMAGE",id:2},{name:"MSG_TYPE_FILE",id:3},{name:"MSG_TYPE_AUDIO",id:4},{name:"MSG_TYPE_VIDEO",id:5},{name:"MSG_TYPE_LOCATION",id:6}]},{name:"MsgStatus",values:[{name:"MSG_STAT_DELIVERING",id:1},{name:"MSG_STAT_DELIVERED",id:2},{name:"MSG_STAT_READ",id:3},{name:"MSG_STAT_FAILED",id:4},{name:"MSG_TYPE_RECALLED",id:5}]},{name:"mouse_events_type",values:[{name:"WM_MOUSEMOVE",id:512},{name:"WM_LBUTTONDOWN",id:513},{name:"WM_LBUTTONUP",id:514},{name:"WM_LBUTTONDBLCLK",id:515},{name:"WM_RBUTTONDOWN",id:516},{name:"WM_RBUTTONUP",id:517},{name:"WM_RBUTTONDBLCLK",id:518},{name:"WM_MBUTTONDOWN",id:519},{name:"WM_MBUTTONUP",id:520},{name:"WM_MBUTTONDBLCLK",id:521},{name:"WM_MOUSEWHEEL",id:522}]},{name:"keyboard_events_type",values:[{name:"WM_KEYDOWN",id:256},{name:"WM_KEYUP",id:257},{name:"WM_CHAR",id:258}]},{name:"keyboard_vk_type",values:[{name:"VK_BACK",id:8},{name:"VK_TAB",id:9},{name:"VK_SHIFT",id:16},{name:"VK_CONTROL",id:17},{name:"VK_MENU",id:18},{name:"VK_PAUSE",id:19},{name:"VK_CAPITAL",id:20},{name:"VK_KANA",id:21},{name:"VK_JUNJA",id:23},{name:"VK_FINAL",id:24},{name:"VK_HANJA",id:25},{name:"VK_KANJI",id:25},{name:"VK_ESCAPE",id:27},{name:"VK_CONVERT",id:28},{name:"VK_NONCONVERT",id:29},{name:"VK_ACCEPT",id:30},{name:"VK_MODECHANGE",id:31},{name:"VK_SPACE",id:32},{name:"VK_PRIOR",id:33},{name:"VK_NEXT",id:34},{name:"VK_END",id:35},{name:"VK_HOME",id:36},{name:"VK_LEFT",id:37},{name:"VK_UP",id:38},{name:"VK_RIGHT",id:39},{name:"VK_DOWN",id:40},{name:"VK_SELECT",id:41},{name:"VK_PRINT",id:42},{name:"VK_EXECUTE",id:43},{name:"VK_SNAPSHOT",id:44},{name:"VK_INSERT",id:45},{name:"VK_DELETE",id:46},{name:"VK_HELP",id:47}]}]}).build();ModuleBase.define("CmdProtobufCoded",[],function(){var y,e=function(){y=cmdBuilder.room_pdu};return e.prototype.getRoomPduTypeEnum=function(){return y.RoomPduType},e.prototype.getRoomStatusEnum=function(){return y.RoomStatus},e.prototype.getResourceOptEnum=function(){return y.ResourceOpt},e.prototype.getResourceStatusEnum=function(){return y.ResourceStatus},e.prototype.getCameraTypeEnum=function(){return y.CameraType},e.prototype.getUserStatusEnum=function(){return y.UserStatus},e.prototype.getUserRoleEnum=function(){return y.UserRole},e.prototype.getMediaTypeEnum=function(){return y.MediaType},e.prototype.getSessionTypeEnum=function(){return y.SessionType},e.prototype.getRepResultTypeEnum=function(){return y.RepResultType},e.prototype.getUserMsgOptEnum=function(){return y.UserMsgOpt},e.prototype.getRoomModeEnum=function(){return y.RoomMode},e.prototype.getLineArrowEnum=function(){return y.LineArrow},e.prototype.getAnnotationTypeEnum=function(){return y.AnnotationType},e.prototype.getExporterTypeEnum=function(){return y.ExporterType},e.prototype.getOutgoingInviteTypeEnum=function(){return y.OutgoingInviteType},e.prototype.getOutGoingViewLayoutMode=function(){return y.OutGoingViewLayoutMode},e.prototype.newWebcam=function(){return new y.Webcam},e.prototype.newWebcam=function(e,t,r,n){return new y.Webcam(e,t,r,n)},e.prototype.newSpeaker=function(){return new y.Speaker},e.prototype.newSpeaker=function(e,t,r,n){return new y.Speaker(e,t,r,n)},e.prototype.newDesktop=function(){return new y.Desktop},e.prototype.newDesktop=function(e,t,r,n){return new y.Desktop(e,t,r,n)},e.prototype.newDocFile=function(){return new y.DocFile},e.prototype.newDocFile=function(e,t,r,n,o){return new y.DocFile(e,t,r,n,o)},e.prototype.newAddWebcamMsg=function(){return new y.AddWebcamMsg},e.prototype.newAddWebcamMsg=function(e,t){return new y.AddWebcamMsg(e,t)},e.prototype.newRemoveWebcamMsg=function(){return new y.RemoveWebcamMsg},e.prototype.newRemoveWebcamMsg=function(e,t){return new y.RemoveWebcamMsg(e,t)},e.prototype.newAddSpeakerMsg=function(){return new y.AddSpeakerMsg},e.prototype.newAddSpeakerMsg=function(e,t){return new y.AddSpeakerMsg(e,t)},e.prototype.newRemoveSpeakerMsg=function(){return new y.RemoveSpeakerMsg},e.prototype.newRemoveSpeakerMsg=function(e,t){return new y.RemoveSpeakerMsg(e,t)},e.prototype.newAddDocFileMsg=function(){return new y.AddDocFileMsg},e.prototype.newAddDocFileMsg=function(e,t){return new y.AddDocFileMsg(e,t)},e.prototype.newRemoveDocFileMsg=function(){return new y.RemoveDocFileMsg},e.prototype.newRemoveDocFileMsg=function(e,t){return new y.RemoveDocFileMsg(e,t)},e.prototype.newRoomResourceInfo=function(){return new y.RoomResourceInfo},e.prototype.newRoomResourceInfo=function(e,t,r){return new y.RoomResourceInfo(e,t,r)},e.prototype.newRoomInfo=function(){return new y.RoomInfo},e.prototype.newRoomInfo=function(e,t){return new y.RoomInfo(e,t)},e.prototype.newUserPolicy=function(){return new y.UserPolicy},e.prototype.newUserPolicy=function(e,t,r){return new y.UserPolicy(e,t,r)},e.prototype.newJoinInfo=function(){return new y.JoinInfo},e.prototype.newJoinInfo=function(e,t,r,n,o){return new y.JoinInfo(e,t,r,n,o)},e.prototype.newUserInfo=function(){return new y.UserInfo},e.prototype.newUserInfo=function(e,t,r,n,o,i,s,a,c,l,d,u){return new y.UserInfo(e,t,r,n,o,i,s,a,c,l,d,u)},e.prototype.newMediaStream=function(){return new y.MediaStream},e.prototype.newMediaStream=function(e,t,r,n,o,i,s){var a=new y.MediaStream;return a.stream_name=e,a.type=t,a.sdp=r,void 0!==n&&0!=n&&(a.width=n),void 0!==o&&0!=o&&(a.height=o),void 0!==i&&0!=i&&(a.frame_rate=i),void 0!==s&&(a.payload=s),a},e.prototype.newMediaStreamInfo=function(){return new y.MediaStreamInfo},e.prototype.newMediaStreamInfo=function(e,t,r){return new y.MediaStreamInfo(e,t,r)},e.prototype.newResourceIndiction=function(){return new y.ResourceIndiction},e.prototype.newResourceIndiction=function(e,t,r,n,o){return new y.ResourceIndiction(e,t,r,n,o)},e.prototype.newAddDesktopMsg=function(){return new y.AddDesktopMsg},e.prototype.newAddDesktopMsg=function(e,t){return new y.AddDesktopMsg(e,t)},e.prototype.newRemoveDesktopMsg=function(){return new y.RemoveDesktopMsg},e.prototype.newRemoveDesktopMsg=function(e,t){return new y.RemoveDesktopMsg},e.prototype.newUpdateWebcamMsg=function(){return new y.UpdateWebcamMsg},e.prototype.newUpdateWebcamMsg=function(e,t,r){return new y.UpdateWebcamMsg(e,t,r)},e.prototype.newUpdateSpeakerMsg=function(){return new y.UpdateSpeakerMsg},e.prototype.newUpdateSpeakerMsg=function(e,t,r){return new y.UpdateSpeakerMsg(e,t,r)},e.prototype.newUpdateDesktopMsg=function(){return new y.UpdateDesktopMsg},e.prototype.newUpdateDesktopMsg=function(e,t,r){return new y.UpdateDesktopMsg(e,t,r)},e.prototype.newLeaveMsg=function(){return new y.LeaveMsg},e.prototype.newLeaveMsg=function(e,t){return new y.LeaveMsg(e,t)},e.prototype.newUpdateRoomStatusMsg=function(){return new y.UpdateRoomStatusMsg},e.prototype.newUpdateRoomStatusMsg=function(e){return new y.UpdateRoomStatusMsg(e)},e.prototype.newPubRoomResourceMsg=function(){return new y.PubRoomResourceMsg},e.prototype.newPubRoomResourceMsg=function(e,t){return new y.PubRoomResourceMsg(e,t)},e.prototype.newUnpubRoomResourceMsg=function(){return new y.UnpubRoomResourceMsg},e.prototype.newUnpubRoomResourceMsg=function(e){return new y.UnpubRoomResourceMsg(e)},e.prototype.newSubRoomResourceMsg=function(){return new y.SubRoomResourceMsg},e.prototype.newSubRoomResourceMsg=function(e,t,r){return new y.SubRoomResourceMsg(e,t,r)},e.prototype.newSubRoomResourceMsg=function(e,t,r,n){return new y.SubRoomResourceMsg(e,t,r,n)},e.prototype.newUnsubRoomResourceMsg=function(){return new y.UnsubRoomResourceMsg},e.prototype.newUnsubRoomResourceMsg=function(e,t){return new y.UnsubRoomResourceMsg(e,t)},e.prototype.newPubResourceReq=function(){return new y.PubResourceReq},e.prototype.newPubResourceReq=function(e,t){return new y.PubResourceReq(e,t)},e.prototype.newPubResourceRep=function(){return new y.PubResourceRep},e.prototype.newPubResourceRep=function(e,t,r){return new y.PubResourceRep(e,t,r)},e.prototype.newCloseRoomReq=function(){return new y.CloseRoomReq},e.prototype.newCloseRoomReq=function(e,t,r){return new y.CloseRoomReq(e,t,r)},e.prototype.newCloseRoomRep=function(){return new y.CloseRoomRep},e.prototype.newCloseRoomRep=function(e,t,r){return new y.CloseRoomRep(e,t,r)},e.prototype.newUpdateUserName=function(){return new y.UpdateUserName},e.prototype.newUpdateUserName=function(e,t){return new y.UpdateUserName(e,t)},e.prototype.newStartVideoDataMsg=function(){return new y.StartVideoDataMsg},e.prototype.newStartVideoDataMsg=function(e){return new y.StartVideoDataMsg(e)},e.prototype.newStopVideoDataMsg=function(){return new y.StopVideoDataMsg},e.prototype.newStopVideoDataMsg=function(e){return new y.StopVideoDataMsg(e)},e.prototype.newModifyResourceReq=function(){return new y.ModifyResourceReq},e.prototype.newModifyResourceReq=function(e,t,r){return new y.ModifyResourceReq(e,t,r)},e.prototype.newModifyResourceRep=function(){return new y.ModifyResourceRep},e.prototype.newModifyResourceRep=function(e,t,r){return new y.ModifyResourceRep(e,t,r)},e.prototype.newRoomKV=function(){return new y.RoomKV},e.prototype.newRoomKV=function(e,t){return new y.RoomKV(e,t)},e.prototype.newRoomDataInfo=function(){return new y.RoomDataInfo},e.prototype.newRoomDataInfo=function(e,t){return new y.RoomDataInfo(e,t)},e.prototype.newTextMsg=function(){return new y.TextMsg},e.prototype.newTextMsg=function(e,t){return new y.TextMsg(e,t)},e.prototype.newData=function(){return new y.DATA},e.prototype.newData=function(e){return new y.DATA(e)},e.prototype.newUserInfoMsg=function(){return new y.UserInfoMsg},e.prototype.newUserInfoMsg=function(e){return new y.UserInfoMsg(e)},e.prototype.newUserMsg=function(){return new y.UserMsg},e.prototype.newUserMsg=function(e,t,r){return new y.UserMsg(e,t,r)},e.prototype.newUpdateUserRolePriviledgeMsg=function(){return new y.UpdateUserRolePriviledgeMsg},e.prototype.newUpdateUserRolePriviledgeMsg=function(e,t,r){return new y.UpdateUserRolePriviledgeMsg(e,t,r)},e.prototype.newUpdateUserStatusMsg=function(){return new y.UpdateUserStatusMsg},e.prototype.newUpdateUserStatusMsg=function(e,t,r){return new y.UpdateUserStatusMsg(e,t,r)},e.prototype.newUpdateUserRoleMsg=function(){return new y.UpdateUserRoleMsg},e.prototype.newUpdateUserRoleMsg=function(e,t,r){return new y.UpdateUserRoleMsg(e,t,r)},e.prototype.newUserIndiction=function(){return new y.UserIndiction},e.prototype.newUserIndiction=function(e,t,r){return new y.UserIndiction(e,t,r)},e.prototype.newUpdateUserDataMsg=function(){return new y.UpdateUserDataMsg},e.prototype.newUpdateUserDataMsg=function(e,t){return new y.UpdateUserDataMsg(e,t)},e.prototype.newCloseRoomMsg=function(){return new y.CloseRoomMsg},e.prototype.newCloseRoomMsg=function(e,t){return new y.CloseRoomMsg(e,t)},e.prototype.newOfferReq=function(){return new y.OfferReq},e.prototype.newOfferReq=function(e,t,r){return new y.OfferReq(e,t,r)},e.prototype.newOfferRep=function(){return new y.OfferRep},e.prototype.newOfferRep=function(e,t,r,n,o){return new y.OfferRep(e,t,r,n,o)},e.prototype.newCandidateMsg=function(){return new y.CandidateMsg},e.prototype.newCandidateMsg=function(e,t,r,n){return new y.CandidateMsg(e,t,r,n)},e.prototype.newSubRoomResourceReq=function(){return new y.SubRoomResourceReq},e.prototype.newSubRoomResourceReq=function(e,t,r){return new y.SubRoomResourceReq(e,t,r)},e.prototype.newSubRoomResourceRep=function(){return new y.SubRoomResourceRep},e.prototype.newSubRoomResourceRep=function(e,t,r,n){return new y.SubRoomResourceRep(e,t,r,n)},e.prototype.newOpenReq=function(){return new y.OpenReq},e.prototype.newOpenReq=function(e,t,r,n,o,i){return new y.OpenReq(e,t,r,n,o,i)},e.prototype.newInviteRoomReq=function(){return new y.InviteRoomReq},e.prototype.newInviteRoomReq=function(e,t,r,n){return new y.InviteRoomReq(e,t,r,n)},e.prototype.newInviteRoomReq1=function(){return new y.InviteRoomReq1},e.prototype.newInviteRoomReq1=function(e,t,r,n,o,i,s,a,c){var l=new y.InviteRoomReq1(e,t,r,n,o,i,s,a,c);return l.is_dtls=!0,l},e.prototype.newCandidateMsg1=function(){return new y.CandidateMsg1},e.prototype.newCandidateMsg1=function(e,t,r,n){return new y.CandidateMsg1(e,t,r,n)},e.prototype.newCloseMsg=function(){return new y.CloseMsg},e.prototype.newCloseMsg=function(e){return new y.CloseMsg(e)},e.prototype.newPoint=function(){return new y.Point},e.prototype.newPoint=function(e,t){return new y.Point(e,t)},e.prototype.newcolor=function(){return new y.color},e.prototype.newcolor=function(e,t,r,n){return new y.color(e,t,r,n)},e.prototype.newRect=function(){return new y.Rect},e.prototype.newRect=function(e,t,r,n){return new y.Rect(e,t,r,n)},e.prototype.newAnnotationObject=function(){return new y.AnnotationObject},e.prototype.newAnnotationObject=function(e,t,r,n,o,i,s,a,c,l){return new y.AnnotationObject(e,t,r,n,o,i,s,a,c,l)},e.prototype.newAnnotation2Point=function(){return new y.Annotation2Point},e.prototype.newAnnotation2Point=function(e,t,r){return new y.Annotation2Point(e,t,r)},e.prototype.newAnnotationMultiPoint=function(){return new y.AnnotationMultiPoint},e.prototype.newAnnotationMultiPoint=function(e,t){return new y.AnnotationMultiPoint(e,t)},e.prototype.newAnnotationList=function(){return new y.AnnotationList},e.prototype.newAnnotationList=function(e,t){return new y.AnnotationList(e,t)},e.prototype.newUpdateAnnotationMsg=function(e,t,r,n,o,i,s,a,c){return new y.UpdateAnnotationMsg(e,t,r,n,o,i,s,a,c)},e.prototype.newAnnotationMsg=function(){return new y.AnnotationMsg},e.prototype.newAnnotationMsg=function(e,t){return new y.AnnotationMsg(e,t)},e.prototype.newBoardObject=function(){return new y.BoardObject},e.prototype.newBoardObject=function(e,t,r,n,o,i,s,a,c,l,d){return new y.BoardObject(e,t,r,n,o,i,s,a,c,l,d)},e.prototype.newUpdateBoardMsg=function(){return new y.UpdateBoardMsg},e.prototype.newUpdateBoardMsg=function(e,t,r,n,o){return new y.UpdateBoardMsg(e,t,r,n,o)},e.prototype.newBoardsInfoMsg=function(){return new y.BoardsInfoMsg},e.prototype.newBoardsInfoMsg=function(e){return new y.BoardsInfoMsg(e)},e.prototype.newBindAudioToVideoReq=function(e,t,r){return new y.BindAudioToVideoReq(e,t,r)},e.prototype.serverVersionCompatible=function(e){var t=new ArrayBuffer(10),r=new Int8Array(t);r[0]=88,r[1]="3".charCodeAt(),r[2]="t".charCodeAt(),r[3]="e".charCodeAt(),r[4]="e".charCodeAt(),r[5]="a".charCodeAt(),r[6]="v".charCodeAt(),r[7]="d".charCodeAt(),r[8]=2,r[9]=1;for(var n=new Int8Array(e),o=10+n.length,i=new ArrayBuffer(o),s=new Int8Array(i),a=0;a<10;a++)s[a]=r[a];for(var c=0;c<n.length;c++){s[c+10]=n[c]}return i},e.prototype.encodedPacket=function(e,t,r,n,o){var i=y.Packet,s=null;null!=o&&(s=o.toArrayBuffer());var a=new i(e,t,r,n,s).toArrayBuffer();return e==this.getRoomPduTypeEnum().OPEN_REQ&&(a=this.serverVersionCompatible(a)),a},e.prototype.decodePacket=function(e){return y.Packet.decode(e)},e.prototype.decodeUserMsg=function(e){return y.UserMsg.decode(e)},e.prototype.decodeAnnotationMultiPoint=function(e){return y.AnnotationMultiPoint.decode(e)},e.prototype.decodeAnnotation2Point=function(e){return y.Annotation2Point.decode(e)},e.prototype.decodeAnnotationList=function(e){return y.AnnotationList.decode(e)},e.prototype.decodeOutgoingVideoInfo=function(e){return y.OutgoingVideoInfo.decode(e)},e.prototype.newOutgoingCreateStreamsExporterReq=function(){return new y.OutgoingCreateStreamsExporterReq},e.prototype.newOutgoingCreateStreamsExporterReq=function(e,t,r,n,o,i,s,a,c,l,d,u,p,f,h,m,g,v){return new y.OutgoingCreateStreamsExporterReq(e,t,r,n,o,i,s,a,c,l,d,u,p,f,h,m,g,v)},e.prototype.newOutgoingSelectStreamReq=function(){return new y.OutgoingSelectStreamReq},e.prototype.newOutgoingSelectStreamReq=function(e,t,r,n,o,i,s,a){return new y.OutgoingSelectStreamReq(e,t,r,n,o,i,s,a)},e.prototype.newOutgoingMixStreamsReq=function(){return new y.OutgoingMixStreamsReq},e.prototype.newOutgoingMixStreamsReq=function(e,t,r,n,o,i,s){return new y.OutgoingMixStreamsReq(e,t,r,n,o,i,s)},e.prototype.newOutgoingVideoInfo=function(){return new y.OutgoingVideoInfo},e.prototype.newOutgoingVideoInfo=function(e,t,r,n,o,i,s,a){return new y.OutgoingVideoInfo(e,t,r,n,o,i,s,a)},e.prototype.newOutgoingDestroyExporterReq=function(){return new y.OutgoingDestroyExporterReq},e.prototype.newOutgoingDestroyExporterReq=function(e,t,r,n){return new y.OutgoingDestroyExporterReq(e,t,r,n)},e.prototype.newOutgoingPauseResumeExporterReq=function(){return new y.OutgoingPauseResumeExporterReq},e.prototype.newOutgoingPauseResumeExporterReq=function(e,t,r,n,o){return new y.OutgoingPauseResumeExporterReq(e,t,r,n,o)},e.prototype.newRoomControl=function(e,t){return new y.RoomControl(e,t)},e.prototype.newRoomAvcControl=function(e,t){return new y.RoomAvcControl(e,t)},e.prototype.newRoomSetStreamNameReq=function(e,t,r,n,o){return new y.RoomSetStreamNameReq(e,t,r,n,o)},e.prototype.newOutgoingExporterSetFocusVideoReq=function(e,t,r,n,o){return new y.OutgoingExporterSetFocusVideoReq(e,t,r,n,o)},e.prototype.newOutgoingGetExporterInfoReq=function(e,t,r,n){return new y.OutgoingGetExporterInfoReq(e,t,r,n)},e.prototype.decodeBody=function(e){var t=y.RoomPduType,r=y.Packet.decode(e),n=r.type;if(n==t.OPEN_REP)return y.OpenRep.decode(r.body);if(n==t.INVITE_ROOM_REP1)return y.InviteRoomRep1.decode(r.body);if(n==t.ROOM_RESOURCE_INFOS)return y.RoomResourceInfos.decode(r.body);if(n==t.CANDIDATE_MSG1)return y.CandidateMsg1.decode(r.body);if(n==t.ICE_RESTART_MSG)return y.IceRestartMsg.decode(r.body);if(n==t.PUB_RESOURCE_REP)return y.PubResourceRep.decode(r.body);if(n==t.PRIVATE_TEXT_MSG)return y.TextMsg.decode(r.body);if(n==t.PUBLIC_TEXT_MSG)return y.TextMsg.decode(r.body);if(n==t.PRIVATE_DATA)return e=y.DATA.decode(r.body);if(n==t.PUBLIC_DATA)return e=y.DATA.decode(r.body);if(n==t.ROOM_DATA_INFO)return y.RoomDataInfo.decode(r.body);if(n==t.UPDATE_USER_DATA_MSG)return y.UpdateUserDataMsg.decode(r.body);if(n!=t.USER_INFO_MSG)return n==t.USER_MSG?y.UserMsg.decode(r.body):n==t.USER_INDICTION?y.UserIndiction.decode(r.body):n==t.UPDATA_USER_ROLE_PRIVILEDGE_MSG?y.UpdateUserRolePriviledgeMsg.decode(r.body):n==t.ADD_WEBCAM_MSG?y.AddWebcamMsg.decode(r.body):n==t.ADD_SPEAKER_MSG?y.AddSpeakerMsg.decode(r.body):n==t.ADD_DESKTOP_MSG?y.AddDesktopMsg.decode(r.body):n==t.REMOVE_WEBCAM_MSG?y.RemoveWebcamMsg.decode(r.body):n==t.REMOVE_SPEAKER_MSG?y.RemoveSpeakerMsg.decode(r.body):n==t.UPDATE_SPEAKER_MSG?y.UpdateSpeakerMsg.decode(r.body):n==t.UPDATE_WEBCAM_MSG?y.UpdateWebcamMsg.decode(r.body):n==t.UPDATE_DESKTOP_MSG?y.UpdateDesktopMsg.decode(r.body):n==t.PUB_ROOM_RESOURCE_MSG?y.PubRoomResourceMsg.decode(r.body):n==t.PUB_ROOM_RESOURCE_MSG_REP?y.PubRoomResourceMsgRep.decode(r.body):n==t.UNPUB_ROOM_RESOURCE_MSG?y.UnpubRoomResourceMsg.decode(r.body):n==t.PUB_VIDEO_REQ||n==t.PUB_AUDIO_REQ?y.PubResourceReq.decode(r.body):n==t.PUB_VIDEO_REP||n==t.PUB_AUDIO_REP?y.PubResourceRep.decode(r.body):n==t.VIDEO_INDICTION?y.ResourceIndiction.decode(r.body):n==t.AUDIO_INDICTION?y.ResourceIndiction.decode(r.body):n==t.OFFER_REQ?y.OfferReq.decode(r.body):n==t.OFFER_REP?y.OfferRep.decode(r.body):n==t.CANDIDATE_MSG?y.CandidateMsg.decode(r.body):n==t.SUB_ROOM_RESOURCE_REQ?y.SubRoomResourceReq.decode(r.body):n==t.SUB_ROOM_RESOURCE_REP?y.SubRoomResourceRep.decode(r.body):n==t.SUB_ROOM_RESOURCE_MSG?y.SubRoomResourceMsg.decode(r.body):n==t.UNSUB_ROOM_RESOURCE_MSG?y.UnsubRoomResourceMsg.decode(r.body):n==t.CLOSE_ROOM_REP?y.CloseRoomRep.decode(r.body):n==t.CLOSE_ROOM_MSG?y.CloseRoomMsg.decode(r.body):n==t.UPDATE_USER_NAME?y.UpdateUserName.decode(r.body):n==t.START_VIDEO_DATA_MSG?y.StartVideoDataMsg.decode(r.body):n==t.STOP_VIDEO_DATA_MSG?y.StopVideoDataMsg.decode(r.body):n==t.MODIFY_RESOURCE_REQ?y.ModifyResourceReq.decode(r.body):n==t.MODIFY_RESOURCE_REP?y.ModifyResourceRep.decode(r.body):n==t.UPDATE_BOARD_MSG?y.UpdateBoardMsg.decode(r.body):n==t.BOARDS_INFO_PDU?y.BoardsInfoMsg.decode(r.body):n==t.UPDATE_ANNOTATION_MSG?y.UpdateAnnotationMsg.decode(r.body):n==t.BIND_AUDIO_TO_VIDEO_REP?y.BindAudioToVideoRep.decode(r.body):n==t.OUTGOING_CREATE_STREAMS_EXPORTER_REP?y.OutgoingCreateStreamsExporterRep.decode(r.body):n==t.OUTGOING_SELECT_STREAM_REP?y.OutgoingSelectStreamRep.decode(r.body):n==t.OUTGOING_MIX_STREAMS_REP?y.OutgoingMixStreamsRep.decode(r.body):n==t.OUTGOING_DESTROY_EXPORTER_REP?y.OutgoingDestroyExporterRep.decode(r.body):n==t.OUTGOING_PAUSE_RESUME_EXPORTER_REP?y.OutgoingPauseResumeExporterRep.decode(r.body):n==t.OUTGOING_EXPORTER_ERROR_NOTIFY?y.OutgoingExporterErrorNotify.decode(r.body):n==t.OUTGOING_INVITE_STATUS_NOTIFY?y.OutgoingInviteStatusNotify.decode(r.body):n==t.ROOM_ATTRIBUTE_CHANGE_NOTIFY?y.RoomAttributeChangeNotify.decode(r.body):n==t.ROOM_START_AVC_MIXER_MEDIA_REP?y.RoomAvcControlRep.decode(r.body):n==t.ROOM_SET_STREAM_NAME_RSP?y.RoomSetStreamNameRsp.decode(r.body):n==t.ROOM_STREAM_NAME_CHANGED_NOTIFY?y.RoomStreamNameChangedNotify.decode(r.body):n==t.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP?y.OutgoingExporterSetFocusVideoRsp.decode(r.body):n==t.OUTGOING_GET_EXPORTER_INFO_RSP?y.OutgoingGetExporterInfoRsp.decode(r.body):void 0;var o=y.UserInfoMsg;return null==r.body?null:o.decode(r.body)},e});var RTCBrowserType={RTC_BROWSER_CHROME:"rtc_browser.chrome",RTC_BROWSER_FIREFOX:"rtc_browser.firefox"},keyMap={};keyMap[RTCBrowserType.RTC_BROWSER_FIREFOX]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsLost:"packetsLost",packetsSent:"packetsSent",bytesReceived:"bytesReceived",bytesSent:"bytesSent"},keyMap[RTCBrowserType.RTC_BROWSER_CHROME]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsSent:"packetsSent",packetsLost:"packetsLost",bytesReceived:"bytesReceived",bytesSent:"bytesSent",receiveBandwidth:"googAvailableReceiveBandwidth",sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"googRemoteAddress",transportType:"googTransportType",localAddress:"googLocalAddress",activeConnection:"googActiveConnection",googFrameHeightReceived:"googFrameHeightReceived",googFrameWidthReceived:"googFrameWidthReceived",googFrameHeightSent:"googFrameHeightSent",googFrameWidthSent:"googFrameWidthSent",googFrameRateSent:"googFrameRateSent",googFrameRateReceived:"googFrameRateReceived",audioInputLevel:"audioInputLevel",audioOutputLevel:"audioOutputLevel"};var connectionQualityValues={98:"18px",81:"15px",64:"11px",47:"7px",30:"3px",0:"0px"},connectionIndicator={room:{localaddress:"",localport:0,remoteaddress:"",remoteport:0,transport:"",uploadBitrate:0,downloadBitrate:0,uploadPacketLoss:0,downloaPacketLoss:0,uploadPacket:0,downloadPacket:0,packetLost:0,uploadBandwidth:0,downloadBandwidth:0},getRoomConnection:function(){return connectionIndicator.room},getVideoConnection:function(e,t){return deviceId2videoConnection[t]},getAudioConnection:function(e){return userId2audioConnection[e]},getScreenConnection:function(e){return userId2screenConnection[e]}},userId2audioConnection={},deviceId2videoConnection={},userId2screenConnection={};function getBrowserType(){return RTCBrowserType.RTC_BROWSER_CHROME}function PeerStats(){this.ssrc2bitrate={},this.ssrc2resolution={},this.ssrc2frameRate={},this.ssrc2Loss={},this.ssrc2AudioLevel={}}function formatAudioLevel(e){return Math.min(Math.max(e,0),1)}function calculatePacketLoss(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}function getStatValue(e,t){if(!keyMap[getBrowserType()][t])throw"The property isn't supported!";var r=keyMap[getBrowserType()][t];return getBrowserType()==RTCBrowserType.RTC_BROWSER_CHROME?e.stat(r):e[r]}function getIP(e){return e.substring(0,e.lastIndexOf(":"))}function getPort(e){return e.substring(e.lastIndexOf(":")+1,e.length)}function getStringFromArray(e){for(var t="",r=0;r<e.length;r++)t+=(0===r?"":", ")+e[r];return t}function ConnectionInfoCollector(e,t){this.peerconnection=e,this.statsInterval=t,this.currentStatsReport=null,this.baselineStatsReport=null,this.statsIntervalId=null,this.jid=1,this.jid2stats={},this.resolution,this.currentStatsReportSafari=null,this.baseRoomStatsSafari={time:0,bytesSent:0,bytesReceived:0},this.baseSsrc2audioSafari={}}function ConnectionStatistics(e){this.peerconnection=e,this.getPeerStatusTimer=null,this.trace_id=connectionStatisticsConfig.trace_id?connectionStatisticsConfig.trace_id:"",this.samplingRate=connectionStatisticsConfig.sampling_rate?connectionStatisticsConfig.sampling_rate:3,this.logHttpServerAddr=connectionStatisticsConfig.http_server_addr,this.logHttpsServerAddr=connectionStatisticsConfig.https_server_addr,this.sendRate=1,this.app_id=connectionStatisticsConfig.app_id?connectionStatisticsConfig.app_id:"jh",this.user_agent=navigator.userAgent,this.client_type=1,this.ssrc2number={},this.report_mode=connectionStatisticsConfig.report_mode?connectionStatisticsConfig.report_mode:0,this.myDB={name:"3teeDB",version:1,db:null},this.url="";var t=document.location.protocol;"http:"==t?this.url=this.logHttpServerAddr:"https:"==t&&(this.url=this.logHttpsServerAddr),this.sendVideoMap={bytesSent:"bytesSent",codecImplementationName:"codecImplementationName",framesEncoded:"framesEncoded",mediaType:"mediaType",packetsLost:"packetsLost",packetsSent:"packetsSent",qpSum:"qpSum",ssrc:"ssrc",transportId:"transportId",googAdaptationChanges:"googAdaptationChanges",googAvgEncodeMs:"googAvgEncodeMs",googBandwidthLimitedResolution:"googBandwidthLimitedResolution",googCodecName:"googCodecName",googContentType:"googContentType",googCpuLimitedResolution:"googCpuLimitedResolution",googEncodeUsagePercent:"googEncodeUsagePercent",googFirsReceived:"googFirsReceived",googFrameHeightSent:"googFrameHeightSent",googFrameRateInput:"googFrameRateInput",googFrameRateSent:"googFrameRateSent",googFrameWidthSent:"googFrameWidthSent",googHasEnteredLowResolution:"googHasEnteredLowResolution",hugeFramesSent:"hugeFramesSent",googNacksReceived:"googNacksReceived",googPlisReceived:"googPlisReceived",googRtt:"googRtt",googTrackId:"googTrackId"},this.recvVideoMap={bytesReceived:"bytesReceived",codecImplementationName:"codecImplementationName",framesDecoded:"framesDecoded",mediaType:"mediaType",packetsLost:"packetsLost",packetsReceived:"packetsReceived",qpSum:"qpSum",ssrc:"ssrc",transportId:"transportId",googCaptureStartNtpTimeMs:"googCaptureStartNtpTimeMs",googCodecName:"googCodecName",googContentType:"googContentType",googCurrentDelayMs:"googCurrentDelayMs",googDecodeMs:"googDecodeMs",googFirsSent:"googFirsSent",googFrameHeightReceived:"googFrameHeightReceived",googFrameRateDecoded:"googFrameRateDecoded",googFrameRateOutput:"googFrameRateOutput",googFrameRateReceived:"googFrameRateReceived",googFrameWidthReceived:"googFrameWidthReceived",googInterframeDelayMax:"googInterframeDelayMax",googJitterBufferMs:"googJitterBufferMs",googMaxDecodeMs:"googMaxDecodeMs",googMinPlayoutDelayMs:"googMinPlayoutDelayMs",googNacksSent:"googNacksSent",googPlisSent:"googPlisSent",googRenderDelayMs:"googRenderDelayMs",googTargetDelayMs:"googTargetDelayMs",googTrackId:"googTrackId"},this.sendAudioMap={audioInputLevel:"audioInputLevel",bytesSent:"bytesSent",mediaType:"mediaType",packetsSent:"packetsSent",ssrc:"ssrc",totalAudioEnergy:"totalAudioEnergy",totalSamplesDuration:"totalSamplesDuration",transportId:"transportId",googCodecName:"googCodecName",googTrackId:"googTrackId",googTypingNoiseState:"googTypingNoiseState"},this.recvAudioMap={audioOutputLevel:"audioOutputLevel",bytesReceived:"bytesReceived",mediaType:"mediaType",packetsLost:"packetsLost",packetsReceived:"packetsReceived",ssrc:"ssrc",totalAudioEnergy:"totalAudioEnergy",totalSamplesDuration:"totalSamplesDuration",transportId:"transportId",googAccelerateRate:"googAccelerateRate",googCodecName:"googCodecName",googCurrentDelayMs:"googCurrentDelayMs",googDecodingCNG:"googDecodingCNG",googDecodingCTN:"googDecodingCTN",googDecodingCTSG:"googDecodingCTSG",googDecodingMuted:"googDecodingMuted",googDecodingNormal:"googDecodingNormal",googDecodingPLC:"googDecodingPLC",googDecodingPLCCNG:"googDecodingPLCCNG",googExpandRate:"googExpandRate",googJitterBufferMs:"googJitterBufferMs",googJitterReceived:"googJitterReceived",googPreemptiveExpandRate:"googPreemptiveExpandRate",googPreferredJitterBufferMs:"googPreferredJitterBufferMs",googSecondaryDecodedRate:"googSecondaryDecodedRate",googSecondaryDiscardedRate:"googSecondaryDiscardedRate",googSpeechExpandRate:"googSpeechExpandRate",googTrackId:"googTrackId"},this.candidateMap={googActiveConnection:"googActiveConnection",bytesReceived:"bytesReceived",bytesSent:"bytesSent",packetsSent:"packetSent",googReadable:"googReadable",requestsSent:"requestSent",consentRequestsSent:"consentRequestsSent",responsesSent:"responsesSent",requestsReceived:"requestsReceived",responsesReceived:"responsesReceived",googLocalAddress:"googLocalAddress",localCandidateId:"localCandidateId",googLocalCandidateType:"googLocalCandidateType",googRemoteAddress:"googRemoteAddress",remoteCandidateId:"remoteCandidateId",googRemoteCandidateType:"googRemoteCandidateType",googRtt:"googRtt",packetsDiscardedOnSend:"packetsDiscardedOnSend",googTransportType:"googTransportType",googWritable:"googWritable"}}function AudioLevel(e,t){this.audioLevelPermutation=[0,1,2,3,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,9,9,9,9,9,9,9,9],this.peerconnection=e,this.audioLevelsIntervalMilis=t,this.audioLevelsIntervalId=null,this.baselineAudioLevelsReport=null,this.currentAudioLevelsReport=null}PeerStats.bandwidth={},PeerStats.bitrate={},PeerStats.packetLoss=null,PeerStats.transport=[],PeerStats.prototype.setSsrcLoss=function(e,t){this.ssrc2Loss[e]=t},PeerStats.prototype.setSsrcResolution=function(e,t){null===t&&this.ssrc2resolution[e]?delete this.ssrc2resolution[e]:null!==t&&0!=t.width&&(this.ssrc2resolution[e]=t)},PeerStats.prototype.setSsrcFrameRate=function(e,t){null===t&&this.ssrc2frameRate[e]?delete this.ssrc2frameRate[e]:null!==t&&0!=t&&(this.ssrc2frameRate[e]=t)},PeerStats.prototype.setSsrcBitrate=function(e,t){this.ssrc2bitrate[e]?(this.ssrc2bitrate[e].download+=t.download,this.ssrc2bitrate[e].upload+=t.upload):this.ssrc2bitrate[e]=t},PeerStats.prototype.setSsrcAudioLevel=function(e,t){this.ssrc2AudioLevel[e]=formatAudioLevel(t)},ConnectionInfoCollector.prototype.start=function(e){var r=this;e&&(this.statsInterval=e),this.statsIntervalId=setInterval(function(){"chrome"==adapter.browserDetails.browser&&r.peerconnection.getStats(function(e){var t=null;e&&e.result&&"function"==typeof e.result&&(t=e.result()),r.currentStatsReport=t;try{r.processStatsReport()}catch(e){log.error("Unsupported key:"+e,e)}r.baselineStatsReport=r.currentStatsReport},r.errorCallback),"safari"==adapter.browserDetails.browser&&r.peerconnection.getStats(null).then(function(e){r.currentStatsReportSafari=e;try{r.processStatsReportSafari()}catch(e){log.error("Unsupported key:"+e,e)}})},this.statsInterval)},ConnectionInfoCollector.prototype.processStatsReportSafari=function(){var n,o,i,s=this,a={},c={ssrc:"",bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0,packetsLost:0};this.currentStatsReportSafari.forEach(function(e){if("candidate-pair"==e.type&&(n=e.timestamp,o=e.bytesSent,i=e.bytesReceived),"outbound-rtp"==e.type&&("audio"==e.mediaType?(c.ssrc=e.ssrc,c.bytesSent=e.bytesSent,c.packetsSent=e.packetsSent):e.mediaType),s.peerconnection.getLocalStreams()&&0<s.peerconnection.getLocalStreams().length&&s.peerconnection.getLocalStreams()[0].getVideoTracks()&&0<s.peerconnection.getLocalStreams()[0].getVideoTracks().length){var t=s.peerconnection.getLocalStreams()[0].getVideoTracks()[0];if(MediaStreamTrack&&MediaStreamTrack.prototype.getSettings&&t)t.getSettings()}if("track"==e.type)(r=e.id.split("_"))[2],r[4];if("inbound-rtp"==e.type){var r;(r=e.id.split("_"))[1];0<r[0].indexOf("Audio")&&(c.ssrc=e.ssrc,c.bytesReceived=l,c.packetsReceived=e.packetsReceived,c.packetsLost=e.packetsLost)}a[c.ssrc]=c});var e={upload:0,download:0},t=0;if(0!=s.baseRoomStatsSafari.time){t=Math.round((n-s.baseRoomStatsSafari.time)/1e3);var r=o-s.baseRoomStatsSafari.bytesSent,l=i-s.baseRoomStatsSafari.bytesReceived;r=r<=0||t<=0?0:Math.round(8*r/t/1e3),l=l<=0||t<=0?0:Math.round(8*l/t/1e3),e.upload=r,e.download=l}s.baseRoomStatsSafari.time=n,s.baseRoomStatsSafari.bytesSent=o,s.baseRoomStatsSafari.bytesReceived=i;var d=null;r=0,l=0;if(0<c.bytesSent){if(s.baseSsrc2audioSafari[c.ssrc]){if(d=s.baseSsrc2audioSafari[c.ssrc],r=c.bytesSent-d.bytesSent,l=c.bytesReceived-d.bytesReceived,r<=0||t<=0)return r=0,void delete s.baseSsrc2audioSafari[c.ssrc];r=Math.round(8*r/t/1e3),l=l<=0||t<=0?0:Math.round(8*l/t/1e3),d.bytesSent=c.bytesSent,d.bytesReceived=c.bytesReceived}else d={ssrc:c.ssrc,bytesSent:c.bytesSent,bytesReceived:c.bytesReceived,packetsSent:0,packetsReceived:0,packetsLost:0};s.baseSsrc2audioSafari[c.ssrc]=d;var u=room.audioSsrc2user[c.ssrc];if(u){var p={};p.ssrc=d.ssrc,p.uploadBitrate=r?r+" Kbps":"--Kbps",p.downloadBitrate=l?l+" Kbps":"--Kbps",userId2audioConnection[u.id]=p}}var f=e.download?e.download+" Kbps":"--Kbps",h=e.upload?e.upload+" Kbps":"--Kbps";connectionIndicator.room.uploadBitrate=h,connectionIndicator.room.downloadBitrate=f,null!=room?room.eventEmitter.emit(RoomCallback.connection_indicator,connectionIndicator):this.stop()},ConnectionInfoCollector.prototype.processStatsReport=function(){if(this.baselineStatsReport){for(var e in PeerStats.transport=[],this.currentStatsReport){var t=this.currentStatsReport[e];if("googCandidatePair"!=t.type){if("candidatepair"==t.type){if("succeeded"==t.state)continue;var r=this.currentStatsReport[t.localCandidateId],n=this.currentStatsReport[t.remoteCandidateId];PeerStats.transport.push({localip:r.ipAddress+":"+r.portNumber,ip:n.ipAddress+":"+n.portNumber,type:r.transport})}var o=this.baselineStatsReport[e];if(o){var i=getStatValue(t,"ssrc");if(i&&(this.jid||!(Date.now()-t.timestamp<3e3))){var s=this.jid2stats[this.jid];s||(s=new PeerStats,this.jid2stats[this.jid]=s);var a=!0,b="packetsReceived";if(getStatValue(t,b)||(a=!1,getStatValue(t,b="packetsSent"))){var c=getStatValue(t,b);(!c||c<0)&&(c=0);var l=getStatValue(o,b);(!l||l<0)&&(l=0);var d=c-l;(!d||d<0)&&(d=0);var u=getStatValue(t,"packetsLost");(!u||u<0)&&(u=0);var p=getStatValue(o,"packetsLost");(!p||p<0)&&(p=0);var f=u-p;(!f||f<0)&&(f=0);var h=d+f;s.setSsrcLoss(i,{packetsTotal:h,packetsLost:f,isDownloadStream:a});var m=0,g=0;getStatValue(t,"bytesReceived")&&(m=getStatValue(t,"bytesReceived")-getStatValue(o,"bytesReceived")),getStatValue(t,"bytesSent")&&(g=getStatValue(t,"bytesSent")-getStatValue(o,"bytesSent"));var v=Math.round((t.timestamp-o.timestamp)/1e3);m=m<=0||v<=0?0:Math.round(8*m/v/1e3),g=g<=0||v<=0?0:Math.round(8*g/v/1e3),s.setSsrcBitrate(i,{download:m,upload:g});var y={height:0,width:0},_={height:0,width:0};try{getStatValue(t,"googFrameHeightSent")&&getStatValue(t,"googFrameWidthSent")&&(y.height=getStatValue(t,"googFrameHeightSent"),y.width=getStatValue(t,"googFrameWidthSent"),y.height&&y.width&&s.setSsrcResolution(i,y)),getStatValue(t,"googFrameHeightReceived")&&getStatValue(t,"googFrameWidthReceived")&&(_.height=getStatValue(t,"googFrameHeightReceived"),_.width=getStatValue(t,"googFrameWidthReceived"),_.height&&_.width&&s.setSsrcResolution(i,_))}catch(e){}var S=0,w=0;try{getStatValue(t,"googFrameRateSent")&&(S=getStatValue(t,"googFrameRateSent"))&&s.setSsrcFrameRate(i,S),getStatValue(t,"googFrameRateReceived")&&(w=getStatValue(t,"googFrameRateReceived"))&&s.setSsrcFrameRate(i,w)}catch(e){}}}}}else{var E,C,T,I;try{E=getStatValue(t,"remoteAddress"),C=getStatValue(t,"transportType"),T=getStatValue(t,"localAddress"),I=getStatValue(t,"activeConnection")}catch(e){}if(!E||!C||!T||"true"!=I)continue;for(var R=!1,P=0;P<PeerStats.transport.length;P++)PeerStats.transport[P].ip==E&&PeerStats.transport[P].type==C&&PeerStats.transport[P].localip==T&&(R=!0);if(R)continue;PeerStats.transport.push({localip:T,ip:E,type:C})}}var x=this,M={download:0,upload:0},k={download:0,upload:0},A=0,O=0;Object.keys(this.jid2stats).forEach(function(y){Object.keys(x.jid2stats[y].ssrc2Loss).forEach(function(e){var t="upload";x.jid2stats[y].ssrc2Loss[e].isDownloadStream&&(t="download"),M[t]+=x.jid2stats[y].ssrc2Loss[e].packetsTotal,k[t]+=x.jid2stats[y].ssrc2Loss[e].packetsLost}),Object.keys(x.jid2stats[y].ssrc2bitrate).forEach(function(e){var t=x.jid2stats[y].ssrc2bitrate[e].upload,r=x.jid2stats[y].ssrc2bitrate[e].download,n=t?t+" Kbps":"--Kbps",o=r?r+" Kbps":"--Kbps",i=room.videoSsrc2user[e],s=room.videoSsrc2deviceId[e];if(i&&s){var a=deviceId2videoConnection[s];if(a)a.ssrc=e,a.uploadBitrate=n,a.downloadBitrate=o;else{var c={};c.ssrc=e,c.uploadBitrate=n,c.downloadBitrate=o,deviceId2videoConnection[s]=c}}else for(b in deviceId2videoConnection)try{var l=deviceId2videoConnection[b];if(l.ssrc==e){l.uploadBitrate=n,l.downloadBitrate=o;break}}catch(e){}var d=room.screenSsrc2user[e];if(d){var u=userId2screenConnection[d.id];if(u)u.ssrc=e,u.uploadBitrate=n,u.downloadBitrate=o;else{var p={};p.ssrc=e,p.uploadBitrate=n,p.downloadBitrate=o,p[d.id]=p}}else for(b in userId2screenConnection)try{var f=userId2screenConnection[b];if(f.ssrc==e){f.uploadBitrate=n,f.downloadBitrate=o;break}}catch(e){}var h=room.audioSsrc2user[e];if(h){var m=userId2audioConnection[h.id];if(m)m.ssrc=e,m.uploadBitrate=n,m.downloadBitrate=o;else{var g={};g.ssrc=e,g.uploadBitrate=n,g.downloadBitrate=o,userId2audioConnection[h.id]=g}}else for(b in userId2audioConnection)try{var v=userId2audioConnection[b];if(v.ssrc==e){v.uploadBitrate=n,v.downloadBitrate=o;break}}catch(e){}A+=r,O+=t,delete x.jid2stats[y].ssrc2bitrate[e]}),Object.keys(x.jid2stats[y].ssrc2resolution).forEach(function(e){var t=room.videoSsrc2user[e],r=room.videoSsrc2deviceId[e];if(t&&r){var n=x.jid2stats[y].ssrc2resolution[e].width,o=x.jid2stats[y].ssrc2resolution[e].height,i=deviceId2videoConnection[r];if(i)i.ssrc=e,i.resolution=n+"x"+o,i.resolutionWidth=n,i.resolutionHeight=o;else{var s={};s.ssrc=e,s.resolution=n+"x"+o,s.resolutionWidth=n,s.resolutionHeight=o,deviceId2videoConnection[r]=s}}else for(b in deviceId2videoConnection)try{var a=deviceId2videoConnection[b];if(a.ssrc==e){a.resolution="--x--",a.resolutionWidth=0,a.resolutionHeight=0;break}}catch(e){}var c=room.screenSsrc2user[e];if(c){n=x.jid2stats[y].ssrc2resolution[e].width,o=x.jid2stats[y].ssrc2resolution[e].height;var l=userId2screenConnection[c.id];if(l)l.ssrc=e,l.resolution=n+"x"+o,l.resolutionWidth=n,l.resolutionHeight=o;else{var d={};d.ssrc=e,d.resolution=n+"x"+o,d.resolutionWidth=n,d.resolutionHeight=o,userId2screenConnection[c.id]=d}}else for(b in userId2screenConnection)try{var u=userId2screenConnection[b];if(u.ssrc==e){u.resolution="--x--",u.resolutionWidth=0,u.resolutionHeight=0;break}}catch(e){}}),Object.keys(x.jid2stats[y].ssrc2frameRate).forEach(function(e){var t=room.videoSsrc2user[e],r=room.videoSsrc2deviceId[e];if(t&&r){var n=x.jid2stats[y].ssrc2frameRate[e],o=deviceId2videoConnection[r];if(o)o.ssrc=e,o.frameRate=n+"fps";else{var i={};i.ssrc=e,i.frameRate=n+"fps",deviceId2videoConnection[r]=i}}else for(b in deviceId2videoConnection)try{var s=deviceId2videoConnection[b];if(s.ssrc==e){s.frameRate="--fps";break}}catch(e){}var a=room.screenSsrc2user[e];if(a){n=x.jid2stats[y].ssrc2frameRate[e];var c=userId2screenConnection[a.id];if(c)c.ssrc=e,c.frameRate=n+"fps";else{var l={};l.ssrc=e,l.frameRate=n+"fps",userId2screenConnection[a.id]=l}}else for(b in userId2screenConnection)try{var d=userId2screenConnection[b];if(d.ssrc==e){d.frameRate="--fps";break}}catch(e){}})}),PeerStats.bitrate={upload:O,download:A},PeerStats.packetLoss={total:calculatePacketLoss(k.download+k.upload,M.download+M.upload),download:calculatePacketLoss(k.download,M.download),upload:calculatePacketLoss(k.upload,M.upload)},this.generateText()}},ConnectionInfoCollector.prototype.generateText=function(){var e,t,r,n,o,s,a,c,l;if(a=null===PeerStats.bitrate?s="--Kbps":(s=PeerStats.bitrate.download?PeerStats.bitrate.download+" Kbps":"--Kbps",PeerStats.bitrate.upload?PeerStats.bitrate.upload+" Kbps":"--Kbps"),l=null===PeerStats.packetLoss?c="--":(c=(null!==PeerStats.packetLoss.download?PeerStats.packetLoss.download:"--")+"%",(null!==PeerStats.packetLoss.upload?PeerStats.packetLoss.upload:"--")+"%"),PeerStats.transport&&0!==PeerStats.transport.length){var d={remoteIP:[],localIP:[],remotePort:[],localPort:[]};for(i=0;i<PeerStats.transport.length;i++){var u=getIP(PeerStats.transport[i].ip),p=getPort(PeerStats.transport[i].ip),f=getIP(PeerStats.transport[i].localip),h=getPort(PeerStats.transport[i].localip);-1==d.remoteIP.indexOf(u)&&d.remoteIP.push(u),-1==d.remotePort.indexOf(p)&&d.remotePort.push(p),-1==d.localIP.indexOf(f)&&d.localIP.push(f),-1==d.localPort.indexOf(h)&&d.localPort.push(h)}r=getStringFromArray(d.localIP),n=getStringFromArray(d.localPort),e=getStringFromArray(d.remoteIP),t=getStringFromArray(d.remotePort)}else;PeerStats.transport[0]&&(o=PeerStats.transport[0].type),connectionIndicator.room.localaddress=r,connectionIndicator.room.localport=n,connectionIndicator.room.remoteaddress=e,connectionIndicator.room.remoteport=t,connectionIndicator.room.transport=o,connectionIndicator.room.uploadBitrate=a,connectionIndicator.room.downloadBitrate=s,connectionIndicator.room.uploadPacketLoss=l,connectionIndicator.room.downloaPacketLoss=c,null!=room?room.eventEmitter.emit(RoomCallback.connection_indicator,connectionIndicator):this.stop()},ConnectionInfoCollector.prototype.errorCallback=function(e){log.error("StatsCollector.errorCallback().Get stats error",e),this.stop()},ConnectionInfoCollector.prototype.stop=function(){this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},ConnectionStatistics.prototype.start2Log=function(n){var e=this;n=n||5;var o=0,i=0;clearInterval(e.getPeerStatusTimer),e.getPeerStatusTimer=setInterval(function(){e.getPeerStatus().then(function(e){e.forEach(function(e){switch(e.event_type){case connectionEventTypeEnum.sendVideo:log.info("stream sendVideo device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.googFrameWidthSent+"x"+e.googFrameHeightSent+" "+e.googFrameRateInput+" ] ");break;case connectionEventTypeEnum.recvVideo:log.info("stream recvVideo device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.googFrameWidthReceived+"x"+e.googFrameHeightReceived+" "+e.googFrameRateOutput+" ] ");break;case connectionEventTypeEnum.sendAudio:log.info("stream sendAudio device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.audioInputLevel+" ] ");break;case connectionEventTypeEnum.recvAudio:log.info("stream recvAudio device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.audioOutputLevel+" ] ");break;case connectionEventTypeEnum.conndidate:var t=parseInt((e.bytesSent-o)/n),r=parseInt((e.bytesReceived-i)/n);log.info("room ["+e.googTransportType+" "+e.googLocalAddress+" -> "+e.googRemoteAddress+" ] [ "+t+","+r+" ] "),o=parseInt(e.bytesSent),i=parseInt(e.bytesReceived)}})})},1e3*n)},ConnectionStatistics.prototype.start=function(){var t=this;if(console.log(t.url),t.url){var r=1,n=[];t.openDB(),clearInterval(t.getPeerStatusTimer),t.getPeerStatusTimer=setInterval(function(){t.getPeerStatus().then(function(e){n=n.concat(e),r==t.sendRate&&(t.sendData(n),n=[],r=0),r++})},1e3*t.samplingRate)}},ConnectionStatistics.prototype.stop=function(){clearInterval(this.getPeerStatusTimer)},ConnectionStatistics.prototype.sendData=function(e){var t={data:{trace_id:this.trace_id,app_id:this.app_id,user_id:room.selfUser.id,user_name:room.selfUser.name,room_id:room.id,user_agent:this.user_agent,client_type:this.client_type,data_infos:e}};0==parseInt(this.report_mode)?this.fetchPost(this.url,t).then(function(e){}).catch(function(e){}):this.addData(t)},ConnectionStatistics.prototype.getPeerStatus=function(){var t=when.defer(),n=this,o=[];return n.peerconnection.getStats(function(e){e.result().forEach(function(e){var t={};if(t.timestamp=Date.parse(e.timestamp),"ssrc"==e.type){if(n.ssrc2number[e.stat("ssrc")]?n.ssrc2number[e.stat("ssrc")]++:n.ssrc2number[e.stat("ssrc")]=1,t.seq_num=n.ssrc2number[e.stat("ssrc")],room.videoSsrc2user[e.stat("ssrc")]&&room.videoSsrc2user[e.stat("ssrc")].id==room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.sendVideo,t.device_id=room.videoSsrc2deviceId[e.stat("ssrc")],n.sendVideoMap)t[r]=e.stat(r);o.push(t)}else if(room.videoSsrc2user[e.stat("ssrc")]&&room.videoSsrc2user[e.stat("ssrc")].id!=room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.recvVideo,t.device_id=room.videoSsrc2deviceId[e.stat("ssrc")],n.recvVideoMap)t[r]=e.stat(r);o.push(t)}else if(room.audioSsrc2user[e.stat("ssrc")]&&room.audioSsrc2user[e.stat("ssrc")].id==room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.sendAudio,t.device_id=room.audioSsrc2user[e.stat("ssrc")].audio.id,n.sendAudioMap)t[r]=e.stat(r);o.push(t)}else if(room.audioSsrc2user[e.stat("ssrc")]&&room.audioSsrc2user[e.stat("ssrc")].id!=room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.recvAudio,t.device_id=room.audioSsrc2user[e.stat("ssrc")].audio.id,n.recvAudioMap)t[r]=e.stat(r);o.push(t)}}else if("googCandidatePair"==e.type&&"true"==e.stat("googActiveConnection")){for(var r in t.event_type=connectionEventTypeEnum.conndidate,n.candidateMap)t[r]=e.stat(r);o.push(t)}}),t.resolve(o)}),t.promise},ConnectionStatistics.prototype.fetchPost=function(e,t){return new Promise(function(r,n){axios.post(e,t,{headers:{"Content-Type":"application/json"}}).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};n(t)}}).catch(function(e){if(e.response){var t=new Error(e.response.status,e.response.data);n(t)}else{t=new Error(1e4,e.message);n(t)}n(e)})})},ConnectionStatistics.prototype.openDB=function(){var t=this,r=r||1,e=window.indexedDB.open(t.myDB.name,t.myDB.version);e.onerror=function(e){console.log(e.currentTarget.error.message)},e.onsuccess=function(e){t.myDB.db=e.target.result,console.log("本地数据库打开成功")},e.onupgradeneeded=function(e){var t=e.target.result;if(!t.objectStoreNames.contains("body_content"))t.createObjectStore("body_content",{autoIncrement:!0});console.log("DB version changed to "+r)}},ConnectionStatistics.prototype.addData=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").add(e)},ConnectionStatistics.prototype.deleteDataByKey=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").delete(e)},ConnectionStatistics.prototype.fetchStoreByCursor=function(){var r=this;r.myDB.db.transaction("body_content").objectStore("body_content").openCursor().onsuccess=function(e){var t=e.target.result;console.log(t),t&&(r.deleteDataByKey(t.key),t.continue(),r.fetchPost(r.url,t.value).then(function(e){}).catch(function(e){}))}},ConnectionStatistics.prototype.sendDBData=function(){this.fetchStoreByCursor()},AudioLevel.prototype.start=function(e){var r=when.defer(),n=this;return e&&(n.audioLevelsIntervalMilis=e),clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=setInterval(function(){if("chrome"==adapter.browserDetails.browser&&n.peerconnection.getStats(function(e){var t=null;e&&e.result&&"function"==typeof e.result&&(t=e.result()),n.currentAudioLevelsReport=t,n.processAudioLevelReport(),n.baselineAudioLevelsReport=n.currentAudioLevelsReport,r.resolve()},function(e){log.error("StatsCollector.errorCallback().Get stats error",e),r.reject(e)}),"safari"==adapter.browserDetails.browser){var e=!1;if(n.peerconnection.getLocalStreams()&&0<n.peerconnection.getLocalStreams().length&&n.peerconnection.getLocalStreams()[0].getAudioTracks()&&0<n.peerconnection.getLocalStreams()[0].getAudioTracks().length)for(var t=0;t<n.peerconnection.getLocalStreams()[0].getAudioTracks().length;t++)"live"==n.peerconnection.getLocalStreams()[0].getAudioTracks()[t].readyState&&(e=!0);e?new LocalStatsCollector(n.peerconnection.getLocalStreams()[0],300,function(e){room.selfUser.audio.setAudioLevel(n.audioLevelFullRange(8e4*e))}).start():room.selfUser.audio.setAudioLevel(0),n.peerconnection.getStats(null).then(function(e){e.forEach(function(e){if("track"==e.type){var t=e.id.split("_");if("audio"==t[2]){var r=room.audioSsrc2user[t[4]];r&&r.audio&&r.audio.setAudioLevel(n.audioLevelFullRange(8e4*e.audioLevel))}}})}),r.resolve()}},n.audioLevelsIntervalMilis),r.promise},AudioLevel.prototype.stop=function(){var e=when.defer();return this.audioLevelsIntervalId?(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null,e.resolve()):e.reject(),e.promise},AudioLevel.prototype.processAudioLevelReport=function(){if(this.baselineAudioLevelsReport)for(var e in this.currentAudioLevelsReport){var t=this.currentAudioLevelsReport[e];if("ssrc"==t.type)if("audio"==(t.mediaType?t.mediaType:t.stat("mediaType"))){var r=this.baselineAudioLevelsReport[e],n=getStatValue(t,"ssrc");if(r)if(n){var o=!getStatValue(t,"packetsReceived");try{var i=getStatValue(r,"audioInputLevel"),s=getStatValue(r,"audioOutputLevel"),a=getStatValue(t,"audioInputLevel"),c=getStatValue(t,"audioOutputLevel")}catch(e){return loger.error("Audio Levels are not available in the statistics."),void clearInterval(this.audioLevelsIntervalId)}if(a&&0<a&&i!=a?o&&room&&room.selfUser&&room.selfUser.audio&&room.selfUser.audio.setAudioLevel(this.audioLevelFullRange(a)):o&&room&&room.selfUser&&room.selfUser.audio&&room.selfUser.audio.setAudioLevel(0),room)if(c&&0<c&&s!=c){var l=room.audioSsrc2user[n];!o&&l&&l.audio&&l.audio.setAudioLevel(this.audioLevelFullRange(c))}else{l=room.audioSsrc2user[n];!o&&l&&l.audio&&l.audio.setAudioLevel(0)}}else Date.now()-t.timestamp<3e3&&log.error("No ssrc: ");else log.debug(n+" not enough data")}}},AudioLevel.prototype.audioLevelFullRange=function(e){var t=parseInt(e/1e3);0==t&&250<e&&(t=1);var r=this.audioLevelPermutation[t];return r||(r=0),r};var WEBAUDIO_ANALYZER_FFT_SIZE=2048,WEBAUDIO_ANALYZER_SMOOTING_TIME=.8;window.AudioContext=window.AudioContext||window.webkitAudioContext;var context=null;function timeDomainDataToAudioLevel(e){for(var t=0,r=e.length,n=0;n<r;n++)t<e[n]&&(t=e[n]);return parseFloat(((t-127)/128).toFixed(3))}function animateLevel(e,t){var r=0,n=t-e;return r=.2<n?t-.2:n<-.4?t+.4:e,parseFloat(r.toFixed(3))}function LocalStatsCollector(e,t,r){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=r}function LoggerReport(){this.httpServerAddr="",this.httpsServerAddr="",this.reportMode=0,this.traceId="",this.appId="jh",this.reportLogLevel=1,this.userAgent=navigator.userAgent,this.clientType=1,this.reportUrl="",this.openLogger=!1,this.myDB={name:"3teeDB_logger",version:1,db:null},this.myDBOnsuccess=!1,this.sendDataCache=[],LoggerReport.prototype.start=function(){console.log("======logger report open===="),this.httpServerAddr=loggerReportConfig.http_server_addr,this.httpsServerAddr=loggerReportConfig.https_server_addr,this.reportMode=loggerReportConfig.report_mode?loggerReportConfig.report_mode:0,this.traceId=loggerReportConfig.trace_id?loggerReportConfig.trace_id:"",this.appId=loggerReportConfig.app_id?loggerReportConfig.app_id:"jh",this.reportLogLevel=loggerReportConfig.log_level?loggerReportConfig.log_level:1,this.reportUrl=this.httpServerAddr,"https:"==protocolStr&&(this.reportUrl=this.httpsServerAddr),this.openDB(),this.openLogger=!0},LoggerReport.prototype.stop=function(){console.log("======logger report close===="),this.openLogger=!1},LoggerReport.prototype.debug=function(e){this.baseLevel(e,1)},LoggerReport.prototype.info=function(e){this.baseLevel(e,2)},LoggerReport.prototype.error=function(e){this.baseLevel(e,3)},LoggerReport.prototype.baseLevel=function(e,t){if(this.openLogger&&t>=this.reportLogLevel){var r=[],n={},o=new Date;if(n.timestamp=o.getTime(),n.log_content=e,n.log_level=t,r.push(n),room&&room.selfUser&&room.selfUser.id&&this.myDBOnsuccess){for(;0<this.sendDataCache.length;){var i=this.sendDataCache.pop();this.sendData(i)}this.sendData(r)}else this.sendDataCache.unshift(r)}},LoggerReport.prototype.sendData=function(e){var t="";room&&room.selfUser&&room.selfUser.id&&(t=room.selfUser.id);var r="";room&&room.selfUser&&room.selfUser.name&&(r=room.selfUser.name);var n="";room&&room.id&&(n=room.id);var o={data:{app_id:this.appId,user_id:t,user_name:r,room_id:n,user_agent:this.userAgent,client_type:this.clientType,trace_id:this.traceId,log_infos:e}};0==parseInt(this.reportMode)?this.fetchPost(this.reportUrl,o).then(function(e){}).catch(function(e){}):this.addData(o)},LoggerReport.prototype.fetchPost=function(e,t){return new Promise(function(r,n){axios.post(e,t,{headers:{"Content-Type":"application/json"}}).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};n(t)}}).catch(function(e){if(e.response){var t=new Error(e.response.status,e.response.data);n(t)}else{t=new Error(1e4,e.message);n(t)}n(e)})})},LoggerReport.prototype.openDB=function(){console.log("======openDB======");var t=this,r=r||1,e=window.indexedDB.open(t.myDB.name,t.myDB.version);e.onerror=function(e){console.log(e.currentTarget.error.message)},e.onsuccess=function(e){t.myDB.db=e.target.result,console.log("本地数据库打开成功"),t.myDBOnsuccess=!0},e.onupgradeneeded=function(e){var t=e.target.result;if(!t.objectStoreNames.contains("body_content"))t.createObjectStore("body_content",{autoIncrement:!0});console.log("DB version changed to "+r)}},LoggerReport.prototype.addData=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").add(e)},LoggerReport.prototype.deleteDataByKey=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").delete(e)},LoggerReport.prototype.fetchStoreByCursor=function(){var r=this;r.myDB.db.transaction("body_content").objectStore("body_content").openCursor().onsuccess=function(e){var t=e.target.result;t&&(r.deleteDataByKey(t.key),t.continue(),r.fetchPost(r.reportUrl,t.value).then(function(e){}).catch(function(e){}))}},LoggerReport.prototype.sendDBData=function(){this.fetchStoreByCursor()}}LocalStatsCollector.prototype.start=function(){if(window.AudioContext&&!context&&(context=new AudioContext).suspend(),context){context.resume();var r=context.createAnalyser();r.smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,r.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE,context.createMediaStreamSource(this.stream).connect(r);var n=this;this.intervalId=setInterval(function(){var e=new Uint8Array(r.frequencyBinCount);r.getByteTimeDomainData(e);var t=timeDomainDataToAudioLevel(e);t!=n.audioLevel&&(n.audioLevel=animateLevel(t,n.audioLevel),n.callback(n.audioLevel))},this.intervalMilis)}},LocalStatsCollector.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},function(){var s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(e,t){var r,n,o=s,i=[];if(t=t||o.length,e)for(r=0;r<e;r++)i[r]=o[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=o[19==r?3&n|8:n]);return i.join("")},Math.uuidFast=function(){for(var e,t=s,r=new Array(36),n=0,o=0;o<36;o++)8==o||13==o||18==o||23==o?r[o]="-":14==o?r[o]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,r[o]=t[19==o?3&e|8:e]);return r.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}(),ModuleBase.define("BrowserInfo",[],function(e){return(e=function(){}).prototype.getBrowserInfo=function(){navigator.appVersion;var e,t,r=navigator.userAgent,n=navigator.appName,o=""+parseFloat(navigator.appVersion),i="",s="";-1!=(f=r.indexOf("OPR/"))?(n="Opera",o=r.substring(f+4)):-1!==(f=r.indexOf("Opera"))?(n="Opera",o=r.substring(f+6),-1!==(f=r.indexOf("Version"))&&(o=r.substring(f+8))):-1!==(f=r.indexOf("MSIE"))?(n="IE",o=r.substring(f+5)):-1!==(f=r.indexOf("Chrome"))?(n="Chrome",o=r.substring(f+7)):-1!==(f=r.indexOf("Safari"))?(n="Safari",o=r.substring(f+7),-1!==(f=r.indexOf("Version"))&&(o=r.substring(f+8))):-1!==(f=r.indexOf("Firefox"))?(n="Firefox",o=r.substring(f+8)):(e=r.lastIndexOf(" ")+1)<(f=r.lastIndexOf("/"))&&(n=r.substring(e,f),o=r.substring(f+1),n.toLowerCase()===n.toUpperCase()&&(n=navigator.appName));var a=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob);/rv:([^\)]+)\) like Gecko/.test(navigator.userAgent)&&(n="IE",o=RegExp.$1);var c=/QQBrowser/.test(navigator.userAgent),l=/MetaSr/.test(navigator.userAgent),d=/BIDUBrowser/.test(navigator.userAgent),u=function(e,t){var r=window.external||{};for(var n in r)if(e.test(t?r[n]:n))return!0;return!1}(/^liebao/i,0),p=/3Tee/.test(navigator.userAgent);if(a){n="Edge";var f=r.indexOf("Edge");s=r.substring(f+5)}if(c){i="QQ";f=r.indexOf("QQBrowser");s=r.substring(f+10)}if(l){i="Sougou";f=r.indexOf("MetaSr");s=r.substring(f+7)}if(d){i="Baidu";f=r.indexOf("BIDUBrowser");s=r.substring(f+12)}if(u&&(i="Liebao",s=""),p){i="3Tee";f=r.indexOf("3Tee");s=r.substring(f+5)}return-1!==(t=o.indexOf(";"))&&(o=o.substring(0,t)),-1!==(t=o.indexOf(" "))&&(o=o.substring(0,t)),{name:n,fullVersion:o,shellName:i,shellFullVersion:s,is3Tee:p}},e}),ModuleBase.define("OSInfo",[],function(e){return(e=function(){}).prototype.getOSInfo=function(){var e="Unknown OS",t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()},getOsName:function(){var e="Unknown OS";return t.Android()&&(e="Android"),t.BlackBerry()&&(e="BlackBerry"),t.iOS()&&(e="iOS"),t.Opera()&&(e="Opera Mini"),t.Windows()&&(e="Windows"),e}};return t.any()?e=t.getOsName():(-1!==navigator.appVersion.indexOf("Win")&&(e="Windows"),-1!==navigator.appVersion.indexOf("Mac")&&(e="OSX"),-1!==navigator.appVersion.indexOf("X11")&&(e="UNIX"),-1!==navigator.appVersion.indexOf("Linux")&&(e="Linux")),e},e}),ModuleBase.define("CheckGetUserMedia",[],function(e){return(e=function(){}).prototype.getUserMediaSupport=function(){var e=!1;return void 0!==navigator.webkitGetUserMedia||void 0!==navigator.mozGetUserMedia?e=!0:navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(e=!0),e},e}),ModuleBase.define("CheckRTCPeerConnection",[],function(e){return(e=function(){}).prototype.RTCPeerConnectionSupport=function(){var e=!1;try{e=["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].some(function(e){return e in window})}catch(e){}return e},e}),ModuleBase.define("CheckDataChannelSupport",[],function(e){return(e=function(){}).prototype.dataChannelSupport=function(){var t=!1;try{var e=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(e){var r=new e({iceServers:[{url:"stun:0"}]});t="createDataChannel"in r,r.close()}}catch(e){t=!1}return t},e}),ModuleBase.define("BrowserDetect",["BrowserInfo","OSInfo","CheckGetUserMedia","CheckRTCPeerConnection","CheckDataChannelSupport"],function(s,a,c,l,e){var t=function(){this.detect={};var e="https:"===location.protocol,t=new s;this.detect.browser=t.getBrowserInfo(),this.detect.browser["is"+this.detect.browser.name]=!0;var r=this.detect.browser.fullVersion.split(".")[0],n=new a;this.detect.osName=n.getOSInfo();var o=new c;this.detect.getUserMediaSupport=o.getUserMediaSupport();var i=new l;this.detect.RTCPeerConnectionSupport=i.RTCPeerConnectionSupport(),this.detect.WebSocketSupport="WebSocket"in window&&2===window.WebSocket.CLOSING,this.detect.screenSharingSupport=!1,this.detect.browser.isChrome&&42<=r&&(this.detect.screenSharingSupport=!0),e||(this.detect.screenSharingSupport=!1),this.detect.h264Support=!1,this.detect.browser.isChrome&&52<=r&&(this.detect.h264Support=!0),this.detect.browser.isFirefox&&52<=r&&(this.detect.h264Support=!0),this.detect.ORTCSupport="undefined"!=typeof RTCIceGatherer};return t.prototype.checkBrowserSupport=function(){var e=!1,t=this.detect.browser.isChrome,r=this.detect.browser.isOpera,n=(this.detect.browser.isIE,this.detect.browser.isFirefox,this.detect.browser.isSafari,this.detect.browser.fullVersion.split(".")[0]),o=1==t&&42<=Number(n)||1==r&&30<=Number(n);return"Android"==this.detect.osName&&(o=1==t&&37<=Number(n)),1==o&&1==this.detect.getUserMediaSupport&&1==this.detect.RTCPeerConnectionSupport&&1==this.detect.WebSocketSupport&&(e=!0),e},t.prototype.checkBrowserPluginSupport=function(){var e=!1,t=(this.detect.browser.isChrome,this.detect.browser.isOpera,this.detect.browser.isIE),r=(this.detect.browser.isFirefox,this.detect.browser.isSafari,this.detect.browser.fullVersion.split(".")[0]);return 1==t&&10<=Number(r)&&(e=!0),e},t.prototype.checkChromeSupportH264=function(){var e=!1,t=this.detect.browser.isChrome,r=(this.detect.browser.name,this.detect.browser.fullVersion.split(".")[0]);return 1==(1==t&&52<=Number(r))&&(e=!0),e},t}),ModuleBase.define("Base",[],function(){var e=function(e,t){this.id=e,this.name=t,this.status=StreamStatus.init,this.element=null,this.resourceInfo=null,this.ownerId=null,this.track=null,this.RTCRtpSender=null};return e.prototype.getNewStreamByTrack=function(){var e=null;return"chrome"==adapter.browserDetails.browser?e=new webkitMediaStream:"safari"==adapter.browserDetails.browser&&(e=new MediaStream),e.addTrack(this.track),e},e}),ModuleBase.define("Video",["Base","Error"],function(r,o){var e=function(e,t){r.call(this,e,t),this.level,this.description,this.resolutionSelect,this.resolution={width:room.avdEngine.defaultVideoParamsWidth,height:room.avdEngine.defaultVideoParamsHeight},this.setType=room.avdEngine.defaultVideoParamsResolutionSetType,this.frameRate=room.avdEngine.defaultVideoParamsFrameRate,this.aspectRatio=0,this.cameraType,this.minBandwidth=room.avdEngine.defaultVideoParamsMinBandwidth,this.maxBandwidth=room.avdEngine.defaultVideoParamsMaxBandwidth,this.streamName,this.streamNickName};(e.prototype=new r).setLevel=function(e){this.level=e},e.prototype.setDescription=function(e){this.description=e},e.prototype.setStreamName=function(e){this.streamName=e},e.prototype.setStreamNickName=function(e){this.streamNickName=e},e.prototype.setResolution=function(e,t){this.resolutionSelect=e,this.resolution=Resolution[e],t&&(this.setType=t)},e.prototype.setResolutionWH=function(e,t,r){this.resolutionSelect=e;var n={order:1};n.width=e,n.height=t,this.resolution=n,r&&(this.setType=r)},e.prototype.setFrameRate=function(e){"string"==typeof e&&(e=Number(e)),this.frameRate=e},e.prototype.setAspectRatio=function(e){"string"==typeof e&&(e=Number(e)),this.aspectRatio=e},e.prototype.applyConstraints=function(){if(this.track){var e=getApplyConstraints(this);this.track.applyConstraints(e)}},e.prototype.setBandwidth=function(e,t){var r=null==e||e<=0,n=null==t||t<=0;if(r&&n){var o=room.calInitVideoBitrate(this.resolution.width,this.resolution.height);this.minBandwidth=parseInt(o),this.maxBandwidth=parseInt(2*o)}else!r&&n?(this.minBandwidth=e,this.maxBandwidth=e+10):r&&!n?(this.minBandwidth=t-10,this.maxBandwidth=t):e==t?(this.minBandwidth=e,this.maxBandwidth=t+10):t<e?(this.minBandwidth=t-10,this.maxBandwidth=t):(this.minBandwidth=e,this.maxBandwidth=t+10);console.debug("video.setBandwidth(),this.minBandwidth:"+this.minBandwidth+",this.maxBandwidth:"+this.maxBandwidth),room.currMinBandwidth=this.minBandwidth,room.currMaxBandwidth=this.maxBandwidth,this.status==StreamStatus.none||this.status==StreamStatus.init||room.selfUser.screen.track||room.traceablePeerConnection.updateBandwidthSdp(this.minBandwidth,this.maxBandwidth)},e.prototype.preview=function(t){var e,r=when.defer(),n=this;if(null!=(e=doFsCheck(FTConstant.video,o)))return r.reject(e),r.promise;if(640<parseInt(n.resolutionSelect)&&null!=(e=doFsCheck(FTConstant.video_hd,o)))return r.reject(e),r.promise;return null!=n.track?(n.status!=StreamStatus.published&&(n.status=StreamStatus.opened),(n.element=t).srcObject=n.getNewStreamByTrack(),r.resolve()):obtainUserMedia(null,this,function(e){n.track=e.videoStream.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.videoStream:room.selfUser.stream.addTrack(n.track),n.status=StreamStatus.opened,(n.element=t).srcObject=n.getNewStreamByTrack(),r.resolve()},function(e){r.reject(e)}),r.promise},e.prototype.unpreview=function(){null!=this.element&&(this.element.srcObject=null,this.element=null),this.status=StreamStatus.init},e.prototype.publish=function(){var t=when.defer(),r=this;return this.publishHandle().then(function(){loggerReport.info("发布视频流成功,设备Id:"+r.id+"，设备名称："+r.name),t.resolve()}).otherwise(function(e){log.error(e),loggerReport.error("发布视频流异常,设备Id:"+r.id+",Error:"+e),t.reject(e)}),t.promise},e.prototype.previewAndPublish=function(e){var t,r=when.defer(),n=this;if(loggerReport.debug("previewAndPublish()触发..."),null!=(t=doFsCheck(FTConstant.video,o)))return log.error(t),r.reject(t),r.promise;if(640<parseInt(this.resolutionSelect)&&null!=(t=doFsCheck(FTConstant.video_hd,o)))return log.error(t),r.reject(t),r.promise;return this.publishHandle(e).then(function(){loggerReport.info("预览摄像头及发布流成功,设备Id:"+n.id+"，设备名称："+n.name),r.resolve()}).otherwise(function(e){log.error(e),loggerReport.error("预览摄像头及发布视频流异常,设备Id:"+n.id+",Error:"+e),r.reject(e)}),r.promise},e.prototype.publishHandle=function(n){log.debug("publishHandle()...");var o=when.defer(),i=getRandomNum(1,3e3),s=this;if(s.status==StreamStatus.init)if(null!=s.track){var e=room.composePDUDeviceId(room.selfUser.id,s.id),t=s.getNewStreamByTrack();room.masterServer.videoPublishHandle(e,t,i),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(null!=n&&(s.status=StreamStatus.opened,(s.element=n).srcObject=t),s.status=StreamStatus.published,room.hasObject(room.pubVideos,s)||room.pubVideos.push(s),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,s.status,s.id,s.name,room.selfUser.id),o.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&o.reject(e)})}else obtainUserMedia(null,this,function(e){s.track=e.videoStream.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.videoStream:room.selfUser.stream.addTrack(s.track),s.status=StreamStatus.opened;var t=s.getNewStreamByTrack(),r=room.composePDUDeviceId(room.selfUser.id,s.id);room.masterServer.videoPublishHandle(r,t,i),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(null!=n&&(s.status=StreamStatus.opened,(s.element=n).srcObject=t),s.status=StreamStatus.published,room.hasObject(room.pubVideos,s)||room.pubVideos.push(s),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,s.status,s.id,s.name,room.selfUser.id),o.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&o.reject(e)})},function(e){o.reject(e)});else if(s.status==StreamStatus.opened)if(null!=s.track){e=room.composePDUDeviceId(room.selfUser.id,s.id);room.masterServer.videoPublishHandle(e,s.getNewStreamByTrack(),i),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(s.status=StreamStatus.published,room.hasObject(room.pubVideos,s)||room.pubVideos.push(s),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,s.status,s.id,s.name,room.selfUser.id),o.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&o.reject(e)})}else obtainUserMedia(null,this,function(e){s.track=e.videoStream.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.videoStream:room.selfUser.stream.addTrack(s.track),s.status=StreamStatus.published;var t=room.composePDUDeviceId(room.selfUser.id,s.id);room.masterServer.videoPublishHandle(t,s.getNewStreamByTrack(),i),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(room.hasObject(room.pubVideos,s)||room.pubVideos.push(s),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,s.status,s.id,s.name,room.selfUser.id),o.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&o.reject(e)})},function(e){o.reject(e)});else if(s.status==StreamStatus.published&&0<room.reconnectionCount){log.debug("TTTTTTTTT00000000000000");e=room.composePDUDeviceId(room.selfUser.id,s.id);room.masterServer.videoPublishHandle(e,s.getNewStreamByTrack(),i),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,s.status,s.id,s.name,room.selfUser.id),o.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&o.reject(e)})}return o.promise},e.prototype.unpublish=function(){var t=this;if(this.status==StreamStatus.published||this.status==StreamStatus.init&&(null!=this.track||null!=this.track)){arrayUtil.objectSplice(room.pubVideos,this.id),this.status=StreamStatus.init,room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,room.selfUser.id);var e=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.videoUnpublishHandle(e,this.getNewStreamByTrack()),loggerReport.info("取消发布视频流，设备Id:"+t.id);var r=room.selfUser.stream;if(r&&r.getTracks().forEach(function(e){e.id==t.track.id&&e.stop()}),null!=t.element)t.element.srcObject.getTracks().forEach(function(e){e.stop()}),t.element.srcObject=null,t.element=null;t.track.stop(),t.track=null,room.currBandwidth=null}};return e.prototype.subscrible=function(e){for(var t in room.selfUser.subVideoIds)if(room.selfUser.subVideoIds[t]==this.id)return;room.selfUser.subVideoIds.push(this.id),e?room.masterServer.videoSubscribleHandle(this.resourceInfo,e):room.masterServer.videoSubscribleHandle(this.resourceInfo,VideoQualityType.high),loggerReport.info("订阅视频流，设备Id:"+this.id)},e.prototype.unsubscrible=function(){arrayUtil.baseSplice(room.selfUser.subVideoIds,this.id),room.masterServer.videoUnsubscribleHandle(this.resourceInfo),loggerReport.info("取消订阅视频流，设备Id:"+this.id)},e.prototype.changeSubscribedVideoQuality=function(e){room.masterServer.changeSubscribedVideoQuality(this.resourceInfo,this.quality2Level(e))},e.prototype.changePublishVideoQuality=function(e){if(room.selfUser.screen.track)log.info("=====video.changePublishVideoQuality():桌面共享打开，带宽最小3M, 最大4M,后面的大小频逻辑不执行=====，");else{var t=this;room.selfUser.changePublishVideoQuality=e,log.debug("=========changePublishVideoQuality(),level:"+e),room.selfUser.changePublishVideoQualityInterval&&(clearInterval(room.selfUser.changePublishVideoQualityInterval),room.selfUser.changePublishVideoQualityInterval=null,log.debug("=========changePublishVideoQuality(),clearInterval...")),room.selfUser.changePublishVideoQualityInterval=setInterval(function(){room&&room.selfUser.changePublishVideoQuality&&"stable"==room.selfUser.toMCUPC.signalingState&&(log.debug("=========changePublishVideoQuality(),changePublishVideoQualityHandle..."),t.changePublishVideoQualityHandle(room.selfUser.changePublishVideoQuality),room.selfUser.changePublishVideoQuality=null,clearInterval(room.selfUser.changePublishVideoQualityInterval),room.selfUser.changePublishVideoQualityInterval=null)},1e3)}},e.prototype.changePublishVideoQualityHandle=function(e){var t=this.level2Quality(e);if(log.debug("=====changePublishVideoQuality()===,userName:"+room.selfUser.name+",level:"+e),log.debug("=====changePublishVideoQuality(),resolution.width:"+this.resolution.width+",resolution.height:"+this.resolution.height),MediaStreamTrack&&MediaStreamTrack.prototype.getSettings&&this.track){var r=this.track.getSettings();if(console.log("=====changePublishVideoQuality(),track Setting:"+JSON.stringify(r)),log.debug("=====changePublishVideoQuality(),real resolution.width:"+r.width+",real resolution.height:"+r.height),this.resolution.width!=r.width||this.resolution.height!=r.height){var n=room.calInitVideoBitrate(r.width,r.height);log.debug("=====changePublishVideoQuality(),calInitVideoBitrate:"+n),this.minBandwidth=parseInt(n),this.maxBandwidth=parseInt(2*n)}}if(this.maxBandwidth){var o=this.minBandwidth,i=this.maxBandwidth;t==VideoQualityType.high?(o=this.minBandwidth,i=this.maxBandwidth):t==VideoQualityType.normal?(o=parseInt(this.minBandwidth/4),i=parseInt(this.maxBandwidth/4)):t==VideoQualityType.low&&(o=parseInt(this.minBandwidth/8),i=parseInt(this.maxBandwidth/8)),this.track&&(log.debug("=====带宽源端大小调整。video.changePublishVideoQuality(),minBandwidth:"+o+",maxBandwidth:"+i),o==i&&(i+=10),room.currMinBandwidth=o,room.currMaxBandwidth=i,room.traceablePeerConnection.updateBandwidthSdp(o,i))}},e.prototype.quality2Level=function(e){var t=3;return e==VideoQualityType.high?t=4:e==VideoQualityType.normal?t=3:e==VideoQualityType.low&&(t=2),t},e.prototype.level2Quality=function(e){VideoQualityType.normal;return 4<=e?VideoQualityType.high:3==e?VideoQualityType.normal:VideoQualityType.low},e.prototype.updateCameraData=function(e,t){var r=room.composePDUDeviceId(room.selfUser.id,this.id);this.level=e,this.description=t,room.masterServer.updateWebcamMsg(room.selfUser.nodeId,r,this)},e.prototype.updateExporterStreamName=function(e,t){var r=when.defer();return this.streamName=e,this.streamNickName=t,room.masterServer.updateExporterStreamName(this).then(function(){r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},e}),ModuleBase.define("Audio",["Base","Error"],function(r,a){var e=function(e,t){r.call(this,e,t),this.audioLevel=0};return(e.prototype=new r).openMicrophone=function(n){var o=when.defer(),i=this,e=doFsCheck(FTConstant.audio,a);if(null!=e)return o.reject(e),o.promise;var s=getRandomNum(30001,6e3);if(null!=i.track){var t=room.composePDUDeviceId(room.selfUser.id,i.id),r=i.getNewStreamByTrack();room.masterServer.audioPublishHandle(t,r,s),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==s&&(i.state=StreamStatus.opened,void 0!==n&&null!=n&&""!=n&&((i.element=n).srcObject=r),i.status=StreamStatus.published,room.hasObject(room.pubAudios,i)||room.pubAudios.push(i),room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,i.status,i.id,i.name,room.selfUser.id),loggerReport.info("打开音频及发布流成功，设备Id:"+i.id),o.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==s&&(loggerReport.error("打开音频及发布流失败，设备Id:"+i.id+"，Error:"+e),o.reject(e))})}else obtainUserMedia(this,null,function(e){i.track=e.audioStream.getAudioTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.audioStream:room.selfUser.stream.addTrack(i.track),i.state=StreamStatus.opened;var t=room.composePDUDeviceId(room.selfUser.id,i.id),r=i.getNewStreamByTrack();room.masterServer.audioPublishHandle(t,r,s),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==s&&(void 0!==n&&null!=n&&""!=n&&((i.element=n).srcObject=r),i.status=StreamStatus.published,room.hasObject(room.pubAudios,i)||room.pubAudios.push(i),room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,i.status,i.id,i.name,room.selfUser.id),o.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==s&&o.reject(e)})},function(e){o.reject(e)});return o.promise},e.prototype.closeMicrophone=function(){var t=this;if(t.status==StreamStatus.published||t.status==StreamStatus.muted){null!=t.element&&(t.element.srcObject=null,t.element=null),arrayUtil.objectSplice(room.pubAudios,this.id),t.status=StreamStatus.init,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,t.status,t.id,t.name,room.selfUser.id);var e=room.composePDUDeviceId(room.selfUser.id,t.id),r=t.getNewStreamByTrack();if(room.masterServer.audioUnpublishHandle(e,r),this.setAudioLevel(0),room.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&e.stop()}),null!=t.element)t.element.srcObject.getTracks().forEach(function(e){e.stop()}),t.element.srcObject=null,t.element=null;t.track.stop(),t.track=null,room.avdEngine.safariInitAudioStream=null,loggerReport.info("关闭音频及取消发布流操作，设备Id:"+t.id)}},e.prototype.subscrible=function(){for(var e in room.selfUser.subAudioTrack2ResourceInfo[this.resourceInfo.stream.stream_name]=this.resourceInfo,room.selfUser.subAudioIds)if(room.selfUser.subAudioIds[e]==this.id)return;room.selfUser.subVideoIds.push(this.id),room.masterServer.audioSubscribleHandle(this.resourceInfo),loggerReport.info("订阅音频流操作，设备Id:"+this.id)},e.prototype.unsubscrible=function(){arrayUtil.baseSplice(room.selfUser.subAudioIds,this.id),room.masterServer.audioUnsubscribleHandle(this.resourceInfo),loggerReport.info("取消订阅音频流操作，设备Id:"+this.id)},e.prototype.muteMicrophone=function(){var t=this;if(this.status==StreamStatus.published){if(this.status=StreamStatus.muted,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id),room.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),null!=t.element)t.element.srcObject.getTracks().forEach(function(e){e.enabled=!1});t.track&&(t.track.enabled=!1);var e=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.updateSpeakerMsg(room.selfUser.nodeId,e,this),loggerReport.info("禁音")}},e.prototype.unmuteMicrophone=function(){var t=this;if(this.status==StreamStatus.muted){if(this.status=StreamStatus.published,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id),room.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),null!=t.element)t.element.srcObject.getTracks().forEach(function(e){e.enabled=!0});t.track&&(t.track.enabled=!0);var e=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.updateSpeakerMsg(room.selfUser.nodeId,e,this),loggerReport.info("取消禁音")}},e.prototype.ismuteMicrophone=function(){var e=!1;return this.status==StreamStatus.muted&&(e=!0),e},e.prototype.setAudioLevel=function(e){this.audioLevel=e},e.prototype.getAudioLevel=function(){return this.audioLevel},e}),ModuleBase.define("Screen",["Base","Error"],function(r,t){var e=function(e,t){r.call(this,e,t),this.level,this.description,this.resolution={width:room.avdEngine.defaultScreenParamsMaxWidth,height:room.avdEngine.defaultScreenParamsMaxHeight},this.frameRate={min:room.avdEngine.defaultScreenParamsMinFrameRate,max:room.avdEngine.defaultScreenParamsMaxFrameRate},this.extensionFlag,this.ipc=null};return(e.prototype=new r).setLevel=function(e){this.level=e},e.prototype.setDescription=function(e){this.description=e},e.prototype.setResolution=function(e,t){var r={};r.width=e,r.height=t,this.resolution=r},e.prototype.setFrameRate=function(e,t){var r={};r.min=e,r.max=t,this.frameRate=r},e.prototype.preview=function(e){e&&(this.element=e,this.element.srcObject=this.getNewStreamByTrack())},e.prototype.publish=function(){var n=when.defer(),t=this;if(null!=(o=doFsCheck(FTConstant.screen,e)))return n.reject(o),n.promise;if(this.status==StreamStatus.published)n.resolve();else if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(e){e&&(e.addEventListener("inactive",function(e){log.debug("screen.publish(),track.onended====="),t.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,t.status,t.id,t.name,room.selfUser.id),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}),t.publishHandleInner(t,e,"",n)),n.resolve()}).catch(function(e){console.log("Unable to acquire screen capture",e.name);var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_overconstrainedError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_notAllowedError):new r(ErrorConstant.navigatorDisplayMediaError_unknown),n.reject(t)});else if(extensionInstalled){if("https:"!=document.location.protocol){log.debug("Screen sharing is not https"),loggerReport.error("发布桌面共享失败,原因是非https访问");var e=ModuleBase.use(ModulesEnum.error),r=new e(ErrorConstant.navigatorDisplayMediaError_notSupportedError);n.reject(r)}else window.postMessage({type:"SS_UI_REQUEST"+room.avdEngine.screenExtensionFlag,text:"start"},"*"),loggerReport.info("发布桌面共享"),n.resolve()}else{log.debug("Screen sharing plugin is not accessible "),loggerReport.error("发布桌面共享失败,原因是屏幕共享插件无法访问");var o=new e(ErrorConstant.screen_sharing_plugin_not_accessible);n.reject(o)}return n.promise},e.prototype.electronPublish=function(e,t,r){var n=when.defer();return(this.ipc=e)&&this.registerElectronIPCInner(),room.avdEngine.electronManager.getDesktopSources(t,r).then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)}),n.promise},e.prototype.electronPrimaryDisplayPublish=function(){var t=when.defer(),e=room.avdEngine.electronManager.getPrimaryDisplay();log.debug("======================electronPrimaryDisplayPublish(),primaryDisplay:",e);var r="screen:"+e.id;return"win32"==require("os").platform()&&(r="screen:0:0"),log.debug("================electronPrimaryDisplayPublish(),primaryDisplaySourceId:",r),this.publishHandle(r).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.registerElectronIPCInner=function(){this.ipc.on("selectSourceId",function(e,t){room.selfUser.getScreen().publishHandle(t).otherwise(function(e){})})},e.prototype.cancelChooseDesktopMedia=function(){window.postMessage({type:"SS_UI_CANCEL"+room.avdEngine.screenExtensionFlag,text:"close"},"*")},e.prototype.unpublish=function(){if(this.status==StreamStatus.published){this.status=StreamStatus.init;var e=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.screenUnpublishHandle(e,this.getNewStreamByTrack()),arrayUtil.objectSplice(room.pubScreens,this.id),this.track.stop(),this.track=null,room.isMcu()||(this.stream=null),loggerReport.info("取消发布桌面共享")}},e.prototype.subscrible=function(){for(var e in room.selfUser.subScreenIds)if(room.selfUser.subScreenIds[e]==this.id)return;room.selfUser.subScreenIds.push(this.id),room.masterServer.screenSubscribleHandle(this.resourceInfo),loggerReport.info("订阅桌面共享流")},e.prototype.unsubscrible=function(){arrayUtil.baseSplice(room.selfUser.subScreenIds,this.id),room.masterServer.screenUnsubscribleHandle(this.resourceInfo),loggerReport.info("取消订阅桌面共享流")},e.prototype.updateScreenData=function(e,t){var r=room.composePDUDeviceId(room.selfUser.id,this.id);this.level=e,this.description=t,room.masterServer.updateScreenIdMsg(room.selfUser.nodeId,r,this)},e.prototype.publishHandle=function(r){var n=when.defer(),o=this;return log.debug("Screen publishHandle(),streamId :",r),navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxWidth:o.resolution.width,maxHeight:o.resolution.height,minFrameRate:o.frameRate.min,maxFrameRate:o.frameRate.max}}},function(e){if(log.debug("gotShareStream.stream:",e),e&&e.getTracks()){var t=e.getTracks()[0];void 0!==t.onended?t.onended=function(){log.debug("screen.publish(),track.onended====="),null!=o.track&&(o.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,o.status,o.id,o.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:void 0!==e.onended?e.onended=function(){log.debug("screen.publish(),stream.onended====="),null!=o.track&&(o.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,o.status,o.id,o.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:e.oninactive=function(){log.debug("screen.publish(),stream.oninactive====="),null!=o.track&&(o.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,o.status,o.id,o.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}}o.publishHandleInner(o,e,r,n)},function(e){log.debug("An error occurred: "+e);e=new t(ErrorConstant.screen_sharing_plugin_not_accessible);n.reject(e)}),n.promise},e.prototype.publishHandleInner=function(t,r,n,o){var i=getRandomNum(6001,9e3),e=room.composePDUDeviceId(room.selfUser.id,t.id);t.track=r.getVideoTracks()[0];var s=t.getNewStreamByTrack();room.masterServer.screenPublishHandle(e,s,i),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(null==room.selfUser.stream?room.selfUser.stream=r:room.selfUser.stream.addTrack(t.track),t.status=StreamStatus.published,room.pubScreens.push(t),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,t.status,t.id,t.name,room.selfUser.id),o.resolve(n))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&o.reject(e)})},e});var currentVideoParameter={videoWidth:!1,videoHeight:!1,frameRate:!1,aspectRatio:!1};function isAndroid(){return-1!=navigator.userAgent.indexOf("Android")}function getPreviousResolution(e){if(!Resolutions[e])return null;var t=Resolutions[e].order,r=null,n=null;for(var o in Resolutions){var i=Resolutions[o];(null==r||r.order<i.order&&i.order<t)&&(n=o,r=i)}return n}function getConstraints(e,t){var r={audio:!1,video:!1};return e&&(r.audio={mandatory:{},optional:[]}),t&&("safari"==adapter.browserDetails.browser||"firefox"==adapter.browserDetails.browser?r.video={width:{},height:{}}:r.video={width:{},height:{},frameRate:{}}),r.audio&&(r.audio.optional.push({googEchoCancellation:!0},{googAutoGainControl:!0},{googNoiseSuppression:!0},{googHighpassFilter:!0},{googNoisesuppression2:!0},{googEchoCancellation2:!0},{googAutoGainControl2:!0}),e.id&&(r.audio.mandatory.sourceId=e.id)),r.video&&t.id&&"chrome"==adapter.browserDetails.browser&&(r.video.deviceId={exact:t.id}),t&&(t.resolution&&setResolutionConstraints(r,t.resolution,t.setType),t.frameRate&&setFrameRateConstraints(r,t.frameRate),0<t.aspectRatio&&setAspectRatioConstraints(r,t.aspectRatio)),r}function getApplyConstraints(e){var t={};return e&&(t="safari"==adapter.browserDetails.browser||"firefox"==adapter.browserDetails.browser?{width:{},height:{}}:{width:{},height:{},frameRate:{}}),t&&e.id&&"chrome"==adapter.browserDetails.browser&&(t.deviceId={exact:e.id}),e&&(e.resolution&&setApplyResolutionConstraints(t,e.resolution,e.setType),e.frameRate&&setApplyFrameRateConstraints(t,e.frameRate),0<e.aspectRatio&&setApplyAspectRatioConstraints(t,e.aspectRatio)),t}function setResolutionConstraints(e,t,r){t&&(r==ResolutionSetType.ideal?(e.video.width={ideal:t.width},e.video.height={ideal:t.height}):(e.video.width={exact:t.width},e.video.height={exact:t.height}),currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height)}function setApplyResolutionConstraints(e,t,r){t&&(r==ResolutionSetType.ideal?(e.width={ideal:t.width},e.height={ideal:t.height}):(e.width={exact:t.width},e.height={exact:t.height}),currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height)}function setFrameRateConstraints(e,t){t&&"safari"!=adapter.browserDetails.browser&&"firefox"!=adapter.browserDetails.browser&&(e.video.frameRate={ideal:t},currentVideoParameter.frameRate=t)}function setApplyFrameRateConstraints(e,t){t&&"safari"!=adapter.browserDetails.browser&&"firefox"!=adapter.browserDetails.browser&&(e.frameRate={ideal:t},currentVideoParameter.frameRate=t)}function setAspectRatioConstraints(e,t){t&&"safari"!=adapter.browserDetails.browser&&"firefox"!=adapter.browserDetails.browser&&(e.video.aspectRatio={exact:t},currentVideoParameter.aspectRatio=t)}function setApplyAspectRatioConstraints(e,t){t&&"safari"!=adapter.browserDetails.browser&&"firefox"!=adapter.browserDetails.browser&&(e.aspectRatio={exact:t},currentVideoParameter.aspectRatio=t)}function obtainUserMedia(e,t,n,o){"firefox"==adapter.browserDetails.browser?null!=e&&null!=t?getUserMediaWithConstraints(e,!1,function(r){getUserMediaWithConstraints(!1,t,function(e){var t=handleLocalStream({audioStream:r,videoStream:e});n(t)},function(e){o(e)})},function(e){o(e)}):null!=e&&null==t?getUserMediaWithConstraints(e,!1,function(e){var t=handleLocalStream({audioStream:e,videoStream:null});n(t)},function(e){o(e)}):null==e&&null!=t&&getUserMediaWithConstraints(!1,t,function(e){var t=handleLocalStream({audioStream:null,videoStream:e});n(t)},function(e){o(e)}):getUserMediaWithConstraints(e,t,function(e){n(handleLocalStream(e))},function(e){o(e)})}function getUserMediaWithConstraints(e,t,r,n){var o=getConstraints(e,t);log.debug("getUserMediaWithConstraints(),constraints:"+JSON.stringify(o));try{navigator.mediaDevices.getUserMedia(o).then(function(e){r(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),n&&n(t)})}catch(e){var i=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);n&&n(i)}}function handleLocalStream(e){var t,r;if("chrome"==adapter.browserDetails.browser){if(t=new webkitMediaStream,r=new webkitMediaStream,e){for(var n=e.getAudioTracks(),o=0;o<n.length;o++)t.addTrack(n[o]);var i=e.getVideoTracks();for(o=0;o<i.length;o++)r.addTrack(i[o])}}else if("safari"==adapter.browserDetails.browser){if(t=new MediaStream,r=new MediaStream,e){for(n=e.getAudioTracks(),o=0;o<n.length;o++)t.addTrack(n[o]);i=e.getVideoTracks();for(o=0;o<i.length;o++)r.addTrack(i[o])}}else if("Internet Explorer"==adapter.browserDetails.browser){if(r=t=null,e){var s;if(0<(n=e.getAudioTracks()).length)(s=e.clone()).removeTrack(n[0]),r=s;else r=e;if(0<(i=e.getVideoTracks()).length)(s=e.clone()).removeTrack(i[0]),t=s;else t=e}}else"firefox"==adapter.browserDetails.browser&&(t=e.audioStream,r=e.videoStream);return{audioStream:t,videoStream:r}}var fakeVideoConstraints={video:!0,fake:!0},fakeAudioConstraints={audio:!0,fake:!0};function getFakeVideoStream(t){navigator.mediaDevices.getUserMedia(fakeVideoConstraints).then(function(e){t(e)}).catch(function(e){})}function getFakeAudioStream(t){navigator.mediaDevices.getUserMedia(fakeAudioConstraints).then(function(e){t(e)}).catch(function(e){})}function getAllAudioVideoDevices(t,e){if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator)),navigator.enumerateDevices){var o=[],i=[],s=[],a=[],c=[],l=[];navigator.enumerateDevices(function(e){e.forEach(function(e){var t,r={};for(var n in e)r[n]=e[n];o.forEach(function(e){e.id===r.id&&(t=!0)}),t||("audio"===r.kind&&(r.kind="audioinput"),"video"===r.kind&&(r.kind="videoinput"),r.deviceId||(r.deviceId=r.id),r.id||(r.id=r.deviceId),r.label||(r.label="Please invoke getUserMedia once."),"audioinput"!==r.kind&&"audio"!==r.kind||a.push(r),"audiooutput"===r.kind&&c.push(r),"videoinput"!==r.kind&&"video"!==r.kind||l.push(r),-1!==r.kind.indexOf("audio")&&i.push(r),-1!==r.kind.indexOf("video")&&s.push(r),o.push(r))}),t&&t({allMdiaDevices:o,allVideoDevices:s,allAudioDevices:i,videoInputDevices:l,audioInputDevices:a,audioOutputDevices:c})})}else e(null,"Neither navigator.mediaDevices.enumerateDevices NOR MediaStreamTrack.getSources are available.")}function captureUserMedia(e,t,r){navigator.mediaDevices.getUserMedia(e).then(t)}navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)});var extensionInstalled=!1,mcuServerUrl,clusterRestAddr,roomServerUrl,iceServers,stunUrl,trunUrl,iceusername,iceCredential;window.addEventListener("message",function(e){var t=e.origin,r=e.data.type,n=e.data.text,o=e.data.streamId;if(t!==window.location.origin&&console.warn("ScreenStream: you should discard foreign event from origin:",t),"flag"===n)avdEngine.checkExtensionFlags+=r;else{if("SS_DIALOG_SUCCESS"===r)room.selfUser.getScreen().publishHandle(o).then().otherwise(function(e){});"SS_DIALOG_CANCEL"===r&&console.log("User cancelled!")}extensionInstalled=-1<avdEngine.checkExtensionFlags.indexOf(avdEngine.screenExtensionFlag)});var is_cluster=!1,protocolStr=document.location.protocol;"http:"!=protocolStr&&"https:"!=protocolStr&&(protocolStr="http:");var fsCheck={isCheck:!1,content:{}},connectionStatisticsConfig=null,loggerReportConfig=null,loggerReport=null,doFsCheck=function(e,t){var r=null;1==fsCheck.isCheck&&(1!=fsCheck.content[e.value]&&(r=new t(ErrorConstant.ft_no_authorization.code,e.name+ErrorConstant.ft_no_authorization.message)));return r};function saveLog(e,t,r){var n=document.location.protocol+"//"+logAjax.server+"/write?db="+logAjax.db+"&u="+logAjax.userName+"&p="+logAjax.password,o="";"undefined"!=typeof returnCitySN&&(o=returnCitySN.cip);(new Date).getTime();var i="",s="",a="",c="",l=0;room&&(room.id&&(i=room.id),room.selfUser&&(room.selfUser.name&&(s=room.selfUser.name),room.selfUser.id&&(a=room.selfUser.id))),browserDetect&&browserDetect.detect&&browserDetect.detect.browser&&(browserDetect.detect.browser.name&&(c=browserDetect.detect.browser.name),browserDetect.detect.browser.fullVersion&&(l=browserDetect.detect.browser.fullVersion));var d='js_log host_ip="'+o+'",roomId="'+i+'",userName="'+s+'",userId="'+a+'",browserName="'+c+'",browserVersion="'+l+'",level="'+e+'",msg="'+t+'" ';$.ajax({type:"post",url:n,timeout:5e3,data:d,success:function(e){},error:function(e,t,r){}})}ModuleBase.define("RestServer",["Error"],function(Error){var RestServer=function(e){e&&(protocolStr=e)};return RestServer.prototype.getServerinfo=function(serverURI,accessToken){var deferred=when.defer();mcuServerUrl=serverURI;var url=protocolStr+"//"+serverURI+"/sdk/config/serverinfo",params={params:{uri_encode:"yes",client_info:{access_tocken:accessToken}}};return this.fetchGet(url,params).then(function(serverinfo){var fuValue=serverinfo.ft_value;fuValue&&(fsCheck.isCheck=!0,"object"==typeof fuValue?fsCheck.content=fuValue:"string"==typeof fuValue&&(fsCheck.content=eval("("+fuValue+")")));var error=doFsCheck(FTConstant.platform_web,Error);if(null!=error)return deferred.reject(error),deferred.promise;connectionStatisticsConfig=serverinfo.statistic_config?serverinfo.statistic_config:{},connectionStatisticsConfig.open_statistic=serverinfo.open_statistic?serverinfo.open_statistic:0,connectionStatisticsConfig.trace_id=serverinfo.trace_id?serverinfo.trace_id:"",loggerReportConfig=serverinfo.logger_config?serverinfo.logger_config:{},loggerReportConfig.open_logger=serverinfo.open_logger?serverinfo.open_logger:0,loggerReportConfig.trace_id=serverinfo.trace_id?serverinfo.trace_id:"",roomServerUrl=serverinfo.room_server.uri,iceServers=serverinfo.ice_servers,null!=iceServers&&0<iceServers.length&&(stunUrl=iceServers[0].url,trunUrl=iceServers[1].url,iceusername=iceServers[1].username,iceCredential=iceServers[1].credential),serverinfo.is_cluster&&("true"!=serverinfo.is_cluster&&1!=serverinfo.is_cluster||(is_cluster=!0)),deferred.resolve()}).catch(function(e){e=new Error(e.code,e.message);return deferred.reject(e),!1}),deferred.promise},RestServer.prototype.getMcu=function(e,t){var n=when.defer();loggerReport.info("调度服务器地址:"+mcuServerUrl);var r=protocolStr+"//"+mcuServerUrl+"/sdk/get_mcu",o={params:{room_id:e,token:t}};return console.log("=======restServer.getMcu(),room.avdEngine.mcuClusterRouteParams:"+room.avdEngine.mcuClusterRouteParams),room.avdEngine.mcuClusterRouteParams&&(o.params.options=room.avdEngine.mcuClusterRouteParams,log.info("ajax (/sdk/getMcu) getMcuUrl(带mcuClusterRouteParams):")),this.fetchGet(r,o).then(function(e){var t=e.ret;if(0==t)roomServerUrl=e.addr,clusterRestAddr=e.cluster_rest_addr,loggerReport.info("MCU服务器地址:"+clusterRestAddr),log.debug("============getMcu(),clusterRestAddr:"+clusterRestAddr),n.resolve();else{var r=new Error(t,e.msg);n.reject(r)}}).catch(function(e){console.log(e);e=new Error(e.code,e.message);return n.reject(e),!1}),n.promise},RestServer.prototype.getMcuWithOEM=function(e,t){var n=when.defer(),r=protocolStr+"//"+mcuServerUrl+"/sdk/get_mcu",o={params:{room_id:e,access_token:t}};return this.fetchGet(r,o).then(function(e){var t=e.ret;if(0==t)roomServerUrl=e.addr,clusterRestAddr=e.cluster_rest_addr,room.avdEngine.accessToken=e.access_token,log.info("ajax (/sdk/getMcuWithOEM)  roomServerUrl:"+e.addr+"；accessToken："+e.access_token),n.resolve();else{var r=new Error(t,e.msg);n.reject(r)}}).catch(function(e){e=new Error(e.code,e.message);return n.reject(e),!1}),n.promise},RestServer.prototype.getMqttWSAddr=function(e,t){var o=when.defer(),r=protocolStr+"//"+e+"/sdk/mqtt/serverinfo",n={params:{token:t}};return this.fetchGet(r,n).then(function(e){var t=e.ret;if(0==t){var r=e.data.mqtt_ws_addr;log.info("ajax (/sdk/mqtt/serverinfo)  mqttWSAddr:"+r),o.resolve(r)}else{var n=new Error(t,e.msg);o.reject(n)}}).catch(function(e){e=new Error(e.code,e.message);return o.reject(e),!1}),o.promise},RestServer.prototype.fetchGet=function(e,t){return new Promise(function(r,n){axios.get(e,t).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};n(t)}}).catch(function(e){if(e.response){var t=new Error(e.response.status,e.response.data);n(t)}else{t=new Error(1e4,e.message);n(t)}n(e)})})},RestServer}),ModuleBase.define("MasterServer",["CmdProtobufCoded","TraceablePeerConnection","Error"],function(t,r,C){var e=function(e){this.signalingChannel=e,this.cmdProtobufCoded=new t,this.roomPduType=this.cmdProtobufCoded.getRoomPduTypeEnum(),this.mediaType=this.cmdProtobufCoded.getMediaTypeEnum(),this.sessionType=this.cmdProtobufCoded.getSessionTypeEnum(),this.resourceStatus=this.cmdProtobufCoded.getResourceStatusEnum(),this.resourceOpt=this.cmdProtobufCoded.getResourceOptEnum(),this.userMsgOpt=this.cmdProtobufCoded.getUserMsgOptEnum(),this.cameraType=this.cmdProtobufCoded.getCameraTypeEnum(),this.lineArrow=this.cmdProtobufCoded.getLineArrowEnum(),this.annotationType=this.cmdProtobufCoded.getAnnotationTypeEnum(),this.exporterType=this.cmdProtobufCoded.getExporterTypeEnum(),this.outGoingViewLayoutMode=this.cmdProtobufCoded.getOutGoingViewLayoutMode(),this.traceablePeerConnection=new r,room.traceablePeerConnection=this.traceablePeerConnection,this.traceablePeerConnection.getToMCUPeerConnection(),"firefox"==adapter.browserDetails.browser&&this.traceablePeerConnection.getToMCUPeerConnectionForFirefox()};function n(){var d=when.defer();return room.masterServer.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(e){if("safari"==adapter.browserDetails.browser)for(var t=e.sdp.split("\r\n"),r=findLine(t,"a=ssrc","ssrc"),n=0;n<r.length;n++)e.sdp=e.sdp.replace(t[r[n]]+"\r\n","");room.codecPayloadVP8=getCodecPayloadType(e.sdp,"VP8"),room.codecPayloadVP9=getCodecPayloadType(e.sdp,"VP9"),room.codecPayloadH264=getCodecPayloadType(e.sdp,"H264");var o="102",i=getPayloadByProfileLevel(e.sdp);i&&(o=i);var s=0;for(n=0;n<room.codecPayloadH264.length;n++)if(room.codecPayloadH264[n]==o){s=n;break}if(0<s){var a=room.codecPayloadH264[0];room.codecPayloadH264[0]=o,room.codecPayloadH264[s]=a}var c=room.codecPayloadVP8.concat(room.codecPayloadVP9).concat(room.codecPayloadH264);room.codecPayloadOpus=getCodecPayloadType(e.sdp,"Opus"),room.codecPayloadISAC_16K=getCodecPayloadType(e.sdp,"ISAC/16000"),room.codecPayloadISAC_32K=getCodecPayloadType(e.sdp,"ISAC/32000"),room.codecPayloadG722=getCodecPayloadType(e.sdp,"G722"),room.codecPayloadPCMU=getCodecPayloadType(e.sdp,"PCMU"),room.codecPayloadPCMA=getCodecPayloadType(e.sdp,"PCMA"),remoteSDPInit=e.sdp,remoteSDPInit=setReplaceMediaPayloads(c,remoteSDPInit,"video");var l="js_v"+avdVersion+" ";if(room.codecPayloadVP8&&0<room.codecPayloadVP8.length)for(n=0;n<room.codecPayloadVP8.length;n++)l=l+"vp8:"+room.codecPayloadVP8[n]+",";else l+="vp8:0,";if(room.codecPayloadVP9&&0<room.codecPayloadVP9.length)for(n=0;n<room.codecPayloadVP9.length;n++)l=l+"vp9:"+room.codecPayloadVP9[n]+",";else l+="vp9:0,";if(room.codecPayloadH264&&0<room.codecPayloadH264.length)for(n=0;n<room.codecPayloadH264.length;n++)l=l+"h264:"+room.codecPayloadH264[n]+",";else l+="h264:0,";d.resolve(l)},function(e){log.error("getVersionReforms(), createOffer error:"+e.toString()),d.reject(e)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}),d.promise}function i(){var e=0;return is_cluster&&(e=1),e}return e.prototype.openReqSend=function(){var o=this;n().then(function(e){log.debug("====openReqSend,version:"+e);var t=i();log.debug("====openReqSend,is_cluster:"+t);loggerReportConfig&&loggerReportConfig.trace_id&&loggerReportConfig.trace_id;var r=o.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,"",e,"",t),n=o.cmdProtobufCoded.encodedPacket(o.roomPduType.OPEN_REQ,0,0,0,r);log.info("====openReqSend,OPEN_REQ====="),loggerReport.info("Send PDU OPEN_REQ"),o.signalingChannel.send(n)})},e.prototype.openReqReconnectionSend=function(){var o=this;n().then(function(e){log.debug("====openReqReconnectionSend,version:"+e);var t=i();log.debug("====openReqSend,is_cluster:"+t);var r=o.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,room.signalTocken,e,"",t),n=o.cmdProtobufCoded.encodedPacket(o.roomPduType.OPEN_REQ,0,0,0,r);log.info("====openReqReconnectionSend,OPEN_REQ====="),o.signalingChannel.send(n)})},e.prototype.pingIntervalHandle=function(){var e=this;room.pingIntervalId=setInterval(function(){room&&(room.pingCountTime+=room.pingInterval,packetArray=e.cmdProtobufCoded.encodedPacket(e.roomPduType.PING,room.lastPDUSeq,0,0,null),e.signalingChannel.send(packetArray))},room.pingInterval)},e.prototype.pingTimeoutHandle=function(){var e=this,t=3*room.pingInterval;room.pingTimeoutId=setInterval(function(){room&&room.pingCountTime>=t&&(room.reconnectionState||(log.info("=========Ping包饱和测试无响应时间超过指定时长10秒时，进行websocket重连操作=========="),loggerReport.info("Ping包饱和测试无响应时间超过指定时长10秒时，进行websocket重连操作"),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),e.pingInit(),room.reconnectionHandle()))},1e3)},e.prototype.pingInit=function(){room.pingCountTime=0,clearInterval(room.pingIntervalId),clearInterval(room.pingTimeoutId),room.pingIntervalId=null,room.pingTimeoutId=null},e.prototype.inviteRoomReqSend=function(){var e=null;0<room.reconnectionCount&&(e=room.selfUser.nodeId);var t=this.cmdProtobufCoded.newUserPolicy(!0,!0,!0),r=room.userAgent;console.debug("=============room.avdEngine.clientResource:",room.avdEngine.clientResource);var n=JSON.stringify(room.avdEngine.clientResource);console.debug("=============userResources:",n);var o=this.cmdProtobufCoded.newJoinInfo([],[],r,t,n),i=this.cmdProtobufCoded.newInviteRoomReq1(20,room.id,"",room.avdEngine.accessToken,room.selfUser.id,room.selfUser.name,o,room.selfUser.password,e);if(i.user_data=room.selfUser.data,"firefox"==adapter.browserDetails.browser){var s=this;this.traceablePeerConnection.getInviteRoomReq1ByFirefox().then(function(){null!=room.iceUfragLocal&&(i.ice_ufrag=room.iceUfragLocal),null!=room.icePwdLocal&&(i.ice_pwd=room.icePwdLocal),null!=room.iceUfragLocal2&&(i.ice_ufrag=i.ice_ufrag+":"+room.iceUfragLocal2),null!=room.icePwdLocal2&&(i.ice_pwd=i.ice_pwd+":"+room.icePwdLocal2);var e=s.cmdProtobufCoded.encodedPacket(s.roomPduType.INVITE_ROOM_REQ1,0,0,0,i);s.signalingChannel.send(e)})}else{loggerReport.info("Send PDU INVITE_ROOM_REQ1");var a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.INVITE_ROOM_REQ1,0,0,0,i);this.signalingChannel.send(a)}},e.prototype.sendOffer=function(){var e=this;this.traceablePeerConnection.doSetLocalDescription().then(function(){e.traceablePeerConnection.doSetRemoteDescription()}),"firefox"==adapter.browserDetails.browser&&this.traceablePeerConnection.doSetLocalDescriptionForFirefox().then(function(){e.traceablePeerConnection.doSetRemoteDescriptionForFirefox()})},e.prototype.setAddIcecandidate=function(e){if(roomServerUrl){var t=roomServerUrl.split("/")[0];if(t){var r=t.split(":");0<r.size&&(t=r[0])}e.candidate=e.candidate.replace("127.0.0.1",t)}log.info("setAddIcecandidate(),mcu server send candidate:"+e.candidate),this.traceablePeerConnection.doAddIceCandidate(e)},e.prototype.addWebcamMsg=function(e,t){var r=this.cmdProtobufCoded.newWebcam(e,t.name,t.status,this.sessionType.Video);r.ctype=this.cameraType.unknown,r.level=t.level,r.description=t.description;var n=this.cmdProtobufCoded.newAddWebcamMsg(room.selfUser.nodeId,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_WEBCAM_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)},e.prototype.removeWebcamMsg=function(e){var t=this.cmdProtobufCoded.newRemoveWebcamMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_WEBCAM_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.addScreenMsg=function(e,t){var r=this.cmdProtobufCoded.newDesktop(e,t.name,t.status,this.sessionType.ShareScreen);r.level=t.level,r.description=t.description;var n=this.cmdProtobufCoded.newAddDesktopMsg(room.selfUser.nodeId,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_DESKTOP_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)},e.prototype.addSpeakerMsg=function(e,t){var r=this.cmdProtobufCoded.newSpeaker(e,t.name,t.status,this.sessionType.Audio),n=this.cmdProtobufCoded.newAddSpeakerMsg(room.selfUser.nodeId,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_SPEAKER_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)},e.prototype.removeSpeakerMsg=function(e){var t=this.cmdProtobufCoded.newRemoveSpeakerMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_SPEAKER_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.updateUserName=function(e,t){var r=this.cmdProtobufCoded.newUpdateUserName(e,t),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_NAME,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(n)},e.prototype.updateUserDataMsg=function(e){var t=this.cmdProtobufCoded.newUpdateUserDataMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_DATA_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.roomDataInfo=function(e,t){var r=this.cmdProtobufCoded.newRoomKV(e,t),n=[];n.push(r);var o=this.cmdProtobufCoded.newRoomDataInfo(room.id,n),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_DATA_INFO,0,room.selfUser.nodeId,0,o);this.signalingChannel.send(i)},e.prototype.pubRoomResourceMsg=function(e,t,r,n,o){var i,s=100;if(videoCoding==VideoCodingType.VP8?s=100:videoCoding==VideoCodingType.VP9?s=101:videoCoding==VideoCodingType.H264&&(s=107),"video"==e?i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,r,currentVideoParameter.videoWidth,currentVideoParameter.videoHeight,currentVideoParameter.frameRate,s):"audio"==e?i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,r):"screen"==e&&(i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,r,1920,1280,5,s)),null!=i){i.sdp_version=3;var a=this.cmdProtobufCoded.newRoomResourceInfo(n,room.selfUser.nodeId,i);if("video"==e){var c=room.selfUser.getVideo(room.splitPDUDeviceId(n));c&&(c.resourceInfo=a)}var l=this.cmdProtobufCoded.newPubRoomResourceMsg(a,o),d=this.cmdProtobufCoded.encodedPacket(this.roomPduType.PUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,l);this.signalingChannel.send(d),this.signalingChannel.send("")}},e.prototype.subRoomResourceMsg=function(e,t,r){var n;if(1==e){var o=this.cmdProtobufCoded.newSubRoomResourceMsg(t,room.selfUser.nodeId,1,r);n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,o)}else if(0==e){var i=this.cmdProtobufCoded.newUnsubRoomResourceMsg(t,room.selfUser.nodeId);n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNSUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,i)}this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.unpubRoomResourceMsg=function(e,t,r){var n,o;if("video"==e){var i=room.splitPDUDeviceId(r);console.debug("+++++++++++++++++++masterServer.unpubRoomResourceMsg(),deviceId:",i),n=room.selfUser.deviceId2VideoSdpSsrc[i],console.debug("+++++++++++++++++++masterServer.unpubRoomResourceMsg(),sdp:",n),o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,n)}else"audio"==e?(n=room.selfUser.audioSdpSsrc,o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,n)):"screen"==e&&(n=room.selfUser.screenSdpSsrc,o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,n));o&&(o.sdp_version=3);var s=this.cmdProtobufCoded.newRoomResourceInfo(r,room.selfUser.nodeId,o);if("video"==e){var a=room.selfUser.getVideo(room.splitPDUDeviceId(r));a&&(a.resourceInfo=s)}var c=this.cmdProtobufCoded.newUnpubRoomResourceMsg(s),l=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,c);this.signalingChannel.send(l),this.signalingChannel.send("")},e.prototype.updateSpeakerMsg=function(e,t,r){var n=room.composePDUDeviceId(room.selfUser.id,r.id),o=this.cmdProtobufCoded.newSpeaker(n,r.name,r.status,this.sessionType.Audio),i=this.cmdProtobufCoded.newUpdateSpeakerMsg(e,t,o),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_SPEAKER_MSG,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s),this.signalingChannel.send("")},e.prototype.updateWebcamMsg=function(e,t,r){var n=room.composePDUDeviceId(room.selfUser.id,r.id),o=r.status;r.status!=StreamStatus.none&&r.status!=StreamStatus.opened||(o=1);var i=this.cmdProtobufCoded.newWebcam(n,r.name,o,this.sessionType.Video);i.level=r.level,i.description=r.description;var s=this.cmdProtobufCoded.newUpdateWebcamMsg(e,t,i),a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_WEBCAM_MSG,0,room.selfUser.nodeId,0,s);this.signalingChannel.send(a),this.signalingChannel.send("")},e.prototype.updateScreenIdMsg=function(e,t,r){var n=room.composePDUDeviceId(room.selfUser.id,r.id),o=this.cmdProtobufCoded.newDesktop(n,r.name,r.status,this.sessionType.ShareScreen);o.level=r.level,o.description=r.description;var i=this.cmdProtobufCoded.newUpdateDesktopMsg(e,t,o),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_DESKTOP_MSG,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s),this.signalingChannel.send("")},e.prototype.videoIndiction=function(e,t,r){var n=this.resourceOpt.pub;e||(n=this.resourceOpt.unpub);var o=this.cmdProtobufCoded.newResourceIndiction(t,n,r,room.selfUser.nodeId,"host_tocken"),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.VIDEO_INDICTION,0,room.selfUser.nodeId,r,o);this.signalingChannel.send(i)},e.prototype.audioIndiction=function(e,t,r){var n=this.resourceOpt.pub;e||(n=this.resourceOpt.unpub);var o=this.cmdProtobufCoded.newResourceIndiction(t,n,r,room.selfUser.nodeId,"host_tocken"),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.AUDIO_INDICTION,0,room.selfUser.nodeId,r,o);this.signalingChannel.send(i)},e.prototype.sendMessage=function(e,t){var r=new Date;r.setMinutes(r.getMinutes()+r.getTimezoneOffset());var n=r.getTime();n=Math.round(n/1e3);var o=this.cmdProtobufCoded.newTextMsg(e,n),i=this.roomPduType.PUBLIC_TEXT_MSG,s=0;if(void 0!==t&&null!=t&&""!=t){var a=room.getNodeId(t);if(null==a)return!1;s=a,i=this.roomPduType.PRIVATE_TEXT_MSG}var c=this.cmdProtobufCoded.encodedPacket(i,0,room.selfUser.nodeId,s,o);this.signalingChannel.send(c)},e.prototype.sendData=function(e,t){var r=this.cmdProtobufCoded.newData(e),n=this.roomPduType.PUBLIC_DATA,o=0;if(void 0!==t&&null!=t&&""!=t){var i=room.getNodeId(t);null!=i&&(o=i,n=this.roomPduType.PRIVATE_DATA)}var s=this.cmdProtobufCoded.encodedPacket(n,0,room.selfUser.nodeId,o,r);this.signalingChannel.send(s)},e.prototype.userIndiction=function(e,t){var r=room.getNodeId(t),n=this.cmdProtobufCoded.newUserMsg(r,this.userMsgOpt.kickoff,e),o=this.cmdProtobufCoded.newUserIndiction(room.selfUser.nodeId,this.roomPduType.USER_MSG,n.toArrayBuffer()),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_INDICTION,0,room.selfUser.nodeId,r,o);this.signalingChannel.send(i)},e.prototype.userMsg=function(e,t){var r=this.userMsgOpt.leave;if(t&&(r=this.userMsgOpt.kickoff),room&&room.selfUser&&room.selfUser.nodeId){var n=this.cmdProtobufCoded.newUserMsg(room.selfUser.nodeId,r,e),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)}},e.prototype.closeRoom=function(e){var t=this.cmdProtobufCoded.newCloseRoomReq(50,room.getNodeId(e),room.getRoomId()),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CLOSE_ROOM_REQ,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.videoPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("video",e,t,r):this.pubRoomResourceMsg("video",t.id,null,e,r)},e.prototype.videoUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("video",e,t):this.unpublishHandleP2P("video",room.selfUser.subMyVideosP2P,t,e)},e.prototype.videoSubscribleHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.updateSdp("video",1,e,t):this.subscribleHandleP2P(e)},e.prototype.videoUnsubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("video",0,e,null):this.unsubscribleHandleP2P("video",e)},e.prototype.changeSubscribedVideoQuality=function(e,t){if(room.isMcu()){var r=this.cmdProtobufCoded.newModifyResourceReq("60",e,t),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.MODIFY_RESOURCE_REQ,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(n)}},e.prototype.screenPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("screen",e,t,r):this.pubRoomResourceMsg("screen",t.id,null,e,r)},e.prototype.screenUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("screen",e,t):this.unpublishHandleP2P("screen",room.selfUser.subMyScreensP2P,t,e)},e.prototype.screenSubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("screen",1,e,null):this.subscribleHandleP2P(e)},e.prototype.screenUnsubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("screen",0,e,null):this.unsubscribleHandleP2P("screen",e)},e.prototype.audioPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("audio",e,t,r):this.pubRoomResourceMsg("audio",t.id,null,e,r)},e.prototype.audioUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("audio",e,t):this.unpublishHandleP2P("audio",room.selfUser.subMyAudiosP2P,t,e)},e.prototype.audioSubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("audio",1,e,null):this.subscribleHandleP2P(e)},e.prototype.audioUnsubscribleHandle=function(e){room.isMcu()?room.traceablePeerConnection.updateSdp("audio",0,e,null):this.unsubscribleHandleP2P("audio",e)},e.prototype.bindAudioToVideo=function(e,t,r){var n=this.cmdProtobufCoded.newBindAudioToVideoReq(e,t,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.BIND_AUDIO_TO_VIDEO_REQ,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(o)},e.prototype.sendOfferP2P=function(e,t){log.debug("=========sendOfferP2P()========OFFER_REQ======");var r=this.cmdProtobufCoded.newOfferReq(0,e,room.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REQ,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(n)},e.prototype.setRemoteP2P=function(e,t){log.debug("=========setRemoteP2P()========OFFER_REP======");var r=this.cmdProtobufCoded.newOfferRep(0,1,"",e,room.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REP,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(n)},e.prototype.sendCandidateMsgP2P=function(e,t){var r=this.cmdProtobufCoded.newCandidateMsg(e.candidate,e.sdpMLineIndex,e.sdpMid,room.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CANDIDATE_MSG,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(n)},e.prototype.sendSubSdpOfferP2P=function(e,t,r){var n,o=e.info;if(o.stream.sdp=t,"offerSub"==r)log.debug("send P2P SUB_ROOM_RESOURCE_REQ: "+room.selfUser.nodeId+"------\x3e"+o.owner_id),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,room.selfUser.nodeId,o.owner_id,e);else if("answerSub"==r){log.debug("send P2P SUB_ROOM_RESOURCE_REP: "+room.selfUser.nodeId+"------\x3e"+e.sub_node_id);var i=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",o);n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,room.selfUser.nodeId,e.sub_node_id,i)}this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.sendSubSdpAnswerP2P=function(e,t,r,n){var o;if(t.stream.sdp=r,"offerSub"==e){var i=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",t);o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,room.selfUser.nodeId,n,i)}else if("answerSub"==e){var s=this.cmdProtobufCoded.newSubRoomResourceMsg(t,room.selfUser.nodeId,1);o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,n,s)}this.signalingChannel.send(o),this.signalingChannel.send("")},e.prototype.subscribleHandleP2P=function(e){if(room.selfUser.nodeId>e.owner_id){e.stream.sdp="";var t=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,room.selfUser.nodeId);log.info("=========subscribleHandleP2P() =======SUB_ROOM_RESOURCE_REQ====");var r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,room.selfUser.nodeId,e.owner_id,t);this.signalingChannel.send(r),this.signalingChannel.send("")}else{t=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,room.selfUser.nodeId);room.traceableP2PPeerConnection.sendSubSdpOfferP2P("offerSub",t)}},e.prototype.unpublishHandleP2P=function(e,t,r,n){if(null!=t&&0<t.length)for(var o=0;o<t.length;o++){var i=t[o];room.traceableP2PPeerConnection.removeStreamP2P(e,i,r),room.selfUser.nodeId>i?room.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unpubAnswer",e,i,null):room.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unpubOffer",e,i,null)}var s;"video"==e?(s=this.mediaType.video,log.debug("===unPubWebcam() p2p=== send  video  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice")):"audio"==e?(s=this.mediaType.audio,log.debug("===unPubWebcam() p2p=== send  audio  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice")):"screen"==e&&(s=this.mediaType.desktop,log.debug("===unPubWebcam() p2p=== send  screen  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice"));var a=this.cmdProtobufCoded.newMediaStream(r.id,s,null),c=this.cmdProtobufCoded.newRoomResourceInfo(n,room.selfUser.nodeId,a),l=this.cmdProtobufCoded.newUnpubRoomResourceMsg(c),d=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,l);this.signalingChannel.send(d),this.signalingChannel.send("")},e.prototype.unsubscribleHandleP2P=function(e,t){room.selfUser.nodeId>t.owner_id?room.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unsubAnswer",e,t.owner_id,t):room.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unsubOffer",e,t.owner_id,t)},e.prototype.setRoomControl=function(e,t){var r=this.cmdProtobufCoded.newRoomControl(e,t),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_CONTROL,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.addBoardMsg=function(e,t){var r=t.backgroundColor.split(","),n=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(r[3])),parseInt(r[0]),parseInt(r[1]),parseInt(r[2])),o=this.cmdProtobufCoded.newBoardObject(t.id,room.selfUser.nodeId,room.selfUser.id,t.width,t.height,n,t.backgroundImage,null,t.title,t.description,t.extendData),i=this.cmdProtobufCoded.newUpdateBoardMsg(e,room.selfUser.nodeId,room.selfUser.id,t.id,o),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s),this.signalingChannel.send("")},e.prototype.removeBoardMsg=function(e,t){var r=this.cmdProtobufCoded.newUpdateBoardMsg(e,room.selfUser.nodeId,room.selfUser.id,t,null),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.closeBoardMsg=function(e,t){var r=this.cmdProtobufCoded.newUpdateBoardMsg(e,room.selfUser.nodeId,room.selfUser.id,t,null),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.shareBoardMsg=function(e,t){var r=this.cmdProtobufCoded.newUpdateBoardMsg(e,room.selfUser.nodeId,room.selfUser.id,t,null),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.sendAddAnnotationMessage=function(e,t,r,n,o,i,s){log.info("sendAddAnnotationMessage   objectId = "+e);var a=null,c=null,l=OperType.add,d=t._rectWithStroke?t._rectWithStroke:{},u=t.shape?t.shape:{},p=t.id,f=parseInt(d.x)?parseInt(d.x):0,h=parseInt(d.y)?parseInt(d.y):0,m=parseInt(d.x+d.width)?parseInt(d.x+d.width):0,g=parseInt(d.y+d.height)?parseInt(d.y+d.height):0,v={type:"",start:null,end:null,pointArray:[]},y=i,b=this.annotationType.annotation_tool_mouse;if(r==shapeTypeEnum.line)b=this.annotationType.annotation_tool_line,v.type="Annotation2Point",v.start=[parseInt(u.x1),parseInt(u.y1)],v.end=[parseInt(u.x2),parseInt(u.y2)];else if(r==shapeTypeEnum.rhomb){b=this.annotationType.annotation_tool_rhomb,v.type="Annotation2Point";var _=parseInt(u.points[0][0]),S=parseInt(u.points[3][1]),w=parseInt(u.points[2][0]),E=parseInt(u.points[1][1]);v.start=[_,S],v.end=[w,E]}else if(r==shapeTypeEnum.polyline)b=this.annotationType.annotation_tool_polyline,v.type="AnnotationMultiPoint",v.pointArray=u.points;else if(r==shapeTypeEnum.ellipse){b=this.annotationType.annotation_tool_ellipse,v.type="Annotation2Point";_=parseInt(u.cx-u.rx),S=parseInt(u.cy-u.ry),w=parseInt(u.cx+u.rx),E=parseInt(u.cy+u.ry);v.start=[_,S],v.end=[w,E]}else r==shapeTypeEnum.rect?(b=this.annotationType.annotation_tool_rectangle,v.type="Annotation2Point",v.start=[parseInt(u.x),parseInt(u.y)],v.end=[parseInt(u.x+u.width),parseInt(u.y+u.height)]):r==shapeTypeEnum.arrow?(b=this.annotationType.annotation_tool_arrow,v.type="Annotation2Point",v.start=[parseInt(u.x),parseInt(u.y)],v.end=[parseInt(u.x+u.width),parseInt(u.y+u.height)]):r==shapeTypeEnum.hlight_texttag?(b=this.annotationType.annotation_tool_hlight_texttag,v.type="Annotation2Point",v.start=[parseInt(u.x),parseInt(u.y)],v.end=[parseInt(u.x+u.width),parseInt(u.y+u.height)]):r==shapeTypeEnum.success?(b=this.annotationType.annotation_tool_success,v.type="Annotation2Point",v.start=[parseInt(u.x),parseInt(u.y)],v.end=[parseInt(u.x+u.width),parseInt(u.y+u.height)]):r==shapeTypeEnum.failure?(b=this.annotationType.annotation_tool_failure,v.type="Annotation2Point",v.start=[parseInt(u.x),parseInt(u.y)],v.end=[parseInt(u.x+u.width),parseInt(u.y+u.height)]):r==shapeTypeEnum.hlight_point&&(b=this.annotationType.annotation_tool_hlight_point,v.type="Annotation2Point",v.start=[parseInt(t.position[0]+t.style.width/2),parseInt(t.position[1]+t.style.height/2)],v.end=[parseInt(t.position[0]+t.style.width/2),parseInt(t.position[1]+t.style.height/2)]);var C=function(e){var t=e.split("(")[1].split(")")[0].split(",");4<=t.length||(t[3]=1);return t}(n),T=(n=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(C[3])),parseInt(C[0]),parseInt(C[1]),parseInt(C[2])),null);s==fillTypeEnum.none?T=this.cmdProtobufCoded.newcolor(0,255,255,255):s==fillTypeEnum.full&&(T=n);var I=this.cmdProtobufCoded.newRect(h,g,f,m),R=this.cmdProtobufCoded.newAnnotationObject(e,p,room.selfUser.nodeId,room.selfUser.id,b,y,o,n,T,I);if("Annotation2Point"==v.type){var P=this.cmdProtobufCoded.newPoint(v.start[0],v.start[1]),x=this.cmdProtobufCoded.newPoint(v.end[0],v.end[1]);a=this.cmdProtobufCoded.newAnnotation2Point(R,P,x)}else if("AnnotationMultiPoint"==v.type){var M=[];for(var k in v.pointArray){var A=this.cmdProtobufCoded.newPoint(parseInt(v.pointArray[k][0]),parseInt(v.pointArray[k][1]));M.push(A)}c=this.cmdProtobufCoded.newAnnotationMultiPoint(R,M)}var O=this.cmdProtobufCoded.newUpdateAnnotationMsg(l,e,r,p,room.selfUser.nodeId,room.selfUser.id,a,c,null);room.addAnnotationMsg(O,!0);var U=this.roomPduType.UPDATE_ANNOTATION_MSG,L=this.cmdProtobufCoded.encodedPacket(U,0,room.selfUser.nodeId,0,O);this.signalingChannel.send(L)},e.prototype.sendRemoveAnnotationMessage=function(e,t,r){var n=r,o=OperType.remove;t==shapeTypeEnum.clear&&(n=null);var i=this.cmdProtobufCoded.newUpdateAnnotationMsg(o,e,t,n,room.selfUser.nodeId,room.selfUser.id);room.addAnnotationMsg(i,!0);var s=this.roomPduType.UPDATE_ANNOTATION_MSG,a=this.cmdProtobufCoded.encodedPacket(s,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(a)},e.prototype.createServerRecorder=function(e,t,r,n,o,i,s,a,c,l,d,u){var p,f=when.defer(),h=getRandomNum(2e3,8e3);switch(o){case exporterTypeEnum.record:p=this.exporterType.EXPORTER_TYPE_RECORD;break;case exporterTypeEnum.record_real_time:p=this.exporterType.EXPORTER_TYPE_RECORD_REAL_TIME;break;case exporterTypeEnum.liver:p=this.exporterType.EXPORTER_TYPE_LIVER;break;case exporterTypeEnum.avc_media_mixer:p=this.exporterType.EXPORTER_TYPE_AVC_MEDIA_MIXER}var m=this.cmdProtobufCoded.newOutgoingCreateStreamsExporterReq(h,e,t,r,n,p,i,s,a,c,d,!0,0,0,"","",l,u),g=this.roomPduType.OUTGOING_CREATE_STREAMS_EXPORTER_REQ;console.debug("========createServerRecorder(),outgoingCreateStreamsExporterReq:",m);var v=this.cmdProtobufCoded.encodedPacket(g,0,room.selfUser.nodeId,0,m);this.signalingChannel.send(v);var y=setTimeout(function(){var e=new C(1e4,"createServerRecorder time out");f.reject(e)},5e3);return room.addCallback(ExporderCallBack.create_server_recorder_rep_success,function(e,t,r,n){if(e==h){var o={exporter_id:t,exporter_name:r,play_urls:n};f.resolve(o),clearTimeout(y)}}),room.addCallback(ExporderCallBack.create_server_recorder_rep_error,function(e,t){t==h&&(f.reject(e),clearTimeout(y))}),f.promise},e.prototype.selectStream4Exporter=function(e,t,r,n,o,i,s){var a=when.defer(),c=getRandomNum(2e3,8e3),l=this.cmdProtobufCoded.newOutgoingSelectStreamReq(c,e,t,r,n,o,i,s),d=this.roomPduType.OUTGOING_SELECT_STREAM_REQ,u=this.cmdProtobufCoded.encodedPacket(d,0,room.selfUser.nodeId,0,l);this.signalingChannel.send(u);var p=setTimeout(function(){var e=new C(1e4,"selectStream4Exporter time out");a.reject(e)},5e3);return room.addCallback(ExporderCallBack.select_stream_rep_success,function(e,t){if(e==c){var r={exporter_id:t};a.resolve(r),clearTimeout(p)}}),room.addCallback(ExporderCallBack.select_stream_rep_error,function(e,t){t==c&&(a.reject(e),clearTimeout(p))}),a.promise},e.prototype.mixMedia4Exporter=function(e,t,r,n,o,i){console.log("==============111111111========videoItems:",n);var s,a=when.defer(),c=getRandomNum(2e3,8e3),l=[];if(console.log("==============111111111AAAAAAAAAA========videoItems:",n),console.log("==============111111111A========videoItems.length:",n.length),n&&0<n.length)for(var d=0;d<n.length;d++){var u=n[d];console.log("==============22222222========videoItem:",u);var p=u.userId,f=u.zorder,h=u.x,m=u.y,g=u.width,v=u.height,y=u.deviceId,b=this.cmdProtobufCoded.newOutgoingVideoInfo(p,f,h,m,g,v,y,"");console.log("==============3333333333========videoInfo:",b),l.push(b)}console.log("==============44444444========videoInfos:",l),r==viewLayoutModeEnum.fixation?s=this.outGoingViewLayoutMode.Outgoing_View_Layout_Fixation:r==viewLayoutModeEnum.auto?s=this.outGoingViewLayoutMode.Outgoing_View_Layout_Auto:r==viewLayoutModeEnum.auto_orato&&(s=this.outGoingViewLayoutMode.Outgoing_View_Layout_Auto_Orato);var _=this.cmdProtobufCoded.newOutgoingMixStreamsReq(c,e,t,s,l,o,i);console.log("=========555555555=======mixStreamsReq:",_);var S=this.roomPduType.OUTGOING_MIX_STREAMS_REQ,w=this.cmdProtobufCoded.encodedPacket(S,0,room.selfUser.nodeId,0,_);this.signalingChannel.send(w);var E=setTimeout(function(){var e=new C(1e4,"mixMedia4Exporter time out");a.reject(e)},5e3);return room.addCallback(ExporderCallBack.mix_media_rep_success,function(e,t){if(e==c){var r={exporter_id:t};a.resolve(r),clearTimeout(E)}}),room.addCallback(ExporderCallBack.mix_media_rep_error,function(e,t){t==c&&(a.reject(e),clearTimeout(E))}),a.promise},e.prototype.pauseResumeExporter=function(e,t,r,n){var o=when.defer(),i=getRandomNum(2e3,8e3),s=this.cmdProtobufCoded.newOutgoingPauseResumeExporterReq(i,e,t,r,n),a=this.roomPduType.OUTGOING_PAUSE_RESUME_EXPORTER_REQ,c=this.cmdProtobufCoded.encodedPacket(a,0,room.selfUser.nodeId,0,s);this.signalingChannel.send(c);var l=setTimeout(function(){var e=new C(1e4,"pauseResumeExporter time out");o.reject(e)},5e3);return room.addCallback(ExporderCallBack.pause_stream_rep_success,function(e,t){if(e==i){var r={exporter_id:t};o.resolve(r),clearTimeout(l)}}),room.addCallback(ExporderCallBack.pause_stream_rep_error,function(e,t){t==i&&(o.reject(e),clearTimeout(l))}),o.promise},e.prototype.destroyExporter=function(e,t,r){var n=when.defer(),o=getRandomNum(2e3,8e3),i=this.cmdProtobufCoded.newOutgoingDestroyExporterReq(o,e,t,r),s=this.roomPduType.OUTGOING_DESTROY_EXPORTER_REQ,a=this.cmdProtobufCoded.encodedPacket(s,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(a);var c=setTimeout(function(){var e=new C(1e4,"destroyExporter time out");n.reject(e)},5e3);return room.addCallback(ExporderCallBack.stop_stream_rep_success,function(e,t){if(e==o){var r={exporter_id:t};n.resolve(r),clearTimeout(c)}}),room.addCallback(ExporderCallBack.stop_stream_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(c))}),n.promise},e.prototype.updateExporterStreamName=function(e){var r=when.defer(),n=getRandomNum(1e4,12e3),t=room.composePDUDeviceId(room.selfUser.id,e.id),o=this.cmdProtobufCoded.newRoomSetStreamNameReq(n,room.id,e.ownerId,t,e.streamName,e.streamNickName),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_SET_STREAM_NAME_REQ,0,room.selfUser.nodeId,0,o);this.signalingChannel.send(i),this.signalingChannel.send("");var s=setTimeout(function(){var e=new C(1e4,"updateExporterStreamName time out");r.reject(e)},5e3);return room.addCallback(UserCallback.room_set_stream_name_rep_success,function(e){e==n&&(r.resolve(),clearTimeout(s))}),room.addCallback(UserCallback.room_set_stream_name_rep_error,function(e,t){t==n&&(r.reject(e),clearTimeout(s))}),r.promise},e.prototype.outgoingExporterSetFocusVideo=function(e,t,r){var n=when.defer(),o=getRandomNum(1e4,12e3),i=this.cmdProtobufCoded.newOutgoingExporterSetFocusVideoReq(o,room.id,e,t,r),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_REQ,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s),this.signalingChannel.send("");var a=setTimeout(function(){var e=new C(1e4,"outgoingExporterSetFocusVideo time out");n.reject(e)},5e3);return room.addCallback(ExporderCallBack.set_focus_video_rep_success,function(e){e==o&&(n.resolve(),clearTimeout(a))}),room.addCallback(ExporderCallBack.set_focus_video_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(a))}),n.promise},e.prototype.outgoingGetExporterInfo=function(e,t,r){var n=when.defer(),o=getRandomNum(1e4,12e3),i=this.cmdProtobufCoded.newOutgoingGetExporterInfoReq(o,e,t,r);log.debug("=============outgoingGetExporterInfo(),outgoingGetExporterInfoReq:",i);var s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OUTGOING_GET_EXPORTER_INFO_REQ,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s),this.signalingChannel.send("");var a=setTimeout(function(){var e=new C(1e4,"outgoingGetExporterInfo time out");n.reject(e)},5e3);return room.addCallback(ExporderCallBack.get_exporter_info_rep_success,function(e,t,r){e==o&&(n.resolve(t,r),clearTimeout(a))}),room.addCallback(ExporderCallBack.get_exporter_info_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(a))}),n.promise},e}),ModuleBase.define("P2PServer",["TraceableP2PPeerConnection"],function(e){var t=function(){this.selfNodeIntervalId=null,this.traceableP2PPeerConnection=new e,room.traceableP2PPeerConnection=this.traceableP2PPeerConnection};function r(e){room.selfUser.nodeId<e&&(null!=this.selfNodeIntervalId&&(clearInterval(this.selfNodeIntervalId),this.selfNodeIntervalId=null),room.traceableP2PPeerConnection.getToP2PPeerConnection(e))}return t.prototype.createP2PPeerConnection=function(e){null!=room.selfUser&&null!=room.selfUser.nodeId?r(e):this.selfNodeIntervalId=setInterval(function(){null!=room.selfUser&&null!=room.selfUser.nodeId&&r(e)},200)},t});var log=log4javascript.getLogger(),room,rooms=[],browserDetect,videoCoding=VideoCodingType.VP8,audioCoding=AudioCodingType.ISAC_16k,audioAutoSub=!0,bugout=null,avdVersion="3.6.0.0";"safari"==adapter.browserDetails.browser&&(videoCoding=VideoCodingType.H264);var setRemoteDescriptionSuccess=!1,setRemoteDescriptionSuccessForFirefox=!1,addIcecandidateList=[],remoteSDPInit;function getFingerPrint(e){var t=null;console.log(e);for(var r=e.split("\r\n"),n=0;n<r.length;n++)if(-1<r[n].indexOf("a=fingerprint")){t=r[n].split(" ")[1];break}return console.log(t),t}function updateSDPFingerPrint(e,t){var r=preferLineSdp(e,"a=","fingerprint");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=fingerprint:sha-1 "+t)}return e}function updateSDPIceUfrag(e,t){var r=preferLineSdp(e,"a=","ice-ufrag");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=ice-ufrag:"+t)}return e}function updateSDPIcePwd(e,t){var r=preferLineSdp(e,"a=","ice-pwd");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=ice-pwd:"+t)}return e}function updateSDPSetup(e,t){var r=preferLineSdp(e,"a=","setup");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=setup:"+t)}return e}function preferLineSdp(e,t,r){var n=[],o=e.split("\r\n"),i=findLine(o,t,r);if(null!=i&&0<i.length)for(var s=0;s<i.length;s++)n.push(o[i[s]]);return n}function findLine(e,t,r){return findLineInRange(e,0,-1,t,r)}function findLineInRange(e,t,r,n,o){for(var i=[],s=-1!==r?r:e.length,a=t;a<s;++a)0===e[a].indexOf(n)&&(o&&-1===e[a].toLowerCase().indexOf(o.toLowerCase())||i.push(a));return i}function findLine1(e,t,r){return findLineInRange1(e,0,-1,t,r)}function findLineInRange1(e,t,r,n,o){for(var i=-1!==r?r:e.length,s=t;s<i;++s)if(0===e[s].indexOf(n)&&(!o||-1!==e[s].toLowerCase().indexOf(o.toLowerCase())))return s;return null}function preferBitRate(e,t,r){if(null==t||t<=0)return-1===e.indexOf("b=AS:")||(e=e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")),e;var n=e.split("\r\n"),o=findLine1(n,"m=",r);if(null===o)return trace("Failed to add bandwidth line to sdp, as no m-line found"),e;var i=findLineInRange1(n,o+1,-1,"m=");null===i&&(i=n.length);var s=findLineInRange1(n,o+1,i,"c=");if(null===s)return trace("Failed to add bandwidth line to sdp, as no c-line found"),e;var a=findLineInRange1(n,s+1,i,"b=AS");a&&n.splice(a,1);var c="b=AS:"+t;return n.splice(s+1,0,c),e=n.join("\r\n")}ModuleBase.define("AVDEngine",["Room","RestServer","Error","BrowserDetect","Record","Live","Outgoing","StreamExporterManager","ElectronManager","MqttManager","InviteManager"],function(t,s,a,c,r,n,o,e,i,l,d){var u=function(){this.accessToken,this.cameraMap={},this.microphoneMap={},this.speakerMap={},this.checkMicrophoneId=null,this.checkMicrophoneName=null,this.checkAudioStream=null,this.checkVideoStream=null,this.mcuClusterRouteParams=null,this.screenExtensionFlag="JH_SS_PING",this.checkExtensionFlags="",this.defaultVideoParamsWidth=640,this.defaultVideoParamsHeight=480,this.defaultVideoParamsResolutionSetType=ResolutionSetType.exact,this.defaultVideoParamsFrameRate=20,this.defaultVideoParamsMinBandwidth=500,this.defaultVideoParamsMaxBandwidth=800,this.defaultScreenParamsMaxWidth=1920,this.defaultScreenParamsMaxHeight=1080,this.defaultScreenParamsMinFrameRate=5,this.defaultScreenParamsMaxFrameRate=10,this.clientResource=new Object,this.applyToElectron=!1,this.electronProtocol="http:",this.electronManager=null;var e=new log4javascript.BrowserConsoleAppender;e.setThreshold(log4javascript.Level.ERROR),p(e),loggerReport=new LoggerReport};function p(e){var t=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n");e.setLayout(t),log.addAppender(e)}return u.prototype.getVersion=function(){return"cn.tee3.avd-"+avdVersion},u.prototype.setApplyToElectron=function(e,t){e&&(this.applyToElectron=e),t&&(this.electronProtocol=t)},u.prototype.getElectronManager=function(){return this.electronManager=new i,this.electronManager},u.prototype.getBrowserDetect=function(){return(new c).detect},u.prototype.checkBrowserSupport=function(){return(new c).checkBrowserSupport()},u.prototype.checkBrowserPluginSupport=function(){return(new c).checkBrowserPluginSupport()},u.prototype.setLog=function(e,t){var r;e==Appender.alert?r=new log4javascript.AlertAppender:e==Appender.inpage?r=new log4javascript.InPageAppender:e==Appender.popup?r=new log4javascript.PopUpAppender:e==Appender.browserConsole&&(r=new log4javascript.BrowserConsoleAppender),t==LogLevel.all?r.setThreshold(log4javascript.Level.ALL):t==LogLevel.trace?r.setThreshold(log4javascript.Level.TRACE):t==LogLevel.debug?r.setThreshold(log4javascript.Level.DEBUG):t==LogLevel.info?r.setThreshold(log4javascript.Level.INFO):t==LogLevel.warn?r.setThreshold(log4javascript.Level.WARN):t==LogLevel.error?r.setThreshold(log4javascript.Level.ERROR):t==LogLevel.fatal?r.setThreshold(log4javascript.Level.FATAL):t==LogLevel.off&&r.setThreshold(log4javascript.Level.OFF),p(r)},u.prototype.setBugout=function(e){(bugout=new debugout).realTimeLoggingOn=!1,bugout.useTimestamps=!0,e&&(bugout.logFilename=e)},u.prototype.setVideoCoding=function(e){videoCoding=e,loggerReport.info("设置视频编解码:"+videoCoding)},u.prototype.getVideoCoding=function(){return videoCoding},u.prototype.setAudioCoding=function(e){audioCoding=e,loggerReport.info("设置音频编解码:"+audioCoding)},u.prototype.getAudioCoding=function(){return audioCoding},u.prototype.setAudioAutoSub=function(e){audioAutoSub=e,loggerReport.info("设置音频自动订阅:"+e)},u.prototype.getAudioAutoSub=function(){return audioAutoSub},u.prototype.getResolutionEnum=function(){var e=when.defer();return e.resolve(Resolution),e.promise},u.prototype.setMcuClusterRouteParams=function(e){this.mcuClusterRouteParams=e},u.prototype.setDefaultVideoParams=function(e,t,r,n,o,i){e&&(this.defaultVideoParamsWidth=e),t&&(this.defaultVideoParamsHeight=t),r&&(this.defaultVideoParamsResolutionSetType=r),n&&(this.defaultVideoParamsFrameRate=n),o&&(this.defaultVideoParamsMinBandwidth=o),i&&(this.defaultVideoParamsMaxBandwidth=i),loggerReport.info("设置视频相关的默认参数值===分辨率宽:"+e+",分辨率高:"+t+",分辨率设置类型:"+r+",视频帧率:"+n+",最小码流:"+o+",最大码流:"+i)},u.prototype.setDefaultScreenParams=function(e,t,r,n){e&&(this.defaultScreenParamsMaxWidth=e),t&&(this.defaultScreenParamsMaxHeight=t),r&&(this.defaultScreenParamsMinFrameRate=r),n&&(this.defaultScreenParamsMaxFrameRate=n),loggerReport.info("设置桌面共享相关的默认参数值===分辨率最大宽度:"+e+",分辨率最大高度:"+t+",视频最小帧率:"+r+",视频最大帧率:"+n)},u.prototype.setScreenExtensionFlag=function(e){this.screenExtensionFlag=e,window.postMessage({type:"CHECKID",text:"checkId"},"*")},u.prototype.init=function(e,t){var n=when.defer();log.info("AVDEngine init begin"),loggerReport.info("AVDEngine init begin");var o=this;if(!t||!e){var r=new a(ErrorConstant.avdEngine_init_failed);return n.reject(r),n.promise}browserDetect=new c;var i=null;return i=this.applyToElectron?new s(this.electronProtocol):new s,this.accessToken=t.replace(/%3D%3D/g,"=="),this.accessToken=this.accessToken.replace(/%3d%3d/g,"=="),i.getServerinfo(e,t).then(function(){loggerReportConfig.open_logger&&1==parseInt(loggerReportConfig.open_logger)&&loggerReport.start(),loggerReport.info("引擎初始化成功！");var e=o.getVersion();loggerReport.info("JS SDK 版本号："+e);var t=o.getBrowserDetect();if(loggerReport.info("浏览器内核名称："+t.browser.name+",内核版本:"+t.browser.fullVersion+",操作系统名称:"+t.osName),loggerReport.info("默认视频编解码:"+videoCoding),loggerReport.info("默认音频编解码:"+audioCoding),o.clientResource.os=t.osName,o.clientResource.endpoint=t.browser.name+"/"+t.browser.fullVersion,t.browser.is3Tee&&(o.clientResource.endpointShell=t.browser.shellName+"/"+t.browser.shellFullVersion),void 0!==navigator.Promise&&getLocalClientIP().then(function(e){console.log("===========localClientIP:",e),o.clientResource.ips=e}),void 0!==navigator.connection){var r=getEffectiveType();console.log("===========effectiveType:",r),o.clientResource.net=r}n.resolve()}).otherwise(function(e){if(loggerReport.error("引擎初始化失败！error:"+e.message),e)n.reject(e);else{var t=new a(ErrorConstant.avdEngine_init_failed);n.reject(t)}}),n.promise},u.prototype.initWithOEM=function(e,t){var r=when.defer();if(log.info("AVDEngine OEM  init begin"),"qiniu.com"!=t){var n=new a(ErrorConstant.oemname_notfound);r.reject(n)}else browserDetect=new c,roomServerUrl=mcuServerUrl=e,is_cluster=!0,r.resolve();return r.promise},u.prototype.obtainRoom=function(e){return null==(room=function(e){for(var t=null,r=0;r<rooms.length;r++){var n=rooms[r];if(n.roomId==e){t=n;break}}return t}(e))&&((room=new t(e)).avdEngine=this,rooms.push(room)),"Android"==room.avdEngine.getBrowserDetect().osName&&(room.userAgent=USER_AGENT_AVD_VIDEO_TRANSCODING),room},u.prototype.getAllDevices=function(){var t=when.defer();if(void 0!==navigator.mediaDevices)log.debug("====================getAllDevices():navigator.mediaDevices.enumerateDevices()"),navigator.mediaDevices.enumerateDevices().then(function(e){t.resolve(e)});else if("undefined"!=typeof MediaStreamTrack)log.debug("====================getAllDevices():MediaStreamTrack.getSources"),MediaStreamTrack.getSources(function(e){t.resolve(e)});else{var e=new a(ErrorConstant.not_support_mediaStreamTrack);t.reject(e)}return t.promise},u.prototype.initDevice=function(){var v=when.defer(),y=this;return log.info("initDevice:Camera and Microphone begin"),this.getAllDevices().then(function(e){for(var t={},r=0,n={},o=0,i=null,s={},a=0,c=null,l=0;l!=e.length;++l){var d=e[l],u=d.deviceId||d.id;"videoinput"===d.kind||"video"===d.kind?(r+=1,t[u]=d.label||"camera"+r):"audioinput"===d.kind||"audio"===d.kind?"default"==d.deviceId?(o+=1,n[u]=d.label||"microphone"+o,i=d.groupId):d.groupId!=i&&(o+=1,n[u]=d.label||"microphone"+o):"audiooutput"===d.kind&&("default"==d.deviceId?(a+=1,s[u]=d.label||"speaker"+a,c=d.groupId):d.groupId!=c&&(a+=1,s[u]=d.label||"speaker"+a))}for(var p in y.cameraMap=t,log.debug("initDevice Camera finish!cameraMap:",t),y.clientResource.cameras=[],t){var f=t[p],h=new Object;h.id=p,h.name=f,y.clientResource.cameras.push(h)}for(var p in y.microphoneMap=n){f=n[p];y.checkMicrophoneId=p,y.checkMicrophoneName=f;break}for(var p in log.debug("initDevice Microphone finish!microphoneMap:",n),y.clientResource.microphones=[],n){f=n[p];var m=new Object;m.id=p,m.name=f,y.clientResource.microphones.push(m)}for(var p in y.speakerMap=s,log.debug("initDevice Speaker finish!speakerMap:",s),y.clientResource.speakers=[],s){f=s[p];var g=new Object;g.id=p,g.name=f,y.clientResource.speakers.push(g)}v.resolve(1)}).otherwise(function(e){if(e)v.reject(e);else{var t=new a(ErrorConstant.avdEngine_init_failed);v.reject(t)}}),v.promise},u.prototype.refreshDevice=function(){var e=when.defer(),h=this,m=[];for(key in h.microphoneMap)m.push(key);var g=[];for(key in h.cameraMap)g.push(key);return this.getAllDevices().then(function(e){for(var t={},r=0,n={},o=0,i=null,s={},a=0,c=null,l=0;l!=e.length;++l){var d=e[l],u=d.deviceId||d.id;"videoinput"===d.kind||"video"===d.kind?(r+=1,t[u]=d.label||"camera"+r):"audioinput"===d.kind||"audio"===d.kind?"default"==d.deviceId?(o+=1,n[u]=d.label||"microphone"+o,i=d.groupId):d.groupId!=i&&(o+=1,n[u]=d.label||"microphone"+o):"audiooutput"===d.kind&&("default"==d.deviceId?(a+=1,s[u]=d.label||"speaker"+a,c=d.groupId):d.groupId!=c&&(a+=1,s[u]=d.label||"speaker"+a))}for(var p in function(e,t,r,n){var o=[];for(var i in t)o.push(i);var s=arrayUtil.inANotInB(o,e),a=arrayUtil.inANotInB(e,o);if(0==a.length&&0==s.length)return;{if("safari"==adapter.browserDetails.browser)return;for(var c=0;c<r.length;c++){var l=r[c];if(null!=l.selfUser){if(0<s.length)for(var d=0;d<s.length;d++){var u=t[s[d]];n[s[d]]=u,l.selfUser.initVideo(s[d],u)}if(0<a.length)for(var d=0;d<a.length;d++)delete n[a[d]],l.selfUser.deleteVideo(a[d])}}}}(g,t,this.rooms,h.cameraMap),n){var f=n[p];h.checkMicrophoneId=p,h.checkMicrophoneName=f;break}!function(e,t,r,n){var o=[];for(var i in t)o.push(i);var s=arrayUtil.inANotInB(o,e),a=arrayUtil.inANotInB(e,o);if(0==a.length&&0==s.length)return;for(var c=0;c<this.rooms.length;c++){var l=r[c];if(null!=l.selfUser){if(0<s.length)for(var d=0;d<s.length;d++){var u=t[s[d]];n[s[d]]=u}if(0<a.length)for(var d=0;d<a.length;d++){var u=n[a[d]];a[d]==self.checkMicrophoneId&&l.selfUser.deleteAudio(a[d]),delete n[a[d]]}}}}(m,n,this.rooms,h.microphoneMap),h.speakerMap=s}).otherwise(function(e){log.info("get device error!error code:"+e.code+"; error message:"+e.message)}),setTimeout(function(){e.resolve()},2e3),e.promise},u.prototype.setRecordingMicrophone=function(t){var r=this,n=room.selfUser.audio;if(null==n){var e=r.microphoneMap[t];room.selfUser.initAudio(t,e)}else if(t!=n.id)if(n.status==StreamStatus.init){room.selfUser.deleteAudio(n.id);e=r.microphoneMap[t];room.selfUser.initAudio(t,e)}else if(n.status==StreamStatus.published){var o=n.element;n.closeMicrophone(),setTimeout(function(){room.selfUser.deleteAudio(n.id);var e=r.microphoneMap[t];room.selfUser.initAudio(t,e),room.selfUser.audio.openMicrophone(o)},500)}},u.prototype.getDeviceObject=function(){var f=when.defer();return log.info("getDeviceObject begin"),this.getAllDevices().then(function(e){for(var t={video:null,audio:null,speaker:null},r={},n=0,o={},i=0,s=null,a={},c=0,l=null,d=0;d!=e.length;++d){var u=e[d],p=u.deviceId||u.id;"videoinput"===u.kind||"video"===u.kind?(n+=1,r[p]=u.label||"camera"+n):"audioinput"===u.kind||"audio"===u.kind?"default"==u.deviceId?(i+=1,o[p]=u.label||"microphone"+i,s=u.groupId):u.groupId!=s&&(i+=1,o[p]=u.label||"microphone"+i):"audiooutput"===u.kind&&("default"==u.deviceId?(c+=1,a[p]=u.label||"speaker"+c,l=u.groupId):u.groupId!=l&&(c+=1,a[p]=u.label||"speaker"+c))}t.video=r,t.audio=o,t.speaker=a,f.resolve(t)}).otherwise(function(e){f.reject(e)}),f.promise},u.prototype.checkDevice=function(){var o=when.defer();return this.getAllDevices().then(function(e){for(var t={video:!1,audio:!1,speaker:!1},r=0;r!=e.length;++r){var n=e[r];n.deviceId||n.id;"videoinput"===n.kind||"video"===n.kind?t.video=!0:"audioinput"===n.kind||"audio"===n.kind?t.audio=!0:"audiooutput"===n.kind&&(t.speaker=!0)}o.resolve(t)}).otherwise(function(e){o.reject(e)}),o.promise},u.prototype.checkOpenVideo=function(e,t,r){var n=when.defer(),o=this,i={video:{},audio:!1};if(e&&(i.video.deviceId={exact:e}),t){var s=Resolution[t];i.video.width={},i.video.height={},i.video.width.min=s.width,i.video.height.min=s.height,i.video.width.max=s.width,i.video.height.max=s.height}r&&"safari"!=adapter.browserDetails.browser&&"firefox"!=adapter.browserDetails.browser&&("string"==typeof r&&(r=Number(r)),i.video.frameRate={},i.video.frameRate.min=r,i.video.frameRate.max=r);try{navigator.mediaDevices.getUserMedia(i).then(function(e){o.checkVideoStream=e,n.resolve(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),n.reject(t)})}catch(e){var a=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);n.reject(a)}return n.promise},u.prototype.checkOpenAudio=function(e){var n=when.defer(),t=this,r={video:!1,audio:!0};e&&(r.audio.deviceId={exact:e});try{navigator.mediaDevices.getUserMedia(r).then(function(e){t.checkAudioStream=e,n.resolve(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),n.reject(t)})}catch(e){var o=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);n.reject(o)}return n.promise},u.prototype.checkOpenVideoAndAudio=function(e,t,r,n){var a=when.defer(),c=this,o={video:!0,audio:!0};if(e&&(o.video.deviceId={exact:e}),t&&(o.audio.deviceId={exact:t}),r){var i=Resolution[r];o.video.width={},o.video.height={},o.video.width.min=i.width,o.video.height.min=i.height,o.video.width.max=i.width,o.video.height.max=i.height}n&&"safari"!=adapter.browserDetails.browser&&"firefox"!=adapter.browserDetails.browser&&("string"==typeof n&&(n=Number(n)),o.video.frameRate={},o.video.frameRate.min=n,o.video.frameRate.max=n);try{navigator.mediaDevices.getUserMedia(o).then(function(e){var t=new MediaStream,r=new MediaStream;if(e){for(var n=e.getAudioTracks(),o=0;o<n.length;o++)t.addTrack(n[o]);var i=e.getVideoTracks();for(o=0;o<i.length;o++)r.addTrack(i[o])}var s={audioStream:t,videoStream:r};c.checkVideoStream=s.videoStream,c.checkAudioStream=s.audioStream,a.resolve(s)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),a.reject(t)})}catch(e){var s=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);a.reject(s)}return a.promise},u.prototype.checkCloseVideo=function(){this.checkVideoStream&&this.checkVideoStream.getTracks().forEach(function(e){e.stop()}),this.checkVideoStream=null},u.prototype.checkCloseAudio=function(){this.checkAudioStream&&this.checkAudioStream.getTracks().forEach(function(e){e.stop()}),this.checkAudioStream=null},u.prototype.obtainRecord=function(e){return new r(e)},u.prototype.obtainLive=function(e){return new n(e)},u.prototype.obtainOutgoing=function(e){return new o(e)},u.prototype.getStreamExporterManager=function(){return new e},u}),ModuleBase.define("Room",["SignalFactory","RestServer","MasterServer","P2PServer","User","Error"],function(a,i,r,n,s,l){var e=function(e){this.id=e,this.roomTocken=null,this.signalTocken=null,this.outgoingAddr=null,this.userAgent=USER_AGENT_AVD_DEFAULT,this.pingTimeout,this.pingInterval,this.pingCountTime=0,this.pingIntervalId=null,this.pingTimeoutId=null,this.webocketStatusIntervalId=null,this.lastPDUSeq=0,this.roomInfo=null,this.status=RoomStatus.opening,this.appData={},this.selfUser=null,this.participants=[],this.muteSpeakerFlag=!1,this.avdEngine=null,this.masterServer=null,this.p2pServer=null,this.cmdProtobufCoded=null,this.traceablePeerConnection=null,this.traceableP2PPeerConnection=null,this.eventEmitter=new EventEmitter,this.iceUfragLocal,this.icePwdLocal,this.iceUfragLocal2,this.icePwdLocal2,this.fingerPrint,this.iceUfrag,this.icePwd,this.setup,this.sdp=null,this.iceUfragForFirefox,this.icePwdForFirefox,this.sdpForFirefox=null,this.connectionInfoCollector=null,this.audioLevel=null,this.connectionStatistics=null,this.baselineReconnectionTime,this.reconnectionTime,this.reconnectionCount=0,this.reconnectionState=!1,this.reconnectionOpenRep402=!1,this.toMCUReconnectionPC=null,this.toMCUReconnectionPCForFirefox=null,this.reJoinRoomTimeOutCount=3,this.reJoinRoomCount=0,this.reJoinAfterTimer=null,this.reJoinAfterUsers=[],this.pubVideos=[],this.pubAudios=[],this.pubScreens=[],this.baselineJoinTime=null,this.joinTimeoutIntervalId=null,this.joinTimeout=1e4,this.joinTimeoutState=!1,this.currMinBandwidth=null,this.currMaxBandwidth=null,this.currScreenMinBandwidth=2400,this.currScreenMaxBandwidth=3200,this.videoSsrc2user={},this.audioSsrc2user={},this.screenSsrc2user={},this.videoSsrc2deviceId={},this.addSdpLocalStates=0,this.boardId2userId={},this.annotation2boardId={},this.isDoPDUSeq=0,this.codecPayloadVP8=null,this.codecPayloadVP9=null,this.codecPayloadH264=null,this.codecPayloadOpus=null,this.codecPayloadISAC_16K=null,this.codecPayloadISAC_32K=null,this.codecPayloadG722=null,this.codecPayloadPCMU=null,this.codecPayloadPCMA=null,this.localFirefoxSDP,this.localFirefoxSecondSDP,this.fakeVideoStreams=[],this.fakeAudioStreams=[],this.localVideoMsids=0,this.localAudioMsids=0,this.localAddFakeVideoStreams=[],this.localAddFakeAudioStreams=[],this.videoSsrc=null,this.audioSsrc=null,this.updateTimer=null};function t(){clearInterval(this.statsIntervalId),this.statsIntervalId=setInterval(function(){var t={},e=0,r="",n=room.getParticipants(),o=room.getAppData(appDataKeyEnum.lecturer)?room.getAppData(appDataKeyEnum.lecturer):"",i=0;for(var s in n.forEach(function(e){e.audio&&(t[e.id]=e.audio.getAudioLevel())}),t)try{var a=t[s];s==o&&(i=a),e<a&&(e=a,r=s)}catch(e){log.error(e)}o!=r&&i<4&&3<=e-i&&(log.debug("发送更改语音激励通知，语音激励id为"+r+"--值为"+e),room.updateAppData(appDataKeyEnum.lecturer,r))},3e3)}function c(e){log.info("============openReqSend(websocket)===========");var t=when.defer();return room.p2pServer=new n,room.masterServer=new r(e),room.masterServer.openReqSend(),room.addCallback(EngineCallback.room_join_success,function(e){t.resolve(e)}),room.addCallback(EngineCallback.room_join_error,function(e){t.reject(e)}),t.promise}return e.prototype.setUserAgent=function(e){this.userAgent=e},e.prototype.join=function(e,t,r){var n=when.defer();is_cluster?(loggerReport.info("服务器是集群版本"),(new i).getMcu(room.id,room.avdEngine.accessToken).then(function(){room.doJoin(e,t,r,"",n)}).otherwise(function(e){n.reject(e)})):(loggerReport.info("服务器是单机版本"),room.doJoin(e,t,r,"",n));if(!room.isMcu()){var o=doFsCheck(FTConstant.p2p,l);if(null!=o)return n.reject(o),n.promise}return n.promise},e.prototype.joinWithOEM=function(e,t,r,n){var o=when.defer();return(new i).getMcuWithOEM(room.id,n).then(function(){room.doJoin(e,t,r,"",o)}).otherwise(function(e){o.reject(e)}),o.promise},e.prototype.doJoin=function(e,t,r,n,o){if(null==e||""==e){var i=new l(ErrorConstant.userId_required);o.reject(i)}else if(0<e.indexOf("_")){i=new l(ErrorConstant.userId_format);o.reject(i)}else{null==room.baselineJoinTime&&(room.baselineJoinTime=new Date),room.joinTimeoutIntervalId=setInterval(function(){if(new Date-room.baselineJoinTime>=room.joinTimeout){room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null),room.joinTimeoutState=!0,log.error("登录加会超时："+ErrorConstant.join_room_timeout.code),loggerReport.error("登录加会超时.");var e=new l(ErrorConstant.join_room_timeout);o.reject(e)}},500),this.selfUser=new s(e,t,r,n),this.selfUser.userAgent=this.userAgent,(new a).getDataChannel(SignalType.websocket).connect().then(c).then(function(e){log.debug("==========doJoin websokcet(one) success========"),e.joinTimeoutIntervalId&&(clearInterval(e.joinTimeoutIntervalId),e.joinTimeoutIntervalId=null,e.baselineJoinTime=null),o.resolve(e)}).otherwise(function(e){log.debug("==========doJoin websokcet(one) error========"),room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null,room.masterServer.pingInit()),o.reject(e)})}room.addCallback(EngineCallback.room_join_websocket_reconnection_success,function(e){c(e).then(function(e){log.debug("==========doJoin websokcet(reconnection) success========"),e.joinTimeoutIntervalId&&(clearInterval(e.joinTimeoutIntervalId),e.joinTimeoutIntervalId=null,e.baselineJoinTime=null),o.resolve(e)}).otherwise(function(e){log.debug("==========doJoin websokcet(reconnection) error========"),room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null,room.masterServer.pingInit()),o.reject(e)})})},e.prototype.reJoin=function(){if(room.isDoPDUSeq=0,this.selfUser.reJoinPubVideoIds&&0<this.selfUser.reJoinPubVideoIds.length);else{this.selfUser.reJoinPubVideoIds=[],this.selfUser.reJoinPubVideoElements=[];var e=this.pubVideos;if(null!=e&&0<e.length){log.debug("402后，重新加会，初始化videos之前先把自己pub的视频unpub掉，room.pubVideos.length:"+e.length);for(var t=0;t<e.length;t++)if(e[t].ownerId==this.selfUser.id){log.debug("402后，重新加会，初始化videos之前先把自己pub的视频unpub掉,selfUser.video.id:"+e[t].id);var r=this.selfUser.getVideo(e[t].id);this.selfUser.reJoinPubVideoIds.push(e[t].id),this.selfUser.reJoinPubVideoElements.push(r.element),r.unpublish()}}}if(this.selfUser.reJoinPubAudioId&&""!=this.selfUser.reJoinPubAudioId);else{this.selfUser.reJoinPubAudioId="";var n=this.pubAudios;if(null!=n&&0<n.length){log.debug("402后，重新加会，初始化audio之前先把自己pub的视频unpub掉,room.pubAudios.length:"+n.length);for(t=0;t<n.length;t++)if(n[t].ownerId==this.selfUser.id){log.debug("402后，重新加会，初始化audio之前先把自己pub的视频unpub掉,selfUser.audio.id:"+n[t].id);var o=this.selfUser.getAudio(n[t].id);this.selfUser.reJoinPubAudioId=n[t].id,o.closeMicrophone()}}}clearTimeout(room.reJoinAfterTimer),room.reJoinAfterUsers=[],this.selfUser.reJoinSubVideoIds||(this.selfUser.reJoinSubVideoIds=this.selfUser.subVideoIds),this.selfUser.reJoinSubAudioIds||(this.selfUser.reJoinSubAudioIds=this.selfUser.subAudioIds),this.selfUser.reJoinSubScreenIds||(this.selfUser.reJoinSubScreenIds=this.selfUser.subScreenIds);var i=this.pubScreens;if(null!=i&&0<i.length){log.debug("402后，重新加会，初始化screen之前先把自己pub的桌面共享unpub掉,room.pubScreens.length:"+i.length);for(t=0;t<i.length;t++){if(i[t].ownerId==this.selfUser.id)log.debug("402后，重新加会，初始化audio之前先把自己pub的桌面共享unpub掉,selfUser.screen.id:"+i[t].id),this.selfUser.getScreen(i[t].id).unpublish()}}if(null!=this.selfUser&&(null!=this.selfUser.toMCUPC&&(this.selfUser.toMCUPC.close(),this.selfUser.toMCUPC=null),null!=this.selfUser.toMCUPCForFirefox&&"firefox"==adapter.browserDetails.browser&&(this.selfUser.toMCUPCForFirefox.close(),this.selfUser.toMCUPCForFirefox=null)),this.selfUser.init(),!(room.reJoinRoomCount<room.reJoinRoomTimeOutCount))return log.info("网络故障,重新加会失败。超出预设的重新加会次数。"),loggerReport.error("网络故障,重新加会失败，超出预设的重新加会次数。"),void room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reJoinRoomTimeOut);room.reJoinRoomCount++,log.info("第"+this.reJoinRoomCount+"次重新加会。"),loggerReport.info("第"+this.reJoinRoomCount+"次重新加会。");var s=when.defer();return room.traceablePeerConnection.close(this.toMCUReconnectionPC),this.toMCUReconnectionPC=null,"firefox"==adapter.browserDetails.browser&&(room.traceablePeerConnection.close(this.toMCUReconnectionPCForFirefox),this.toMCUReconnectionPCForFirefox=null),room.webocketStatusIntervalId=setInterval(function(){room.masterServer.signalingChannel.readyState==WebSocket.CLOSING||room.masterServer.signalingChannel.readyState==WebSocket.CLOSED?(clearInterval(room.webocketStatusIntervalId),room.webocketStatusIntervalId=null,(new a).getDataChannel(SignalType.websocket).connect().then(c).then(function(e){room.pingTimeout=e.pingTimeout,room.pingInterval=e.pingInterval,room.signalTocken=e.signalTocken,room.masterServer=e.masterServer,s.resolve(room)}).otherwise(function(e){s.reject(e)})):room.masterServer.signalingChannel.close()},500),s.promise},e.prototype.continuousReJoin=function(){(this.reconnectionCount=0,this.reconnectionState=!1,this.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,addIcecandidateList=[],this.reJoinRoomCount=0,this.reJoinAfterTimer=null,this.reJoinAfterUsers=[],is_cluster)?(new i).getMcu(room.id,room.avdEngine.accessToken).then(function(){room.reJoin()}).otherwise(function(e){room.reJoin()}):room.reJoin()},e.prototype.reconnectionHandle=function(){var e=new Date;(0==this.reconnectionCount&&(this.baselineReconnectionTime=e),e-this.baselineReconnectionTime>this.pingTimeout-3*this.pingInterval)?(log.info("========与服务器重连超时，进行重新加会操作========="),loggerReport.info("网络故障,与服务器重连超时，进行重新加会操作."),this.reconnectionCount=0,this.reconnectionState=!1,this.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,addIcecandidateList=[],this.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),is_cluster?room.getMcuByReJoin():room.reJoin()):(this.reconnectionState=!0,this.reconnectionCount+=1,log.info("与服务器第"+this.reconnectionCount+"次重连。"),loggerReport.info("与服务器第"+this.reconnectionCount+"次重连。"),(new a).getDataChannel(SignalType.websocket).connect().then(function(e){null!=room.joinTimeoutIntervalId?(log.info("=========重连时,websocket重连成功======="),room.reconnectionState=!1,room.reconnectionCount=0,room.eventEmitter.emit(EngineCallback.room_join_websocket_reconnection_success,e)):(log.debug("=========房间网络科动时,websocket重连成功======="),room.reconnectionCount=0,room.joinTimeoutState=!1,room.masterServer.pingInit(),room.masterServer.signalingChannel=e,room.masterServer.openReqReconnectionSend())}))},e.prototype.getMcuByReJoin=function(){var e=when.defer();return(new i).getMcu(room.id,room.avdEngine.accessToken).then(function(){log.debug("=============getMcuByReJoin(),success"),room.reJoin()}).otherwise(function(e){log.debug("=============getMcuByReJoin(),code:"+e.code+",message:"+e.message),room.reJoin()}),e.promise},e.prototype.getRoomId=function(){return room.roomInfo.room_id},e.prototype.getRoomTopic=function(){return room.roomInfo.topic},e.prototype.getOwnerId=function(){return room.roomInfo.owner_id},e.prototype.isMcu=function(){var e=!0;if(null==room.roomInfo)return e;var t=room.roomInfo.room_mode;return 3!=t&&4!=t||(e=!1),e},e.prototype.getRoomType=function(e){var t=!1;if(room.roomInfo&&room.roomInfo.room_type){var r=room.roomInfo.room_type.toString(2);e==RoomTypeEnum.join_host_first?t=room.isHasPrivilige(roomTypePrivilige.join_host_first,r):e==RoomTypeEnum.net_acc?t=room.isHasPrivilige(roomTypePrivilige.net_acc,r):e==RoomTypeEnum.host_control?t=room.isHasPrivilige(roomTypePrivilige.host_control,r):e==RoomTypeEnum.free_speech&&(t=!room.isHasPrivilige(roomTypePrivilige.host_control,r))}return t},e.prototype.isHasPrivilige=function(e,t){var r=!1;return 0<(e&t)&&(r=!0),r},e.prototype.getMaxAudio=function(){return room.roomInfo.max_audio},e.prototype.getMaxVideo=function(){return room.roomInfo.max_video},e.prototype.getMaxAttendee=function(){return room.roomInfo.attendee_max},e.prototype.getUsableVideo=function(){var e=this.getMaxVideo()-this.pubVideos.length;return e<0&&(e=0),e},e.prototype.getUsableAudio=function(){var e=this.getMaxAudio()-this.pubAudios.length;return e<0&&(e=0),e},e.prototype.updateRoomStatus=function(e){this.status=e},e.prototype.getRoomStatus=function(){return this.status},e.prototype.getSelfUser=function(){return room.selfUser},e.prototype.getSelfUserId=function(){return room.selfUser.id},e.prototype.getParticipants=function(){return this.participants},e.prototype.getUser=function(e){for(var t,r=0;r<this.participants.length;r++){var n=this.participants[r];if(n.id==e){t=n;break}}return t},e.prototype.hasUser=function(e){for(var t=!1,r=0;r<this.participants.length;r++){if(this.participants[r].id==e){t=!0;break}}return t},e.prototype.localICERestart=function(){log.info("PeerConnection createOffer ICE Restart");room.selfUser.toMCUPC.createOffer({iceRestart:!0}).then(function(e){return e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),log.debug("====room.localICERestart(),LocalDescription:"+e.sdp),room.selfUser.toMCUPC.setLocalDescription(e)})},e.prototype.remoteICERestart=function(e){e.candidate&&(console.log("==========room.remoteICERestart(),candidate:"+e.candidate),room.masterServer.traceablePeerConnection.doAddIceCandidate(e),room.localICERestart())},e.prototype.getPublishedCameraCount=function(){return this.pubVideos.length},e.prototype.getPublishedCamera=function(){return this.pubVideos},e.prototype.getPublishedScreenCount=function(){return this.pubScreens.length},e.prototype.getPublishedScreen=function(){return this.pubScreens},e.prototype.addUser=function(e){this.hasUser(e.id)||this.participants.push(e)},e.prototype.removeUser=function(e){null!=this.participants&&0<this.participants.length&&arrayUtil.objectSplice(this.participants,e)},e.prototype.getUserByNodeId=function(e){for(var t,r=0;r<this.participants.length;r++){var n=this.participants[r];if(n.nodeId==e){t=n;break}}return t},e.prototype.getNodeId=function(e){var t=null,r=this.getUser(e);return null!=r&&(t=r.nodeId),t},e.prototype.getUserId=function(e){var t=null,r=this.getUserByNodeId(e);return null!=r&&(t=r.id),t},e.prototype.sendPublicMessage=function(e){var t=when.defer(),r=doFsCheck(FTConstant.chat,l);return null==r?(this.masterServer.sendMessage(e),t.resolve()):t.reject(r),t.promise},e.prototype.sendPrivateMessage=function(e,t){var r=when.defer(),n=doFsCheck(FTConstant.chat,l);return null==n?(this.masterServer.sendMessage(e,t),r.resolve()):r.reject(n),r.promise},e.prototype.sendPublicData=function(e){var t=when.defer(),r=doFsCheck(FTConstant.datachannel,l);return null==r?(this.masterServer.sendData(e),t.resolve()):t.reject(r),t.promise},e.prototype.sendPrivateData=function(e,t){var r=when.defer(),n=doFsCheck(FTConstant.datachannel,l);return null==n?(this.masterServer.sendData(e,t),r.resolve()):r.reject(n),r.promise},e.prototype.updateAppData=function(e,t){this.appData[e]=t,this.masterServer.roomDataInfo(e,t)},e.prototype.getAppData=function(e){return void 0===e||null==e||""==e?this.appData:this.appData[e]},e.prototype.setCameraResolutionOrFrameRate=function(e,t,r,n,o){var i=when.defer();if(640<parseInt(t)&&null!=(a=doFsCheck(FTConstant.video_hd,l)))return i.reject(a),i.promise;var s=room.selfUser.getVideo(e);if(null!=s)"string"==typeof r&&(r=Number(r)),"string"==typeof o&&(o=Number(o)),s.resolution==Resolution[t]&&s.setType==n&&s.frameRate==r&&s.aspectRatio==o||(s.setResolution(t,n),s.setFrameRate(r),s.setAspectRatio(o),null!=s.track&&s.applyConstraints(),i.resolve());else{var a=new l(ErrorConstant.cameraId_does_not_exist);i.reject(a)}return i.promise},e.prototype.setCameraResolutionWHOrFrameRate=function(e,t,r,n,o,i){var s=when.defer();if(640<parseInt(t)&&null!=(c=doFsCheck(FTConstant.video_hd,l)))return s.reject(c),s.promise;var a=room.selfUser.getVideo(e);if(null!=a)"string"==typeof n&&(n=Number(n)),"string"==typeof i&&(i=Number(i)),void 0===a.resolution?(a.setResolutionWH(t,r,o),a.setFrameRate(n),s.resolve()):a.resolution.width==t&&a.resolution.height==r&&a.setType==o&&a.frameRate==n&&a.aspectRatio==i||(a.setResolutionWH(t,r,o),a.setFrameRate(n),a.setAspectRatio(i),null!=a.track&&a.applyConstraints(),s.resolve());else{var c=new l(ErrorConstant.cameraId_does_not_exist);s.reject(c)}return s.promise},e.prototype.muteSpeaker=function(){this.muteSpeakerFlag=!0,this.participants.forEach(function(e){if(e.id!=room.selfUser.id){var t=e.audio.track;null!=t&&(t.enabled=!1)}})},e.prototype.unmuteSpeaker=function(){this.muteSpeakerFlag=!1,this.participants.forEach(function(e){if(e.id!=room.selfUser.id){var t=e.audio.track;null!=t&&(t.enabled=!0)}})},e.prototype.ismuteSpeaker=function(){return this.muteSpeakerFlag},e.prototype.hasObject=function(e,t){console.log(t),console.log(e);for(var r=!1,n=0;n<e.length;n++){var o=e[n];if(o.id==t.id&&o.ownerId==t.ownerId){r=!0;break}}return r},e.prototype.kickoffUser=function(e,t){this.masterServer.userIndiction(e,t)},e.prototype.leave=function(e,t){var r=when.defer();this.userClearInfo();var n=this;return setTimeout(function(){n.masterServer.userMsg(e,t),null!=room&&(room.masterServer.signalingChannel.close(),room=null),r.resolve()},1e3),r.promise},e.prototype.userClearInfo=function(){var e=room.selfUser.videos;if(null!=e&&0<e.length)for(key in e){var t=e[key];t.status==StreamStatus.published&&(t.unpreview(),t.unpublish())}var r=room.selfUser.audio;null!=r&&r.status==StreamStatus.published&&r.closeMicrophone();var n=room.selfUser.screen;null!=n&&n.status==StreamStatus.published&&n.unpublish(),null!=this.pingIntervalId&&(clearInterval(this.pingIntervalId),this.pingIntervalId=null),null!=this.pingTimeoutId&&(clearInterval(this.pingTimeoutId),this.pingTimeoutId=null),null!=this.selfUser.changePublishVideoQualityInterval&&(clearInterval(this.selfUser.changePublishVideoQualityInterval),this.selfUser.changePublishVideoQualityInterval=null),null!=this.selfUser&&(null!=this.selfUser.toMCUPC&&this.selfUser.toMCUPC.close(),null!=this.selfUser.toMCUPCForFirefox&&"firefox"==adapter.browserDetails.browser&&this.selfUser.toMCUPCForFirefox.close()),setRemoteDescriptionSuccessForFirefox=setRemoteDescriptionSuccess=!1,addIcecandidateList=[]},e.prototype.closeRoom=function(e){this.userClearInfo(),this.masterServer.closeRoom(e)},e.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},e.prototype.getRoomControl=function(){return this.roomControl},e.prototype.setRoomControl=function(e){this.masterServer.setRoomControl(this.id,e)},e.prototype.composePDUDeviceId=function(e,t){return e+"_"+t},e.prototype.splitPDUDeviceId=function(e){return e.split("_")[1]},e.prototype.splitUserId=function(e){return e.split("_")[0]},e.prototype.calInitVideoBitrate=function(e,t){var r=e*t,n=Math.sqrt(r),o=Math.log10(r),i=Math.log10(n),s=Math.pow(i,2);return 2*parseInt(8*(o*n/s/10))},e.prototype.sendAddAnnotation=function(e,t,r,n,o,i,s){log.info("send AddAnnotation ========="),this.masterServer.sendAddAnnotationMessage(e,t,r,n,o,i,s)},e.prototype.sendRemoveAnnotation=function(e,t,r){log.info("send RemoveAnnotation ========="),this.masterServer.sendRemoveAnnotationMessage(e,t,r)},e.prototype.initFakeVideoStream=function(e){for(var t=0;t<e;t++)getFakeVideoStream(function(e){room.fakeVideoStreams.push(e)})},e.prototype.initFakeAudioStream=function(e){for(var t=0;t<e;t++)getFakeAudioStream(function(e){room.fakeAudioStreams.push(e)})},e.prototype.addAnnotationMsg=function(e,t){room.annotation2boardId[e.objectId]||(room.annotation2boardId[e.objectId]={storageArr:[],queueArr:[]}),e.annotationType!=shapeTypeEnum.hlight_point&&room.annotation2boardId[e.objectId].storageArr.push(e),t||room.annotation2boardId[e.objectId].queueArr.push(e)},e.prototype.updateAnnotationDrow=function(e){var t=this;for(console.log(e.length);0<e.length;){var r=e[0],n=room.getUser(room.boardId2userId[r.objectId]).getBoard(r.objectId);if(!n.annotation){clearTimeout(t.updateTimer),t.updateTimer=setTimeout(function(){t.updateAnnotationDrow(e)},100);break}switch(e.shift(),r.operType){case OperType.add:r.annotationType==shapeTypeEnum.line||r.annotationType==shapeTypeEnum.ellipse||r.annotationType==shapeTypeEnum.rect||r.annotationType==shapeTypeEnum.arrow||r.annotationType==shapeTypeEnum.success||r.annotationType==shapeTypeEnum.failure||r.annotationType==shapeTypeEnum.rhomb||r.annotationType==shapeTypeEnum.hlight_texttag||r.annotationType==shapeTypeEnum.hlight_point?n.annotation.drawToBoard(r.ann2pt):r.annotationType==shapeTypeEnum.polyline&&n.annotation.drawToBoard(r.annMutlipt);break;case OperType.remove:n.annotation.removeToBoard(r);break;case OperType.update:}}},e.prototype.voiceActivatedHandler=function(){room.audioLevel&&room.audioLevel.start(500).then(t)},e}),"firefox"==adapter.browserDetails.browser&&(remoteSDPInit=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendonly","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass","m=video 1 UDP/TLS/RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=sendonly","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","a=fmtp:121 profile-level-id=42e01f;level-asymmetry-allowed=1","a=fmtp:120 max-fs=12288;max-fr=60","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_1","a=rtcp-fb:120 nack","a=rtcp-fb:120 ccm fir","a=fmtp:120 x-google-max-bitrate=10000; x-google-min-bitrate=100; x-google-start-bitrate=645","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=rtpmap:121 VP9/90000","a=rtpmap:126 H264/90000","a=setup:actpass",""].join("\r\n")),sdpLines=function(e){return e.split("\r\n").filter(function(e){return 0<e.length})},sdpMline=function(e){for(var t=e.substr(2).split(" "),r={media:t[0],port:t[1],proto:t[2],formats:[]},n=3;n<t.length;n++)t[n]&&r.formats.push(t[n]);return r},findLineInFirefox=function(e,t,r){for(var n=e.length,o=0;o<t.length;o++)if(t[o].substr(0,n)===e)return t[o];if(!r)return!1;for(var i=0;i<r.length;i++)if(r[i].substr(0,n)===e)return r[i];return!1},findLinesInFirefox=function(e,t,r){for(var n=[],o=e.length,i=0;i<t.length;i++)t[i].substr(0,o)===e&&n.push(t[i]);if(n.length||!r)return n;for(var s=0;s<r.length;s++)r[s].substr(0,o)===e&&n.push(r[s]);return n},rtpmap=function(e){var t=e.substr(9).split(" "),r={id:t.shift()};return t=t[0].split("/"),r.name=t[0],r.clockrate=t[1],r.channels=3==t.length?t[2]:"1",r},sctpmap=function(e){var t=e.substr(10).split(" ");return{number:t.shift(),protocol:t.shift(),streams:t.shift()}},fmtp=function(e){for(var t,r,n,o=e.substr(e.indexOf(" ")+1).split(";"),i=[],s=0;s<o.length;s++)r=(t=o[s].split("="))[0].trim(),n=t[1],r&&n?i.push({key:r,value:n}):r&&i.push({key:"",value:r});return i},crypto=function(e){var t=e.substr(9).split(" ");return{tag:t[0],cipherSuite:t[1],keyParams:t[2],sessionParams:t.slice(3).join(" ")}},fingerprint=function(e){var t=e.substr(14).split(" ");return{hash:t[0],value:t[1]}},extmap=function(e){var t=e.substr(9).split(" "),r={},n=t.shift(),o=n.indexOf("/");return 0<=o?(r.id=n.substr(0,o),r.senders=n.substr(o+1)):(r.id=n,r.senders="sendrecv"),r.uri=t.shift()||"",r},rtcpfb=function(e){var t=e.substr(10).split(" "),r={};return r.id=t.shift(),r.type=t.shift(),"trr-int"===r.type?r.value=t.shift():r.subtype=t.shift()||"",r.parameters=t,r},sdpCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:t[3],ip:t[4],port:t[5],type:t[7],generation:"0"},n=8;n<t.length;n+=2)"raddr"===t[n]?r.relAddr=t[n+1]:"rport"===t[n]?r.relPort=t[n+1]:"generation"===t[n]?r.generation=t[n+1]:"tcptype"===t[n]&&(r.tcpType=t[n+1]);return r.network="1",r},sourceGroups=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].substr(13).split(" ");t.push({semantics:n.shift(),sources:n})}return t},sources=function(e){for(var t=[],r={},n=0;n<e.length;n++){var o=e[n].substr(7).split(" "),i=o.shift();if(!r[i]){var s={ssrc:i,parameters:[]};t.push(s),r[i]=s}var a=(o=o.join(" ").split(":")).shift(),c=o.join(":")||null;r[i].parameters.push({key:a,value:c})}return t},groups=function(e){for(var t,r=[],n=0;n<e.length;n++)t=e[n].substr(8).split(" "),r.push({semantics:t.shift(),contents:t});return r},msidSemantics=function(e){for(var t,r=[],n=0;n<e.length;n++)t="firefox"==adapter.browserDetails.browser?e[n].substr(16).split(" "):e[n].substr(17).split(" "),r.push({semantics:t.shift(),contents:t});return r},bandwidth=function(e){var t=e.substr(2).split(":"),r={};return r.type=t.shift(),r.bandwidth=t.shift(),r},getSsrcBySdp=function(e){return e.split("\r\n")[1].split(" ")[0].split(":")[1]},getCodecPayloadType=function(e,t){for(var r=[],n=e.split("\r\n"),o=findLine(n,"a=rtpmap",t),i=0;i<o.length;i++)r[i]=o?getCodecPayloadTypeFromLine(n[o[i]]):null;return r},getPayloadByProfileLevel=function(e){var t="",r=e.split("\r\n"),n=findLine(r,"a=fmtp","profile-level-id=42e01f");n&&0<n.length&&(t=r[n[0]].split(" ")[0].split(":")[1]);return t},getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null},setReplaceCoding=function(e,t,r){var n=e.join(" "),o=t.split("\r\n"),i=findLine(o,"m=",r),s=o[i].split(" ").slice(0,3);s.push(n);var a=s.join(" ");return t=t.replace(o[i],a)},setReplaceMediaPayloads=function(e,t,r){var n=e.join(" "),o=t.split("\r\n"),i=findLine(o,"m=",r);if(0==i.length)return t;var s=o[i].split(" "),a=s.slice(0,3);a.push(n);var c=a.join(" ");t=t.replace(o[i],c);var l=s.slice(3,s.length),d=diff(l,e);t=(t=(t=setDeletedMediaPayloads(d,t)).replace(/a=setup:actpass/g,"a=setup:active")).replace(/a=recvonly/g,"a=sendrecv");for(var u=0;u<e.length;u++){t=t+"a=fmtp:"+e[u]+" x-google-max-bitrate=10000; x-google-min-bitrate=300; x-google-start-bitrate=645\r\n"}return t},setDeletedMediaPayloads=function(e,t){for(var r=0;r<e.length;r++)for(var n=t.split("\r\n"),o=findLine(n,"a=",":"+e[r]+" "),i=0;i<o.length;i++)t=t.replace(n[o[i]]+"\r\n","");return t},diff=function(e,t){for(var r=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&r.push(e[n]);for(var o=[],i=0;i<t.length;i++)-1===e.indexOf(t[i])&&o.push(t[i]);return r.concat(o)};var remoteSDPFirfox_audio=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendonly","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass",""].join("\r\n"),remoteSDPFirefox_video=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=video 1 RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=sendonly","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","a=fmtp:121 profile-level-id=42e01f;level-asymmetry-allowed=1","a=fmtp:120 max-fs=12288;max-fr=60","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_1","a=rtcp-fb:120 nack","a=rtcp-fb:120 ccm fir","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=rtpmap:121 VP9/90000","a=rtpmap:126 H264/90000","a=setup:actpass",""].join("\r\n"),remoteSDPFirefox_video_add=["m=video 1 RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=rtcp:1 IN IP4 0.0.0.0","a=ice-ufrag:e8cf35cf","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=fingerprint:sha-256 FF:8A:0A:40:A4:EF:3D:4C:B1:6E:12:DB:FE:0B:69:B6:D3:7B:40:50:CE:A9:BA","a=setup:actpass","a=sendrecv","a=mid:sdparta_x","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=fmtp:120 max-fs=12288;max-fr=60","a=rtcp-fb:120 nack","a=rtcp-fb:120 nack pli","a=rtcp-fb:120 ccm fir","a=rtpmap:121 VP9/90000","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtpmap:126 H264/90000","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1\r\n","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir",""].join("\r\n"),remoteSDPFirefox_audio_add=["m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendrecv","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass",""].join("\r\n");function firefoxRemoveStream(r,e){e&&r.getSenders().forEach(function(t){e.getTracks().forEach(function(e){e==t.track&&r.removeTrack(t)})})}function checkSdpContents(e,t){var r=0,n=toSessionJSON(e,{});for(var o in n.contents){n.contents[o].description.media==t&&(r+=1)}return r}function checkRemoteMsids(e,t){var r=[],n=toSessionJSON(e,{});for(var o in n.contents){var i=n.contents[o];if(i.description.media==t){var s=i.description.sources;for(var a in s){var c=s[a].parameters;for(var l in c){var d=c[l];"msid"==d.key&&""!=d.value&&r.push(d.value)}}}}return unique(r).length}function checkLocalMsids(e,t){var r=[],n=toSessionJSON(e,{});for(var o in n.contents){var i=n.contents[o];if(i.description.media==t){var s=i.description.msid;null!=s&&null!=s.msid&&null!=s.trackId&&r.push(s.streamId+" "+s.trackId)}}return unique(r).length}function unique(e){for(var t,r=[],n={},o=0;null!=(t=e[o]);o++)n[t]||(r.push(t),n[t]=!0);return r}function addGroupContents(e,t){if(t<=0)return e;for(var r=toSessionJSON(e,{}),n=r.groups[0],o=n.contents.length,i=0;i<t;i++){var s="sdparta_"+(o+i);n.contents.push(s)}return toSessionSDP(r,{})}function updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(e,t,r,n,o){var i=toSessionJSON(e,{});for(var s in i.contents){var a=i.contents[s];t&&0<a.transport.fingerprints.length&&(a.transport.fingerprints[0].value=t),r&&0<a.transport.fingerprints.length&&(a.transport.fingerprints[0].setup=r),n&&(a.transport.ufrag=n),o&&(a.transport.pwd=o)}return toSessionSDP(i,{})}function updateSDPSenders(e,t,r){var n=toSessionJSON(e,{});for(var o in n.contents){var i=n.contents[o];i.description.media==t&&(i.senders=r)}return toSessionSDP(n,{})}function getSdpSsrc(e,t,r){var n=toSessionJSON(e,{});for(var o in n.contents){var i=n.contents[o];if(i.description.media==t){if("firefox"!=adapter.browserDetails.browser)return getSdpSsrcHandle(i.description);if(i.description.msid.streamId==r)return getSdpSsrcByFirefox2ChromeHandle(i.description)}}}function getSdpSsrcHandle(e){var t="",r=e.sourceGroups;for(var n in r){var o=r[n];t+="a=ssrc-group:"+o.semantics+" "+(i=o.sources).join(" ")+"\r\n"}var i=e.sources;for(var n in i){var s=i[n],a=s.ssrc,c=s.parameters;for(var l in c){var d=c[l];t+="a=ssrc:"+a+" "+d.key+":"+d.value+"\r\n"}}return t=t.replace(/^\n+|\n+$/g,"")}function getSdpSsrcByFirefox2ChromeHandle(e){var t,r=getSdpSsrcHandle(e),n=e.msid;if(r.length){var o=r.split(" "),i=o[0].split(":"),s=o[1].split(":");t=i[1],s[1]}var a=r+"\r\n";return a+="a=ssrc:"+t+" msid:"+n.streamId+" "+n.trackId+"\r\n",a+="a=ssrc:"+t+" mslabel:"+n.streamId+"\r\n",a+="a=ssrc:"+t+" label:"+n.trackId}function addSdpSsrc(e,t,r){var n=toSessionJSON(e,{}),o=0,i=0;for(var s in n.contents){(a=n.contents[s]).description.media==r&&(i+=1)}for(var s in n.contents){var a;if((a=n.contents[s]).description.media==r){var c=!1;(o+=1)==i&&(c=!0),a.description=addSdpSsrcByFirefoxHandle(n,a.description,t,r,c)}}return toSessionSDP(n,{})}function addSdpSsrcByFirefoxHandle(e,t,r,n,o){var i,s=sdpLines(r);if(0<toSessionSDP(e,{}).indexOf(s[0]))return t;if(1!=o)return null!=(i=t.sources)&&0<i.length?t:addSdpSsrcHandle(t,r);if(null!=(i=t.sources)&&0<i.length){var a=e.groups[0],c="sdparta_"+a.contents.length;if(a.contents.push(c),"video"==n){var l=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(remoteSDPFirefox_video,room.fingerPrint,room.setup,room.iceUfragForFirefox,room.icePwd),d=toSessionJSON(l,{}).contents[0];d.name=c,d.description=addSdpSsrcHandle(d.description,r),e.contents.push(d)}else if("audio"==n){remoteSDPFirfox_audio=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(remoteSDPFirfox_audio,room.fingerPrint,room.setup,room.iceUfragForFirefox,room.icePwd);var u=toSessionJSON(remoteSDPFirfox_audio,{}).contents[0];u.name=c,u.description=addSdpSsrcHandle(u.description,r),e.contents.push(u)}return t}return addSdpSsrcHandle(t,r)}function addSdpSsrcHandle(e,t){for(var r=sdpLines(t),n=findLinesInFirefox("a=ssrc-group:",r),o=sourceGroups(n||[]),i=findLinesInFirefox("a=ssrc:",r),s=sources(i||[]),a=0;a<o.length;a++)e.sourceGroups.push(o[a]);for(a=0;a<s.length;a++)e.sources.push(s[a]);return e}function delRemoveSdp(e,t,r){var n,o=0,i=toSessionJSON(e,{}),s=i.groups[0].contents,a=s.length;for(var c in i.contents){(d=i.contents[c]).description.media==r&&(o+=1)}var l=-1;for(var c in i.contents){var d;if((d=i.contents[c]).description.media==r){var u=d.description.sources;for(var p in u){var f=u[p].parameters;for(var h in f){var m=f[h];if("msid"==m.key&&""!=m.value){var g=t.indexOf(m.value);if(0<=g){l=g;break}}}if(0<=l)break}if(1<o){if(0<=l){var v=d.name;arrayUtil.objectNameSplice(i.contents,v),arrayUtil.baseSplice(s,v);var y=v.split("_")[1];break}var b=t.split("\r\n");for(h=0;h<b.length;h++){var _=b[h]+"\r\n";n=e=e.replace(_,"")}}}}if(n=toSessionSDP(i,{}),y)for(h=0;h<a;h++)if(y<h){var S=h-1;n=(n=n.replace("sdparta_"+h,"sdparta_"+S)).replace("sdparta_"+h,"sdparta_"+S)}return n}function getSDPSenders(e){var t=[],r=toSessionJSON(e,{});for(var n in r.contents){var o=r.contents[n],i=o.name,s=o.senders,a=SENDERS.initiator.outgoing[s];t[i]=a}return t}function setSDPSenders(e,t){var r=toSessionJSON(e,{});for(var n in r.contents){var o=r.contents[n],i=o.name,s=o.senders,a=(SENDERS.initiator.outgoing[s],t[i]);"sendonly"==a?o.senders="responder":"recvonly"==a?o.senders="initiator":"sendrecv"==a?o.senders="both":"inactive"==a&&(o.senders="none")}return toSessionSDP(r,{})}var SENDERS={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}},idCounter=Math.random();if(_setIdCounter=function(e){idCounter=e},toSessionJSON=function(e,t){var r,n=t.creators||[],o=t.role||"initiator",i=t.direction||"outgoing",s=e.split("\r\nm=");for(r=1;r<s.length;r++)s[r]="m="+s[r],r!==s.length-1&&(s[r]+="\r\n");var a=s.shift()+"\r\n",c=sdpLines(a),l={},d=[];for(r=0;r<s.length;r++)d.push(toMediaJSON(s[r],a,{role:o,direction:i,creator:n[r]||"initiator"}));l.contents=d;var u=findLinesInFirefox("a=group:",c);u.length&&(l.groups=groups(u));var p=findLinesInFirefox("a=msid-semantic:",c);return p.length&&(l.msidSemantics=msidSemantics(p)),l},toMediaJSON=function(e,t,r){var n=r.creator||"initiator",o=r.role||"initiator",i=r.direction||"outgoing",s=sdpLines(e),a=sdpLines(t),c=sdpMline(s[0]),l={creator:n,role:o,direction:i,name:c.media,description:{descType:"rtp",media:c.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};"application"==c.media&&(l.description={descType:"datachannel"},l.transport.sctp=[]);var d=l.description,u=l.transport,p=findLineInFirefox("a=mid:",s);if(p&&(l.name=p.substr(6)),findLineInFirefox("a=sendrecv",s,a)?l.senders="both":findLineInFirefox("a=sendonly",s,a)?l.senders=SENDERS[o][i].sendonly:findLineInFirefox("a=recvonly",s,a)?l.senders=SENDERS[o][i].recvonly:findLineInFirefox("a=inactive",s,a)&&(l.senders="none"),"rtp"==d.descType){var f=findLineInFirefox("b=",s);f&&(d.bandwidth=f(f));var h=findLineInFirefox("a=msid:",s);if(h.length){var m=h.substr(7).split(" "),g={};g.msid=h,g.streamId=m[0],g.trackId=m[1],d.msid=g}var v=findLineInFirefox("a=ssrc:",s);v&&(d.ssrc=v.substr(7).split(" ")[0]),findLinesInFirefox("a=rtpmap:",s).forEach(function(e){var t=rtpmap(e);t.parameters=[],t.feedback=[],findLinesInFirefox("a=fmtp:"+t.id,s).forEach(function(e){t.parameters=fmtp(e)}),findLinesInFirefox("a=rtcp-fb:"+t.id,s).forEach(function(e){t.feedback.push(rtcpfb(e))}),d.payloads.push(t)}),findLinesInFirefox("a=crypto:",s,a).forEach(function(e){d.encryption.push(crypto(e))}),findLineInFirefox("a=rtcp-mux",s)&&(d.mux=!0),findLinesInFirefox("a=rtcp-fb:*",s).forEach(function(e){d.feedback.push(rtcpfb(e))}),findLinesInFirefox("a=extmap:",s).forEach(function(e){var t=extmap(e);t.senders=SENDERS[o][i][t.senders],d.headerExtensions.push(t)});var y=findLinesInFirefox("a=ssrc-group:",s);d.sourceGroups=sourceGroups(y||[]);var b=findLinesInFirefox("a=ssrc:",s);d.sources=sources(b||[]),findLineInFirefox("a=x-google-flag:conference",s,a)&&(d.googConferenceFlag=!0)}var _=findLinesInFirefox("a=fingerprint:",s,a),S=findLineInFirefox("a=setup:",s,a);_.forEach(function(e){var t=fingerprint(e);S&&(t.setup=S.substr(8)),u.fingerprints.push(t)});var w=findLineInFirefox("a=ice-ufrag:",s,a),E=findLineInFirefox("a=ice-pwd:",s,a);w&&E&&(u.ufrag=w.substr(12),u.pwd=E.substr(10),u.candidates=[],findLinesInFirefox("a=candidate:",s,a).forEach(function(e){u.candidates.push(toCandidateJSON(e))}));"datachannel"==d.descType&&findLinesInFirefox("a=sctpmap:",s).forEach(function(e){var t=sctpmap(e);u.sctp.push(t)});return l},toCandidateJSON=function(e){var t=sdpCandidate(e.split("\r\n")[0]);return t.id=(idCounter++).toString(36).substr(0,12),t},toSessionSDP=function(e,t){t.role,t.direction;var r=["v=0","o=- "+(t.sid||e.sid||Date.now())+" "+(t.time||Date.now())+" IN IP4 0.0.0.0","s=-","t=0 0"];return(e.groups||[]).forEach(function(e){r.push("a=group:"+e.semantics+" "+e.contents.join(" "))}),(e.msidSemantics||[]).forEach(function(e){navigator.mozGetUserMedia?r.push("a=msid-semantic:"+e.semantics+" "+e.contents.join(" ")):r.push("a=msid-semantic: "+e.semantics+" "+e.contents.join(" "))}),(e.contents||[]).forEach(function(e){r.push(toMediaSDP(e,t))}),r.join("\r\n")+"\r\n"},toMediaSDP=function(e,t){var o=[],r=t.role||"initiator",n=t.direction||"outgoing",i=e.description,s=e.transport,a=i.payloads||[],c=s&&s.fingerprints||[],l=[];if("datachannel"==i.descType?(l.push("application"),l.push("1"),l.push("DTLS/SCTP"),s.sctp&&s.sctp.forEach(function(e){l.push(e.number)})):(l.push(i.media),l.push("1"),i.encryption&&0<i.encryption.length||0<c.length?l.push("RTP/SAVPF"):l.push("RTP/AVPF"),a.forEach(function(e){l.push(e.id)})),o.push("m="+l.join(" ")),o.push("c=IN IP4 0.0.0.0"),i.bandwidth&&i.bandwidth.type&&i.bandwidth.bandwidth&&o.push("b="+i.bandwidth.type+":"+i.bandwidth.bandwidth),"rtp"==i.descType&&o.push("a=rtcp:1 IN IP4 0.0.0.0"),s){s.ufrag&&o.push("a=ice-ufrag:"+s.ufrag),s.pwd&&o.push("a=ice-pwd:"+s.pwd);c.forEach(function(e){o.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&o.push("a=setup:"+e.setup)}),s.sctp&&s.sctp.forEach(function(e){o.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)})}return"rtp"==i.descType&&o.push("a="+(SENDERS[r][n][e.senders]||"sendrecv")),o.push("a=mid:"+e.name),i.msid&&o.push(i.msid.msid),i.mux&&o.push("a=rtcp-mux"),(i.encryption||[]).forEach(function(e){o.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),i.googConferenceFlag&&o.push("a=x-google-flag:conference"),a.forEach(function(t){var e="a=rtpmap:"+t.id+" "+t.name+"/"+t.clockrate;if(t.channels&&"1"!=t.channels&&(e+="/"+t.channels),o.push(e),t.parameters&&t.parameters.length){var r=["a=fmtp:"+t.id],n=[];t.parameters.forEach(function(e){n.push((e.key?e.key+"=":"")+e.value)}),r.push(n.join(";")),o.push(r.join(" "))}t.feedback&&t.feedback.forEach(function(e){"trr-int"===e.type?o.push("a=rtcp-fb:"+t.id+" trr-int "+e.value?e.value:"0"):o.push("a=rtcp-fb:"+t.id+" "+e.type+(e.subtype?" "+e.subtype:""))})}),i.feedback&&i.feedback.forEach(function(e){"trr-int"===e.type?o.push((e.value,e.value)):o.push("a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))}),(i.headerExtensions||[]).forEach(function(e){o.push("a=extmap:"+e.id+(e.senders?"/"+SENDERS[r][n][e.senders]:"")+" "+e.uri)}),(i.sourceGroups||[]).forEach(function(e){o.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))}),(i.sources||[]).forEach(function(e){for(var t=0;t<e.parameters.length;t++){var r=e.parameters[t];o.push("a=ssrc:"+(e.ssrc||i.ssrc)+" "+r.key+(r.value?":"+r.value:""))}}),(s.candidates||[]).forEach(function(e){o.push(toCandidateSDP(e))}),o.join("\r\n")},toCandidateSDP=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"srflx"!==r&&"prflx"!==r&&"relay"!==r||e.relAddr&&e.relPort&&(t.push("raddr"),t.push(e.relAddr),t.push("rport"),t.push(e.relPort)),e.tcpType&&"TCP"==e.protocol.toUpperCase()&&(t.push("tcptype"),t.push(e.tcpType)),t.push("generation"),t.push(e.generation||"0"),"a=candidate:"+t.join(" ")},ModuleBase.define("TraceableWebsocket",["MessageManager","Error"],function(s,a){var e=function(){};return e.prototype.connect=function(){var t=when.defer();try{var e=document.location.protocol;"http:"!=e&&"https:"!=e&&(e="http:"),room.avdEngine.applyToElectron&&(e=room.avdEngine.electronProtocol);var r="ws://";"https:"==e&&(r="wss://");var n=r+roomServerUrl+"/ws";log.debug("=====webSocket URL==="+n),loggerReport.info("websocket url:"+n);var o=new WebSocket(n);o.binaryType="arraybuffer",o.readyState==WebSocket.CONNECTING&&(log.info("webSocket连接正在建立..."),loggerReport.info("webSocket连接正在建立...")),o.onopen=function(){o.readyState==WebSocket.OPEN&&(log.info("webSocket连接已打开!"),loggerReport.info("webSocket连接已打开!")),t.resolve(o)},o.onmessage=function(e){(new s).OnWebSocketMessage(e.data)},o.onclose=function(e){log.info("webSocket连接已关闭！关闭原因："+e.code),loggerReport.info("webSocket连接已关闭！关闭原因："+e.code),o.close(),o.readyState==WebSocket.CLOSED&&(room&&(room.reconnectionOpenRep402||0<room.reJoinRoomCount||room.reconnectionState)?(log.info("webSocket连接已关闭，因已在重连或重新加会中，不再触发其它操作"),loggerReport.info("webSocket连接已关闭，因已在重连或重新加会中，不再触发其它操作")):room&&(log.info("webSocket连接已关闭，进行websocket重连操作"),loggerReport.info("webSocket连接已关闭，进行websocket重连操作"),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),room.masterServer.pingInit(),room.reconnectionHandle()))},o.onerror=function(e){log.error("webSocket连接发生错误。"),loggerReport.error("webSocket连接发生错误。"),null!=room&&0<room.reconnectionCount&&!room.joinTimeoutState&room.reconnectionState?(log.info("=========WebSocket重连发生错误, 再次开始WebSocket重连操作...=========="),setTimeout(function(){room.reconnectionHandle()},3e3)):1==room.reconnectionOpenRep402?(log.info("=========WebSocket连接发生错误,开始重新加会操作...========="),setTimeout(function(){room.reJoin()},3e3)):log.info("WebSocket连接发生错误！")}}catch(e){log.info("websocket Operation  failed. with exception:"+e);var i=new a(ErrorConstant.websock_catch_exception);t.reject(i)}return t.promise},e}),ModuleBase.define("TraceablePeerConnection",["Error"],function(e){var t=function(){iceServers&&0<iceServers.length?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}],sdpSemantics:"plan-b"}:this.iceConfig={iceServers:[],sdpSemantics:"plan-b"},this.pcConstraints={optional:[{googCpuOveruseDetection:!1}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}};t.prototype.getToMCUPeerConnection=function(){return 0<room.reconnectionCount?(null==room.toMCUReconnectionPC&&(room.toMCUReconnectionPC=this.createMCUPeerConnection()),room.toMCUReconnectionPC):(null==room.selfUser.toMCUPC&&(room.selfUser.toMCUPC=this.createMCUPeerConnection()),room.selfUser.toMCUPC)},t.prototype.createMCUPeerConnection=function(){var e=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnection(e),"getConfiguration"in window.RTCPeerConnection.prototype&&log.debug("createPeerConnectionInner(),PeerConnection Configuration:",e.getConfiguration()),"safari"==adapter.browserDetails.browser&&(e.addTransceiver("audio"),e.addTransceiver("video")),e},t.prototype.handleMCUPeerConnection=function(n){var o=when.defer();return n.msgQueue=[],n.forLog=!1,n.onicecandidate=function(e){},n.onopen=function(){},n.ontrack=function(e){if(log.info("pc.ontrack()......"),log.debug("====event.stream.id:"+e.streams[0].id),log.debug("ontrack(),MCU track type: "+e.track.kind),log.debug("====event.track.id:"+e.track.id),"safari"==adapter.browserDetails.browser){var t=getSdpSsrc(e.currentTarget.currentRemoteDescription.sdp,e.track.kind,e.streams[0].id).split("\r\n"),r=findLine(t,"a=ssrc:"," label:"),n=null;if(r.length<3&&(n=(n=t[r[0]].split("label:")[1]).replace(/(^\s*)|(\s*$)/g,"")),console.log("pc.ontrack(),real TrackId:"+n),n!=e.track.id)if("video"==e.track.kind){if(i=room.selfUser.getUserByVideoTrackId(n)){var o=room.selfUser.subVideoTrack2ResourceInfo[n];console.log(o),i.getVideo(o.resource_id).track=e.track,i.eventEmitter.emit(UserCallback.subscrible_camera_result,e.streams[0],i.id,i.name,o.resource_id)}}else if("audio"==e.track.kind){var i;if(i=room.selfUser.getUserByAudioTrackId(n)){o=room.selfUser.subAudioTrack2ResourceInfo[n];i.getAudio(o.resource_id).track=e.track,i.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.streams[0],i.id,i.name)}}}},n.ontrackremoved=function(e){log.info("pc.ontrackremoved()......")},n.onaddstream=function(e){log.info("pc.onaddstream()......")},n.onremovestream=function(e){log.info("pc.onremovestream()......")},n.ondatachannel=function(e){},n.oniceconnectionstatechange=function(e){var t=e.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(),MCU iceConnectionState :"+t),loggerReport.info("Peerconnection iceConnectionState: "+t),t){case"disconnected":room.connectionInfoCollector&&room.connectionInfoCollector.stop();break;case"failed":if(room&&room.reconnectionOpenRep402&&0<room.reJoinRoomCount)break;var r="PeerConnection  iceConnectionState failed.";log.error(r),o.reject(r),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),0==room.reconnectionCount&&(log.info("========客户端IP地址可能发生了变更。重连显示成功，但ICE 状态显示failed，会进行重新加会操作========="),room.joinTimeoutState=!1,room.reconnectionCount=0,room.reconnectionState=!1,room.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,addIcecandidateList=[],room.reJoin());break;case"completed":room.reconnectionOpenRep402=!1,room.audioLevel=new AudioLevel(n,500),room.connectionInfoCollector=new ConnectionInfoCollector(n,1e3),room.connectionStatistics=new ConnectionStatistics(n),connectionStatisticsConfig.open_statistic&&1==parseInt(connectionStatisticsConfig.open_statistic)&&room.connectionStatistics.start(),room.eventEmitter.emit(RoomCallback.mcu_peerconnection_completed,MCUPeerConnectionStatus.completed);break;case"connected":"firefox"==adapter.browserDetails.browser&&(room.audioLevel=new AudioLevel(n,500),room.connectionInfoCollector=new ConnectionInfoCollector(n,1e3),room.eventEmitter.emit(RoomCallback.mcu_peerconnection_completed,MCUPeerConnectionStatus.completed))}},n.onsignalingstatechange=function(e){log.debug("onsignalingstatechange(), MCU signalingState :"+e.target.signalingState),"stable"==e.target.signalingState?0==n.forLog&&(n.forLog=!0,n.intervalSet(n)):"closed"==e.target.signalingState&&(console.log("PC.onsignalingstatechange=closed,无效的Peerconnection,停止显示其状态值"),room.connectionInfoCollector&&room.connectionInfoCollector.stop())},n.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},100)},n.processSignalingMessage=function(e){if(room&&0==room.addSdpLocalStates&&"stable"==e.signalingState&&0<e.msgQueue.length){var t=e.msgQueue.pop();log.debug("MCU 操作对列:"+t.operationType),"add"==t.operationType?function(g,l,d,u){var v;room.addSdpLocalStates=1,clearTimeout(f),f=setTimeout(function(){room.addSdpLocalStates=0},3e3);var p=room.splitPDUDeviceId(l);if("chrome"==adapter.browserDetails.browser)if("getSenders"in window.RTCPeerConnection.prototype){var e=room.traceablePeerConnection.getToMCUPeerConnection().getSenders();if(e&&0<e.length){for(var t=d.getTracks()[0].id,r=!1,n=0;n<e.length;n++)if(e[n].track){var o=e[n].track.id;t==o&&(r=!0)}if(!r)if(room.selfUser.stream&&0<room.selfUser.stream.getTracks().length)if("video"==g){var i=room.selfUser.getVideo(p);i&&(i.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream))}else"screen"==g?room.selfUser.screen.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream):"audio"==g&&(room.selfUser.audio.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream));else if("video"==g){var i=room.selfUser.getVideo(p);i&&(i.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],d))}else"screen"==g?room.selfUser.screen.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],d):"audio"==g&&(room.selfUser.audio.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],d))}else if(room.selfUser.stream&&0<room.selfUser.stream.getTracks().length)if("video"==g){var i=room.selfUser.getVideo(p);i.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream)}else"screen"==g?room.selfUser.screen.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream):"audio"==g&&(room.selfUser.audio.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream));else if("video"==g){var i=room.selfUser.getVideo(p);i.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],d)}else"screen"==g?room.selfUser.screen.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],d):"audio"==g&&(room.selfUser.audio.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],d))}else{var s=room.traceablePeerConnection.getToMCUPeerConnection().getLocalStreams();s&&0<s.length?d.getTracks().forEach(function(e){s[0].addTrack(e)}):room.selfUser.stream&&1==room.selfUser.stream.getTracks().length?room.traceablePeerConnection.getToMCUPeerConnection().addStream(room.selfUser.stream):room.traceablePeerConnection.getToMCUPeerConnection().addStream(d)}if("safari"==adapter.browserDetails.browser){var e=room.traceablePeerConnection.getToMCUPeerConnection().getSenders();if(e&&0<e.length){for(var t=d.getTracks()[0].id,r=!1,n=0;n<e.length;n++)if(e[n].track){var o=e[n].track.id;t==o&&(r=!0)}if(!r){if("video"==g){var i=room.selfUser.getVideo(p);i.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream)}"audio"==g&&(room.selfUser.audio.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream))}}else{if("video"==g){var i=room.selfUser.getVideo(p);i.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream)}"audio"==g&&(room.selfUser.audio.RTCRtpSender=room.traceablePeerConnection.getToMCUPeerConnection().addTrack(d.getTracks()[0],room.selfUser.stream))}}room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(h){var r,n,o,m;if(h.sdp=updateSDPIceUfrag(h.sdp,room.iceUfrag),h.sdp=updateSDPIcePwd(h.sdp,room.icePwd),h.sdp=w(h.sdp),"firefox"==adapter.browserDetails.browser){var e;if("video"==g){for(var t=room.localAddFakeVideoStreams,i=0;i<t.length;i++)t[i];e=y(e=getSdpSsrc(h.sdp,"video",d.id),d.id),log.debug("addSdpHandle(),new add video sdp:"+e),r=room.selfUser.deviceId2VideoSdpSsrc[p],room.selfUser.deviceId2VideoSdpSsrc[p]=e}else"audio"==g?(e=getSdpSsrc(h.sdp,"audio",d.id),log.debug("addSdpHandle(),new add audio sdp:"+e),n=room.selfUser.audioSdpSsrc,room.selfUser.audioSdpSsrc=e):"screen"==g&&(e=y(e=getSdpSsrc(h.sdp,"video",d.id),d.id),log.debug("addSdpHandle(),new add screen sdp:"+e),o=room.selfUser.screenSdpSsrc,room.selfUser.screenSdpSsrc=e);m=e}else{var s=new SdpSerializer(h.sdp);if("video"==g){m=b(m=s._inner.video.ssrcStr),log.debug("addSdpHandle(),new add video sdp:"+m),r=room.selfUser.deviceId2VideoSdpSsrc[p],room.selfUser.deviceId2VideoSdpSsrc[p]=m;var a=getSsrcBySdp(m);room.videoSsrc2user[a]=room.selfUser,room.videoSsrc2deviceId[a]=l}else if("audio"==g){m=s._inner.audio.ssrcStr,log.debug("addSdpHandle(),new add audio sdp:"+m),n=room.selfUser.audioSdpSsrc,room.selfUser.audioSdpSsrc=m;var a=getSsrcBySdp(m);room.audioSsrc2user[a]=room.selfUser}else if("screen"==g){m=b(m=s._inner.video.ssrcStr),log.debug("addSdpHandle(),new add screen sdp:"+m),o=room.selfUser.screenSdpSsrc,room.selfUser.screenSdpSsrc=m;var a=getSsrcBySdp(m);room.screenSsrc2user[a]=room.selfUser}}var c=d.getTracks()[0];log.debug("%%%%%%%%%%%addSdpHandle(),tackId:"+c.id),room.masterServer.pubRoomResourceMsg(g,c.id,m,l,u),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){clearTimeout(f),e==u&&("firefox"==adapter.browserDetails.browser&&(v=getSDPSenders(h.sdp),room.localFirefoxSDP=h.sdp),log.debug("addSdpHandle(),  local sessionDescription:"+h.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(h,function(){room.addSdpLocalStates=0,log.info("addSdpHandle(), success to add local description")},function(e){room.addSdpLocalStates=0,log.error("addSdpHandle(), Failed to add local description: "+e.toString())}),setTimeout(function(){var e={};if(e.sdp=room.sdp,e.type="answer",e.sdp=E(e.sdp),"firefox"==adapter.browserDetails.browser){if("video"==g){var t=checkLocalMsids(h.sdp,"video"),r=checkRemoteMsids(e.sdp,"video"),n=t-r,o=checkSdpContents(h.sdp,"video"),i=checkSdpContents(e.sdp,"video"),s=o-i;if(0<n&&0<s){e.sdp+=remoteSDPFirefox_video_add;var a=i+1;e.sdp=e.sdp.replace("sdparta_x","sdparta_"+a),e.sdp=addGroupContents(e.sdp,n),e.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(e.sdp,room.fingerPrint,room.setup,room.iceUfrag,room.icePwd)}}else if("audio"==g){var c=checkLocalMsids(h.sdp,"audio"),l=checkRemoteMsids(e.sdp,"audio"),n=c-l,d=checkSdpContents(h.sdp,"audio"),u=checkSdpContents(e.sdp,"audio"),s=d-u;if(0<n&&0<s){e.sdp+=remoteSDPFirefox_audio_add;var a=u+1;e.sdp=e.sdp.replace("sdparta_x","sdparta_"+a),e.sdp=addGroupContents(e.sdp,n),e.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(e.sdp,room.fingerPrint,room.setup,room.iceUfrag,room.icePwd)}}e.sdp=setSDPSenders(e.sdp,v);var p=100;videoCoding==VideoCodingType.VP8||(videoCoding==VideoCodingType.VP9?p=101:videoCoding==VideoCodingType.H264&&(p=107)),e.sdp=C(e.sdp,p,m)}room.sdp=e.sdp,log.debug("addSdpHandle(), remote sessionDescription:"+e.sdp);var f=new RTCSessionDescription(e);room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(f,function(){},function(e){log.error(e)})},200))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){clearTimeout(f),room.addSdpLocalStates=0,t==u&&(room.traceablePeerConnection.getToMCUPeerConnection().removeStream(d),"video"==g?room.selfUser.deviceId2VideoSdpSsrc[p]=r:"audio"==g?room.selfUser.audioSdpSsrc=n:"screen"==g&&(room.selfUser.screenSdpSsrc=o))})},T,this.constraints)}(t.para1,t.para2,t.para3,t.para4):"update"==t.operationType?function(l,i,d,s){room.addSdpLocalStates=1;var e=d.stream.stream_name;log.debug("%%%%%%%%updateSdpHandle(),streamLabel:"+e);var t=d.stream.sdp;if(null==t||""==t)return;t=t.replace(/^\n+|\n+$/g,"");var r,n=new SdpSerializer(room.sdp),u=d.stream.stream_name;if(1==i){for(var o=[],a=t.split("\r\n"),c=0;c<a.length;c++){var p=a[c];o.push(p)}if("video"==l){room.selfUser.subVideoTrack2ResourceInfo[d.stream.stream_name]=d;var c=0;null!=n._inner.video.ssrc&&0<n._inner.video.ssrc.length&&(c=n._inner.video.ssrc.length);var f=getSsrcBySdp(t),h=room.getUserByNodeId(d.owner_id);h&&(room.videoSsrc2user[f]=h,room.videoSsrc2deviceId[f]=d.resource_id),n.video.track(c).set(o)}else if("audio"==l){room.selfUser.subAudioTrack2ResourceInfo[d.stream.stream_name]=d;var c=0;null!=n._inner.audio.ssrc&&0<n._inner.audio.ssrc.length&&(c=n._inner.audio.ssrc.length);var f=getSsrcBySdp(t),h=room.getUserByNodeId(d.owner_id);h&&(room.audioSsrc2user[f]=h),n.audio.track(c).set(o)}else if("screen"==l){room.selfUser.subScreenTrack2ResourceInfo[d.stream.stream_name]=d;var c=0;null!=n._inner.video.ssrc&&0<n._inner.video.ssrc.length&&(c=n._inner.video.ssrc.length);var f=getSsrcBySdp(t),h=room.getUserByNodeId(d.owner_id);h&&(room.screenSsrc2user[f]=h),n.video.track(c).set(o)}var m=n.deserialize(),g=(r=m).split("\r\n"),v=findLine(g,"a=msid-semantic",null);if(null!=v){var y=g[v];0<y.indexOf(e)?log.debug("%%%%%%%%updateSdpHandle(),00000000000"):(log.debug("%%%%%%%%updateSdpHandle(),11111111111"),r=r.replace("WMS","WMS "+e))}room.sdp=r}else if(0==i){if("video"==l){for(key in log.debug("updateSdpHandle(),remove video ssrc and user relation"),room.videoSsrc2user)try{var h=room.videoSsrc2user[key];if(h&&h.nodeId==d.owner_id){delete room.videoSsrc2user[key];break}}catch(e){}for(key in room.videoSsrc2deviceId)try{var b=room.videoSsrc2deviceId[key];if(b==d.resource_id){delete room.videoSsrc2deviceId[key];break}}catch(e){}}else if("audio"==l)for(key in log.info("updateSdpHandle(),remove audio ssrc and user relation"),room.audioSsrc2user)try{var h=room.audioSsrc2user[key];if(h&&h.nodeId==d.owner_id){h.audio&&h.audio.setAudioLevel(0),delete room.audioSsrc2user[key];break}}catch(e){}else if("screen"==l)for(key in log.debug("updateSdpHandle(),remove screen ssrc and user relation"),room.screenSsrc2user)try{var h=room.screenSsrc2user[key];if(h&&h.nodeId==d.owner_id){delete room.screenSsrc2user[key];break}}catch(e){}for(var m=room.sdp,a=t.split("\r\n"),c=0;c<a.length;c++){var p=a[c]+"\r\n";m=m.replace(p,"")}0<m.indexOf(e)&&(m=m.replace(e,""),log.debug("%%%%%%%%updateSdpHandle(),555555555")),r=m,room.sdp=r}var _={};_.sdp=r,_.type="answer",_.sdp=E(_.sdp);var S=new RTCSessionDescription(_);room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(e){e.sdp=updateSDPIceUfrag(e.sdp,room.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),e.sdp=w(e.sdp),log.debug("updateSdp(), local sessionDescription:"+e.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e,function(){room.addSdpLocalStates=0,log.info("updateSdpHandle(),success to add local description"),log.debug("updateSdp(), remote sessionDescription:"+_.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(S,function(){room.masterServer.subRoomResourceMsg(i,d,s);var c=room.traceablePeerConnection.getToMCUPeerConnection().getRemoteStreams();if(1==i){if(c&&0<c.length)for(var e=0;e<c.length;e++)c[e].getTracks().forEach(function(e){if(e.id==u&&"live"==e.readyState)if(log.debug("^^^^^^^^^^^^^^onaddTrack^^^^^^^^^^^^"+l),console.log(e),"video"==l){if(d){log.debug("onaddTrack,MCU Track type: video");var t=room.selfUser.getUserByVideoTrackId(u);if(t){var r=t.getVideo(d.resource_id);r.track=e;var n=new webkitMediaStream;n.addTrack(r.track),t.eventEmitter.emit(UserCallback.subscrible_camera_result,n,t.id,t.name,d.resource_id)}}}else if("screen"==l){if(d){log.debug("onaddTrack,MCU Track type: screen");var t=room.selfUser.getUserByScreenTrackId(u);if(t){var o=t.getScreen(d.resource_id);o.track=e;var i=new webkitMediaStream;i.addTrack(o.track),t.eventEmitter.emit(UserCallback.subscrible_screen_result,i,t.id,t.name,d.resource_id)}}}else if("audio"==l&&d){log.debug("onaddTrack,MCU Track type: audio");var t=room.selfUser.getUserByAudioTrackId(u);if(t){var s=t.getAudio(d.resource_id);s.track=e;var a=null;"chrome"==adapter.browserDetails.browser&&adapter.browserDetails.version<52?a=c[0]:(a=new webkitMediaStream).addTrack(e),t.eventEmitter.emit(UserCallback.subscrible_microphone_result,a,t.id,t.name)}}})}else if(0==i)if(log.info("^^^^^^^^^^^^^^onRemoveTrack^^^^^^^^^^^^resourceType:"+l+"，trackId:"+u),"video"==l){var t=room.selfUser.subVideoTrack2ResourceInfo[u];if(t){log.debug("^^^^^^^^^^^^^^onRemoveTrack^^^^^^^^^^^^,videoResourceInfo:"+t);var r=room.selfUser.getUserByVideoTrackId(u);r&&(delete room.selfUser.subVideoTrack2ResourceInfo[u],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id))}}else if("screen"==l){var n=room.selfUser.subScreenTrack2ResourceInfo[u];if(n){log.debug("^^^^^^^^^^^^^^onRemoveTrack^^^^^^^^^^^^,screenResourceInfo:"+n);var r=room.selfUser.getUserByScreenTrackId(u);r&&(delete room.selfUser.subScreenTrack2ResourceInfo[u],r.eventEmitter.emit(UserCallback.unsubscrible_screen_result,r.id,r.name,n.resource_id))}}else if("audio"==l){var o=room.selfUser.subAudioTrack2ResourceInfo[u];if(o){log.debug("^^^^^^^^^^^^^^onRemoveTrack^^^^^^^^^^^^,audioResourceInfo:"+o);var r=room.selfUser.getUserByAudioTrackId(u);r&&(delete room.selfUser.subAudioTrack2ResourceInfo[u],r.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,r.id,r.name))}}},function(e){log.error(e)})},function(e){room.addSdpLocalStates=0,log.error("updateSdpHandle(),Failed to add local description: "+e.toString())})},T,this.constraints)}(t.para1,t.para2,t.para3,t.para4):"reduce"==t.operationType?function(a,c,l){var d;room.addSdpLocalStates=1,console.log("^^^^QQQQQWWWWW000000");var e=room.splitPDUDeviceId(c);if("firefox"==adapter.browserDetails.browser)firefoxRemoveStream(room.traceablePeerConnection.getToMCUPeerConnection(),l);else if("chrome"==adapter.browserDetails.browser)if("getSenders"in window.RTCPeerConnection.prototype)if("video"==a){var t=room.selfUser.getVideo(e);room.traceablePeerConnection.getToMCUPeerConnection().removeTrack(t.RTCRtpSender)}else"screen"==a?room.traceablePeerConnection.getToMCUPeerConnection().removeTrack(room.selfUser.screen.RTCRtpSender):"audio"==a&&room.traceablePeerConnection.getToMCUPeerConnection().removeTrack(room.selfUser.audio.RTCRtpSender);else{var r=room.traceablePeerConnection.getToMCUPeerConnection().getLocalStreams();if(r&&0<r.length){var n=l.getTracks()[0];r[0].removeTrack(n)}}else if("safari"==adapter.browserDetails.browser)if("video"==a){var t=room.selfUser.getVideo(e);room.traceablePeerConnection.getToMCUPeerConnection().removeTrack(t.RTCRtpSender)}else"audio"==a&&room.traceablePeerConnection.getToMCUPeerConnection().removeTrack(room.selfUser.audio.RTCRtpSender);room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(e){if(e.sdp=updateSDPIceUfrag(e.sdp,room.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),e.sdp=w(e.sdp),"video"==a){for(key in log.debug("reduceSdpHandle(), remove video ssrc and user relation"),room.videoSsrc2user)try{var t=e.sdp.indexOf(key);if(t<0){var r=room.videoSsrc2user[key];if(r.id==room.selfUser.id){delete room.videoSsrc2user[key];break}}}catch(e){}for(key in room.videoSsrc2deviceId)try{var n=room.videoSsrc2deviceId[key];if(n==c){delete room.videoSsrc2deviceId[key];break}}catch(e){}}else if("audio"==a)for(key in log.debug("reduceSdpHandle(), remove audio ssrc and user relation"),room.audioSsrc2user)try{var t=e.sdp.indexOf(key);if(t<0){var r=room.audioSsrc2user[key];if(r.id==room.selfUser.id){r.audio&&r.audio.setAudioLevel(0),delete room.audioSsrc2user[key];break}}}catch(e){}else if("screen"==a)for(key in log.debug("reduceSdpHandle(), remove screen ssrc and user relation"),room.screenSsrc2user)try{var t=e.sdp.indexOf(key);if(t<0){var r=room.screenSsrc2user[key];if(r.id==room.selfUser.id){delete room.screenSsrc2user[key];break}}}catch(e){}var o={};o.sdp=room.sdp,o.type="answer",o.sdp=E(o.sdp),"firefox"==adapter.browserDetails.browser&&(d=getSDPSenders(e.sdp),room.localFirefoxSDP=e.sdp),log.debug("reduceSdp(), local sessionDescription:"+e.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e,function(){room.addSdpLocalStates=0,log.info("reduceSdpHandle(),success to add local description")},function(e){room.addSdpLocalStates=0,log.error("reduceSdpHandle(),Failed to add local description: "+e.toString())}),"firefox"==adapter.browserDetails.browser&&(o.sdp=setSDPSenders(o.sdp,d)),log.debug("reduceSdp(), remote sessionDescription:"+o.sdp);var i=new RTCSessionDescription(o),s=l.getTracks()[0];room.masterServer.unpubRoomResourceMsg(a,s.id,c),setTimeout(function(){room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(i,function(){},function(e){log.error(e)})},200)},T,this.constraints)}(t.para1,t.para2,t.para3):"updateBandwidth"==t.operationType&&(r=t.para1,n=t.para2,room.addSdpLocalStates=1,log.info("updateBandwidthSdpHandle(), minBandwidth:"+r+",maxBandwidth:"+n),room.selfUser.toMCUPC.createOffer().then(function(e){return log.debug("====updateBandwidth(),Applying bandwidth restriction to setLocalDescription:\n"+e.sdp),room.selfUser.toMCUPC.setLocalDescription(e,function(){room.addSdpLocalStates=0,log.info("updateBandwidthSdpHandle(),success to add local description")},function(e){room.addSdpLocalStates=0,log.error("updateBandwidthSdpHandle(),Failed to add local description: "+e.toString())})}).then(function(){var e={type:room.selfUser.toMCUPC.remoteDescription.type,sdp:room.selfUser.toMCUPC.remoteDescription.sdp};if(r&&n){e.sdp=e.sdp.replace(/x-google-min-bitrate=[1-9]\d*/g,"x-google-min-bitrate="+r),e.sdp=e.sdp.replace(/x-google-max-bitrate=[1-9]\d*/g,"x-google-max-bitrate="+n);var t=parseInt(2*(r+n)/3);e.sdp=e.sdp.replace(/x-google-start-bitrate=[1-9]\d*/g,"x-google-start-bitrate="+t)}return log.debug("====updateBandwidth(),Applying bandwidth restriction to setRemoteDescription:\n"+e.sdp),room.selfUser.toMCUPC.setRemoteDescription(e)}).then(function(){}).catch(function(e){log.debug("====updateBandwidth(), Failed to set session description:"+e.toString())}))}var r,n},o.promise},t.prototype.getToMCUPeerConnectionForFirefox=function(){return 0<room.reconnectionCount?(null==room.toMCUReconnectionPCForFirefox&&(room.toMCUReconnectionPCForFirefox=this.createMCUPeerConnectionForFirefox()),room.toMCUReconnectionPCForFirefox):(null==room.selfUser.toMCUPCForFirefox&&(room.selfUser.toMCUPCForFirefox=this.createMCUPeerConnectionForFirefox()),room.selfUser.toMCUPCForFirefox)},t.prototype.createMCUPeerConnectionForFirefox=function(){var e=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnectionForFirefox(e),e},t.prototype.handleMCUPeerConnectionForFirefox=function(t){t.msgQueue=[],t.forLog=!1,t.onaddstream=function(e){if("default"!==e.stream.id){if(log.debug("pc2 for fireofox, remote stream added:"+e.stream.id),0<e.stream.getVideoTracks().length){var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.subScreenStream2ResourceInfo[e.stream.id];if(null!=t){log.debug("onaddstream(),pc2 for fireofox, MCU stream type: video");(n=room.selfUser.getUserByVideoStreamLabel(e.stream.id)).getVideo(t.resource_id);n.eventEmitter.emit(UserCallback.subscrible_camera_result,e.stream,n.id,n.name,t.resource_id)}if(null!=r){log.debug("onaddstream(), pc2 for fireofox, MCU  stream type: screen");(n=room.selfUser.getUserByScreenStreamLabel(e.stream.id)).getScreen(r.resource_id);n.eventEmitter.emit(UserCallback.subscrible_screen_result,e.stream,n.id,n.name,r.resource_id)}}else if(0<e.stream.getAudioTracks().length){log.debug("onaddstream(),pc2 for fireofox, MCU stream type: audio");var n;t=room.selfUser.subAudioStream2ResourceInfo[e.stream.id];(n=room.selfUser.getUserByAudioStreamLabel(e.stream.id)).getAudio(t.resource_id).stream=e.stream,n.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.stream,n.id,n.name)}}else log.info("pc2 for fireofox, recvonly remote stream ignored:"+e.stream+" - "+e.stream.id)},t.onremovestream=function(e){log.debug("onremovestream(),pc2 for fireofox, MCU stream label:"+e.stream.id);var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.getUserByVideoStreamLabel(e.stream.id);null!=r&&(delete room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id));var n=room.selfUser.subScreenStream2ResourceInfo[e.stream.id],o=room.selfUser.getUserByScreenStreamLabel(e.stream.id);null!=o&&(delete room.selfUser.subScreenStream2ResourceInfo[e.stream.id],o.eventEmitter.emit(UserCallback.unsubscrible_screen_result,o.id,o.name,n.resource_id));var i=room.selfUser.subAudioStream2ResourceInfo[e.stream.id],s=room.selfUser.getUserByAudioStreamLabel(e.stream.id);null!=s&&(s.getAudio(i.resource_id).stream=null,delete room.selfUser.subAudioStream2ResourceInfo[e.stream.id],s.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,s.id,s.name))},t.oniceconnectionstatechange=function(e){var t=e.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(), pc2 for fireofox, MCU iceConnectionState :"+t),t){case"disconnected":break;case"failed":log.error("Create MCU Second PeerConnection failed For Firefox.")}},t.onsignalingstatechange=function(e){log.debug("onsignalingstatechange(), pc2 for fireofox, MCU signalingState :"+e.target.signalingState),"stable"==e.target.signalingState&&0==t.forLog&&(t.forLog=!0,t.intervalSet(t))},t.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},100)},t.processSignalingMessage=function(e){if("stable"==e.signalingState&&0<e.msgQueue.length){var t=e.msgQueue.pop();log.debug("MCU 操作对列, pc2 for firefox:"+t.operationType),function(e,r,n){var o;log.debug("pc2 for fireofox, update handle "+n.stream.stream_name);var t,i=n.stream.stream_name,s=n.stream.sdp;if(null==s||""==s)return;if(s=s.replace(/^\n+|\n+$/g,""),1==r)log.debug("pc2 for fireofox, update type 11."),"video"==e?t=addSdpSsrc(room.sdpForFirefox,s,"video"):"audio"==e?t=addSdpSsrc(room.sdpForFirefox,s,"audio"):"screen"==e&&(t=addSdpSsrc(room.sdpForFirefox,s,"video"));else if(0==r){log.debug("pc2 for fireofox, update type 00.");for(var a=room.sdpForFirefox,c=s.split("\r\n"),l=0;l<c.length;l++){var d=c[l]+"\r\n";a=a.replace(d,"")}0<a.indexOf(i)&&(a=a.replace(i,"")),t=a}var u={};if(u.sdp=t,u.type="answer",u.sdp=E(u.sdp),1==r)if("video"==e){room.fakeVideoStreams.length<20&&room.initFakeVideoStream(15);var p=checkRemoteMsids(u.sdp,"video"),f=p-room.localVideoMsids,h=checkSdpContents(room.localFirefoxSecondSDP,"video"),m=checkSdpContents(u.sdp,"video"),g=m-h;if(0<f&&0<g)for(var l=0;l<f;l++){var v=room.fakeVideoStreams.shift();room.localAddFakeVideoStreams.push(v),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().addStream(v),room.localVideoMsids+=1}}else if("audio"==e){room.fakeAudioStreams.length<20&&room.initFakeAudioStream(15);var y=checkRemoteMsids(u.sdp,"audio"),f=y-room.localAudioMsids,b=checkSdpContents(room.localFirefoxSecondSDP,"audio"),_=checkSdpContents(u.sdp,"audio"),g=_-b;if(0<f&&0<g)for(var l=0;l<f;l++){var v=room.fakeAudioStreams.shift();room.localAddFakeAudioStreams.push(v),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().addStream(v),room.localAudioMsids+=1}}room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().createOffer(function(e){e.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(e.sdp,null,null,room.iceUfragForFirefox,room.icePwd),e.sdp=w(e.sdp),o=getSDPSenders(e.sdp),room.localFirefoxSecondSDP=e.sdp,log.debug("updateSdpForFirefox(), pc2 for fireofox, local sessionDescription:"+e.sdp),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().setLocalDescription(e,function(){u.sdp=setSDPSenders(u.sdp,o);var e=n.stream.payload;log.debug("payload == "+e),null!=e&&(S[s.split("\r\n")[0].replace(/\s|:|-|=/g,"")]=e),u.sdp=C(u.sdp,e,s),room.sdpForFirefox=u.sdp,log.debug("updateSdpForFirefox(), pc2 for fireofox, remote sessionDescription:"+u.sdp);var t=new RTCSessionDescription(u);room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().setRemoteDescription(t,function(){room.masterServer.subRoomResourceMsg(r,n)},function(e){log.error(e)})},I)},T,this.constraints)}(t.para1,t.para2,t.para3)}}},t.prototype.close=function(e){e&&"closed"!=e.signalingState&&e.close()},t.prototype.getInviteRoomReq1ByFirefox=function(){var e=when.defer(),s=!1,a=!1;this.getToMCUPeerConnection().createOffer(function(e){var t,r=e.sdp;if(null!=(t=preferLineSdp(r,"a=","ice-ufrag"))&&0<t.length)for(var n=0;n<t.length;n++){var o=t[n];log.debug("==========local ice-ufrag======="+o);var i=o.split(":");room.iceUfragLocal=i[1];break}if(null!=(t=preferLineSdp(r,"a=","ice-pwd"))&&0<t.length)for(n=0;n<t.length;n++){o=t[n];log.debug("=================local ice-pw============="+o);i=o.split(":");room.icePwdLocal=i[1];break}s=!0},function(e){},this.constraints),this.getToMCUPeerConnectionForFirefox().createOffer(function(e){var t,r=e.sdp;if(null!=(t=preferLineSdp(r,"a=","ice-ufrag"))&&0<t.length)for(var n=0;n<t.length;n++){var o=t[n];log.debug("==========local ice-ufrag 2======="+o);var i=o.split(":");room.iceUfragLocal2=i[1];break}if(null!=(t=preferLineSdp(r,"a=","ice-pwd"))&&0<t.length)for(n=0;n<t.length;n++){o=t[n];log.debug("=================local ice-pw 2============="+o);i=o.split(":");room.icePwdLocal2=i[1];break}a=!0},function(e){},this.constraints);var t=setInterval(function(){s&&a&&(clearInterval(t),e.resolve())},300);return e.promise},t.prototype.doSetLocalDescription=function(){var t=when.defer(),r=this;return r.getToMCUPeerConnection().createOffer(function(e){e.sdp=updateSDPIceUfrag(e.sdp,room.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),e.sdp=w(e.sdp),log.debug("doSetLocalDescription(), local sessionDescription:"+e.sdp),"firefox"==adapter.browserDetails.browser&&(room.localFirefoxSDP=e.sdp),r.getToMCUPeerConnection().setLocalDescription(e,function(){log.info("doSetLocalDescription(), set local sessionDescription success"),t.resolve()},function(e){log.error("doSetLocalDescription(), set local sessionDescription error: "+e.toString())})},function(e){log.error("doSetLocalDescription(), createOffer error:"+e.toString())},this.constraints),t.promise},t.prototype.doSetRemoteDescription=function(){sdp=updateSDPFingerPrint(remoteSDPInit,room.fingerPrint),sdp=updateSDPIceUfrag(sdp,room.iceUfrag),sdp=updateSDPIcePwd(sdp,room.icePwd),sdp=updateSDPSetup(sdp,room.setup),room.sdp=sdp;var e={};e.sdp=room.sdp,e.type="answer",e.sdp=E(e.sdp),log.debug("doSetRemoteDescription ,remote  sessionDescription:"+e.sdp);var t=new RTCSessionDescription(e);room.sdp=e.sdp;this.getToMCUPeerConnection().setRemoteDescription(t,function(){if(log.info("doSetRemoteDescription(), set remote sessionDescription success"),setRemoteDescriptionSuccess=!0,"firefox"!=adapter.browserDetails.browser&&null!=addIcecandidateList&&0<addIcecandidateList.length){for(var e=0;e<addIcecandidateList.length;e++){var t=addIcecandidateList[e];room.masterServer.setAddIcecandidate(t)}addIcecandidateList=[]}if("firefox"==adapter.browserDetails.browser){room.initFakeVideoStream(30),room.initFakeAudioStream(30)}},function(e){log.error("doSetRemoteDescription(), setRemoteDescription error:"+e)})},t.prototype.doSetLocalDescriptionForFirefox=function(){var t=when.defer(),r=this;return r.getToMCUPeerConnectionForFirefox().createOffer(function(e){e.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(e.sdp,null,null,room.iceUfragForFirefox,room.icePwd),e.sdp=w(e.sdp),log.debug("doSetLocalDescription(), pc2 for fireofox, local sessionDescription:"+e.sdp),room.localFirefoxSecondSDP=e.sdp,r.getToMCUPeerConnectionForFirefox().setLocalDescription(e,function(){log.info("doSetLocalDescription(), pc2 for fireofox, set local sessionDescription success"),t.resolve()},function(e){log.error("doSetLocalDescription(), pc2 for fireofox, set local sessionDescription error: "+e.toString())})},function(e){log.error("doSetLocalDescription(), pc2 for fireofox, createOffer error:"+e.toString())},this.constraints),t.promise},t.prototype.doSetRemoteDescriptionForFirefox=function(){sdp=updateSDPFingerPrint(remoteSDPInit,room.fingerPrint),sdp=updateSDPIceUfrag(sdp,room.iceUfragForFirefox),sdp=updateSDPIcePwd(sdp,room.icePwd),sdp=updateSDPSetup(sdp,room.setup),room.sdpForFirefox=sdp;var e={};e.sdp=room.sdpForFirefox,e.type="answer",e.sdp=E(e.sdp),log.debug("doSetRemoteDescription , pc2 for fireofox, remote  sessionDescription:"+e.sdp);var t=new RTCSessionDescription(e);room.sdpForFirefox=e.sdp,this.getToMCUPeerConnectionForFirefox().setRemoteDescription(t,function(){if(log.info("doSetRemoteDescription(), pc2 for fireofox, set remote sessionDescription success"),setRemoteDescriptionSuccessForFirefox=!0,null!=addIcecandidateList&&0<addIcecandidateList.length){for(var e=0;e<addIcecandidateList.length;e++){var t=addIcecandidateList[e];room.masterServer.setAddIcecandidate(t)}addIcecandidateList=[]}room.initFakeVideoStream(30),room.initFakeAudioStream(30)},function(e){log.error("doSetRemoteDescription(), pc2 for fireofox, setRemoteDescription error:"+e)})},t.prototype.doAddIceCandidate=function(e){log.info("============PeerConnection.addIceCandidate()==================");var t="";-1<e.candidate.indexOf("=")&&(t=e.candidate.split("=")[1]);var r="audio",n="video";"firefox"==adapter.browserDetails.browser&&(r="sdparta_0",n="sdparta_1");var o=new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:r,candidate:t});log.info("=======pc.addIceCandidate，audio："+o.candidate),loggerReport.info("PeerConnection add audio IceCandidate："+o.candidate),this.getToMCUPeerConnection().addIceCandidate(o,s,a);var i=new RTCIceCandidate({sdpMLineIndex:1,sdpMid:n,candidate:t});log.info("=======pc.addIceCandidate,video:"+i.candidate),loggerReport.info("PeerConnection add video IceCandidate："+o.candidate),this.getToMCUPeerConnection().addIceCandidate(i,s,a),"firefox"==adapter.browserDetails.browser&&(this.getToMCUPeerConnectionForFirefox().addIceCandidate(o,s,a),this.getToMCUPeerConnectionForFirefox().addIceCandidate(i,s,a))},t.prototype.addSdp=function(e,t,r,n){this.getToMCUPeerConnection().msgQueue.unshift(o("add",e,t,r,n))},t.prototype.updateSdp=function(e,t,r,n){"firefox"==adapter.browserDetails.browser?this.getToMCUPeerConnectionForFirefox().msgQueue.unshift(o("update",e,t,r)):this.getToMCUPeerConnection().msgQueue.unshift(o("update",e,t,r,n))},t.prototype.reduceSdp=function(e,t,r){this.getToMCUPeerConnection().msgQueue.unshift(o("reduce",e,t,r))},t.prototype.updateBandwidthSdp=function(e,t){this.getToMCUPeerConnection().msgQueue.unshift(o("updateBandwidth",e,t))},t.prototype.isContainsReconnectionSub=function(e,t){var r=!1;if(null!=t&&0<t.length)for(var n=0;n<t.length;n++){if(e==t[n]){r=!0;break}}return r};var f,s=function(){log.info("onAddIceCandidateSuccess()")},a=function(e){log.error("onAddIceCandidateError(),Failed to add remote candidate: "+e.toString())};function o(e,t,r,n,o){var i={};return i.operationType=e,i.para1=t,i.para2=r,i.para3=n,i.para4=o,i}function y(e,t){var r=e,n=r.split("\r\n");if(9<n.length){var o="";if(0<n[4].indexOf(t))for(var i=0;i<9;i++)""==o?o=n[i]:o+="\r\n"+n[i];else for(i=9;i<18;i++)""==o?o=n[i]:o+="\r\n"+n[i];return o}return r}function b(e){var t=e,r=t.split("\r\n");if(9<r.length){for(var n="",o=r.length-9;o<r.length;o++)""==n?n=r[o]:n+="\r\n"+r[o];return n}return t}function w(e){if(null==e||""==e)return e;var t=e;return t=(t=t.replace(/a=sendonly/g,"a=recvonly")).replace(/a=inactive/g,"a=recvonly")}function E(e){if(null==e||""==e)return e;var t=e;if(navigator.mozGetUserMedia&&(t=t.replace(/a=sendrecv/g,"a=sendonly")),"firefox"==adapter.browserDetails.browser)t=(t=(t=t.replace(/a=group:BUNDLE audio video/g,"a=group:BUNDLE sdparta_0 sdparta_1")).replace(/a=mid:audio/g,"a=mid:sdparta_0")).replace(/a=mid:video/g,"a=mid:sdparta_1");else if("chrome"==adapter.browserDetails.browser||"safari"==adapter.browserDetails.browser){if(videoCoding==VideoCodingType.VP8){var r=room.codecPayloadVP8.concat(room.codecPayloadVP9).concat(room.codecPayloadH264);t=setReplaceCoding(r,t,"video")}else if(videoCoding==VideoCodingType.VP9){r=room.codecPayloadVP9.concat(room.codecPayloadVP8).concat(room.codecPayloadH264);t=setReplaceCoding(r,t,"video")}else if(videoCoding==VideoCodingType.H264){r=room.codecPayloadH264.concat(room.codecPayloadVP8).concat(room.codecPayloadVP9);t=setReplaceCoding(r,t,"video")}if(audioCoding==AudioCodingType.opus){var n=room.codecPayloadOpus.concat(room.codecPayloadISAC_16K).concat(room.codecPayloadISAC_32K).concat(room.codecPayloadG722).concat(room.codecPayloadPCMU).concat(room.codecPayloadPCMA);t=setReplaceCoding(n,t,"audio")}else if(audioCoding==AudioCodingType.ISAC_16k){n=room.codecPayloadISAC_16K.concat(room.codecPayloadOpus).concat(room.codecPayloadISAC_32K).concat(room.codecPayloadG722).concat(room.codecPayloadPCMU).concat(room.codecPayloadPCMA);t=setReplaceCoding(n,t,"audio")}else if(audioCoding==AudioCodingType.ISAC_32k){n=room.codecPayloadISAC_32K.concat(room.codecPayloadOpus).concat(room.codecPayloadISAC_16K).concat(room.codecPayloadG722).concat(room.codecPayloadPCMU).concat(room.codecPayloadPCMA);t=setReplaceCoding(n,t,"audio")}else if(audioCoding==AudioCodingType.G722){n=room.codecPayloadG722.concat(room.codecPayloadOpus).concat(room.codecPayloadISAC_16K).concat(room.codecPayloadISAC_32K).concat(room.codecPayloadPCMU).concat(room.codecPayloadPCMA);t=setReplaceCoding(n,t,"audio")}else if(audioCoding==AudioCodingType.PCMA){n=room.codecPayloadPCMA.concat(room.codecPayloadOpus).concat(room.codecPayloadISAC_16K).concat(room.codecPayloadISAC_32K).concat(room.codecPayloadG722).concat(room.codecPayloadPCMU);t=setReplaceCoding(n,t,"audio")}else if(audioCoding==AudioCodingType.PCMU){n=room.codecPayloadPCMU.concat(room.codecPayloadOpus).concat(room.codecPayloadISAC_16K).concat(room.codecPayloadISAC_32K).concat(room.codecPayloadG722).concat(room.codecPayloadPCMA);t=setReplaceCoding(n,t,"audio")}}if(room.selfUser.screen.track){log.info("=====PC:桌面共享打开，带宽最小3M, 最大4M=========="),room.currScreenMinBandwidth%2==0?room.currScreenMinBandwidth++:room.currScreenMinBandwidth--,t=(t=t.replace(/x-google-min-bitrate=[1-9]\d*/g,"x-google-min-bitrate="+room.currScreenMinBandwidth)).replace(/x-google-max-bitrate=[1-9]\d*/g,"x-google-max-bitrate="+room.currScreenMaxBandwidth);var o=parseInt(2*(room.currScreenMinBandwidth+room.currScreenMaxBandwidth)/3);t=t.replace(/x-google-start-bitrate=[1-9]\d*/g,"x-google-start-bitrate="+o)}else if(null!=room.currMinBandwidth&&null!=room.currMaxBandwidth){room.currMinBandwidth%2==0?room.currMinBandwidth++:room.currMinBandwidth--,t=(t=t.replace(/x-google-min-bitrate=[1-9]\d*/g,"x-google-min-bitrate="+room.currMinBandwidth)).replace(/x-google-max-bitrate=[1-9]\d*/g,"x-google-max-bitrate="+room.currMaxBandwidth);o=parseInt(2*(room.currMinBandwidth+room.currMaxBandwidth)/3);t=t.replace(/x-google-start-bitrate=[1-9]\d*/g,"x-google-start-bitrate="+o)}return t}var S={};function C(e,t,r){for(var n=e.split("m=video"),o=n[0],i=1;i<n.length;i++){var s="m=video"+n[i],a="a=ssrc"+s.split("a=ssrc")[1];a=a.replace(/\s|:|-|=/g,""),S[a]?107==S[a]||120==S[a]?s=s.replace("m=video 1 RTP/SAVPF 120 121 126","m=video 1 RTP/SAVPF 126 121 120"):101==S[a]&&(s=s.replace("m=video 1 RTP/SAVPF 120 121 126","m=video 1 RTP/SAVPF 121 120 126")):-1==s.indexOf("ssrc")&&(107==t||120==t?s=s.replace("m=video 1 RTP/SAVPF 120 121 126","m=video 1 RTP/SAVPF 126 121 120"):101==t&&(s=s.replace("m=video 1 RTP/SAVPF 120 121 126","m=video 1 RTP/SAVPF 121 120 126"))),o+=s}return o}function T(e){log.error("onCreateSessionDescriptionError(),Failed to add local description: "+e.toString())}function I(e){log.error("onSetSessionDescriptionError(),Failed to add local description: "+e.toString())}return t}),ModuleBase.define("TraceableP2PPeerConnection",["Error"],function(e){var t=function(){iceServers&&0<iceServers.length?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googImprovedWifiBwe:!0}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}};t.prototype.getToP2PPeerConnection=function(e){var t=room.selfUser.toP2PPCs[e];return null==t&&(t=this.createP2PPeerConnection(e),room.selfUser.toP2PPCs[e]=t,room.selfUser.nodeId<e&&this.sendOfferP2P(t,e)),t},t.prototype.createP2PPeerConnection=function(e){var t=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleP2PPeerConnection(e,t),t},t.prototype.sendOfferP2P=function(t,r,e){var n=this.constraints;n.iceRestart=1==e;var o=this;t.createOffer(function(e){log.debug("sendOfferP2P(): P2P  local sessionDescription:"+e.sdp),t.setLocalDescription(e,l,h),room.masterServer.sendOfferP2P(e.sdp,r),o.constraints.iceRestart=!1},function(e){},n)},t.prototype.setRemoteP2P=function(t){var e={};e.sdp=t.sdp,e.type="offer";var r=new RTCSessionDescription(e);room.sdp=e.sdp,log.debug("setRemoteP2P(): P2P  session Description:"+e.sdp);var n=this.getToP2PPeerConnection(t.node_id);n.setRemoteDescription(r,function(){log.info("setRemoteP2P(): P2P  Set remote session description success."),n.createAnswer(function(e){log.debug("setRemoteP2P(): createAnswer  P2P  local sessionDescription:"+e.sdp),n.setLocalDescription(e,l,h),room.masterServer.setRemoteP2P(e.sdp,t.node_id)},function(e){log.error("setRemoteP2P(): createAnswer  P2P  local sessionDescription false.event:"+e)},this.constraints)},function(e){log.error("setRemoteP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.setAnswerP2P=function(e){var t={};t.sdp=e.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("setAnswerP2P():  P2P  session Description:"+t.sdp),this.getToP2PPeerConnection(e.node_id).setRemoteDescription(r,function(){log.debug("setAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("setAnswerP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.addIceCandidateP2P=function(e){var t=this.getToP2PPeerConnection(e.node_id);log.debug("addIceCandidateP2P(), P2P candidate:"+e.candidate);var r=new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:e.sdp_mid,candidate:e.candidate});t.addIceCandidate(r,n,o)},t.prototype.addStreamP2P=function(e){var t=this.getToP2PPeerConnection(e.sub_node_id),r=e.info.resource_id;if(1==e.info.stream.type){var n=room.splitPDUDeviceId(r),o=room.selfUser.getVideo(n).stream;null!=o&&(t.addStream(o),room.selfUser.subMyVideosP2P.push(e.sub_node_id))}else if(2==e.info.stream.type){n=room.splitPDUDeviceId(r);var i=room.selfUser.getAudio(n).stream;null!=i&&(t.addStream(i),room.selfUser.subMyAudiosP2P.push(e.sub_node_id))}else if(3==e.info.stream.type){n=room.splitPDUDeviceId(r);var s=room.selfUser.getScreen(n).stream;null!=s&&(t.addStream(s),room.selfUser.subMyScreensP2P.push(e.sub_node_id))}},t.prototype.sendSubSdpOfferP2P=function(e,t){var r;"offerSub"==e?r=this.getToP2PPeerConnection(t.info.owner_id):"answerSub"==e&&(r=this.getToP2PPeerConnection(t.sub_node_id)),r.msgQueue.unshift(i("sub",r,e,t,null))},t.prototype.sendSubSdpAnswerP2P=function(r,n,o,e,i,s){var a=i.stream.sdp,t={};t.sdp=a,t.type="offer";var c=new RTCSessionDescription(t);log.debug("sendSubSdpAnswerP2P(), P2P remote sessionDescription:"+t.sdp),log.debug("sendSubSdpAnswerP2P(): P2P  signalingState: "+n.signalingState),n.setRemoteDescription(c,function(){log.debug("sendSubSdpAnswerP2P(): P2P  Set remote session description success.");var e,t=new SdpSerializer(room.selfUser.sdpP2PMap[i.owner_id]=a);"video"==o?(e=d(e=t._inner.video.ssrcStr,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add video sdp:"+e),room.selfUser.videoSdpSsrcMapP2PMap[i.owner_id]=e):"audio"==o?(e=t._inner.audio.ssrcStr,log.debug("sendSubSdpAnswerP2P(), new add audio sdp:"+e),room.selfUser.audioSdpSsrcP2PMap[i.owner_id]=e):"desktop"==o&&(e=d(e=t._inner.video.ssrcStr,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add screen sdp:"+e),room.selfUser.screenSdpSsrcP2PMap[i.owner_id]=e),n.createAnswer(function(e){log.debug("sendSubSdpAnswerP2P(), P2P local sessionDescription:"+e.sdp),n.setLocalDescription(e,l,h),room.masterServer.sendSubSdpAnswerP2P(r,i,e.sdp,s)},f,this.constraints)},function(e){log.error(e)})},t.prototype.getSubSdpAnswerP2P=function(e){var t={};t.sdp=e.info.stream.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("getSubSdpAnswerP2P(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.sub_node_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.getSubSdpAnswerP2PByRep=function(e){var t={};t.sdp=e.info.stream.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("getSubSdpAnswerP2PByRep(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.info.owner_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2PByRep(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2PByRep(): P2P  Set remote session description false.event:"+e)})},t.prototype.removeStreamP2P=function(e,t,r){var n=this.getToP2PPeerConnection(t);"video"==e?null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove video  stream")):"audio"==e?null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove audio  stream")):"screen"==e&&null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove screen  stream"))},t.prototype.sendUnSubSdpOfferP2P=function(e,t,r,n){var o=this.getToP2PPeerConnection(r);null!=o&&"closed"!=o.signalingState&&o.msgQueue.unshift(i("unsub",o,e,t,n))},t.prototype.sendUnSubSdpAnswerP2P=function(e,t,r,n){var o,i=this.getToP2PPeerConnection(r),s={};if("unsubAnswer"==e){var a,c=n.stream.stream_name;"video"==t?a=room.selfUser.videoSdpSsrcMapP2PMap[n.owner_id]:"audio"==t?a=room.selfUser.audioSdpSsrcP2PMap[n.owner_id]:"screen"==t&&(a=room.selfUser.screenSdpSsrcP2PMap[n.owner_id]);for(var l=room.selfUser.sdpP2PMap[n.owner_id],d=a.split("\r\n"),u=0;u<d.length;u++){var p=d[u]+"\r\n";l=l.replace(p,"")}0<l.indexOf(c)&&(l=l.replace(c,"")),room.selfUser.sdpP2PMap[n.owner_id]=l,s.sdp=l,s.type="offer",o=new RTCSessionDescription(s)}else"unpubAnswer"==e&&(s.sdp=i.remoteDescription.sdp,s.type="offer",o=new RTCSessionDescription(s));log.debug("sendUnSubSdpAnswerP2P(): P2P  Remote sessionDescription:"+o.sdp),i.setRemoteDescription(o,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error(e)}),i.createAnswer(function(e){room.sdp=e.sdp,log.debug("sendUnSubSdpAnswerP2P(): P2P  local sessionDescription:"+room.sdp),i.setLocalDescription(e,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set local session description success.")},h)},f,this.constraints)},t.prototype.handleP2PPeerConnection=function(t,r){var e=when.defer();return r.msgQueue=[],r.forLog=!1,r.nodeId=t,r.onicecandidate=function(e){e.candidate?(log.debug("onicecandidate(),P2P event.candidate.candidate :"+e.candidate.candidate),room.masterServer.sendCandidateMsgP2P(e.candidate,t)):log.debug("P2P  End of candidates.")},r.onopen=function(){},r.onaddstream=function(e){if(log.debug("onaddstream(), P2P  stream id:"+e.stream.id),"default"!=e.stream.id)if(0<e.stream.getVideoTracks().length){var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.subScreenStream2ResourceInfo[e.stream.id];if(null!=t){log.debug("onaddstream(), P2P  stream type: video");(n=room.selfUser.getUserByVideoStreamLabel(e.stream.id)).getVideo(t.resource_id);n.eventEmitter.emit(UserCallback.subscrible_camera_result,e.stream,n.id,n.name,t.resource_id)}if(null!=r){log.debug("onaddstream(), P2P  stream type: screen");(n=room.selfUser.getUserByScreenStreamLabel(e.stream.id)).getScreen(r.resource_id);n.eventEmitter.emit(UserCallback.subscrible_screen_result,e.stream,n.id,n.name,r.resource_id)}}else if(0<e.stream.getAudioTracks().length){log.debug("onaddstream(), P2P  stream type: audio");var n;t=room.selfUser.subAudioStream2ResourceInfo[e.stream.id];(n=room.selfUser.getUserByAudioStreamLabel(e.stream.id)).getAudio(t.resource_id).stream=e.stream,n.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.stream,n.id,n.name)}},r.onremovestream=function(e){!function(e){if("default"!=e.id){var t=room.selfUser.subVideoStream2ResourceInfo[e.id],r=room.selfUser.getUserByVideoStreamLabel(e.id);null!=r&&(delete room.selfUser.subVideoStream2ResourceInfo[e.id],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id));var n=room.selfUser.subScreenStream2ResourceInfo[e.id],o=room.selfUser.getUserByScreenStreamLabel(e.id);null!=o&&(delete room.selfUser.subScreenStream2ResourceInfo[e.id],o.eventEmitter.emit(UserCallback.unsubscrible_screen_result,o.id,o.name,n.resource_id));var i=room.selfUser.subAudioStream2ResourceInfo[e.id],s=room.selfUser.getUserByAudioStreamLabel(e.id);if(null!=s){var a=s.getAudio(i.resource_id);a.stream=null,delete room.selfUser.subAudioStream2ResourceInfo[e.id],s.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,s.id,s.name)}}}(e.stream)},r.ondatachannel=function(e){},r.oniceconnectionstatechange=function(e){var t=e.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(),P2P iceConnectionState :"+t),t){case"disconnected":room.isMcu()||room.selfUser.nodeId<r.nodeId&&(log.debug("=======PeerConnection reconnection，send off.  self user nodeId:"+room.selfUser.nodeId+" ----\x3e download user nodeId:"+r.nodeId),room.traceableP2PPeerConnection.sendOfferP2P(r,r.nodeId,!0))}},r.onsignalingstatechange=function(e){log.debug("onsignalingstatechange(), P2P signalingState :"+e.target.signalingState),"stable"==e.target.signalingState&&0==r.forLog&&(r.forLog=!0,r.intervalSet(r))},r.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},400)},r.processSignalingMessage=function(e){if("stable"==e.signalingState&&0<e.msgQueue.length){var t=e.msgQueue.pop();log.debug("P2P 操作对列:"+t.operationType),"sub"==t.operationType?room.traceableP2PPeerConnection.sendSubSdpOfferP2PHandle(t.para1,t.para2,t.para3,t.para4):"unsub"==t.operationType&&room.traceableP2PPeerConnection.sendUnSubSdpOfferP2PHandle(t.para1,t.para2,t.para3,t.para4)}},e.promise},t.prototype.sendSubSdpOfferP2PHandle=function(t,r,n){t.createOffer(function(e){log.debug("sendSubSdpOfferP2P():  P2P  local sessionDescription:"+e.sdp),room.sdp=e.sdp,t.setLocalDescription(e,l,h),room.masterServer.sendSubSdpOfferP2P(n,e.sdp,r)},f,this.constraints)},t.prototype.sendUnSubSdpOfferP2PHandle=function(l,d,u,p){l.createOffer(function(e){log.debug("sendUnSubSdpOfferP2PHandle(): P2P  local sessionDescription:"+e.sdp),l.setLocalDescription(e,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set local session description success.");var e={};if("unpubOffer"==d){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unpubOffer"),e.sdp=l.remoteDescription.sdp,e.type="answer";var t=new RTCSessionDescription(e)}else if("unsubOffer"==d){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unsubOffer");var r,n=l.remoteDescription.sdp,o=new SdpSerializer(n);"video"==u?r=o._inner.video.ssrcStr:"audio"==u?r=o._inner.audio.ssrcStr:"screen"==u&&(r=o._inner.video.ssrcStr);for(var i=r.split("\r\n"),s=0;s<i.length;s++){var a=i[s]+"\r\n";n=n.replace(a,"")}var c=p.stream.stream_name;0<n.indexOf(c)&&(n=n.replace(c,"")),e.sdp=n,e.type="answer",t=new RTCSessionDescription(e)}log.debug("sendUnSubSdpOfferP2PHandle(): P2P  remote  sessionDescription:"+e.sdp),l.setRemoteDescription(t,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description success.")},function(e){log.error("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description false.event:"+e)})},h)},f,this.constraints)};var f=function(){};function l(){}function h(){}var n=function(){},o=function(e){log.error("onAddIceCandidateError(),Failed to add remote  P2P  candidate: "+e.toString())};function d(e,t){var r=e,n=r.split("\r\n");if(9<n.length){var o="";if(0<n[4].indexOf(t))for(var i=0;i<9;i++)""==o?o=n[i]:o+="\r\n"+n[i];else for(i=9;i<18;i++)""==o?o=n[i]:o+="\r\n"+n[i];return o}return r}function i(e,t,r,n,o){var i={};return i.operationType=e,i.para1=t,i.para2=r,i.para3=n,i.para4=o,i}return t}),ModuleBase.define("SignalFactory",["TraceableWebsocket"],function(r){var e=function(){};return e.prototype.getDataChannel=function(e){var t;switch(e){case SignalType.websocket:t=new r}return t},e}),ModuleBase.define("MessageManager",["CmdProtobufCoded","User","Board","Error"],function(qe,Ge,We,He){var e=function(){};function ze(e,t){var r=room.getUserByNodeId(e),n=new Object,o=new Date;return o.setMinutes(o.getMinutes()+o.getTimezoneOffset()),n.timestamp=o.getTime(),n.fromId=r.id,n.fromName=r.name,n.message=t,n}return e.prototype.OnWebSocketMessage=function(e){var t;null==room.cmdProtobufCoded?(t=new qe,room.cmdProtobufCoded=t):t=room.cmdProtobufCoded;var r=t.getRoomPduTypeEnum(),n=t.getMediaTypeEnum(),o=t.getResourceStatusEnum(),i=t.getResourceOptEnum(),s=t.decodePacket(e),a=s.type,c=s.priority;if(a==r.INVITE_ROOM_REP1&&0<c&&(room.isDoPDUSeq=1),1==room.isDoPDUSeq&&a!=r.PONG&&a!=r.OPEN_REP&&a!=r.INVITE_ROOM_REP1){if(log.debug("&&&&&&&&&&&&&MessageManager.OnWebSocketMessage(),packetType:"+a+",pduSeq:"+c),c<=room.lastPDUSeq)return void log.debug("&&&&&&&&&&&&&MessageManager.OnWebSocketMessage(), no todo,packetType:"+a+",pduSeq:"+c);if(log.debug("&&&&&&&&&&&&&MessageManager.OnWebSocketMessage(), doing...,packetType:"+a+",pduSeq:"+c),room.reconnectionState)return void log.debug("&&&&&&&&&&&&&MessageManager.OnWebSocketMessage(), reconnectionState=true, no todo,packetType:"+a+",pduSeq:"+c);room.lastPDUSeq=c}switch(a){case r.OPEN_REP:log.debug("acception OPEN_REP"),loggerReport.info("Acception PDU OPEN_REP");var l=t.decodeBody(e);if("failed"==room.selfUser.toMCUPC.iceConnectionState&&(log.info("======PeerConnection状态为failed，当作402重新加会处理=========="),l.result=402),0==l.result)log.info("======openRep.result：0=========="),room.reconnectionState?(log.debug("======OPEN_REP：重连成功======="),room.reconnectionState=!1,room.masterServer.pingIntervalHandle(),room.masterServer.pingTimeoutHandle(),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reconnected)):(room.pingInterval=l.ping_interval,room.pingTimeout=l.ping_timeout,room.signalTocken=l.signal_tocken,room.masterServer.pingInit(),room.reconnectionOpenRep402?(log.debug("======OPEN_REP：重新加会连接成功======="),room.lastPDUSeq=0,room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reJoinConnected)):(log.debug("======OPEN_REP：连接成功======="),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected)),room.reconnectionOpenRep402=!1,room.joinTimeoutState=!1,room.masterServer.pingIntervalHandle(),room.masterServer.pingTimeoutHandle(),room.masterServer.inviteRoomReqSend());else if(402==l.result)log.info("======openRep.result：402=========="),loggerReport.error("OPEN_REP Result：402"),room.masterServer.signalingChannel.readyState!=WebSocket.CLOSED&&room.masterServer.signalingChannel.close(),room.joinTimeoutState=!1,room.reconnectionCount=0,room.reconnectionState=!1,room.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,room.addSdpLocalStates=0,addIcecandidateList=[],room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),room.reJoin();else if(436==l.result){loggerReport.error("OPEN_REP Result Error,result:"+l.result+",description:"+l.description),log.info("OPEN_REP,openRep.result: "+l.result+",openRep.description:"+l.description),room.reconnectionState=!1;var d=new He(l.result,"客户端版本过高");room.eventEmitter.emit(EngineCallback.room_join_error,d)}else{loggerReport.error("OPEN_REP Result Error,result:"+l.result+",description:"+l.description),log.info("OPEN_REP,openRep.result: "+l.result+",openRep.description:"+l.description),room.reconnectionState=!1;d=new He(l.result,l.description);room.eventEmitter.emit(EngineCallback.room_join_error,d)}break;case r.PONG:room.pingCountTime=0;break;case r.INVITE_ROOM_REP1:log.debug("acception INVITE_ROOM_REP1"),loggerReport.info("Acception PDU INVITE_ROOM_REP1");var u=t.decodeBody(e);if(0==u.result){if(room.fingerPrint=u.finger_print,room.setup=u.setup,"firefox"==adapter.browserDetails.browser){var p=u.ice_ufrag.split(":"),f=u.ice_pwd.split(":");room.iceUfrag=p[0],room.icePwd=f[0],room.iceUfragForFirefox=p[1],room.icePwdForFirefox=f[1]}else room.iceUfrag=u.ice_ufrag,room.icePwd=u.ice_pwd;if(room.roomTocken=u.room_tocken,room.roomInfo=u.room_info,room.roomInfo.room_id!=room.id&&(room.outgoingAddr=room.id,room.id=room.roomInfo.room_id),room.setRemoteDescriptionSuccess=!1,room.masterServer.sendOffer(),0==room.reconnectionCount){room.selfUser.nodeId=u.node_id,room.selfUser.role=1,null!=u.role&&(room.selfUser.role=u.role);var h=room.avdEngine.cameraMap;for(var m in h){var g=h[m];room.selfUser.initVideo(m,g)}if(null!=room.avdEngine.checkMicrophoneId&&room.selfUser.initAudio(room.avdEngine.checkMicrophoneId,room.avdEngine.checkMicrophoneName),room.selfUser.initScreen(),room.addUser(room.selfUser),room.reJoinRoomCount=0,log.info("join room  Success! your nodeId:"+room.selfUser.nodeId+"; userId:"+room.selfUser.id+"; roomId:"+room.id),loggerReport.info("加会成功！房间号:"+room.id+",nodeId:"+room.selfUser.nodeId+",userId:"+room.selfUser.id+",userName:"+room.selfUser.name),console.log("QQQQQQQQQQQQQQQQ00000000000000"),null!=room.selfUser.reJoinPubVideoIds&&0<room.selfUser.reJoinPubVideoIds.length){console.log("QQQQQQQQQQQQQQQQ1111111111111");for(var v=0;v<room.selfUser.reJoinPubVideoIds.length;v++){console.log("QQQQQQQQQQQQQQQQ2222222222222");var y=room.selfUser.getVideo(room.selfUser.reJoinPubVideoIds[v]);console.log("QQQQQQQQQQQQQQQQ3333333333333333"),room.selfUser.reJoinPubVideoElements[v]?(console.log("QQQQQQQQQQQQQQQQ444444444444444"),y.previewAndPublish(room.selfUser.reJoinPubVideoElements[v]).then(function(){console.log("QQQQQQQQQQQQQQQQ5555555555"),log.debug("402后重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,有视频控件，videoId:"+y.id)}).otherwise(function(e){console.log("QQQQQQQQQQQQQQQQ666666666666"),log.debug("402后重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,有视频控件，videoId:"+y.id+",pub error:"+e)})):(console.log("QQQQQQQQQQQQQQQQ77777777777"),y.publish().then(function(){console.log("QQQQQQQQQQQQQQQQ88888888"),log.debug("402后重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,没有视频控件，videoId:"+y.id)}).otherwise(function(e){console.log("QQQQQQQQQQQQQQQQ9999999"),log.debug("402后重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频，没有视频控件，videoId:"+y.id+",pub error:"+e)}))}}if(room.selfUser.reJoinPubAudioId)(X=room.selfUser.getAudio(room.selfUser.reJoinPubAudioId)).openMicrophone().then(function(){log.debug("402后，重新加会，加会前如已经打开音频，重新加会后需要再次打开音频，audioId:"+X.id)}).otherwise(function(e){log.debug("402后，重新加会，加会前如已经打开音频，重新加会后需要再次打开音频，audioId:"+X.id+",pub error:"+e)});clearTimeout(room.reJoinAfterTimer),room.reJoinAfterTimer=setTimeout(function(){if(log.debug("重新加会后，启动定时器(暂定30秒后)，去判断在重新加会过程中的那些离开用户，进行用户退出操作..."),room&&room.participants){var e=arrayUtil.chajiObject(room.participants,room.reJoinAfterUsers);if(null!=e&&0<e.length)for(var t=0;t<e.length;t++){var r=e[t];if(r!=room.selfUser.nodeId){var n=room.getUserByNodeId(r);null!=n&&(log.debug("重新加会后，已离开的用户退出操作，nodeId:"+r+"，name:"+n.name),room.removeUser(n.id),room.eventEmitter.emit(RoomCallback.user_leave_notify,1,null,n))}}room.reJoinAfterUsers=[]}},3e4)}room.eventEmitter.emit(EngineCallback.room_join_success,room);break}if(402==u.result)log.info("======INVITE_ROOM_REP1,inviteRoomRep1.result：402=========="),loggerReport.error("INVITE_ROOM_REP1 Result：402"),room.masterServer.signalingChannel.readyState!=WebSocket.CLOSED&&room.masterServer.signalingChannel.close(),room.joinTimeoutState=!1,room.reconnectionCount=0,room.reconnectionState=!1,room.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,room.addSdpLocalStates=0,addIcecandidateList=[],room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),room.reJoin();else{loggerReport.error("INVITE_ROOM_REP1 Result Error,result:"+u.result+",description:"+u.description),log.info("INVITE_ROOM_REP1,inviteRoomRep1.result: "+u.result+",inviteRoomRep1.description:"+u.description);d=new He(u.result,u.description);room.eventEmitter.emit(EngineCallback.room_join_error,d)}break;case r.CANDIDATE_MSG1:log.debug("acception CANDIDATE_MSG1");var b=t.decodeBody(e);log.info("mcu send  CANDIDATE_MSG1:"+b.candidate),"firefox"==adapter.browserDetails.browser?setRemoteDescriptionSuccess&&setRemoteDescriptionSuccessForFirefox?room.masterServer.setAddIcecandidate(b):addIcecandidateList.push(b):setRemoteDescriptionSuccess?room.masterServer.setAddIcecandidate(b):addIcecandidateList.push(b);break;case r.ICE_RESTART_MSG:log.debug("mcu acception ICE_RESTART_MSG");var _=t.decodeBody(e);room.remoteICERestart(_);break;case r.ROOM_RESOURCE_INFOS:log.debug("acception ROOM_RESOURCE_INFOS");var S=t.decodeBody(e).resource_infos;for(var m in S){if(!(z=S[m]))break;if(!z.stream)break;switch(z.stream.type){case n.video:if(log.info("accept video  JOIN_REP(PUB_ROOM_RESOURCE): "+z.owner_id+"------\x3e"+room.selfUser.nodeId),room.traceablePeerConnection.isContainsReconnectionSub(z.resource_id,room.selfUser.reJoinSubVideoIds)){log.debug("ROOM_RESOURCE_INFOS,video contains true");var w=room.getUserByNodeId(z.owner_id);(y=w.getVideo(z.resource_id)).resourceInfo=z,y.subscrible()}else{if(log.debug("ROOM_RESOURCE_INFOS,video contains false"),w=room.getUserByNodeId(z.owner_id))null==(y=w.getVideo(z.resource_id))&&(y=w.createVideo(z.resource_id,"")),y.resourceInfo=z,y.ownerId=w.id,room.hasObject(room.pubVideos,y)||room.pubVideos.push(y),(B=[]).push(y),log.debug("ROOM_RESOURCE_INFOS,video contains false，todo emit"),w.eventEmitter.emit(UserCallback.camera_status_notify,y.status,y.id,y.name,w.id),w.eventEmitter.emit(UserCallback.publish_camera_notify,B)}break;case n.audio:if(log.info("accept audio  JOIN_REP(PUB_ROOM_RESOURCE): "+z.owner_id+"------\x3e"+room.selfUser.nodeId),room.traceablePeerConnection.isContainsReconnectionSub(z.resource_id,room.selfUser.reJoinSubAudioIds))log.debug("ROOM_RESOURCE_INFOS,audio contains true"),room.masterServer.audioSubscribleHandle(z);else if(log.debug("ROOM_RESOURCE_INFOS,audio contains false"),w=room.getUserByNodeId(z.owner_id))null==(X=w.getAudio(z.resource_id))&&(X=w.createAudio(z.resource_id,"")),X.resourceInfo=z,room.hasObject(room.pubAudios,X)||room.pubAudios.push(X),(j=[]).push(X),audioAutoSub?(room.selfUser.subAudioIds.push(X.id),room.masterServer.audioSubscribleHandle(z)):w.eventEmitter.emit(UserCallback.publish_microphone_notify,j),log.debug("ROOM_RESOURCE_INFOS,audio contains false，todo emit"),w.eventEmitter.emit(UserCallback.microphone_status_notify,X.status,X.id,X.name,w.id);break;case n.desktop:if(log.info("accept desktop  JOIN_REP(PUB_ROOM_RESOURCE): "+z.owner_id+"------\x3e"+room.selfUser.nodeId),room.traceablePeerConnection.isContainsReconnectionSub(z.resource_id,room.selfUser.reJoinSubScreenIds))log.debug("ROOM_RESOURCE_INFOS,screen contains true"),(Y=(w=room.getUserByNodeId(z.owner_id)).getScreen(z.resource_id)).resourceInfo=z,Y.subscrible();else if(log.debug("ROOM_RESOURCE_INFOS,screen contains false"),w=room.getUserByNodeId(z.owner_id))null==(Y=w.getScreen(z.resource_id))&&(Y=w.createScreen(z.resource_id,"")),Y.resourceInfo=z,Y.ownerId=w.id,room.pubScreens.push(Y),(F=[]).push(Y),log.debug("ROOM_RESOURCE_INFOS,screen contains false，todo emit"),w.eventEmitter.emit(UserCallback.screen_status_notify,Y.status,Y.id,Y.name,w.id),w.eventEmitter.emit(UserCallback.publish_screen_notify,F)}}break;case r.USER_INFO_MSG:log.debug("acception USER_INFO_MSG");var E=t.decodeBody(e);if(null==E)return;var C=[];E.user.forEach(function(e){var r=new Ge(e.user_id,e.user_name,null,null);r.nodeId=e.node_id,r.role=e.role,r.userAgent=e.user_agent,r.data=e.user_data,room.reJoinAfterUsers.push(r),e.webcams.forEach(function(e){var t=r.createVideo(e.id,e.name);t.status=e.status,t.cameraType=e.ctype,t.level=e.level,t.description=e.description,t.streamName=e.stream_name,t.streamNickName=e.stream_nick_name}),e.speakers.forEach(function(e){r.createAudio(e.id,e.name).status=e.status}),e.desktops.forEach(function(e){var t=r.createScreen(e.id,e.name);t.status=e.status,t.level=e.level,t.description=e.description}),room.hasUser(r.id)?(log.debug("402重新加会后nodeId会变，更新处理"),room.getUser(r.id).nodeId=e.node_id):(room.addUser(r),C.push(r)),room.isMcu()||room.p2pServer.createP2PPeerConnection(r.nodeId)}),room.eventEmitter.emit(RoomCallback.user_join_notify,C);break;case r.ADD_WEBCAM_MSG:log.debug("acception ADD_WEBCAM_MSG");var T=t.decodeBody(e);if(w=room.getUserByNodeId(T.node_id)){var I=T.webcam;(y=w.createVideo(I.id,I.name)).status=I.status,y.cameraType=I.ctype,y.level=I.level,y.description=I.description,y.streamName=I.stream_name,y.streamNickName=I.stream_nick_name,w.eventEmitter.emit(UserCallback.camera_status_notify,I.status,I.id,I.name,w.id)}break;case r.ADD_SPEAKER_MSG:log.debug("acception ADD_SPEAKER_MSG");var R=t.decodeBody(e);if(w=room.getUserByNodeId(R.node_id)){var P=R.speaker;(X=w.createAudio(P.id,P.name)).status=P.status,w.eventEmitter.emit(UserCallback.microphone_status_notify,P.status,P.id,P.name,w.id)}break;case r.ADD_DESKTOP_MSG:log.debug("acception ADD_DESKTOP_MSG");var x=t.decodeBody(e);if(w=room.getUserByNodeId(x.node_id)){var M=x.desktop;(Y=w.createScreen(M.id,M.name)).status=M.status,Y.level=M.level,Y.description=M.description,w.eventEmitter.emit(UserCallback.screen_status_notify,M.status,M.id,M.name,w.id)}break;case r.REMOVE_WEBCAM_MSG:log.debug("acception REMOVE_WEBCAM_MSG");var k=t.decodeBody(e),A=(w=room.getUserByNodeId(k.node_id)).getVideo(k.resource_id);w.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,A.id,A.name,w.id),arrayUtil.objectSplice(w.videos,k.resource_id);break;case r.REMOVE_SPEAKER_MSG:log.debug("acception REMOVE_SPEAKER_MSG");var O=t.decodeBody(e);(w=room.getUserByNodeId(O.node_id)).eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,w.audio.id,w.audio.name,w.id),w.audio.id==O.resource_id&&(w.audio=null);break;case r.REMOVE_DESKTOP_MSG:log.debug("acception REMOVE_DESKTOP_MSG");var U=t.decodeBody(e);(w=room.getUserByNodeId(U.node_id)).eventEmitter.emit(UserCallback.screen_status_notify,StreamStatus.none,w.screen.id,w.screen.name,w.id),w.screen.id==U.resource_id&&(w.screen=null);break;case r.UPDATE_SPEAKER_MSG:log.debug("acception UPDATE_SPEAKER_MSG");var L=t.decodeBody(e);w=room.getUserByNodeId(L.node_id);(X=w.getAudio(L.resource_id)).status=L.speaker.status,w.eventEmitter.emit(UserCallback.microphone_status_notify,X.status,X.id,X.name,w.id);break;case r.UPDATE_WEBCAM_MSG:log.debug("acception UPDATE_WEBCAM_MSG");var D=t.decodeBody(e);w=room.getUserByNodeId(D.node_id);(y=w.getVideo(D.resource_id)).level=D.webcam.level,y.description=D.webcam.description,y.streamName=D.webcam.stream_name,y.streamNickName=D.webcam.stream_nick_name,w.eventEmitter.emit(UserCallback.camera_data_notify,y.level,y.description,y.id,y.name,w.id);break;case r.UPDATE_DESKTOP_MSG:log.debug("acception UPDATE_DESKTOP_MSG");var N=t.decodeBody(e);(Y=(w=room.getUserByNodeId(N.node_id)).getScreen(N.resource_id)).level=N.desktop.level,Y.description=N.desktop.description,w.eventEmitter.emit(UserCallback.screen_data_notify,Y.level,Y.description,Y.id,Y.name,w.id);break;case r.PUB_ROOM_RESOURCE_MSG:if(log.debug("acception PUB_ROOM_RESOURCE_MSG"),(z=t.decodeBody(e).info).stream.type==n.video){log.info("accept video  PUB_ROOM_RESOURCE_MSG: "+z.owner_id+"------\x3e"+room.selfUser.nodeId);var B=[];if(w=room.getUserByNodeId(z.owner_id))null==(y=w.getVideo(z.resource_id))&&(y=w.createVideo(z.resource_id,"")),y.resourceInfo=z,y.status=StreamStatus.published,y.ownerId=w.id,B.push(y),room.hasObject(room.pubVideos,y)||room.pubVideos.push(y),w.eventEmitter.emit(UserCallback.camera_status_notify,y.status,y.id,y.name,w.id),w.eventEmitter.emit(UserCallback.publish_camera_notify,B)}else if(z.stream.type==n.audio){log.info("accept audio  PUB_ROOM_RESOURCE_MSG: "+z.owner_id+"------\x3e"+room.selfUser.nodeId);var j=[];if(w=room.getUserByNodeId(z.owner_id))null==(X=w.getAudio(z.resource_id))&&(X=w.createAudio(z.resource_id,"")),X.resourceInfo=z,X.status=StreamStatus.published,X.ownerId=w.id,j.push(X),room.hasObject(room.pubAudios,X)||room.pubAudios.push(X),w.eventEmitter.emit(UserCallback.microphone_status_notify,X.status,X.id,X.name,w.id),audioAutoSub?(room.selfUser.subAudioIds.push(X.id),room.masterServer.audioSubscribleHandle(z)):w.eventEmitter.emit(UserCallback.publish_microphone_notify,j)}else if(z.stream.type==n.desktop){log.info("accept screen  PUB_ROOM_RESOURCE_MSG: "+z.owner_id+"------\x3e"+room.selfUser.nodeId);var F=[];if(w=room.getUserByNodeId(z.owner_id))null==(Y=w.getScreen(z.resource_id))&&(Y=w.createScreen(z.resource_id,"")),Y.resourceInfo=z,Y.status=StreamStatus.published,Y.ownerId=w.id,F.push(Y),room.pubScreens.push(Y),w.eventEmitter.emit(UserCallback.screen_status_notify,Y.status,Y.id,Y.name,w.id),w.eventEmitter.emit(UserCallback.publish_screen_notify,F)}break;case r.PUB_ROOM_RESOURCE_MSG_REP:log.debug("acception PUB_ROOM_RESOURCE_MSG_REP");var V=t.decodeBody(e),q=V.id,G=V.result,W=V.description;if(0==G)room.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_success,q);else{log.info("pubRoomResourceMsgRep.result: "+G+",pubRoomResourceMsgRep.description:"+W);var H=new He(G,W);room.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_error,H,q)}break;case r.UNPUB_ROOM_RESOURCE_MSG:var z;if(log.debug("acception UNPUB_ROOM_RESOURCE_MSG"),(z=t.decodeBody(e).info).stream.type==n.video){log.info("accept video  UNPUB_ROOM_RESOURCE_MSG: "+z.owner_id+"------\x3e"+room.selfUser.nodeId);w=room.getUserByNodeId(z.owner_id);(y=w.getVideo(z.resource_id)).status=o.init,w.eventEmitter.emit(UserCallback.camera_status_notify,y.status,y.id,y.name,w.id),w.eventEmitter.emit(UserCallback.unpublish_camera_notify,y),arrayUtil.objectSplice(room.pubVideos,z.resource_id)}else if(z.stream.type==n.audio){log.info("accept audio  UNPUB_ROOM_RESOURCE_MSG: "+z.owner_id+"------\x3e"+room.selfUser.nodeId);w=room.getUserByNodeId(z.owner_id);(X=w.getAudio(z.resource_id)).status=o.init,w.eventEmitter.emit(UserCallback.microphone_status_notify,X.status,X.id,X.name,w.id),audioAutoSub?(arrayUtil.baseSplice(room.selfUser.subAudioIds,this.id),room.masterServer.audioUnsubscribleHandle(z)):w.eventEmitter.emit(UserCallback.unpublish_microphone_notify,X),arrayUtil.objectSplice(room.pubAudios,z.resource_id)}else if(z.stream.type==n.desktop){var Y;log.info("accept screen  UNPUB_ROOM_RESOURCE_MSG: "+z.owner_id+"------\x3e"+room.selfUser.nodeId),(Y=(w=room.getUserByNodeId(z.owner_id)).getScreen(z.resource_id)).status=o.init,w.eventEmitter.emit(UserCallback.screen_status_notify,Y.status,Y.id,Y.name,w.id),w.eventEmitter.emit(UserCallback.unpublish_screen_notify,Y),arrayUtil.objectSplice(room.pubScreens,z.resource_id)}break;case r.VIDEO_INDICTION:log.debug("acception VIDEO_INDICTION");var Q=t.decodeBody(e),K=room.splitPDUDeviceId(Q.resource_id);y=room.selfUser.getVideo(K);Q.opt==i.pub?y.publish():Q.opt==i.unpub&&y.unpublish();break;case r.AUDIO_INDICTION:log.debug("acception AUDIO_INDICTION");Q=t.decodeBody(e);var J=room.splitPDUDeviceId(Q.resource_id),X=room.selfUser.getAudio(J);Q.opt==i.pub?X.openMicrophone():Q.opt==i.unpub&&X.closeMicrophone();break;case r.PUBLIC_TEXT_MSG:log.debug("acception PUBLIC_TEXT_MSG");var $=t.decodeBody(e),Z=ze(s.src,$.content);room.eventEmitter.emit(RoomCallback.public_message,Z);break;case r.PRIVATE_TEXT_MSG:log.debug("acception PRIVATE_TEXT_MSG");$=t.decodeBody(e),Z=ze(s.src,$.content);room.eventEmitter.emit(RoomCallback.private_message,Z);break;case r.PUBLIC_DATA:log.debug("acception PUBLIC_DATA");var ee=t.decodeBody(e);w=room.getUserByNodeId(s.src);room.eventEmitter.emit(RoomCallback.public_data,ee.content.toArrayBuffer(),w.id);break;case r.PRIVATE_DATA:log.debug("acception PRIVATE_DATA");ee=t.decodeBody(e),w=room.getUserByNodeId(s.src);room.eventEmitter.emit(RoomCallback.private_data,ee.content.toArrayBuffer(),w.id);break;case r.UPDATE_USER_DATA_MSG:log.debug("acception UPDATE_USER_DATA_MSG");var te=t.decodeBody(e);(w=room.getUserByNodeId(te.node_id)).data=te.user_data,room.eventEmitter.emit(RoomCallback.user_data_notify,te.user_data,w.id);break;case r.ROOM_DATA_INFO:log.debug("acception ROOM_DATA_INFO");var re=t.decodeBody(e).kvs;if(null!=re)for(v=0;v<re.length;++v){var ne=re[v];room.appData[ne.key]=ne.value,room.eventEmitter.emit(RoomCallback.app_data_notify,ne.key,ne.value),ne.key==appDataKeyEnum.voiceActivated&&ne.value==room.selfUser.id&&(console.log("===========ROOM_DATA_INFO,voice_activated"),room.voiceActivatedHandler())}break;case r.USER_INDICTION:log.debug("acception USER_INDICTION");var oe=t.decodeBody(e);if(oe.type==r.USER_MSG){var ie=t.decodeUserMsg(oe.body),se=room.getUserId(oe.operator_id);room.eventEmitter.emit(RoomCallback.leave_indication,ie.reason,se);room.leave(ie.reason,!0)}break;case r.USER_MSG:log.debug("acception USER_MSG");ie=t.decodeBody(e);if(null==(w=room.getUserByNodeId(ie.node_id)))break;if(null!=w.videos&&0<w.videos.length)for(var m in w.videos){(y=w.videos[m]).resourceInfo&&(null!=room.pubVideos&&0<room.pubVideos.length&&arrayUtil.objectSplice(room.pubVideos,y.id),null!=room.selfUser.subVideoIds&&0<room.selfUser.subVideoIds.length&&(y.unsubscrible(),arrayUtil.baseSplice(room.selfUser.subVideoIds,y.id)),y.resourceInfo&&y.track&&delete room.selfUser.subVideoTrack2ResourceInfo[y.track.id])}return null!=w.audio&&(null!=room.pubAudios&&0<room.pubAudios.length&&arrayUtil.objectSplice(room.pubAudios,w.audio.id),null!=room.selfUser.subAudioIds&&0<room.selfUser.subAudioIds.length&&(w.audio.resourceInfo&&room.masterServer.audioUnsubscribleHandle(w.audio.resourceInfo),arrayUtil.baseSplice(room.selfUser.subAudioIds,w.audio.id)),w.audio.resourceInfo&&w.audio.track&&delete room.selfUser.subAudioTrack2ResourceInfo[w.audio.track.id]),null!=w.screen&&(null!=room.pubScreens&&0<room.pubScreens.length&&arrayUtil.objectSplice(room.pubScreens,w.screen.id),null!=room.selfUser.subScreenIds&&0<room.selfUser.subScreenIds.length&&(w.screen.resourceInfo&&w.screen.unsubscrible(),arrayUtil.baseSplice(room.selfUser.subScreenIds,w.screen.id)),w.screen.resourceInfo&&w.screen.track&&delete room.selfUser.subScreenTrack2ResourceInfo[w.screen.track.id]),room.removeUser(w.id),804==ie.reason?void(w.id==room.selfUser.id?(room.selfUser.mulLanding=!0,room.masterServer.pingInit(),room.eventEmitter.emit(RoomCallback.leave_indication,ie.reason,room.selfUser.id)):room.eventEmitter.emit(RoomCallback.user_leave_notify,ie.opt,ie.reason,w)):808==ie.reason?void(w.id==room.selfUser.id?(room.masterServer.pingInit(),room.eventEmitter.emit(RoomCallback.leave_indication,ie.reason,room.selfUser.id)):room.eventEmitter.emit(RoomCallback.user_leave_notify,ie.opt,ie.reason,w)):809==ie.reason?void(w.id==room.selfUser.id?(room.masterServer.pingInit(),room.eventEmitter.emit(RoomCallback.leave_indication,ie.reason,room.selfUser.id)):room.eventEmitter.emit(RoomCallback.user_leave_notify,ie.opt,ie.reason,w)):void room.eventEmitter.emit(RoomCallback.user_leave_notify,ie.opt,ie.reason,w);case r.CLOSE_ROOM_REP:log.debug("acception CLOSE_ROOM_REP");var ae=t.decodeBody(e);room.eventEmitter.emit(RoomCallback.close_room_result,ae.result,ae.description);break;case r.CLOSE_ROOM_MSG:log.debug("acception CLOSE_ROOM_MSG");var ce=t.decodeBody(e);room.userClearInfo(),room.eventEmitter.emit(RoomCallback.close_room_notify,ce.room_id,ce.reason);break;case r.UPDATE_USER_NAME:log.debug("acception UPDATE_USER_NAME");var le=t.decodeBody(e);w=room.getUserByNodeId(le.node_id);for(var de in room.participants)room.participants[de].id==w.id&&(room.participants[de].name=le.new_name);room.eventEmitter.emit(RoomCallback.user_name_notify,le.new_name,w.id);break;case r.MODIFY_RESOURCE_REQ:log.debug("acception MODIFY_RESOURCE_REQ");var ue=t.decodeBody(e);log.debug("on modify resource req,resource_id:"+ue.info.resource_id);var pe=room.splitPDUDeviceId(ue.info.resource_id);null!=(y=room.selfUser.getVideo(pe))&&(log.debug("modify resource req,videoId:"+y.id+",video_level:"+ue.video_level),y.changePublishVideoQuality(ue.video_level));break;case r.BIND_AUDIO_TO_VIDEO_REP:log.debug("acception BIND_AUDIO_TO_VIDEO_REP");var fe=t.decodeBody(e);fe&&0==fe.result?room.eventEmitter.emit(RoomCallback.bind_audio2video_rep_success,fe.id):room.eventEmitter.emit(RoomCallback.bind_audio2video_rep_error,fe.id);break;case r.ROOM_ATTRIBUTE_CHANGE_NOTIFY:log.debug("acception ROOM_ATTRIBUTE_CHANGE_NOTIFY");var he=t.decodeBody(e);if(he){var me=he.attributes;if(me){var ge=JSON.parse(me);ge.record&&(room.roomControl.record=ge.record),ge.mix_record&&(room.roomControl.mix_record=ge.mix_record),ge.avc_model&&(room.roomControl.avc_model=ge.avc_model),ge.resolution&&(room.roomControl.resolution=ge.resolution),ge.liver&&(room.roomControl.liver=ge.liver),ge.mixer_liver&&(room.roomControl.mixer_liver=ge.mixer_liver),room.eventEmitter.emit(RoomCallback.room_control_change_notify,room.roomControl)}}break;case r.OFFER_REQ:log.debug("P2P acception OFFER_REQ");var ve=t.decodeBody(e);room.traceableP2PPeerConnection.setRemoteP2P(ve);break;case r.OFFER_REP:log.debug("P2P acception OFFER_REP");var ye=t.decodeBody(e);room.traceableP2PPeerConnection.setAnswerP2P(ye);break;case r.CANDIDATE_MSG:log.debug("P2P acception CANDIDATE_MSG");b=t.decodeBody(e);room.traceableP2PPeerConnection.addIceCandidateP2P(b);break;case r.SUB_ROOM_RESOURCE_REQ:log.debug("P2P acception SUB_ROOM_RESOURCE_REQ");var be=t.decodeBody(e);if(room.selfUser.nodeId>be.sub_node_id){room.traceableP2PPeerConnection.addStreamP2P(be);var _e=be.info,Se=room.traceableP2PPeerConnection.getToP2PPeerConnection(be.sub_node_id);_e.stream.type==n.video?(log.info("accept video P2P SUB_ROOM_RESOURCE_REQ: "+be.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subVideoStream2ResourceInfo[_e.stream.stream_name]=_e,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Se,"video",1,_e,be.sub_node_id)):_e.stream.type==n.audio?(log.info("accept audio P2P SUB_ROOM_RESOURCE_REQ: "+be.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subAudioStream2ResourceInfo[_e.stream.stream_name]=_e,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Se,"audio",1,_e,be.sub_node_id)):_e.stream.type==n.desktop&&(log.info("accept desktop P2P  SUB_ROOM_RESOURCE_REQ: "+be.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subScreenStream2ResourceInfo[_e.stream.stream_name]=_e,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Se,"desktop",1,_e,be.sub_node_id))}else room.traceableP2PPeerConnection.addStreamP2P(be),room.traceableP2PPeerConnection.sendSubSdpOfferP2P("answerSub",be);break;case r.SUB_ROOM_RESOURCE_REP:log.debug("P2P acception SUB_ROOM_RESOURCE_REP, TO sub");var we=t.decodeBody(e);if(room.selfUser.nodeId>we.info.owner_id){_e=we.info,Se=room.traceableP2PPeerConnection.getToP2PPeerConnection(_e.owner_id);_e.stream.type==n.video?(room.selfUser.subVideoStream2ResourceInfo[_e.stream.stream_name]=_e,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Se,"video",1,_e,_e.owner_id)):_e.stream.type==n.audio?(room.selfUser.subAudioStream2ResourceInfo[_e.stream.stream_name]=_e,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Se,"audio",1,_e,_e.owner_id)):_e.stream.type==n.desktop&&(room.selfUser.subScreenStream2ResourceInfo[_e.stream.stream_name]=_e,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Se,"desktop",1,_e,_e.owner_id))}else room.traceableP2PPeerConnection.getSubSdpAnswerP2PByRep(we);break;case r.SUB_ROOM_RESOURCE_MSG:log.debug("P2P acception SUB_ROOM_RESOURCE_MSG");var Ee=t.decodeBody(e);room.traceableP2PPeerConnection.getSubSdpAnswerP2P(Ee);break;case r.UPDATE_BOARD_MSG:log.debug("acception UPDATE_BOARD_MSG");var Ce=t.decodeBody(e);log.debug("acception UPDATE_BOARD_MSG,updateBoardMsg",Ce),setTimeout(function(){var e=room.getUser(Ce.operUserId);if(Ce.operType==OperType.add){var t=Ce.board.bgColor,r=t.r+","+t.g+","+t.b+","+t.a/255;(n=new We(Ce.board.ownerUserId,Ce.board.width,Ce.board.height,r,Ce.board.bgImage,Ce.board.title,Ce.board.description,Ce.board.extendData)).setBoardId(Ce.board.objectId),e.boards.push(n),room.boardId2userId[n.id]=e.id,e.eventEmitter.emit(UserCallback.board_add_result,n)}else if(Ce.operType==OperType.remove)arrayUtil.objectSplice(e.boards,Ce.boardId),delete room.boardId2userId[e.id],delete room.annotation2boardId[Ce.boardId],e.eventEmitter.emit(UserCallback.board_remove_result,Ce.boardId);else if(Ce.operType==OperType.share){(n=(e=room.getUser(room.boardId2userId[Ce.boardId])).getBoard(Ce.boardId)).status=boardStatusEnum.open,room.annotation2boardId[Ce.boardId]&&room.updateAnnotationDrow(room.annotation2boardId[Ce.boardId].queueArr),e.eventEmitter.emit(UserCallback.board_share_result,n)}else if(Ce.operType==OperType.close){var n;if((n=(e=room.getUser(room.boardId2userId[Ce.boardId])).getBoard(Ce.boardId)).status=boardStatusEnum.close,n.annotation=null,room.annotation2boardId[Ce.boardId])for(var o in room.annotation2boardId[Ce.boardId].storageArr)room.annotation2boardId[Ce.boardId].queueArr.push(room.annotation2boardId[Ce.boardId].storageArr[o]);e.eventEmitter.emit(UserCallback.board_close_result,Ce.boardId)}},500);break;case r.BOARDS_INFO_PDU:log.debug("acception BOARDS_INFO_PDU");var Te=t.decodeBody(e);break;case r.UPDATE_ANNOTATION_MSG:log.debug("acception UPDATE_ANNOTATION_MSG");var Ie=t.decodeBody(e);if(room.addAnnotationMsg(Ie),w=room.getUser(room.boardId2userId[Ie.objectId])){var Re=w.getBoard(Ie.objectId);console.log(room.annotation2boardId[Ie.objectId]),Re&&Re.status==boardStatusEnum.open&&room.updateAnnotationDrow(room.annotation2boardId[Ie.objectId].queueArr)}break;case r.OUTGOING_CREATE_STREAMS_EXPORTER_REP:log.debug("acception OUTGOING_CREATE_STREAMS_EXPORTER_REP");var Pe=t.decodeBody(e);if(console.log("outgoingCreateStreamsExporterRep:",Pe),0==Pe.result)log.debug("acception OUTGOING_CREATE_STREAMS_EXPORTER_REP,outgoingCreateStreamsExporterRep:",Pe),room.eventEmitter.emit(ExporderCallBack.create_server_recorder_rep_success,Pe.id,Pe.exporter_id,Pe.exporter_name,Pe.play_urls);else{var xe=new He(Pe.result,Pe.msg);room.eventEmitter.emit(ExporderCallBack.create_server_recorder_rep_error,xe,Pe.id)}break;case r.OUTGOING_SELECT_STREAM_REP:log.debug("acception OUTGOING_SELECT_STREAM_REP");var Me=t.decodeBody(e);if(0==Me.result)room.eventEmitter.emit(ExporderCallBack.select_stream_rep_success,Me.id,Me.exporter_id);else{var ke=new He(Me.result,Me.msg);room.eventEmitter.emit(ExporderCallBack.select_stream_rep_error,ke,Me.id)}console.log("selectStreamRep:",Me);break;case r.OUTGOING_MIX_STREAMS_REP:log.debug("acception OUTGOING_MIX_STREAMS_REP");var Ae=t.decodeBody(e);if(0==Ae.result)room.eventEmitter.emit(ExporderCallBack.mix_media_rep_success,Ae.id,Ae.exporter_id);else{ke=new He(Ae.result,Ae.msg);room.eventEmitter.emit(ExporderCallBack.mix_media_rep_error,ke,Ae.id)}console.log("mixStreamsRep:",Ae);break;case r.OUTGOING_PAUSE_RESUME_EXPORTER_REP:log.debug("acception OUTGOING_PAUSE_RESUME_EXPORTER_REP");var Oe=t.decodeBody(e);if(0==Oe.result)room.eventEmitter.emit(ExporderCallBack.pause_stream_rep_success,Oe.id,Oe.exporter_id);else{ke=new He(Oe.result,Oe.msg);room.eventEmitter.emit(ExporderCallBack.pause_stream_rep_error,ke,Oe.id)}console.log("pauseResumeRep:",Oe);break;case r.OUTGOING_DESTROY_EXPORTER_REP:log.debug("acception OUTGOING_DESTROY_EXPORTER_REP ");var Ue=t.decodeBody(e);if(0==Ue.result)room.eventEmitter.emit(ExporderCallBack.stop_stream_rep_success,Ue.id,Ue.exporter_id);else{ke=new He(Ue.result,Ue.msg);room.eventEmitter.emit(ExporderCallBack.stop_stream_rep_error,ke,Ue.id)}console.log("stopStreamRep:",Ue);break;case r.OUTGOING_EXPORTER_ERROR_NOTIFY:log.debug("acception OUTGOING_EXPORTER_ERROR_NOTIFY");Te=t.decodeBody(e);console.log("boardsInfoMsg:",Te);break;case r.OUTGOING_INVITE_STATUS_NOTIFY:log.debug("acception SIP_INVITE_STATUS_NOTIFY");var Le=t.decodeBody(e);console.log("outgoingInviteStatusNotify:",Le),room.eventEmitter.emit(RoomCallback.outgoing_invite_status_notify,Le.type,Le.room_id,Le.sip_addr,Le.status,Le.msg);break;case r.ROOM_SET_STREAM_NAME_RSP:log.debug("acception ROOM_SET_STREAM_NAME_RSP");var De=t.decodeBody(e);if(0==De.ret)room.eventEmitter.emit(UserCallback.room_set_stream_name_rep_success,De.id);else{var Ne=new He(De.ret,De.msg);room.eventEmitter.emit(UserCallback.room_set_stream_name_rep_error,Ne,De.id)}console.log("roomSetStreamNameRsp:",De);break;case r.ROOM_STREAM_NAME_CHANGED_NOTIFY:log.debug("acception ROOM_STREAM_NAME_CHANGED_NOTIFY");var Be=t.decodeBody(e);console.log("roomStreamNameChangedNotify",Be),(w=room.getUser(Be.user_id))&&w.id!=room.selfUser.id&&(y=w.getVideo(Be.video_resource_id))&&(y.streamName=Be.stream_name,y.streamNickName=Be.stream_nick_name);break;case r.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP:log.debug("acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP");var je=t.decodeBody(e);if(0==je.ret)room.eventEmitter.emit(ExporderCallBack.set_focus_video_rep_success,je.id);else{var Fe=new He(je.ret,je.msg);room.eventEmitter.emit(ExporderCallBack.set_focus_video_rep_error,Fe,je.id)}log.debug("outgoingExporterSetFocusVideoRsp:",je);break;case r.OUTGOING_GET_EXPORTER_INFO_RSP:log.debug("acception OUTGOING_GET_EXPORTER_INFO_RSP");var Ve=t.decodeBody(e);log.debug("outgoingGetExporterInfoRsp:",Ve);B=null;console.log("++++++++++++++++++outgoingGetExporterInfoRsp.videos:",Ve.videos),Ve.videos&&0<Ve.videos.length&&(B=t.decodeOutgoingVideoInfo(Ve.videos)),room.eventEmitter.emit(ExporderCallBack.get_exporter_info_rep_success,Ve.id,Ve,B)}},e}),ModuleBase.define("User",["Video","Audio","Screen","Board","Error"],function(n,o,i,s,r){var e=function(e,t,r,n){this.id=e,this.name=t,this.data=r,this.password=n,this.eventEmitter=new EventEmitter,this.subVideoTrack2ResourceInfo={},this.subAudioTrack2ResourceInfo={},this.subScreenTrack2ResourceInfo={},this.init()};return e.prototype.init=function(){this.nodeId=null,this.role=null,this.userAgent=null,this.stream=null,this.videos=[],this.audio,this.screen,this.boards=[],this.toMCUPC,this.toMCUPCForFirefox,this.changePublishVideoQuality=null,this.changePublishVideoQualityInterval=null,this.mulLanding=!1,this.deviceId2VideoSdpSsrc={},this.audioSdpSsrc,this.screenSdpSsrc,this.subVideoIds=[],this.subAudioIds=[],this.subScreenIds=[],this.toP2PPCs={},this.sdpP2PMap={},this.videoSdpSsrcMapP2PMap={},this.audioSdpSsrcP2PMap={},this.screenSdpSsrcP2PMap={},this.subMyVideosP2P=[],this.subMyAudiosP2P=[],this.subMyScreensP2P=[]},e.prototype.createVideo=function(e,t){var r=new n(e,t);return this.videos.push(r),r},e.prototype.createAudio=function(e,t){var r=new o(e,t);return r.ownerId=this.id,this.audio=r},e.prototype.createScreen=function(e,t){var r=new i(e,t);return this.screen=r},e.prototype.initScreen=function(){var e="screen-"+this.id,t=this.name+"-screen",r=this.createScreen(e,t);r.level=0,r.description="",r.ownerId=this.id,this.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,this.id);var n=room.composePDUDeviceId(this.id,e);room.masterServer.addScreenMsg(n,r)},e.prototype.initVideo=function(e,t){var r=this.createVideo(e,t);r.cameraType=CameraType.unknown,r.level=0,r.description="",r.ownerId=this.id,this.eventEmitter.emit(UserCallback.camera_status_notify,r.status,r.id,r.name,this.id);var n=room.composePDUDeviceId(this.id,e);room.masterServer.addWebcamMsg(n,r)},e.prototype.deleteVideo=function(e){var t=this.getVideo(e);if(null!=t){t.status==StreamStatus.opened?t.unpreview():t.status==StreamStatus.published&&t.unpublish(),arrayUtil.objectSplice(this.videos,e),this.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,t.id,t.name,this.id);var r=room.composePDUDeviceId(this.id,e);room.masterServer.removeWebcamMsg(r)}},e.prototype.initAudio=function(e,t){var r=this.createAudio(e,t);room.avdEngine.checkAudioId=e,room.avdEngine.checkAudioName=t,this.eventEmitter.emit(UserCallback.microphone_status_notify,r.status,r.id,r.name,this.id);var n=room.composePDUDeviceId(this.id,e);room.masterServer.addSpeakerMsg(n,r)},e.prototype.deleteAudio=function(e){var t=this.getAudio(e);if(null!=t){t.status==StreamStatus.published&&video.closeMicrophone(),this.audio=null,this.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,t.id,t.name,this.id);var r=room.composePDUDeviceId(this.id,e);room.masterServer.removeSpeakerMsg(r)}},e.prototype.getVideo=function(e){for(var t=null,r=0;r<this.videos.length;r++){var n=this.videos[r];if(n.id==e){t=n;break}}return t},e.prototype.getScreen=function(e){void 0===e&&(e="screen-"+this.id);var t=null;return null!=this.screen&&this.screen.id==e&&(t=this.screen),t},e.prototype.getAudio=function(e){var t=null;return null!=this.audio&&this.audio.id==e&&(t=this.audio),t},e.prototype.openCameraAndMicrophone=function(a,c,l,d){loggerReport.info("预览摄像头及发布流和打开麦克风");var u=when.defer(),p=this;return null!=a&&null==c?a.publish():null==a&&null!=c?c.openMicrophone():null!=a&&null!=c&&obtainUserMedia(c,a,function(e){var r=getRandomNum(1,3e3);a.status=StreamStatus.opened,a.track=e.videoStream.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.videoStream:room.selfUser.stream.addTrack(a.track);var t=room.composePDUDeviceId(p.id,a.id),n=p.getNewStreamByTrack(a.track);room.masterServer.videoPublishHandle(t,n,r),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==r&&((a.element=l).srcObject=n,a.status=StreamStatus.published,room.hasObject(room.pubVideos,a)||room.pubVideos.push(a),p.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,p.id))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==r&&u.reject(e)});var o=getRandomNum(30001,6e3);c.state=StreamStatus.opened,c.track=e.audioStream.getAudioTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.audioStream:room.selfUser.stream.addTrack(c.track);var i=room.composePDUDeviceId(p.id,c.id),s=p.getNewStreamByTrack(c.track);room.masterServer.audioPublishHandle(i,s,o),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==o&&((c.element=d).srcObject=s,c.status=StreamStatus.published,room.hasObject(room.pubAudios,c)||room.pubAudios.push(c),p.eventEmitter.emit(UserCallback.microphone_status_notify,c.status,c.id,c.name,p.id))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&u.reject(e)})},function(e){var t=new r(ErrorConstant.failed_access_localMedia);u.reject(t)}),u.promise},e.prototype.remotecmdPublishCamera=function(e){log.debug("remotecmdPublishCamera(),cameraId:"+e.id),loggerReport.info("命令远端用户发布某一摄像头视频, 设备Id:"+e.id);var t=room.splitUserId(e.id),r=room.getNodeId(t);room.masterServer.videoIndiction(!0,e.id,r)},e.prototype.remotecmdUnpublishCamera=function(e){log.debug("remotecmdUnpublishCamera(),cameraId:"+e),loggerReport.info("命令远端用户取消发布摄像头视频, 设备Id:"+e);var t=room.splitUserId(e),r=room.getNodeId(t);room.masterServer.videoIndiction(!1,e,r)},e.prototype.remotecmdOpenMicrophone=function(e){log.debug("remotecmdOpenMicrophone(),userId:"+e),loggerReport.info("命令远端用户打开麦克风, userId:"+e);var t=room.getUser(e),r=room.getNodeId(e);room.masterServer.audioIndiction(!0,t.audio.id,r)},e.prototype.remotecmdCloseMicrophone=function(e){log.debug("remotecmdCloseMicrophone(),userId:"+e),loggerReport.info("命令远端用户关闭麦克风, userId:"+e);var t=room.getUser(e),r=room.getNodeId(e);room.masterServer.audioIndiction(!1,t.audio.id,r)},e.prototype.updateUserName=function(e){for(var t in loggerReport.info("更新用户名称, userName:"+e),room.participants)room.participants[t].id==this.id&&(room.participants[t].name=e);room.masterServer.updateUserName(this.nodeId,e)},e.prototype.updateUserData=function(e){this.data=e,room.masterServer.updateUserDataMsg(e)},e.prototype.getUserData=function(e){if(void 0===e||null==e||""==e)return this.data;var t=room.getUser(e);return null!=t?t.data:void 0},e.prototype.attachVideoElementMediaStream=function(e,t){if("safari"!=adapter.browserDetails.browser&&null!=t){var r=t.getTracks()[0],n=this.subVideoTrack2ResourceInfo[r.id];this.getUserByVideoTrackId(r.id).getVideo(n.resource_id).element=e}e&&(e.srcObject=t)},e.prototype.attachScreenElementMediaStream=function(e,t){if(null!=t){var r=t.getTracks()[0],n=this.subScreenTrack2ResourceInfo[r.id];this.getUserByScreenTrackId(r.id).getScreen(n.resource_id).element=e}e&&(e.srcObject=t)},e.prototype.attachAudioElementMediaStream=function(e,t){if("safari"!=adapter.browserDetails.browser&&null!=t){var r=t.getTracks()[0],n=this.subAudioTrack2ResourceInfo[r.id];this.getUserByAudioTrackId(r.id).getAudio(n.resource_id).element=e}e&&(e.srcObject=t)},e.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},e.prototype.getUserByVideoTrackId=function(e){var t=this.subVideoTrack2ResourceInfo[e];if(null==t)return null;var r=t.owner_id;return room.getUserByNodeId(r)},e.prototype.getUserByAudioTrackId=function(e){var t=this.subAudioTrack2ResourceInfo[e];if(null==t)return null;var r=t.owner_id;return room.getUserByNodeId(r)},e.prototype.getUserByScreenTrackId=function(e){var t=this.subScreenTrack2ResourceInfo[e];if(null==t)return null;var r=t.owner_id;return room.getUserByNodeId(r)},e.prototype.getNewStreamByTrack=function(e){var t=null;e&&this.stream&&0<this.stream.getTracks().length&&((t=this.stream.clone()).getTracks().forEach(function(e){t.removeTrack(e)}),t.addTrack(e));return t},e.prototype.bindAudioToVideo=function(e,t){var r=when.defer();return room.masterServer.bindAudioToVideo(109,e,t),room.addCallback(EngineCallback.bind_audio2video_rep_success,function(e){109==e&&r.resolve()}),room.addCallback(EngineCallback.bind_audio2video_rep_error,function(e){109==e&&r.reject()}),r.promise},e.prototype.createBoard=function(e,t,r,n,o){var i=new s(this.id,e,t,r,n,o);return this.boards.push(i),room.boardId2userId[i.id]=this.id,room.masterServer.addBoardMsg(OperType.add,i),this.shareBoardById(i.id),i},e.prototype.getBoard=function(e){for(var t,r=0;r<this.boards.length;r++){var n=this.boards[r];if(n.id==e){t=n;break}}return t},e.prototype.getAllBoards=function(){return room.boards},e.prototype.removeBoardById=function(e){arrayUtil.objectSplice(this.boards,e),delete room.boardId2userId[e],delete room.annotation2boardId[e],room.masterServer.removeBoardMsg(OperType.remove,e)},e.prototype.closeBoardById=function(e){var t=this.getBoard(e);if(t.status!=boardStatusEnum.close){if(t.status=boardStatusEnum.close,t.annotation=null,room.annotation2boardId[e])for(var r in room.annotation2boardId[e].queueArr=[],room.annotation2boardId[e].storageArr)room.annotation2boardId[e].queueArr.push(room.annotation2boardId[e].storageArr[r]);room.masterServer.closeBoardMsg(OperType.close,e)}},e.prototype.shareBoardById=function(e){var t=this.getBoard(e);t.status!=boardStatusEnum.open&&(t.status=boardStatusEnum.open,room.annotation2boardId[e]&&room.updateAnnotationDrow(room.annotation2boardId[e].queueArr),room.masterServer.shareBoardMsg(OperType.share,e))},e.prototype.removeBoard=function(){for(var e in this.boards)delete room.boardId2userId[boards[e].id],delete room.annotation2boardId[boards[e].id];arrayUtil.objectSplice(this.boards,this.id)},e}),ModuleBase.define("Record",["RecordRestServer","Error"],function(t,o){var e=function(e){this.restServerURI=e,this.recordRestServer=new t,this.recordInfo={name:"",tag:"",roomId:"",userId:"",audioType:RecordEnum.AudioType.singleuser,videoType:RecordEnum.VideoType.mainflow,fileType:RecordEnum.FileType.mp4}};return e.prototype.createUserRecord=function(e,t){var r=when.defer();if(!t){n=new o(ErrorConstant.params_require);return r.reject(n),r.promise}if(""==t.roomId){var n=new o(ErrorConstant.roomId_required);return r.reject(n),r.promise}if(""!=t.userId)return this.recordRestServer.createUserRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var n=new o(ErrorConstant.userId_required);return r.reject(n),r.promise},e.prototype.stopRecord=function(e,t){var r=when.defer();return this.recordRestServer.stopRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.getRecord=function(e,t){var r=when.defer();return this.recordRestServer.getRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.deleteRecord=function(e,t){var r=when.defer();return this.recordRestServer.deleteRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.findRecords=function(e,t,r,n){var o=when.defer();return this.recordRestServer.findRecords(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},e}),ModuleBase.define("RecordRestServer",["Error"],function(c){var e=function(){};return e.prototype.createUserRecord=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/record/createUserRecord?accessToken="+t,i={params:r};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new c(e.result,e.err);n.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.stopRecord=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/record/stop",i={params:{id:r,accessToken:t}};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new c(e.result,e.err);n.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.getRecord=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/record/getRecord",i={params:{id:r,accessToken:t}};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new c(e.result,e.err);n.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.deleteRecord=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/record/delete",i={params:{id:r,accessToken:t}};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new c(e.result,e.err);n.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.findRecords=function(e,t,r,n,o){var i=when.defer(),s=document.location.protocol+"//"+e+"/avd/api/record/findRecords",a={params:{begin:r,count:n,filter:o,accessToken:t}};return this.fetchGet(s,a).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new c(e.result,e.err);i.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,n){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new c(e.response.status,e.response.data);n(t)}else{t=new c(1e4,e.message);n(t)}n(e)})})},e.prototype.fetchPost=function(e,t){return new Promise(function(r,n){axios.post(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new c(e.response.status,e.response.data);n(t)}else{t=new c(1e4,e.message);n(t)}n(e)})})},e}),ModuleBase.define("Live",["LiveRestServer","Error"],function(t,o){var e=function(e){this.restServerURI=e,this.liveRestServer=new t,this.liveInfo={name:"",tag:"",roomId:"",userId:"",audioType:LiveEnum.AudioType.singleuser,videoType:LiveEnum.VideoType.mainflow,publishurl:"",rtmpurl:"",hlsurl:""}};return e.prototype.createUserLive=function(e,t){var r=when.defer();if(!t){n=new o(ErrorConstant.params_require);return r.reject(n),r.promise}if(""==t.roomId){var n=new o(ErrorConstant.roomId_required);return r.reject(n),r.promise}if(""!=t.userId)return this.liveRestServer.createUserLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var n=new o(ErrorConstant.userId_required);return r.reject(n),r.promise},e.prototype.stopLive=function(e,t){var r=when.defer();return this.liveRestServer.stopLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.getLive=function(e,t){var r=when.defer();return this.liveRestServer.getLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.deleteLive=function(e,t){var r=when.defer();return this.liveRestServer.deleteLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.findLives=function(e,t,r,n){var o=when.defer();return this.liveRestServer.findLives(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},e}),ModuleBase.define("LiveRestServer",["Error"],function(c){var e=function(){};return e.prototype.createUserLive=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/live/createUserLive?accessToken="+t,i={params:r};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new c(e.result,e.err);n.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.stopLive=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/live/stop",i={params:{accessToken:t,id:r}};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new c(e.result,e.err);n.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.getLive=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/live/getLive",i={params:{accessToken:t,id:r}};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new c(e.result,e.err);n.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.deleteLive=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/live/delete",i={params:{accessToken:t,id:r}};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new c(e.result,e.err);n.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.findLives=function(e,t,r,n,o){var i=when.defer(),s=document.location.protocol+"//"+e+"/avd/api/live/findLives",a={params:{begin:r,count:n,filter:o,accessToken:t}};return this.fetchGet(s,a).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new c(e.result,e.err);i.reject(t)}}).catch(function(e){e=new c(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,n){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new c(e.response.status,e.response.data);n(t)}else{t=new c(1e4,e.message);n(t)}n(e)})})},e.prototype.fetchPost=function(e,t){return new Promise(function(r,n){axios.post(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new c(e.response.status,e.response.data);n(t)}else{t=new c(1e4,e.message);n(t)}n(e)})})},e}),ModuleBase.define("Board",["Annotation","Error"],function(r,e){var t=function(e,t,r,n,o,i,s,a){this.id=Math.uuid(),this.status=boardStatusEnum.close,this.title=i||"",this.description=s||"",this.extendData=a||"",this.userId=e,this.width=t,this.height=r,this.backgroundColor=n,this.backgroundImage=o,this.annotation};return t.prototype.setBoardId=function(e){this.id=e},t.prototype.updateBackgroundImage=function(e){this.backgroundImage=e},t.prototype.updateBackgroundColor=function(e){this.backgroundColor=e},t.prototype.updateWidthAndHeight=function(e,t){this.width=e,this.height=t},t.prototype.createAnnotation=function(){var e=when.defer();if(this.annotation)e.reject();else{var t=new r(this.id);this.annotation=t,e.resolve(this.annotation)}return e.promise},t.prototype.updateAnnotation=function(){},t.prototype.removeAnnotation=function(){this.annotation=null},t.prototype.getAnnotation=function(){return this.annotation},t}),ModuleBase.define("Annotation",["Error"],function(e){var t=function(e){this.boardId=e,this.shapeType=shapeTypeEnum.mouse,this.color="rgba(0,0,0,1)",this.lineWidth=2,this.arrowLength=10,this.arrowtype=arrowTypeEnum.end,this.fillType=fillTypeEnum.none,this.fillColor="none",this.shapeArray=[],this.redoArray=[],this.zr=null,this.annoDiv=null,this.currentIndex=-1,this.drawOrEraser=annoSelectTypeEnum.draw,this.isEraser=!1,this.otherShapeMap={},this.screenSize={width:0,height:0},this.hlightPointInfo={imgUrl:"",width:"",height:"",intervalTime:200,isSend:!0},this.hlightPointShape=null,this.textTagShape=null},M=zrender.Path.extend({type:"Successright",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/3*2,o=t.x+t.width/2,i=t.y+t.height,s=t.x+t.width,a=t.y;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(s,a)}}),k=zrender.Path.extend({type:"Failure",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y,o=t.width,i=t.height,s=r-o/2,a=r+o/2,c=n-i/2,l=n+i/2;e.moveTo(s,c),e.lineTo(a,l),e.closePath(),e.moveTo(a,c),e.lineTo(s,l),e.closePath()}}),A=zrender.Path.extend({type:"Arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/3,o=t.x,i=t.y+t.height/3*2,s=t.x+t.width/3*2,a=t.y+t.height/3*2,c=t.x+t.width/3*2,l=t.y+t.height,d=t.x+t.width,u=t.y+t.height/2,p=t.x+t.width/3*2,f=t.y,h=t.x+t.width/3*2,m=t.y+t.height/3;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(s,a),e.lineTo(c,l),e.lineTo(d,u),e.lineTo(p,f),e.lineTo(h,m),e.closePath()}}),O=zrender.Path.extend({type:"Texttag",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/4,o=t.x,i=t.y+t.height/4*3,s=t.x+t.width/5*4,a=t.y+t.height/4*3,c=t.x+t.width/5*4,l=t.y+t.height,d=t.x+t.width,u=t.y+t.height/2,p=t.x+t.width/5*4,f=t.y,h=t.x+t.width/5*4,m=t.y+t.height/4;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(s,a),e.lineTo(c,l),e.lineTo(d,u),e.lineTo(p,f),e.lineTo(h,m),e.closePath()}});function U(e){return"rgba("+e.r+","+e.g+","+e.b+","+parseFloat(e.a/255)+")"}return t.prototype.init=function(e){var a=this,c=[];function t(e){if(a.shapeType==shapeTypeEnum.eraser&&a.isEraser)for(var t in a.shapeArray)a.shapeArray[t].shape.id==e.target.id&&(console.log("mouseOverForEraser"),a.zr.remove(a.shapeArray[t].shape),room.sendRemoveAnnotation(a.boardId,a.shapeType,a.shapeArray[t].shape.id),a.shapeArray.splice(t,1))}a.annoDiv=e,a.zr=zrender.init(a.annoDiv),a.screenSize.width=parseInt(a.annoDiv.style.width),a.screenSize.height=parseInt(a.annoDiv.style.height),a.annoDiv.onmousedown=function(e){if(a.shapeType!=shapeTypeEnum.mouse&&a.shapeType!=shapeTypeEnum.hlight_point){a.shapeType==shapeTypeEnum.eraser&&(a.isEraser=!0);var r,n,o=e.clientX-this.getBoundingClientRect().left,i=e.clientY-this.getBoundingClientRect().top;(c=[]).push([o,i]);var s=null;switch(a.shapeType){case shapeTypeEnum.failure:s=new k({shape:{x:o,y:i,width:20,height:20},style:{stroke:a.color,lineWidth:a.lineWidth},onmouseover:t});break;case shapeTypeEnum.success:s=new M({shape:{x:o-10,y:i-10,width:20,height:20},style:{stroke:a.color,fill:"none",lineWidth:a.lineWidth},onmouseover:t});break;case shapeTypeEnum.arrow:s=new A({shape:{x:o-15,y:i-10,width:30,height:20},style:{stroke:a.color,fill:a.fillColor,lineWidth:a.lineWidth},onmouseover:t});break;case shapeTypeEnum.hlight_texttag:a.textTagShape?a.textTagShape.attr({shape:{x:o-40,y:i-20},style:{text:room.selfUser.name}}):(a.textTagShape=new O({shape:{x:o-40,y:i-20,width:80,height:40},style:{stroke:"red",fill:"red",text:room.selfUser.name,truncate:{outerWidth:50},lineWidth:a.lineWidth},onmouseover:t}),a.textTagShape.id=Math.uuid(),a.zr.add(a.textTagShape)),room.sendAddAnnotation(a.boardId,a.textTagShape,a.shapeType,a.color,a.lineWidth,a.arrowtype,a.fillType);break;case shapeTypeEnum.rhomb:s=new zrender.Polygon({shape:{points:[],smooth:0},style:{stroke:a.color,fill:"none",lineWidth:a.lineWidth},onmouseover:t});break;case shapeTypeEnum.line:s=new zrender.Arrowline({shape:{x1:o,y1:i,x2:o,y2:i,arrowlength:10,arrowtype:a.arrowtype},style:{stroke:a.color,lineWidth:a.lineWidth},onmouseover:t});break;case shapeTypeEnum.polyline:s=new zrender.Polyline({shape:{points:[],smooth:0},style:{stroke:a.color,lineWidth:a.lineWidth},onmouseover:t});break;case shapeTypeEnum.rect:s=new zrender.Rect({shape:{x:o,y:i},style:{stroke:a.color,fill:a.fillColor,lineWidth:a.lineWidth},onmouseover:t});break;case shapeTypeEnum.ellipse:s=new zrender.Ellipse({shape:{cx:o,cy:i,rx:0,ry:0},style:{stroke:a.color,fill:a.fillColor,lineWidth:a.lineWidth},onmouseover:t})}s&&(s.id=Math.uuid(),a.zr.add(s),a.annoDiv.onmousemove=function(e){if(a.shapeType!=shapeTypeEnum.eraser){r=e.clientX-this.getBoundingClientRect().left,n=e.clientY-this.getBoundingClientRect().top,c.push([r,n]);var t=[[o,i+(n-i)/2],[o+(r-o)/2,n],[r,i+(n-i)/2],[o+(r-o)/2,i]];switch(a.shapeType){case shapeTypeEnum.rhomb:s.attr("shape",{points:t});break;case shapeTypeEnum.line:s.attr("shape",{x2:r,y2:n});break;case shapeTypeEnum.polyline:s.attr("shape",{points:c});break;case shapeTypeEnum.rect:s.attr("shape",{width:r-o,height:n-i});break;case shapeTypeEnum.ellipse:s.attr("shape",{cx:r+(o-r)/2,cy:n+(i-n)/2,rx:Math.abs(r-o)/2,ry:Math.abs(n-i)/2})}}},a.annoDiv.onmouseup=function(){a.annoDiv.onmousemove=null,a.annoDiv.onmouseup=null,a.annoDiv.onmouseleave=null,a.shapeType!=shapeTypeEnum.eraser?(a.shapeArray.push({shape:s,shapeType:a.shapeType,color:a.color,lineWidth:a.lineWidth,arrowtype:a.arrowtype,fillType:a.fillType}),a.redoArray=[],room.sendAddAnnotation(a.boardId,s,a.shapeType,a.color,a.lineWidth,a.arrowtype,a.fillType)):a.isEraser=!1},a.annoDiv.onmouseleave=function(){if(a.annoDiv.onmousemove=null,a.annoDiv.onmouseup=null,a.annoDiv.onmouseleave=null,a.shapeType!=shapeTypeEnum.eraser){parseInt(a.annoDiv.style.width),parseInt(a.annoDiv.style.height);a.shapeArray.push({shape:s,shapeType:a.shapeType,color:a.color,lineWidth:a.lineWidth,arrowtype:a.arrowtype,fillType:a.fillType}),a.redoArray=[],room.sendAddAnnotation(a.boardId,s,a.shapeType,a.color,a.lineWidth,a.arrowtype,a.fillType)}else a.isEraser=!1})}}},t.prototype.removeToBoard=function(e){var t=this,r="userId"+e.operUserId;if(e.annotationType==shapeTypeEnum.clear){if(e.operUserId==room.selfUser.id){for(var n in t.shapeArray)t.zr.remove(t.shapeArray[n].shape);t.shapeArray=[]}else for(var n in t.otherShapeMap)if(n==r)for(var o in t.otherShapeMap[n])t.zr.remove(t.otherShapeMap[n][o].shape);delete t.otherShapeMap[r]}else if(e.annotationType==shapeTypeEnum.eraser)if(t.hlightPointShape&&t.hlightPointShape.id==e.annotationId)t.clearCurrHlightPoint();else if(t.textTagShape&&t.textTagShape.id==e.annotationId)t.clearCurrHlightPoint();else if(e.operUserId==room.selfUser.id)for(var n in t.shapeArray)t.shapeArray[n].shape.id==e.annotationId&&(t.zr.remove(t.shapeArray[n].shape),t.shapeArray.splice(n,1));else for(var n in t.otherShapeMap)if(n==r)for(var o in t.otherShapeMap[n])t.otherShapeMap[n][o].id==e.annotationId&&t.zr.remove(t.otherShapeMap[n][o].shape)},t.prototype.drawToBoard=function(e){console.log(e);var r=this,t=parseInt(e.objectBase.type),n=parseInt(e.objectBase.lineWidth),o=parseInt(e.objectBase.arrow),i=U(e.objectBase.lineColor),s=U(e.objectBase.fillColor),a=null;switch(t){case shapeTypeEnum.rhomb:var c=e.start.x,l=e.start.y,d=e.end.x,u=[[c,l+((g=e.end.y)-l)/2],[c+(d-c)/2,g],[d,l+(g-l)/2],[c+(d-c)/2,l]];a=new zrender.Polygon({shape:{points:u,smooth:0},style:{stroke:i,fill:"none",lineWidth:n},onmouseover:x});break;case shapeTypeEnum.line:var p=e.start.x,f=e.start.y,h=e.end.x,m=e.end.y;a=new zrender.Arrowline({shape:{x1:p,y1:f,x2:h,y2:m,arrowlength:10,arrowtype:o},style:{stroke:i,lineWidth:n},onmouseover:x});break;case shapeTypeEnum.failure:d=e.start.x;var g=e.start.y,v=e.end.x-e.start.x,y=e.end.y-e.start.y;a=new k({shape:{x:d,y:g,width:v,height:y},style:{stroke:i,lineWidth:n},onmouseover:x});break;case shapeTypeEnum.success:d=e.start.x,g=e.start.y,v=e.end.x-e.start.x,y=e.end.y-e.start.y;a=new M({shape:{x:d,y:g,width:v,height:y},style:{stroke:i,fill:"none",lineWidth:n},onmouseover:x});break;case shapeTypeEnum.arrow:d=e.start.x,g=e.start.y,v=e.end.x-e.start.x,y=e.end.y-e.start.y;a=new A({shape:{x:d,y:g,width:v,height:y},style:{stroke:i,fill:s,lineWidth:n},onmouseover:x});break;case shapeTypeEnum.hlight_texttag:var b=room.getUser(e.objectBase.ownerUserId);d=e.start.x,g=e.start.y,v=e.end.x-e.start.x,y=e.end.y-e.start.y;if(!b)return;r.textTagShape?r.textTagShape.attr({shape:{x:d,y:g},style:{text:b.name}}):(r.textTagShape=new O({shape:{x:d,y:g,width:v,height:y},style:{stroke:"red",fill:"red",text:b.name,truncate:{outerWidth:50},lineWidth:n},onmouseover:x}),r.zr.add(r.textTagShape),r.textTagShape.id=e.objectBase.annotationId);break;case shapeTypeEnum.polyline:var _=[];for(var S in e.points){var w=[e.points[S].x,e.points[S].y];_.push(w)}a=new zrender.Polyline({shape:{points:_,smooth:0},style:{stroke:i,lineWidth:n},onmouseover:x});break;case shapeTypeEnum.rect:d=e.start.x,g=e.start.y,v=e.end.x-e.start.x,y=e.end.y-e.start.y;a=new zrender.Rect({shape:{x:d,y:g,width:v,height:y},style:{stroke:i,fill:s,lineWidth:n},onmouseover:x});break;case shapeTypeEnum.ellipse:var E=(e.end.x-e.start.x)/2,C=(e.end.y-e.start.y)/2,T=e.start.x+E,I=e.start.y+C;a=new zrender.Ellipse({shape:{cx:T,cy:I,rx:E,ry:C},style:{stroke:i,fill:s,lineWidth:n},onmouseover:x});break;case shapeTypeEnum.hlight_point:d=e.start.x,g=e.start.y,v=r.hlightPointInfo.width,y=r.hlightPointInfo.height;r.hlightPointShape?r.hlightPointShape.attr("position",[d-v/2,g-y/2]):(r.hlightPointShape=new zrender.Image({position:[d,g],scale:[1,1],style:{image:r.hlightPointInfo.imgUrl,width:r.hlightPointInfo.width,height:r.hlightPointInfo.height},draggable:!0}),r.zr.add(r.hlightPointShape),r.hlightPointShape.id=e.objectBase.annotationId)}if(a){var R={id:e.objectBase.annotationId,shape:a};if(r.zr.add(a),a.id=e.objectBase.annotationId,e.objectBase.ownerUserId==room.selfUser.id)r.shapeArray.push({shape:a,shapeType:t,color:i,lineWidth:n,arrowtype:o,fillType:fillTypeEnum.none});else{var P="userId"+e.objectBase.ownerUserId;r.otherShapeMap[P]||(r.otherShapeMap[P]=[]),r.otherShapeMap[P].push(R)}}function x(e){if(r.shapeType==shapeTypeEnum.eraser&&r.isEraser)for(var t in r.shapeArray)r.shapeArray[t].shape.id==e.target.id&&(console.log("mouseOverForEraser"),r.zr.remove(r.shapeArray[t].shape),room.sendRemoveAnnotation(r.boardId,r.shapeType,r.shapeArray[t].shape.id),r.shapeArray.splice(t,1))}},t.prototype.setShapeType=function(e,t){this.shapeType==shapeTypeEnum.hlight_point&&this.hlightPointShape&&this.clearCurrHlightPoint(),this.shapeType==shapeTypeEnum.hlight_texttag&&this.textTagShape&&this.clearCurrHlightPoint();var r="";t&&(r="url("+t+"),auto"),this.zr.handler.proxy.cursor=r||"default",this.shapeType=parseInt(e)},t.prototype.setColor=function(e){this.color=e,"none"!=this.fillColor&&(this.fillColor=e)},t.prototype.setColorOpacity=function(e){var t=this.color.split(",");t[t.length-1]=e+")";var r=t.join(",");console.log(r),this.color=r,"none"!=this.fillColor&&(this.fillColor=r)},t.prototype.setLineWidth=function(e){this.lineWidth=parseInt(e)},t.prototype.setArrowLength=function(e){this.arrowLength=parseInt(e)},t.prototype.setArrowType=function(e){this.arrowtype=parseInt(e)},t.prototype.download=function(){var e=this.zr.dom.getElementsByTagName("canvas")[0];e&&function(e){var t=e.toDataURL("image/png");imgData=t.replace((r="png","image/"+(r=r.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]),"image/octet-stream");var r;var n="个人画板_"+(new Date).getTime()+".png";!function(e,t){var r=document.createElementNS("http://www.w3.org/1999/xhtml","a");r.href=e,r.download=t;var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(n)}(imgData,n)}(e)},t.prototype.setFillColor=function(e){(this.fillType=e)==fillTypeEnum.none?this.fillColor="none":this.fillColor=this.color},t.prototype.clear=function(){for(var e in this.shapeArray)this.zr.remove(this.shapeArray[e].shape);this.shapeArray=[],room.sendRemoveAnnotation(this.boardId,shapeTypeEnum.clear,"")},t.prototype.undo=function(){if(!(this.shapeArray.length<1)){var e=this.shapeArray.pop();this.zr.remove(e.shape),this.redoArray.push(e),room.sendRemoveAnnotation(this.boardId,shapeTypeEnum.eraser,e.shape.id)}},t.prototype.redo=function(){if(!(this.redoArray.length<1)){var e=this.redoArray.pop();this.zr.add(e.shape),this.shapeArray.push(e),room.sendAddAnnotation(this.boardId,e.shape,e.shapeType,e.color,e.lineWidth,e.arrowtype,e.fillType)}},t.prototype.hlightPointInit=function(e,t,r,n){this.hlightPointInfo.imgUrl=e,this.hlightPointInfo.width=parseInt(t)?parseInt(t):this.hlightPointInfo.width,this.hlightPointInfo.height=parseInt(r)?parseInt(r):this.hlightPointInfo.height,this.hlightPointInfo.intervalTime=parseInt(n)?parseInt(n):this.hlightPointInfo.intervalTime},t.prototype.clearCurrHlightPoint=function(){var e=this;e.hlightPointShape&&(room.sendRemoveAnnotation(e.boardId,shapeTypeEnum.eraser,e.hlightPointShape.id),e.zr.remove(e.hlightPointShape),e.hlightPointShape=null),e.textTagShape&&(room.sendRemoveAnnotation(e.boardId,shapeTypeEnum.eraser,e.textTagShape.id),e.zr.remove(e.textTagShape),e.textTagShape=null)},t.prototype.startHlightPoint=function(){var t=this;t.setShapeType(shapeTypeEnum.hlight_point);var r=t.hlightPointInfo.width,n=t.hlightPointInfo.height;t.hlightPointShape=new zrender.Image({position:[-100,-100],scale:[1,1],style:{image:t.hlightPointInfo.imgUrl,width:t.hlightPointInfo.width,height:t.hlightPointInfo.height},draggable:!0}),t.zr.add(t.hlightPointShape),t.hlightPointShape.id=Math.uuid(),t.annoDiv.onmousemove=function(e){t.shapeType==shapeTypeEnum.hlight_point&&(x=e.clientX-this.getBoundingClientRect().left,y=e.clientY-this.getBoundingClientRect().top,t.hlightPointShape.attr("position",[x-r/2,y-n/2]),t.hlightPointInfo.isSend&&(t.hlightPointInfo.isSend=!1,room.sendAddAnnotation(t.boardId,t.hlightPointShape,shapeTypeEnum.hlight_point,t.color,t.lineWidth,t.arrowtype,t.fillType),setTimeout(function(){t.hlightPointInfo.isSend=!0},t.hlightPointInfo.intervalTime)))}},t.prototype.changeScreen=function(e,t){if(this.zr&&0<this.shapeArray.length)for(var r in this.zr.resize(),this.shapeArray){var n=e/this.screenSize.width,o=t/this.screenSize.height;this.shapeArray[r].shape.animateTo({scale:[n,o]},function(){console.log("changeScreenOver")})}this.screenSize.width=e,this.screenSize.width=t},t}),ModuleBase.define("Outgoing",["OutgoingRestServer","Error"],function(t,l){var e=function(e){this.restServerURI=e,this.outgoingRestServer=new t};return e.prototype.createOutgoingUser=function(e,t,r,n,o,i,s){var a=when.defer();if(""==t){var c=new l(ErrorConstant.roomId_required);return a.reject(c),a.promise}if(""==r){c=new l(ErrorConstant.userId_required);return a.reject(c),a.promise}if(""!=o)return this.outgoingRestServer.createOutgoingUser(this.restServerURI,e,t,r,n,o,i,s).then(function(e){a.resolve(e)}).otherwise(function(e){a.reject(e)}),a.promise;c=new l(ErrorConstant.userAddress_require);return a.reject(c),a.promise},e.prototype.destroyOutgoingUser=function(e,t,r,n){var o=when.defer();return this.outgoingRestServer.destroyOutgoingUser(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},e.prototype.getOutgoingUsers=function(e,t){var r=when.defer();return this.outgoingRestServer.getOutgoingUsers(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e}),ModuleBase.define("OutgoingRestServer",["Error"],function(u){var e=function(){};return e.prototype.createOutgoingUser=function(e,t,r,n,o,i,s,a){var c=when.defer(),l=document.location.protocol+"//"+e+"/avd/api/outgoing/createOutgoingUser",d={params:{roomId:r,userAddress:i,userId:n,accessToken:t,userName:o,userData:s,options:a}};return this.fetchGet(l,d).then(function(e){if(e&&0==e.result)c.resolve(e.data);else{var t=new u(e.result,e.err);c.reject(t)}}).catch(function(e){e=new u(e.code,e.message);return c.reject(e),!1}),c.promise},e.prototype.destroyOutgoingUser=function(e,t,r,n,o){var i=when.defer(),s=document.location.protocol+"//"+e+"/avd/api/outgoing/destroyOutgoingUser",a={params:{roomId:r,userAddress:n,userId:o,accessToken:t}};return this.fetchGet(s,a).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new u(e.result,e.err);i.reject(t)}}).catch(function(e){e=new u(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.getOutgoingUsers=function(e,t,r){var n=when.defer(),o=document.location.protocol+"//"+e+"/avd/api/outgoing/getOutgoingUsers",i={params:{roomId:r,accessToken:t}};return this.fetchGet(o,i).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new u(e.result,e.err);n.reject(t)}}).catch(function(e){e=new u(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,n){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new u(e.response.status,e.response.data);n(t)}else{t=new u(1e4,e.message);n(t)}n(e)})})},e}),ModuleBase.define("StreamExporterManager",["StreamExporterServer","Error"],function(d,e){var t=function(){this.streamExporterServers=[]};return t.prototype.createServerRecorder=function(e,t,r,n,o,i,s){var a=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.record,e,t,r,n,o,i,s).then(function(e){a.resolve(e)}).otherwise(function(e){a.reject(e)}),a.promise},t.prototype.createServerRealtimeRecorder=function(e,t,r,n,o,i,s){var a=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.record_real_time,e,t,r,n,o,i,s).then(function(e){a.resolve(e)}).otherwise(function(e){a.reject(e)}),a.promise},t.prototype.createServerLivecast=function(e,t,r,n,o,i,s){var a=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.liver,e,t,r,n,o,i,s).then(function(e){a.resolve(e)}).otherwise(function(e){a.reject(e)}),a.promise},t.prototype.createExportServer=function(r,e,n,o,i,s,t,a){var c=this,l=when.defer();return t||(t=10),room.masterServer.createServerRecorder(Math.uuid(),room.id,room.selfUser.id,e,r,n,o,i,s,t,"",a).then(function(e){var t=new d;t.exporterId=e.exporter_id,t.name=e.exporter_name,t.viewWidth=n,t.viewHeight=o,t.outBitrate=i,t.outFps=s,t.playurls=e.play_urls,t.exporterType=r,c.streamExporterServers.push(t),l.resolve(t)}).otherwise(function(e){l.reject(e)}),l.promise},t.prototype.getExporter=function(e){var t=null;for(var r in streamExporterServers){var n=streamExporterServers[r];(n.exporterId=e)&&(t=n,brea)}return t},t.prototype.getStreamExporterServer=function(e,t,a){var c=when.defer();return room.masterServer.outgoingGetExporterInfo(e,t,a).then(function(e,t){var r=new d;r.exporterId=e.view_stream_id,r.name=e.exporter_name,r.viewWidth=e.view_width,r.viewHeight=e.view_height,r.outBitrate=e.view_bitrate,r.outFps=e.view_fps,r.maxVideoNumber=e.max_video_number,r.viewLayoutMode=e.layoutMode,r.exporterType=a;var n=[];if(t)for(var o in t){var i=t[o],s={userId:i.owner_user_id,deviceId:i.video_resource_id,x:i.x,y:i.y,width:i.w,height:i.h,zorder:i.zoder,data:i.video_data};n.push(s)}r.videoItems=n,c.resolve(r)}).otherwise(function(e){c.reject(e)}),c.promise},t.prototype.setFocusVideo=function(e,t,r){var n=when.defer();return room.masterServer.outgoingExporterSetFocusVideo(e,t,r).then(function(){n.resolve()}).otherwise(function(e){n.reject(e)}),n.promise},t}),ModuleBase.define("StreamExporterServer",["Error"],function(h){var e=function(){this.exporterId="",this.name="",this.appdata=null,this.exporterType=null,this.playurls="",this.viewWidth=0,this.viewHeight=0,this.outBitrate=0,this.outFps=0,this.maxVideoNumber=4,this.createTime="",this.status=exporterStatusEnum.live,this.size=0,this.desturl="",this.videoItems=[],this.audioUserId="",this.viewLayoutMode=viewLayoutModeEnum.fixation,this.pause_resume=!1};return e.prototype.updateStreamsExporter=function(t,e,r,n,o,i,s,a){var c=this,l=when.defer();return room.masterServer.createServerRecorder(e,room.id,room.selfUser.id,r,t,n,o,i,s,a,"").then(function(e){c.exporterId=e.exporter_id,c.name=e.exporter_name,c.viewWidth=n,c.viewHeight=o,c.outBitrate=i,c.outFps=s,c.playurls=e.play_urls,c.exporterType=t,l.resolve()}).otherwise(function(e){l.reject(e)}),l.promise},e.prototype.selectSingleVideo4Exporter=function(e,t,r,n){var o=when.defer();if(t.indexOf("_")<0&&(t=room.composePDUDeviceId(room.selfUser.id,t)),t.split("_")[0]!=e){var i=new h(ErrorConstant.video_and_userId_error);return o.reject(i),o.promise}if(arguments.length<3){i=new h(ErrorConstant.exporter_parameter_lack_error);o.reject(i)}else this.audioUserId=r,n||(n=""),room.masterServer.selectStream4Exporter(this.exporterId,room.id,e,t,this.audioUserId,n,this.exporterType).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)});return o.promise},e.prototype.selectMixedVideos4Exporter=function(){var t=when.defer();return room.masterServer.mixMedia4Exporter(this.exporterId,room.id,this.viewLayoutMode,this.videoItems,this.audioUserId,this.exporterType).then(function(e){t.resolve(e)}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.selectMixedVideos4ExporterStart=function(){var e=this,t=when.defer();return setTimeout(function(){e.selectMixedVideos4Exporter().then(function(e){t.resolve(e)},function(e){t.reject(e)})},0),t.promise},e.prototype.setAudioUserId=function(e){this.audioUserId=e},e.prototype.setAutoLayout=function(e){var t=when.defer(),r=!1;for(var n in viewLayoutModeEnum)if(e==viewLayoutModeEnum[n]){r=!0;break}if(r)this.viewLayoutMode=e,self.selectMixedVideos4Exporter().then(function(e){t.resolve(e)}).otherwise(function(e){t.reject(e)});else{var o=new h(ErrorConstant.exporter_parameter_type_error);t.reject(o)}return t.promise},e.prototype.addVideoItem=function(t,r,n,o,i,s,a,e,c){var l=this,d=when.defer();if(r.indexOf("_")<0&&(r=room.composePDUDeviceId(room.selfUser.id,r)),r.split("_")[0]!=t){var u=new h(ErrorConstant.video_and_userId_error);return d.reject(u),d.promise}if(arguments.length<7){u=new h(ErrorConstant.exporter_parameter_lack_error);d.reject(u)}else l.checkoutArguments(n,o,i,s,a).then(function(){var e={userId:t,deviceId:r,x:parseFloat(n),y:parseFloat(o),width:parseFloat(i),height:parseFloat(s),zorder:parseFloat(a)};l.videoItems.push(e),d.resolve()}).otherwise(function(e){d.reject(e)});return d.promise},e.prototype.removeAllVideoItem=function(){this.videoItems=[]},e.prototype.addSubVideo=function(e,t,r,n,o,i,s,a,c){var l=this,d=when.defer();if(t.indexOf("_")<0&&(t=room.composePDUDeviceId(room.selfUser.id,t)),t.split("_")[0]!=e){var u=new h(ErrorConstant.video_and_userId_error);return d.reject(u),d.promise}if(arguments.length<7){u=new h(ErrorConstant.exporter_parameter_lack_error);d.reject(u)}else{var p=!1;for(var f in l.videoItems)if(l.videoItems[f].deviceId==t){p=!0;break}if(p){u=new h(ErrorConstant.video_has_exporter_error);d.reject(u)}else l.addVideoItem(e,t,r,n,o,i,s,a,c).then(function(){l.selectMixedVideos4Exporter().then(function(e){d.resolve(e)}).otherwise(function(e){d.reject(e)})},function(e){d.reject(e)})}return d.promise},e.prototype.updataVideo=function(e,t,r){var n=!1,o=when.defer();if(r.indexOf("_")<0&&(r=room.composePDUDeviceId(room.selfUser.id,r)),r.split("_")[0]!=t){var i=new h(ErrorConstant.video_and_userId_error);return o.reject(i),o.promise}if(arguments.length<3){i=new h(ErrorConstant.exporter_parameter_lack_error);o.reject(i)}else{for(var s in this.videoItems)if(this.videoItems[s].deviceId==e){n=!0,this.videoItems[s].deviceId=r,this.videoItems[s].userId=t;break}if(n)this.selectMixedVideos4Exporter().then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)});else{i=new h(ErrorConstant.video_not_exporter_error);o.reject(i)}}},e.prototype.modSubVideo=function(e,r,n,o,i,s,a,t,c){var l=this,d=!1,u=when.defer();if(r.indexOf("_")<0&&(r=room.composePDUDeviceId(room.selfUser.id,r)),r.split("_")[0]!=e){var p=new h(ErrorConstant.video_and_userId_error);return u.reject(p),u.promise}if(arguments.length<7){p=new h(ErrorConstant.exporter_parameter_lack_error);u.reject(p)}else this.checkoutArguments(n,o,i,s,a).then(function(){for(var e in l.videoItems)if(l.videoItems[e].deviceId==r){d=!0,l.videoItems[e].x=parseFloat(n),l.videoItems[e].y=parseFloat(o),l.videoItems[e].width=parseFloat(i),l.videoItems[e].height=parseFloat(s),l.videoItems[e].zorder=parseFloat(a);break}if(d)l.selectMixedVideos4Exporter().then(function(e){u.resolve(e)}).otherwise(function(e){u.reject(e)});else{var t=new h(ErrorConstant.video_not_exporter_error);u.reject(t)}},function(e){u.reject(e)});return u.promise},e.prototype.rmvSubVideo=function(e,t){var r=!1,n=when.defer();if(t.indexOf("_")<0&&(t=room.composePDUDeviceId(room.selfUser.id,t)),t.split("_")[0]!=e){var o=new h(ErrorConstant.video_and_userId_error);return n.reject(o),n.promise}for(var i in this.videoItems)if(this.videoItems[i].deviceId==t){r=!0,this.videoItems.splice(i,1);break}if(r)this.selectMixedVideos4Exporter().then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)});else{o=new h(ErrorConstant.video_not_exporter_error);n.reject(o)}return n.promise},e.prototype.pauseResume=function(){var t=this,r=when.defer(),n=!1;if(t.status!=exporterStatusEnum.stop)return t.status==exporterStatusEnum.live&&(n=!0),room.masterServer.pauseResumeExporter(t.exporterId,room.id,n,t.exporterType).then(function(e){t.status=n?exporterStatusEnum.pause:exporterStatusEnum.live,r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var e=new h(ErrorConstant.exporter_has_stop_error);return r.reject(e),r.promise},e.prototype.stopExporter=function(){var t=this,r=when.defer();return room.masterServer.destroyExporter(t.exporterId,room.id,t.exporterType).then(function(e){t.status=exporterStatusEnum.stop,r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.checkoutArguments=function(e,t,r,n,o){var i=when.defer();if("number"!=typeof e||"number"!=typeof t||"number"!=typeof r||"number"!=typeof n||"number"!=typeof o){var s=new h(ErrorConstant.exporter_parameter_type_error);i.reject(s)}else if(1<e||e<0||1<t||t<0||1<r||r<0||1<n||n<0){s=new h(ErrorConstant.exporter_parameter_number_error);i.reject(s)}else if(o<0||10<o){s=new h(ErrorConstant.exporter_parameter_number1_error);i.reject(s)}else i.resolve();return i.promise},e}),ModuleBase.define("ElectronManager",["PeerConnection","Error"],function(l,e){var t=function(){this.electron=require("electron"),this.path=require("path"),this.remote=require("electron").remote,this.ipc=require("electron").ipcRenderer,this.BrowserWindow=this.remote.BrowserWindow,this.curWindId=this.remote.getCurrentWindow().id,this.desktopTypes=["window","screen"],this.appThumbnailSize={width:150,height:150},this.winId2PeerConnection={},this.renderPeerConnection=null,this.ipc&&this.registerElectronIPCInner()};return t.prototype.getDesktopSources=function(e,t){e&&(this.desktopTypes=e),t&&(this.appThumbnailSize=t);var r={types:this.desktopTypes,thumbnailSize:this.appThumbnailSize},s=when.defer();return this.electron.desktopCapturer.getSources(r,function(e,t){if(e)s.reject(e);else{var r=[];for(var n in t){var o=t[n];console.log("=====================source:",o);var i={sourceId:o.id,sourceName:o.name,thumbnail:o.thumbnail.toDataURL()};r.push(i)}s.resolve(r)}}),s.promise},t.prototype.getAllDisplays=function(){return this.electron.screen.getAllDisplays()},t.prototype.getPrimaryDisplay=function(){return this.electron.screen.getPrimaryDisplay()},t.prototype.getExternalDisplays=function(){var e=[],t=this.electron.screen.getAllDisplays();for(var r in t){var n=t[r];0===n.bounds.x&&0===n.bounds.y||e.push(n)}return e},t.prototype.renderToDisplay=function(e,t,r,n,o,i,s){var a=this.createWindowInner(t,r,n,o,i,s);if(a){var c=this.getPeerConnectionInner(a.id);c||((c=new l).createPeerConnectionInner(),c.startInner(e.srcObject,a,this.curWindId),this.winId2PeerConnection[a.id]=c)}return a.id},t.prototype.cancelRenderToDisplay=function(e){if(e){var t=this.getPeerConnectionInner(e);t&&(t.close(),t=null,delete this.winId2PeerConnection[e],this.remote.BrowserWindow.fromId(e).close())}},t.prototype.getRender=function(e){var t=new l(e);this.renderPeerConnection=t},t.prototype.closeRenderWindow=function(){this.remote.BrowserWindow.fromId(this.renderPeerConnection.parentWindId).webContents.send("closeWindow",this.remote.getCurrentWindow().id),this.remote.getCurrentWindow().close()},t.prototype.createWindowInner=function(e,t,r,n,o,i){var s=this,a=new this.BrowserWindow({x:e.bounds.x+r,y:e.bounds.y+n,webPreferences:{webSecurity:!1}}),c=a.id;return a.on("close",function(){s.remote.getCurrentWindow().webContents.send("closeWindow",c),a=null}),a.loadURL(t),o&&a.webContents.openDevTools(),i&&a.maximize(),a.show(),a},t.prototype.getPeerConnectionInner=function(e){return this.winId2PeerConnection[e]},t.prototype.registerElectronIPCInner=function(){var o=this;o.ipc.on("closeWindow",function(e,t){console.log("======closeWindow,winId:",t);var r=o.winId2PeerConnection[t];r&&(r.close(),r=null,delete o.winId2PeerConnection[t])}),o.ipc.on("remoteSDP",function(e,t,r){console.log("+++++++++++++++++++++++id:",t);var n=o.winId2PeerConnection[t];n&&n.setAnswerRemoteDescriptionInner(r)}),o.ipc.on("candidates",function(e,t,r){var n=o.winId2PeerConnection[t];n&&(console.log("===========remoteCandidates:",r),n.remoteCandidates=r)})},t}),ModuleBase.define("PeerConnection",["Error"],function(e){var t=function(e){this.pc=null,this.localSDP=null,this.remoteSDP=null,this.localCandidates=[],this.remoteCandidates=null,this.renderVideoElement=e,this.remote=require("electron").remote,this.ipc=require("electron").ipcRenderer,this.curWindId=this.remote.getCurrentWindow().id,this.parentWindId=null,this.subWin=null,this.remoteCandidatesIntervalId=null,this.ipc&&this.registerElectronIPCInner()};return t.prototype.createPeerConnectionInner=function(){var r=this,e=new RTCPeerConnection({iceServers:[],sdpSemantics:"plan-b"});(r.pc=e).onicecandidate=function(e){if(e.candidate){var t=JSON.stringify(e.candidate.toJSON());r.localCandidates.push(t)}else console.debug("================electron onicecandidate(),candidates:",r.localCandidates),r.subWin?r.subWin.webContents.send("candidates",r.localCandidates):r.remote.BrowserWindow.fromId(r.parentWindId).webContents.send("candidates",r.curWindId,r.localCandidates)},e.ontrack=function(e){console.debug("====ontrack(),track: ",e.track);var t=new window.MediaStream;t.addTrack(e.track),r.renderVideoElement.srcObject=t},e.oniceconnectionstatechange=function(e){console.info("electron oniceconnectionstatechange(),  iceConnectionState :"+e.target.iceConnectionState)},e.onsignalingstatechange=function(e){console.debug("electron onsignalingstatechange(),  signalingState :"+e.target.signalingState)}},t.prototype.startInner=function(r,n,e){var o=this;o.parentWindId=e,(o.subWin=n).webContents.on("did-finish-load",function(e){if(r){var t=r.getVideoTracks()[0];o.pc.addTrack(t,r)}o.createOfferInner().then(function(e){o.localSDP=e.sdp,o.setLocalDescriptionInner(e).then(function(){n.webContents.send("extrnal-show",o.parentWindId,o.localSDP)}).catch(function(e){console.error("electron setLocalDescriptionInner(),error:",e)})}).catch(function(e){console.error("electron createOfferInner(),error:",e)})})},t.prototype.registerElectronIPCInner=function(){var i=this;i.ipc.on("extrnal-show",function(e,t,r){if(i.pc||i.createPeerConnectionInner(),i.parentWindId=t,i.remoteSDP=r){var n={type:"offer",sdp:i.remoteSDP},o=new RTCSessionDescription(n);i.setRemoteDescriptionInner(o).then(function(){i.createAnswerInner().then(function(e){i.localSDP=e.sdp,i.setLocalDescriptionInner(e).then(function(){i.remote.BrowserWindow.fromId(i.parentWindId).webContents.send("remoteSDP",i.curWindId,i.localSDP)}).catch(function(e){console.error("electron setLocalDescriptionInner(),error:",e)})}).catch(function(e){console.error("electron createAnswerInner(),error:",e)})}).catch(function(e){console.error("electron setRemoteDescriptionInner(),error:",e)})}})},t.prototype.createOfferInner=function(){var e=this;return new Promise(function(t,r){e.pc.createOffer(function(e){console.log("================electron createOffer sessionDescription:",e),t(e)},function(e){console.error("============electron createOffer,error:",e),r(e)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1})})},t.prototype.createAnswerInner=function(){var e=this;return new Promise(function(t,r){e.pc.createAnswer(function(e){console.log("================electron  createAnswer sessionDescription:",e),t(e)},function(e){console.error("============electron createAnswer,error:",e),r(e)})})},t.prototype.setLocalDescriptionInner=function(r){var n=this;return new Promise(function(e,t){console.log("================ electron Local SDP:",r.sdp),n.pc.setLocalDescription(r,function(){console.debug("===============electron setLocalDescription Success"),e()},function(e){console.error("===============electron setLocalDescription error,error:",e),t(e)})})},t.prototype.setAnswerRemoteDescriptionInner=function(e){var t=new RTCSessionDescription({type:"answer",sdp:e});this.setRemoteDescriptionInner(t).then(function(){}).catch(function(e){console.error("======electron setRemoteDescription(),error:",e)})},t.prototype.setRemoteDescriptionInner=function(r){var n=this;return new Promise(function(e,t){r.sdp=r.sdp.replace(/a=inactive/g,"a=recvonly"),"answer"==r.type&&(n.subWin?r.sdp=r.sdp.replace(/a=setup:actpass/g,"a=setup:active"):r.sdp=r.sdp.replace(/a=setup:actpass/g,"a=setup:passive")),r.sdp=r.sdp.replace(/96 97 98 99 100 101 102 122 127/g,"127 96 97 98 99 100 101 102 122"),console.log("================electron Remote  SDP:",r.sdp),n.pc.setRemoteDescription(r,function(){console.debug("===============electron setRemoteDescription Success"),n.addIceCandidateInner(),e()},function(e){console.error("===============electron setRemoteDescription error,error:",e),t(e)})})},t.prototype.addIceCandidateInner=function(){var e=this;e.remoteCandidates?e.addIceCandidateHandleInner():e.remoteCandidatesIntervalId=setInterval(function(){e.remoteCandidates&&(e.addIceCandidateHandleInner(),null!=e.remoteCandidatesIntervalId&&(clearInterval(e.remoteCandidatesIntervalId),e.remoteCandidatesIntervalId=null))},500)},t.prototype.addIceCandidateHandleInner=function(){for(var e in this.remoteCandidates){var t=JSON.parse(this.remoteCandidates[e]);this.pc.addIceCandidate(t,function(){console.log("============electron addIceCandidate Success")},function(e){console.error("============electron addIceCandidate error:",e)})}},t.prototype.close=function(){this.pc&&"closed"!=this.pc.signalingState&&this.pc.close()},t}),ModuleBase.define("MqttManager",["MqttMessageManager","Error"],function(a,c){var e=function(e,t,r){this.mqttWSAddr=e,this.account=t,this.password=r};return e.prototype.connect=function(){var r=when.defer();try{var e=document.location.protocol;"http:"!=e&&"https:"!=e&&(e="http:");var t="ws://";"https:"==e&&(t="wss://");var n=t+this.mqttWSAddr;log.debug("=====mqtt webSocket URL==="+n);var o={clientId:this.account,username:this.account,password:this.password},i=mqtt.connect(n,o);console.log("======client:",i),i.on("connect",function(){console.log("mqtt connect success!"),r.resolve(i)}),i.on("error",function(e){console.log("mqtt connect error:",e);var t=new c(e.code,e.message);i.end(),r.reject(t)}),i.on("message",function(e,t){console.log([e,t]),(new a).OnWebSocketMessage(t)})}catch(e){log.info("MQTT  Operation  failed. with exception:"+e);var s=new c(ErrorConstant.websock_catch_exception);r.reject(s)}return r.promise},e}),ModuleBase.define("MqttMessageManager",["Error"],function(e){var t=function(){};return t.prototype.OnWebSocketMessage=function(e){console.log("======MqttMessageManager.OnWebSocketMessage(),payload:",e);var t=signalClient.mqttServer.mqttProtobufCoded.decodePacket(e);console.log("======MqttMessageManager.OnWebSocketMessage(),signalHeader:",t);var r=t.group_type,n=t.cmd_type,o=t.content,i=t.from,s=t.to,a=signalClient.mqttServer.signalGroupTypeEnum,c=signalClient.mqttServer.signalCmdTypeEnum;switch(r){case a.SIGNALE_GROUP_TYPE_INVITE:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_INVITE"),n){case c.SIGNALE_CMD_TYPE_INVITE:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE");var l=signalClient.mqttServer.mqttProtobufCoded.decodeInvite(o);console.log("======MqttMessageManager.OnWebSocketMessage(),invite:",l),signalClient.inviteManager.emitCallNotify(l.id,i,s,l.options);break;case c.SIGNALE_CMD_TYPE_INVITE_CANCEL:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_CANCEL");var d=signalClient.mqttServer.mqttProtobufCoded.decodeInviteCancel(o);console.log("======MqttMessageManager.OnWebSocketMessage(),decodeInviteCancel:",d),(l=signalClient.inviteManager.getInvite(d.id)).emitCallCancelNotify();break;case c.SIGNALE_CMD_TYPE_INVITE_RINGING:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_RINGING");var u=signalClient.mqttServer.mqttProtobufCoded.decodeInviteRinging(o);console.log("======MqttMessageManager.OnWebSocketMessage(),decodeInviteRinging:",u),(l=signalClient.inviteManager.getInvite(u.id)).emitCallRingingNotify();break;case c.SIGNALE_CMD_TYPE_INVITE_OK:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_OK");var p=signalClient.mqttServer.mqttProtobufCoded.decodeInviteOk(o);console.log("======MqttMessageManager.OnWebSocketMessage(),inviteOk:",p),(l=signalClient.inviteManager.getInvite(p.id)).emitCallAcceptNotify(p.options);break;case c.SIGNALE_CMD_TYPE_INVITE_REJECT:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_REJECT");var f=signalClient.mqttServer.mqttProtobufCoded.decodeInviteReject(o);console.log("======MqttMessageManager.OnWebSocketMessage(),inviteReject:",f),(l=signalClient.inviteManager.getInvite(f.id)).emitCallRejectNotify(f.reson);break;case c.SIGNALE_CMD_TYPE_INVITE_BYE:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_BYE");var h=signalClient.mqttServer.mqttProtobufCoded.decodeInviteBye(o);console.log("======MqttMessageManager.OnWebSocketMessage(),inviteBye:",h),(l=signalClient.inviteManager.getInvite(h.id)).emitCallCloseNotify(h.reson)}break;case a.SIGNALE_GROUP_TYPE_REMOTE_CONTROL:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_REMOTE_CONTROL"),n){case c.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS:log.debug("acception cmdType = SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS");var m=signalClient.mqttServer.mqttProtobufCoded.decodeMouseEvents(o);console.log("======MqttMessageManager.OnWebSocketMessage(),mouseEvents:",m),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendMouseMessage(m.eventsType,m.video_x,m.video_y,m.video_w,m.video_h);break;case c.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS:log.debug("acception cmdType = SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS");var g=signalClient.mqttServer.mqttProtobufCoded.decodeKeyBoardEvents(o);console.log("======MqttMessageManager.OnWebSocketMessage(),keyBoardEvents:",g),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendKeyboardMessage(g.eventsType,g.keyc,g.keyv)}break;case a.SIGNALE_GROUP_TYPE_MESSAGE:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_MESSAGE"),n){case c.SIGNALE_CMD_TYPE_MESSAGE_DATA:if(i==signalClient.selfUser.userId)return;var v=signalClient.mqttServer.mqttProtobufCoded.decodeMsgData(o);console.log("======MqttMessageManager.OnWebSocketMessage(),msgData:",v),signalClient.chatManager.emitReceiveMessageNotify(i,v.msg_id,v.session_type,v.session_id,v.create_time,v.msg_type,v.msg_content.toArrayBuffer())}break;case a.SIGNALE_GROUP_TYPE_RPC:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_RPC"),n){case c.SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE:var y=signalClient.mqttServer.mqttProtobufCoded.decodeRpcCallResponse(o);console.log("======MqttMessageManager.OnWebSocketMessage(),rpcCallResponse:",y),y&&signalClient.rpcManager.eventEmitter.emit(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+y.id,y.id,y.rpc_data.toArrayBuffer())}}},t}),ModuleBase.define("MqttServer",["MqttProtobufCoded","Error"],function(t,p){var e=function(e){this.signalingChannel=e,this.mqttProtobufCoded=new t,this.signalGroupTypeEnum=this.mqttProtobufCoded.getSignalGroupTypeEnum(),this.signalCmdTypeEnum=this.mqttProtobufCoded.getSignalCmdTypeEnum(),this.mouseEventsTypeEnum=this.mqttProtobufCoded.getMouseEventsTypeEnum(),this.keyboardEventsTypeEnum=this.mqttProtobufCoded.getKeyboardEventsTypeEnum(),this.keyboardVKTypeEnum=this.mqttProtobufCoded.getKeyboardVKTypeEnum()};return e.prototype.publish=function(e,t){console.debug("===========MqttServer.publish(),topic:",e),this.signalingChannel&&this.signalingChannel.publish(e,t)},e.prototype.subscribe=function(e){console.log("===========MqttServer.subscribe(),topic:",e),this.signalingChannel&&this.signalingChannel.subscribe(e)},e.prototype.unsubscribe=function(e){console.log("===========MqttServer.unsubscribe(),topic:",e),this.signalingChannel&&this.signalingChannel.unsubscribe(e)},e.prototype.end=function(){console.debug("===========MqttServer.end()"),this.signalingChannel&&this.signalingChannel.end()},e.prototype.sendInviteCall=function(e,t,r,n){console.debug("===========MqttServer.sendInviteCall()");var o=when.defer();try{var i="/u/"+r,s="";n&&(s=JSON.stringify(n));var a=this.mqttProtobufCoded.newInvite(e,s),c=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE,t,r,a);console.log("===============mqttServer.sendInviteCall(),headerBuffer:",c);var l=new Uint8Array(c);this.publish(i,l),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteCancel=function(e,t,r){console.debug("===========MqttServer.sendInviteCancel()");var n=when.defer();try{var o="/u/"+r,i=this.mqttProtobufCoded.newInviteCancel(e),s=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_CANCEL,t,r,i);console.log("===============mqttServer.sendInviteCancel(),headerBuffer:",s);var a=new Uint8Array(s);this.publish(o,a),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteRinging=function(e,t,r){console.debug("===========MqttServer.sendInviteRinging()");var n=when.defer();try{var o="/u/"+r,i=this.mqttProtobufCoded.newInviteRinging(e),s=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_RINGING,t,r,i);console.log("===============mqttServer.sendInviteRinging(),headerBuffer:",s);var a=new Uint8Array(s);this.publish(o,a),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteAccept=function(e,t,r,n){console.debug("===========MqttServer.sendInviteAccept()");var o=when.defer();try{var i="/u/"+r,s="";n&&(s=JSON.stringify(n));var a=this.mqttProtobufCoded.newInviteOk(e,s),c=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_OK,t,r,a);console.log("===============mqttServer.sendInviteAccept(),headerBuffer:",c);var l=new Uint8Array(c);this.publish(i,l),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteReject=function(e,t,r,n){console.debug("===========MqttServer.sendInviteReject()");var o=when.defer();try{var i="/u/"+r,s=this.mqttProtobufCoded.newInviteReject(e,n),a=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_REJECT,t,r,s);console.log("===============mqttServer.sendInviteReject(),headerBuffer:",a);var c=new Uint8Array(a);this.publish(i,c),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteClose=function(e,t,r,n){console.debug("===========MqttServer.sendInviteClose()");var o=when.defer();try{var i="/u/"+r,s=this.mqttProtobufCoded.newInviteBye(e,n),a=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_BYE,t,r,s);console.log("===============mqttServer.sendInviteClose(),headerBuffer:",a);var c=new Uint8Array(a);this.publish(i,c),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendMouseMessage=function(e,t,r,n,o,i,s,a){console.debug("===========MqttServer.sendMouseMessage()");var c=when.defer();try{var l="/u/"+r,d=this.mqttProtobufCoded.newMouseEvents(e,o,i,s,a,n);console.log("===============mqttServer.sendMouseMessage(),mouseEvents:",d);var u=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS,t,r,d);console.log("===============mqttServer.sendMouseMessage(),headerBuffer:",u);var p=new Uint8Array(u);this.publish(l,p),c.resolve()}catch(e){c.reject(e)}return c.promise},e.prototype.sendKeyboardMessage=function(e,t,r,n,o,i){console.debug("===========MqttServer.sendKeyboardMessage()");var s=when.defer();try{var a="/u/"+r,c=this.mqttProtobufCoded.newKeyBoardEvents(e,o,i,n);console.log("===============mqttServer.sendKeyboardMessage(),keyBoardEvents:",c);var l=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS,t,r,c);console.log("===============mqttServer.sendKeyboardMessage(),headerBuffer:",l);var d=new Uint8Array(l);this.publish(a,d),s.resolve()}catch(e){s.reject(e)}return s.promise},e.prototype.sendMsgData=function(e,t){console.debug("===========MqttServer.sendMsgData()");var r=when.defer();try{var n=typeConversionUtil.stringToUint8Array(t.content),o=this.mqttProtobufCoded.newMsgData(t.messageId,t.sessionType,t.sessionId,t.createTime,t.messageType,n);console.log("===============mqttServer.sendMsgData(),msgData:",o);var i=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_MESSAGE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_MESSAGE_DATA,t.sendUserId,t.sessionId,o);console.log("===============mqttServer.sendMsgData(),headerBuffer:",i);var s=new Uint8Array(i);this.publish(e,s),r.resolve()}catch(e){r.reject(e)}return r.promise},e.prototype.sendRpcCall=function(e,t,r,n){console.debug("===========MqttServer.sendRpcCall()");var o=when.defer(),i=Math.uuid();n.id=i;var s=JSON.stringify(n),a=typeConversionUtil.stringToUint8Array(s),c=this.mqttProtobufCoded.newRpcCallRequest(i,a);console.log("===============mqttServer.sendRpcCall(),rpcCallRequest:",c);var l=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_CALL_REQUEST,e,t,c);console.log("===============mqttServer.sendMsgData(),headerBuffer:",l);var d=new Uint8Array(l);this.publish(r,d);var u=setTimeout(function(){var e=new p(1e4,"sendRpcCall time out");o.reject(e)},5e3);return signalClient.rpcManager.addCallback(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+i,function(e,t){console.log("=========sendRpcCall().addCallback(),id:",e,"parameters:",t),e==i&&(signalClient.rpcManager.offCallback([signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+i]),o.resolve(t),clearTimeout(u))}),o.promise},e.prototype.sendRpcNotification=function(e,t,r,n){console.debug("===========MqttServer.sendRpcNotification()");var o=when.defer();try{var i=Math.uuid();n.id=i;var s=JSON.stringify(n),a=typeConversionUtil.stringToUint8Array(s),c=this.mqttProtobufCoded.newRpcNotification(i,a);console.log("===============mqttServer.sendRpcNotification(),rpcNotification:",c);var l=this.mqttProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_NOTIFICATION,e,t,rpcCallRequest);console.log("===============mqttServer.sendRpcNotification(),headerBuffer:",l);var d=new Uint8Array(l);this.publish(r,d),o.resolve()}catch(e){o.reject(e)}return o.promise},e}),ModuleBase.define("MqttProtobufCoded",[],function(){var a,e=function(){a=mqttBuilder.signal_pdu};return e.prototype.getSignalGroupTypeEnum=function(){return a.signal_group_type},e.prototype.getSignalCmdTypeEnum=function(){return a.signal_cmd_type},e.prototype.getMouseEventsTypeEnum=function(){return a.mouse_events_type},e.prototype.getKeyboardEventsTypeEnum=function(){return a.keyboard_events_type},e.prototype.getKeyboardVKTypeEnum=function(){return a.keybaord_vk_type},e.prototype.getSessionTypeEnum=function(){return a.SessionType},e.prototype.getMsgTypeEnum=function(){return a.MsgType},e.prototype.getMsgStatusEnum=function(){return a.MsgStatus},e.prototype.encodedHeader=function(e,t,r,n,o){var i=null;null!=o&&(i=o.toArrayBuffer());var s=Math.round((new Date).getTime()/1e3),a=this.newSignalHeader("1.0",e,t,s,r,n,i);return console.log("=====================encodedHeader(),signalHeader:",a),a.toArrayBuffer()},e.prototype.newSignalHeader=function(e,t,r,n,o,i,s){return new a.signal_header(e,t,r,n,o,i,s)},e.prototype.newInvite=function(e,t){return new a.Invite(e,t)},e.prototype.newInviteCancel=function(e){return new a.InviteCancel(e)},e.prototype.newInviteRinging=function(e){return new a.InviteRinging(e)},e.prototype.newInviteOk=function(e,t){return new a.InviteOk(e,t)},e.prototype.newInviteReject=function(e,t){return new a.InviteReject(e,t)},e.prototype.newInviteBye=function(e,t){return new a.InviteBye(e,t)},e.prototype.newMouseEvents=function(e,t,r,n,o,i){return new a.MouseEvents(e,t,r,n,o,i)},e.prototype.newKeyBoardEvents=function(e,t,r,n){return new a.KeyBoardEvents(e,t,r,n)},e.prototype.newMsgData=function(e,t,r,n,o,i){return new a.MsgData(e,t,r,n,o,i)},e.prototype.newMsgDataDelivered=function(e,t,r){return new a.MsgDataDelivered(e,t,r)},e.prototype.newMsgDataRead=function(e,t,r){return new a.MsgDataRead(e,t,r)},e.prototype.newMsgDataRecalled=function(e,t,r){return new a.MsgDataRecalled(e,t,r)},e.prototype.newRpcCallRequest=function(e,t){return new a.RpcCallRequest(e,t)},e.prototype.newRpcNotification=function(e,t){return new a.RpcNotification(e,t)},e.prototype.decodePacket=function(e){return a.signal_header.decode(e)},e.prototype.decodeInvite=function(e){return a.Invite.decode(e)},e.prototype.decodeInviteCancel=function(e){return a.InviteCancel.decode(e)},e.prototype.decodeInviteRinging=function(e){return a.InviteRinging.decode(e)},e.prototype.decodeInviteOk=function(e){return a.InviteOk.decode(e)},e.prototype.decodeInviteReject=function(e){return a.InviteReject.decode(e)},e.prototype.decodeInviteBye=function(e){return a.InviteBye.decode(e)},e.prototype.decodeMouseEvents=function(e){return a.MouseEvents.decode(e)},e.prototype.decodeKeyBoardEvents=function(e){return a.KeyBoardEvents.decode(e)},e.prototype.decodeMsgData=function(e){return a.MsgData.decode(e)},e.prototype.decodeRpcCallResponse=function(e){return a.RpcCallResponse.decode(e)},e}),ModuleBase.define("ClientUser",["Error"],function(e){return function(e,t){this.userId=e,this.account=e,this.password=t,this.userName}}),ModuleBase.define("InviteManager",["Invite","Error"],function(s,e){var t=function(){this.InviteManagerCallbackEnum={CALL_NOTIFY:"call.notify"},this.invites={},this.eventEmitter=new EventEmitter};return t.prototype.createInvite=function(e,t,r){var n=new s(e,t,r);return this.invites[n.inviteId]=n},t.prototype.getInvite=function(e){return this.invites[e]},t.prototype.call=function(e){var t=when.defer();return e.callInner().then(function(){log.debug("=============InviteManager.call(),success"),t.resolve()}).otherwise(function(e){log.debug("=============InviteManager.call(),error:",e),t.reject(e)}),t.promise},t.prototype.emitCallNotify=function(e,t,r,n){var o=null;n&&(o=JSON.parse(n));var i=new s(r,t,o);i.inviteId=e,(this.invites[i.inviteId]=i).onCallTimeOutInner(),this.eventEmitter.emit(this.InviteManagerCallbackEnum.CALL_NOTIFY,i)},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t}),ModuleBase.define("Invite",["Error"],function(e){var t=function(e,t,r){this.InviteCallbackEnum={CALL_ACCEPT_NOTIFY:"call.accept.notify",CALL_REJECT_NOTIFY:"call.reject.notify",CALL_TIMEOUT_NOTIFY:"call.timeout.notify",CALL_RINGING_NOTIFY:"call.ringing.notify",CALL_CANCEL_NOTIFY:"call.cancel.notify",RESPONSE_CALL_TIMEOUT_NOTIFY:"response.call.timeout.notify",CALL_CLOSE_NOTIFY:"call.close.notify"},this.eventEmitter=new EventEmitter,this.inviteId=++Task_Id,this.fromUserId=e,this.toUserId=t,this.options=r,this.callTimeout=6e4,this.callBaseTime=null,this.callTimeoutIntervalId=null,this.onCallTimeout=55e3,this.onCallBaseTime=null,this.onCallTimeoutIntervalId=null};return t.prototype.callInner=function(){console.debug("===========invite.callInner()");var e=this;null==e.callBaseTime&&(e.callBaseTime=new Date),e.callTimeoutIntervalId=setInterval(function(){new Date-e.callBaseTime>=e.callTimeout&&(e.clearanceInner(),e.eventEmitter.emit(e.InviteCallbackEnum.CALL_TIMEOUT_NOTIFY,e.toUserId))},500);var t=when.defer();return signalClient.mqttServer.sendInviteCall(e.inviteId,e.fromUserId,e.toUserId,e.options).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.onCallTimeOutInner=function(){console.debug("===========invite.onCallTimeOutInner()");var e=this;null==e.onCallBaseTime&&(e.onCallBaseTime=new Date),e.onCallTimeoutIntervalId=setInterval(function(){new Date-e.onCallBaseTime>=e.onCallTimeout&&(e.clearanceInnerOnCall(),e.eventEmitter.emit(e.InviteCallbackEnum.RESPONSE_CALL_TIMEOUT_NOTIFY,e.fromUserId))},500)},t.prototype.clearanceInner=function(){clearInterval(this.callTimeoutIntervalId),this.callTimeoutIntervalId=null,this.callBaseTime=null},t.prototype.clearanceInnerOnCall=function(){clearInterval(this.onCallTimeoutIntervalId),this.onCallTimeoutIntervalId=null,this.onCallBaseTime=null},t.prototype.cancel=function(){var t=when.defer(),e=this;return signalClient.mqttServer.sendInviteCancel(e.inviteId,e.fromUserId,e.toUserId).then(function(){e.clearanceInner(),t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.ringing=function(){var t=when.defer();return signalClient.mqttServer.sendInviteRinging(this.inviteId,this.fromUserId,this.toUserId).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.accept=function(e){var t=this,r=when.defer();return signalClient.mqttServer.sendInviteAccept(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.reject=function(e){var t=this,r=when.defer();return signalClient.mqttServer.sendInviteReject(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.close=function(e){var t=this,r=when.defer();return signalClient.mqttServer.sendInviteClose(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInner(),t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.emitCallCancelNotify=function(){this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CANCEL_NOTIFY,this.toUserId)},t.prototype.emitCallRingingNotify=function(){this.callBaseTime=new Date,this.eventEmitter.emit(this.InviteCallbackEnum.CALL_RINGING_NOTIFY,this.toUserId)},t.prototype.emitCallAcceptNotify=function(e){this.clearanceInner();var t=null;e&&(t=JSON.parse(e)),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_ACCEPT_NOTIFY,this.toUserId,t)},t.prototype.emitCallRejectNotify=function(e){this.clearanceInner(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_REJECT_NOTIFY,this.toUserId,e)},t.prototype.emitCallCloseNotify=function(e){this.clearanceInner(),this.clearanceInnerOnCall(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CLOSE_NOTIFY,this.fromUserId,e)},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t}),ModuleBase.define("RemoteControlManager",["Error"],function(e){var t=function(){this.MouseEventsTypeEnum={WM_MOUSEMOVE:512,WM_LBUTTONDOWN:513,WM_LBUTTONUP:514,WM_LBUTTONDBLCLK:515,WM_RBUTTONDOWN:516,WM_RBUTTONUP:517,WM_RBUTTONDBLCLK:518,WM_MBUTTONDOWN:519,WM_MBUTTONUP:520,WM_MBUTTONDBLCLK:521,WM_MOUSEWHEEL:522},this.KeyboardEventsTypeEnum={WM_KEYDOWN:256,WM_KEYUP:257,WM_CHAR:258},this.KeyboardVKTypeEnum={VK_BACK:8,VK_TAB:9,VK_SHIFT:16,VK_CONTROL:17,VK_MENU:18,VK_PAUSE:19,VK_CAPITAL:20,VK_KANA:21,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_ESCAPE:27,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SPACE:32,VK_PRIOR:33,VK_NEXT:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SNAPSHOT:44,VK_INSERT:45,VK_DELETE:46,VK_HELP:47},this.RemoteControlManagerCallbackEnum={MOUSE_EVENTS_NOTIFY:"mouse.events.notify",KEYBOARD_EVENTS_NOTIFY:"KeyBoard.events.notify"},this.fromUserId="",this.toUserId="",this.baseRemotectrl=null};return t.prototype.setBaseRemotectrl=function(e){this.baseRemotectrl=e},t.prototype.setFromUserAndToUser=function(e,t){this.fromUserId=e,this.toUserId=t},t.prototype.sendMouseMessage=function(e,t,r,n,o){var i=++Task_Id,s=when.defer();return signalClient.mqttServer.sendMouseMessage(i,this.fromUserId,this.toUserId,e,t,r,n,o).then(function(){s.resolve()}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.sendKeyboardMessage=function(e,t,r){var n=++Task_Id,o=when.defer();return signalClient.mqttServer.sendKeyboardMessage(n,this.fromUserId,this.toUserId,e,t,r).then(function(){o.resolve()}).otherwise(function(e){o.reject(e)}),o.promise},t}),ModuleBase.define("ChatManager",["Message","Error"],function(l,e){var t=function(){this.ChatManagerCallbackEnum={RECEIVE_MESSAGE_NOTIFY:"receive.message.notify",MESSAGE_STATUS_CHANGED_NOTIFY:"message.status.changed.notify"},this.SessionTypeEnum={peers:1,group:2,chatroom:3},this.MessageTypeEnum={text:1,image:2,file:3,audio:4,video:5,location:6},this.MessageStatussEnum={delivering:1,delivered:2,read:3,failed:4,recalled:5},this.eventEmitter=new EventEmitter};return t.prototype.registerGroups=function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t];signalClient.mqttServer.subscribe("/g/"+r)}},t.prototype.unregisterGroup=function(e){e&&signalClient.mqttServer.unsubscribe("/g/"+e)},t.prototype.newTextMessage=function(e,t,r){var n=Math.uuid(),o=new l(n,e,t);return o.sendUserId=signalClient.selfUser.userId,o.messageType=this.MessageTypeEnum.text,o.content=r,o.createTime=signalClient.getServeTime(),o.status=this.MessageStatussEnum.delivering,o},t.prototype.sendMessage=function(e){var t=when.defer(),r="/u/"+e.sessionId;return e.sessionType!=this.SessionTypeEnum.peers&&(r="/g/"+e.sessionId),signalClient.mqttServer.sendMsgData(r,e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.emitReceiveMessageNotify=function(e,t,r,n,o,i,s){var a=new l(t,r,n);a.sendUserId=e,a.messageType=i;var c=new Uint8Array(s);a.content=typeConversionUtil.Uint8ArrayToString(c),a.createTime=o,a.status=this.MessageStatussEnum.delivered,this.eventEmitter.emit(this.ChatManagerCallbackEnum.RECEIVE_MESSAGE_NOTIFY,a)},t.prototype.sendImageMessage=function(e,t,r,n){},t.prototype.sendFileMessage=function(e,t,r,n){},t.prototype.sendAudioMessage=function(e,t,r,n){},t.prototype.readMessage=function(e){},t.prototype.recallMessage=function(e){},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.off(r)}},t}),ModuleBase.define("Message",["Error"],function(e){return function(e,t,r){this.messageId=e,this.sessionType=t,this.sessionId=r,this.sendUserId=null,this.messageType=null,this.content=null,this.createTime=null,this.status=null}}),ModuleBase.define("RpcManager",["Error"],function(s){var e=function(){this.RpcManagerCallbackEnum={CALL_RESPONSE_SUCCESS:"call.response.success",CALL_RESPONSE_ERROR:"call.response.error"},this.eventEmitter=new EventEmitter};return e.prototype.call=function(e){var i=when.defer(),t=signalClient.selfUser.userId;return signalClient.mqttServer.sendRpcCall(t,"root","/s",e).then(function(e){console.log("=========RpcManager.call(),result rpcData:",e);var t=new Uint8Array(e),r=typeConversionUtil.Uint8ArrayToString(t),n=JSON.parse(r);if(console.log("=========RpcManager.call(),result Json:",n),n.error){var o=new s(n.error.code,n.error.message);i.reject(o)}else i.resolve(n.result)}).otherwise(function(e){i.reject(e)}),i.promise},e.prototype.notification=function(e){var t=when.defer(),r=signalClient.selfUser.userId;return signalClient.mqttServer.sendRpcNotification(r,"root","/s",e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},e.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.removeAllListeners(r)}},e}),!log)var log=log4javascript.getLogger();if(!bugout)var bugout=null;var signalClient=null,Task_Id=0,mqttVersion="1.0.0.0";ModuleBase.define("Client",["RestServer","MqttManager","MqttServer","ClientUser","InviteManager","RemoteControlManager","ChatManager","RpcManager","Error"],function(r,t,s,a,e,n,o,i,c){var l=function(e,t){this.serverURI=e,this.accessToken=t,this.mqttWSAddr=null,this.restServer=new r,this.mqttManager=null,this.mqttServer=null,this.inviteManager=null,this.remoteControlManager=null,this.chatManager=null,this.rpcManager=null,this.selfUser=null,signalClient=this};return l.prototype.getVersion=function(){return"cn.tee3.mqtt-"+mqttVersion},l.prototype.setLog=function(e,t){var r,n,o;e==Appender.alert?r=new log4javascript.AlertAppender:e==Appender.inpage?r=new log4javascript.InPageAppender:e==Appender.popup?r=new log4javascript.PopUpAppender:e==Appender.browserConsole&&(r=new log4javascript.BrowserConsoleAppender),t==LogLevel.all?r.setThreshold(log4javascript.Level.ALL):t==LogLevel.trace?r.setThreshold(log4javascript.Level.TRACE):t==LogLevel.debug?r.setThreshold(log4javascript.Level.DEBUG):t==LogLevel.info?r.setThreshold(log4javascript.Level.INFO):t==LogLevel.warn?r.setThreshold(log4javascript.Level.WARN):t==LogLevel.error?r.setThreshold(log4javascript.Level.ERROR):t==LogLevel.fatal?r.setThreshold(log4javascript.Level.FATAL):t==LogLevel.off&&r.setThreshold(log4javascript.Level.OFF),n=r,o=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n"),n.setLayout(o),log.addAppender(n)},l.prototype.login=function(r,n){var o=when.defer(),i=this;return i.restServer.getMqttWSAddr(i.serverURI,i.accessToken).then(function(e){console.log("login resule  mqttWSAddr:",e),i.mqttWSAddr=e,i.mqttManager=new t(i.mqttWSAddr,r,n),i.mqttManager.connect().then(function(e){signalClient.mqttServer=new s(e),signalClient.mqttServer.subscribe("/u/"+r);var t=new a(r,n);i.selfUser=t,o.resolve()}).otherwise(function(e){o.reject(e)})}).otherwise(function(e){console.log("login error:",e),o.reject(e)}),o.promise},l.prototype.logout=function(e){var t=when.defer();try{this.mqttServer.end(),signalClient=null,this.selfUser=null,t.resolve()}catch(e){t.reject(e)}return t.promise},l.prototype.getInviteManager=function(){return this.inviteManager||(this.inviteManager=new e),this.inviteManager},l.prototype.getRemoteControlManager=function(){return this.remoteControlManager||(this.remoteControlManager=new n),this.remoteControlManager},l.prototype.getChatManager=function(){return this.chatManager||(this.chatManager=new o),this.chatManager},l.prototype.getRpcManager=function(){return this.rpcManager||(this.rpcManager=new i),this.rpcManager},l.prototype.getServeTime=function(){var e=new Date;e.setMinutes(e.getMinutes()+e.getTimezoneOffset());var t=e.getTime();return t=Math.round(t/1e3)},l.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},l.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.off(r)}},l}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.axios=t():e.axios=t()}(this,function(){return function(r){function n(e){if(o[e])return o[e].exports;var t=o[e]={exports:{},id:e,loaded:!1};return r[e].call(t.exports,t,t.exports,n),t.loaded=!0,t.exports}var o={};return n.m=r,n.c=o,n.p="",n(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function n(e){var t=new s(e),r=i(s.prototype.request,t);return o.extend(r,s.prototype,t),o.extend(r,t),r}var o=r(2),i=r(3),s=r(4),a=r(5),c=n(a);c.Axios=s,c.create=function(e){return n(o.merge(a,e))},c.Cancel=r(22),c.CancelToken=r(23),c.isCancel=r(19),c.all=function(e){return Promise.all(e)},c.spread=r(24),e.exports=c,e.exports.default=c},function(e,t,r){"use strict";function i(e){return"[object Array]"===c.call(e)}function n(e){return null!==e&&"object"==typeof e}function o(e){return"[object Function]"===c.call(e)}function s(e,t){if(null!=e)if("object"==typeof e||i(e)||(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var a=r(3),c=Object.prototype.toString;e.exports={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===c.call(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:n,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===c.call(e)},isFile:function(e){return"[object File]"===c.call(e)},isBlob:function(e){return"[object Blob]"===c.call(e)},isFunction:o,isStream:function(e){return n(e)&&o(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement},forEach:s,merge:function r(){function e(e,t){"object"==typeof n[t]&&"object"==typeof e?n[t]=r(n[t],e):n[t]=e}for(var n={},t=0,o=arguments.length;t<o;t++)s(arguments[t],e);return n},extend:function(r,e,n){return s(e,function(e,t){r[t]=n&&"function"==typeof e?a(e,n):e}),r},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t){"use strict";e.exports=function(r,n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(n,e)}}},function(e,t,r){"use strict";function o(e){this.defaults=e,this.interceptors={request:new s,response:new s}}var n=r(5),i=r(2),s=r(16),a=r(17),c=r(20),l=r(21);o.prototype.request=function(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(n,this.defaults,{method:"get"},e)).baseURL&&!c(e.url)&&(e.url=l(e.baseURL,e.url));var t=[a,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},i.forEach(["delete","get","head"],function(r){o.prototype[r]=function(e,t){return this.request(i.merge(t||{},{method:r,url:e}))}}),i.forEach(["post","put","patch"],function(n){o.prototype[n]=function(e,t,r){return this.request(i.merge(r||{},{method:n,url:e,data:t}))}}),e.exports=o},function(e,t,r){"use strict";function n(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var o,i=r(2),s=r(6),a=/^\)\]\}',?\n/,c={"Content-Type":"application/x-www-form-urlencoded"},l={adapter:("undefined"!=typeof XMLHttpRequest?o=r(7):"undefined"!=typeof process&&(o=r(7)),o),transformRequest:[function(e,t){return s(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(n(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(n(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e){e=e.replace(a,"");try{e=JSON.parse(e)}catch(e){}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&e<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},i.forEach(["delete","get","head"],function(e){l.headers[e]={}}),i.forEach(["post","put","patch"],function(e){l.headers[e]=i.merge(c)}),e.exports=l},function(e,t,r){"use strict";var o=r(2);e.exports=function(r,n){o.forEach(r,function(e,t){t!==n&&t.toUpperCase()===n.toUpperCase()&&(r[n]=e,delete r[t])})}},function(e,t,p){"use strict";var f=p(2),h=p(8),m=p(11),g=p(12),v=p(13),y=p(9),b="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||p(14);e.exports=function(u){return new Promise(function(r,n){var o=u.data,i=u.headers;f.isFormData(o)&&delete i["Content-Type"];var s=new XMLHttpRequest,e="onreadystatechange",a=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in s||v(u.url)||(s=new window.XDomainRequest,e="onload",a=!0,s.onprogress=function(){},s.ontimeout=function(){}),u.auth){var t=u.auth.username||"",c=u.auth.password||"";i.Authorization="Basic "+b(t+":"+c)}if(s.open(u.method.toUpperCase(),m(u.url,u.params,u.paramsSerializer),!0),s.timeout=u.timeout,s[e]=function(){if(s&&(4===s.readyState||a)&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))){var e="getAllResponseHeaders"in s?g(s.getAllResponseHeaders()):null,t={data:u.responseType&&"text"!==u.responseType?s.response:s.responseText,status:1223===s.status?204:s.status,statusText:1223===s.status?"No Content":s.statusText,headers:e,config:u,request:s};h(r,n,t),s=null}},s.onerror=function(){n(y("Network Error",u)),s=null},s.ontimeout=function(){n(y("timeout of "+u.timeout+"ms exceeded",u,"ECONNABORTED")),s=null},f.isStandardBrowserEnv()){var l=p(15),d=(u.withCredentials||v(u.url))&&u.xsrfCookieName?l.read(u.xsrfCookieName):void 0;d&&(i[u.xsrfHeaderName]=d)}if("setRequestHeader"in s&&f.forEach(i,function(e,t){void 0===o&&"content-type"===t.toLowerCase()?delete i[t]:s.setRequestHeader(t,e)}),u.withCredentials&&(s.withCredentials=!0),u.responseType)try{s.responseType=u.responseType}catch(e){if("json"!==s.responseType)throw e}"function"==typeof u.onDownloadProgress&&s.addEventListener("progress",u.onDownloadProgress),"function"==typeof u.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",u.onUploadProgress),u.cancelToken&&u.cancelToken.promise.then(function(e){s&&(s.abort(),n(e),s=null)}),void 0===o&&(o=null),s.send(o)})}},function(e,t,r){"use strict";var o=r(9);e.exports=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(o("Request failed with status code "+r.status,r.config,null,r)):e(r)}},function(e,t,r){"use strict";var i=r(10);e.exports=function(e,t,r,n){var o=new Error(e);return i(o,t,r,n)}},function(e,t){"use strict";e.exports=function(e,t,r,n){return e.config=t,r&&(e.code=r),e.response=n,e}},function(e,t,r){"use strict";function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var s=r(2);e.exports=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(s.isURLSearchParams(t))n=t.toString();else{var o=[];s.forEach(t,function(e,t){null!=e&&(s.isArray(e)&&(t+="[]"),s.isArray(e)||(e=[e]),s.forEach(e,function(e){s.isDate(e)?e=e.toISOString():s.isObject(e)&&(e=JSON.stringify(e)),o.push(i(t)+"="+i(e))}))}),n=o.join("&")}return n&&(e+=(-1===e.indexOf("?")?"?":"&")+n),e}},function(e,t,r){"use strict";var i=r(2);e.exports=function(e){var t,r,n,o={};return e&&i.forEach(e.split("\n"),function(e){n=e.indexOf(":"),t=i.trim(e.substr(0,n)).toLowerCase(),r=i.trim(e.substr(n+1)),t&&(o[t]=o[t]?o[t]+", "+r:r)}),o}},function(e,t,r){"use strict";var s=r(2);e.exports=s.isStandardBrowserEnv()?function(){function r(e){var t=e;return o&&(i.setAttribute("href",t),t=i.href),i.setAttribute("href",t),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}var n,o=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");return n=r(window.location.href),function(e){var t=s.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0}},function(e,t){"use strict";function a(){this.message="String contains an invalid character"}(a.prototype=new Error).code=5,a.prototype.name="InvalidCharacterError",e.exports=function(e){for(var t,r,n=String(e),o="",i=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.charAt(0|i)||(s="=",i%1);o+=s.charAt(63&t>>8-i%1*8)){if(255<(r=n.charCodeAt(i+=.75)))throw new a;t=t<<8|r}return o}},function(e,t,r){"use strict";var a=r(2);e.exports=a.isStandardBrowserEnv()?{write:function(e,t,r,n,o,i){var s=[];s.push(e+"="+encodeURIComponent(t)),a.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),a.isString(n)&&s.push("path="+n),a.isString(o)&&s.push("domain="+o),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";function n(){this.handlers=[]}var o=r(2);n.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(t){o.forEach(this.handlers,function(e){null!==e&&t(e)})},e.exports=n},function(e,t,r){"use strict";function n(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var o=r(2),i=r(18),s=r(19),a=r(5);e.exports=function(t){return n(t),t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=o.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),o.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||a.adapter)(t).then(function(e){return n(t),e.data=i(e.data,e.headers,t.transformResponse),e},function(e){return s(e)||(n(t),e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(e,t,r){"use strict";var n=r(2);e.exports=function(t,r,e){return n.forEach(e,function(e){t=e(t,r)}),t}},function(e,t){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t){"use strict";e.exports=function(e,t){return e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")}},function(e,t){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},function(e,t,r){"use strict";function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new o(e),t(r.reason))})}var o=r(22);n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var t;return{token:new n(function(e){t=e}),cancel:t}},e.exports=n},function(e,t){"use strict";e.exports=function(t){return function(e){return t.apply(null,e)}}}])});